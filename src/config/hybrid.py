#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
⚙️ КОНФИГУРАЦИЯ ГИБРИДНОЙ СИСТЕМЫ
Настройки для умного rate limiting и кэширования
"""

# =============================================================================
# RATE LIMITING НАСТРОЙКИ
# =============================================================================

# Лимиты для API (запросов в минуту)
API_RATE_LIMITS = {
    "binance": {
        "max_per_minute": 10,      # Консервативный лимит
        "min_interval": 6.0,        # 6 секунд между запросами
        "timeout": 10,              # Таймаут запроса
        "retry_attempts": 3        # Количество повторных попыток
    },
    "coingecko": {
        "max_per_minute": 3,        # Очень консервативный
        "min_interval": 20.0,       # 20 секунд между запросами
        "timeout": 15,
        "retry_attempts": 2
    },
    "bybit": {
        "max_per_minute": 8,
        "min_interval": 7.5,
        "timeout": 10,
        "retry_attempts": 3
    },
    "okx": {
        "max_per_minute": 8,
        "min_interval": 7.5,
        "timeout": 10,
        "retry_attempts": 3
    }
}

# =============================================================================
# КЭШИРОВАНИЕ НАСТРОЙКИ
# =============================================================================

# TTL для разных типов данных (секунды)
CACHE_TTL = {
    "ohlc": 300,        # 5 минут для OHLC данных
    "price": 60,        # 1 минута для цен
    "volume": 300,      # 5 минут для объемов
    "anomaly": 600,     # 10 минут для аномалий
    "news": 3600        # 1 час для новостей
}

# TTL по приоритетам символов
PRIORITY_TTL = {
    "critical": 30,     # 30 секунд для критических (BTC, ETH, BNB)
    "high": 60,         # 1 минута для высоких
    "medium": 120,      # 2 минуты для средних
    "low": 300          # 5 минут для низких
}

# Максимальный размер кэша
MAX_CACHE_SIZE = 1000

# =============================================================================
# ПРИОРИТЕТЫ СИМВОЛОВ
# =============================================================================

SYMBOL_PRIORITIES = {
    "critical": [
        "BTCUSDT", "ETHUSDT", "BNBUSDT"
    ],
    "high": [
        "ADAUSDT", "SOLUSDT", "DOTUSDT", "LINKUSDT", "UNIUSDT", "SNXUSDT"
    ],
    "medium": [
        "DASHUSDT", "NEARUSDT", "WIFUSDT", "AAVEUSDT"
    ],
    "low": [
        "FETUSDT", "TRUMPUSDT", "ZENUSDT"
    ]
}

# =============================================================================
# ФОНОВОЕ ОБНОВЛЕНИЕ
# =============================================================================

# Интервалы обновления по приоритетам (секунды)
UPDATE_INTERVALS = {
    "critical": 30,     # 30 секунд для критических
    "high": 60,         # 1 минута для высоких
    "medium": 120,      # 2 минуты для средних
    "low": 300          # 5 минут для низких
}

# Максимальный возраст данных перед принудительным обновлением
MAX_DATA_AGE = {
    "critical": 30,     # 30 секунд
    "high": 60,         # 1 минута
    "medium": 120,      # 2 минуты
    "low": 300          # 5 минут
}

# =============================================================================
# ОБРАБОТКА СИГНАЛОВ
# =============================================================================

# Интервал проверки сигналов (секунды)
SIGNAL_CHECK_INTERVAL = 30

# Максимальное количество символов для одновременной обработки
MAX_CONCURRENT_SYMBOLS = 6  # Максимум 6 позиций одновременно

# Задержка между символами (секунды)
SYMBOL_PROCESSING_DELAY = 0.1

# =============================================================================
# МОНИТОРИНГ И ЛОГИРОВАНИЕ
# =============================================================================

# Интервал сбора статистики (секунды)
STATS_COLLECTION_INTERVAL = 60

# Интервал очистки кэша (секунды)
CACHE_CLEANUP_INTERVAL = 300

# Уровень логирования
LOG_LEVEL = "INFO"

# =============================================================================
# FALLBACK НАСТРОЙКИ
# =============================================================================

# Включить fallback к кэшу при ошибках API
ENABLE_CACHE_FALLBACK = True

# Включить graceful degradation
ENABLE_GRACEFUL_DEGRADATION = True

# Максимальное время ожидания API (секунды)
API_TIMEOUT = 10

# =============================================================================
# ТЕЛЕГРАМ НАСТРОЙКИ
# =============================================================================

# Задержка между сообщениями в Telegram (секунды)
TELEGRAM_MESSAGE_DELAY = 0.1

# Максимальное количество повторных попыток отправки
TELEGRAM_MAX_RETRIES = 3

# Таймаут отправки сообщения (секунды)
TELEGRAM_TIMEOUT = 5

# =============================================================================
# ПРОИЗВОДИТЕЛЬНОСТЬ
# =============================================================================

# Включить асинхронную обработку
ENABLE_ASYNC_PROCESSING = True

# Количество воркеров для обработки
WORKER_COUNT = 4

# Размер батча для обработки
BATCH_SIZE = 5

# =============================================================================
# БЕЗОПАСНОСТЬ
# =============================================================================

# Максимальное количество ошибок подряд перед остановкой
MAX_CONSECUTIVE_ERRORS = 10

# Время восстановления после ошибок (секунды)
ERROR_RECOVERY_TIME = 60

# Включить circuit breaker
ENABLE_CIRCUIT_BREAKER = True

# Порог срабатывания circuit breaker
CIRCUIT_BREAKER_THRESHOLD = 5
