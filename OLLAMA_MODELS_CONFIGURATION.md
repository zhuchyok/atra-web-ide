# ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Ollama –º–æ–¥–µ–ª–µ–π - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–î–∞—Ç–∞:** 2026-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ù–ê–°–¢–†–û–ï–ù–û**

---

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π –≤ Ollama

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –º–æ–¥–µ–ª–∏:
- ‚úÖ `moondream` (1.6 GB) - –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- ‚è≥ `llava:7b` (4.7 GB) - –¥–ª—è PDF –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚è≥ `phi3.5:3.8b` (2.5 GB) - –±—ã—Å—Ç—Ä–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

#### `local_router.py`:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `OLLAMA_MODELS` —Å–ª–æ–≤–∞—Ä—å —Å –º–æ–¥–µ–ª—è–º–∏ Ollama
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `MODEL_MAP` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `phi3.5:3.8b` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `_select_model()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Ollama –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω fallback –Ω–∞ Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX

#### `vision_processor.py`:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `_process_with_ollama_fallback()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `llava:7b` –¥–ª—è PDF
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `process_pdf_page()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF —Å—Ç—Ä–∞–Ω–∏—Ü

---

## üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π

### Ollama –º–æ–¥–µ–ª–∏ (OLLAMA_MODELS):

```python
OLLAMA_MODELS = {
    "fast": "phi3.5:3.8b",      # –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å (2.5 GB)
    "vision": "moondream",       # Vision –º–æ–¥–µ–ª—å (1.6 GB)
    "vision_pdf": "llava:7b",    # Vision –¥–ª—è PDF (4.7 GB)
    "default": "phi3.5:3.8b"     # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
}
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

1. **MLX –º–æ–¥–µ–ª–∏** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)
2. **Ollama –º–æ–¥–µ–ª–∏** (fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX)
3. **–û–±–ª–∞—á–Ω—ã–µ –º–æ–¥–µ–ª–∏** (–ø–æ—Å–ª–µ–¥–Ω–∏–π fallback)

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç fallback

### –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á:

1. –ü—Ä–æ–±—É–µ—Ç MLX API Server (–ø–æ—Ä—Ç 11435)
2. –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama —Å `phi3.5:3.8b`
3. –ï—Å–ª–∏ Ollama –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –≤ –æ–±–ª–∞–∫–æ

### –î–ª—è vision –∑–∞–¥–∞—á:

1. –ü—Ä–æ–±—É–µ—Ç Moondream Station (MLX, –ø–æ—Ä—Ç 2020)
2. –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama —Å `moondream`
3. –î–ª—è PDF ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama —Å `llava:7b`
4. –ï—Å–ª–∏ Ollama –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí fallback –≤ –æ–±–ª–∞–∫–æ

---

## ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏:

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `phi3.5:3.8b` –∏–∑ Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX:

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç phi3.5:3.8b –∏–∑ Ollama
result = await router.run_local_llm(
    prompt="–ü—Ä–∏–≤–µ—Ç!",
    category="fast"
)
```

### Vision –∑–∞–¥–∞—á–∏:

```python
from vision_processor import get_vision_processor

processor = get_vision_processor()

# –û–±—ã—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç moondream
result = await processor.describe_image(image_path="image.jpg")

# PDF —Å—Ç—Ä–∞–Ω–∏—Ü—ã - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç llava:7b
result = await processor.process_pdf_page(image_path="pdf_page.png")
```

---

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
ollama list

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# - moondream
# - llava:7b
# - phi3.5:3.8b
# - tinyllama:1.1b-chat (—É–∂–µ –±—ã–ª–∞)
```

---

## üéØ –ò—Ç–æ–≥

‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ollama –º–æ–¥–µ–ª–µ–π  
‚úÖ Fallback –Ω–∞ Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ Vision –º–æ–¥–µ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∑–∞–¥–∞—á–∏ (moondream –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤, llava –¥–ª—è PDF)  
‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç phi3.5:3.8b –∏–∑ Ollama  

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞!**
