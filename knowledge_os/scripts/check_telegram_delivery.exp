#!/usr/bin/expect -f

set timeout 60
set server "185.177.216.15"
set user "root"
set password "u44Ww9NmtQj,XG"

spawn ssh ${user}@${server}

expect {
    "password:" {
        send "${password}\r"
    }
    "yes/no" {
        send "yes\r"
        expect "password:"
        send "${password}\r"
    }
}

expect "# "
send "cd /root/atra\r"
expect "# "

send "echo '=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ˜ Ð’ TELEGRAM ==='\r"
expect "# "

send "echo '1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° notify_user Ð¸ notify_user_enhanced:'\r"
expect "# "
send "grep -E 'notify_user|notify_user_enhanced|ðŸ“¤.*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½|ÑÐ¸Ð³Ð½Ð°Ð».*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½.*Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ' bot_startup.log 2>/dev/null | tail -20\r"
expect "# "

send "echo '2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¾Ðº (message_id):'\r"
expect "# "
send "grep -E 'message_id|Message.*sent|Telegram.*message' bot_startup.log 2>/dev/null | tail -15\r"
expect "# "

send "echo '3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° user_id Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»ÐµÐ¹:'\r"
expect "# "
send "grep -E 'Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½.*Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ|user.*556251171|user.*958930260' bot_startup.log 2>/dev/null | tail -15\r"
expect "# "

send "echo '4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº Telegram API:'\r"
expect "# "
send "grep -i 'telegram.*error\|api.*error\|bad.*request\|unauthorized\|forbidden\|chat.*not.*found' bot_startup.log 2>/dev/null | tail -15\r"
expect "# "

send "echo '5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° enhanced_delivery:'\r"
expect "# "
send "grep -E 'enhanced.*delivery|notify_user_enhanced|delivery.*success|delivery.*error' bot_startup.log 2>/dev/null | tail -15\r"
expect "# "

send "echo '6. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ñ… Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¾Ðº (PRODUCTION):'\r"
expect "# "
send "grep -E 'PRODUCTION.*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½|âœ….*PRODUCTION' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "exit\r"
expect eof

