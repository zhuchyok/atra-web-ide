#!/usr/bin/expect -f

set timeout 60
set server "185.177.216.15"
set user "root"
set password "u44Ww9NmtQj,XG"

spawn ssh ${user}@${server}

expect {
    "password:" {
        send "${password}\r"
    }
    "yes/no" {
        send "yes\r"
        expect "password:"
        send "${password}\r"
    }
}

expect "# "
send "cd /root/atra\r"
expect "# "

send "echo '=== –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ==='\r"
expect "# "

send "echo '1. –í—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å:'\r"
expect "# "
send "grep -E 'BLOCK|üö´' bot_startup.log 2>/dev/null | tail -50\r"
expect "# "

send "echo '2. –í—Å–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:'\r"
expect "# "
send "grep -E 'PASS|‚úÖ.*PASS' bot_startup.log 2>/dev/null | tail -30\r"
expect "# "

send "echo '3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–æ —Ç–∏–ø–∞–º:'\r"
expect "# "
send "grep -E 'BLOCK|üö´' bot_startup.log 2>/dev/null | grep -oE '(BLOCK|üö´).*' | sed 's/.*\\[\\(.*\\)\\].*/\\1/' | sort | uniq -c | sort -rn\r"
expect "# "

send "echo '4. –ü—Ä–∏–º–µ—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–ª–∏ –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã:'\r"
expect "# "
send "grep -B 5 -A 5 'QUALITY PASS.*VOLUME PASS.*BREAKOUT PASS' bot_startup.log 2>/dev/null | tail -40\r"
expect "# "

send "echo '5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏:'\r"
expect "# "
send "grep -E '–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å|–ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å' bot_startup.log 2>/dev/null | tail -20\r"
expect "# "

send "echo '6. –ü—Ä–æ–≤–µ—Ä–∫–∞ Quality –∏ Confidence:'\r"
expect "# "
send "grep -E 'Quality.*Confidence|QUALITY CHECK' bot_startup.log 2>/dev/null | tail -20\r"
expect "# "

send "echo '7. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 60 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:'\r"
expect "# "
send "tail -60 bot_startup.log\r"
expect "# "

send "exit\r"
expect eof

