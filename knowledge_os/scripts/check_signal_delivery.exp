#!/usr/bin/expect -f

set timeout 60
set server "185.177.216.15"
set user "root"
set password "u44Ww9NmtQj,XG"

spawn ssh ${user}@${server}

expect {
    "password:" {
        send "${password}\r"
    }
    "yes/no" {
        send "yes\r"
        expect "password:"
        send "${password}\r"
    }
}

expect "# "
send "cd /root/atra\r"
expect "# "

send "echo '=== ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐžÐ¢ÐŸÐ ÐÐ’ÐšÐ˜ Ð¡Ð˜Ð“ÐÐÐ›ÐžÐ’ ==='\r"
expect "# "

send "echo '1. ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²:'\r"
expect "# "
send "grep -E 'SEND_SIGNAL|notify_user|ÑÐ¸Ð³Ð½Ð°Ð».*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½|signal_sent' bot_startup.log 2>/dev/null | tail -20\r"
expect "# "

send "echo '2. ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ Ð² Telegram:'\r"
expect "# "
send "grep -i 'error.*telegram\|Ð¾ÑˆÐ¸Ð±ÐºÐ°.*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ðº\|failed.*send\|notify.*error' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "echo '3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¾Ðº:'\r"
expect "# "
send "grep -E 'SEND_SIGNAL SUCCESS|âœ….*Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½|ÑÐ¸Ð³Ð½Ð°Ð».*ÑƒÑÐ¿ÐµÑˆÐ½Ð¾' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "echo '4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸:'\r"
expect "# "
send "grep -E 'SEND_SIGNAL BLOCK|ðŸš«.*BLOCK.*ÑÐ¸Ð³Ð½Ð°Ð»' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "exit\r"
expect eof

