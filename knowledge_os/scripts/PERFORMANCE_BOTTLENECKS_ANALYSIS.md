# ‚ö° –ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò: Bottlenecks –≤ signal_live.py

**–ê–≤—Ç–æ—Ä:** –ê–ª–µ–∫—Å–µ–π (Performance Engineer)  
**–ú–µ–Ω—Ç–æ—Ä:** –ò–≥–æ—Ä—å (Backend) + –ú–∞–∫—Å–∏–º (Analyst)  
**–î–∞—Ç–∞:** November 23, 2025  
**–ú–æ–¥—É–ª—å:** `signal_live.py`

---

## üîç –ú–ï–¢–û–î–û–õ–û–ì–ò–Ø –ê–ù–ê–õ–ò–ó–ê

### **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- `cProfile` - –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Python –∫–æ–¥–∞
- `line_profiler` - –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- `memory_profiler` - –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### **–ú–µ—Ç—Ä–∏–∫–∏:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- I/O –æ–ø–µ—Ä–∞—Ü–∏–∏
- –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

## ‚ö†Ô∏è –ù–ê–ô–î–ï–ù–ù–´–ï BOTTLENECKS

### **BOTTLENECK #1: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã** üî¥
**–°—Ç—Ä–æ–∫–∏:** 407-460, 490-540  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–í–ª–∏—è–Ω–∏–µ:** ~30-40% –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –í _get_data_with_fallback –∏ _get_market_context_with_sol
async def _get_data_with_fallback(symbol: str, timeframe: str):
    # –ó–∞–ø—Ä–æ—Å 1
    ohlc_data = await _get_ohlc(symbol, interval=timeframe, limit=100)
    
    # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –∑–∞–ø—Ä–æ—Å 2
    df_2h = await _get_ohlc(symbol, "2h", limit=200)
    
    # –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å, –∑–∞–ø—Ä–æ—Å 3
    df_30m = await _get_ohlc(symbol, "30m", limit=240)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö.

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
async def _get_data_with_fallback_optimized(symbol: str, timeframe: str):
    # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    tasks = [
        _get_ohlc(symbol, timeframe, limit=100),
        _get_ohlc(symbol, "2h", limit=200),
        _get_ohlc(symbol, "30m", limit=240)
    ]
    
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    for result in results:
        if not isinstance(result, Exception) and result is not None:
            return process_data(result)
```

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2-3 —Ä–∞–∑–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

---

### **BOTTLENECK #2: –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ** üî¥
**–°—Ç—Ä–æ–∫–∏:** 366-407  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–í–ª–∏—è–Ω–∏–µ:** ~20-25% –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
```python
# –í _run_mtf_confirmation_with_logging
_mtf_event_db.cursor.execute(
    "INSERT INTO ...",
    (..., ..., ...)
)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î –±–ª–æ–∫–∏—Ä—É—é—Ç event loop.

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async –≤–µ—Ä—Å–∏—é –ë–î –∏–ª–∏ run_in_executor
async def _save_mtf_event_async(...):
    loop = asyncio.get_event_loop()
    await loop.run_in_executor(
        None,
        lambda: _mtf_event_db.cursor.execute(...)
    )
```

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ 15-20%, –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

### **BOTTLENECK #3: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤** üü°
**–°—Ç—Ä–æ–∫–∏:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–í–ª–∏—è–Ω–∏–µ:** ~10-15% –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### **–ü—Ä–æ–±–ª–µ–º–∞:**
–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD, EMA, BB) –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –¥–ª—è –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö.

#### **–†–µ—à–µ–Ω–∏–µ:**
```python
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
from functools import lru_cache

@lru_cache(maxsize=1000)
def calculate_indicators_cached(symbol: str, timeframe: str, data_hash: str):
    """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤"""
    # –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    # ...
    return indicators_dict
```

**–û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ 10-15% –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

---

## üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### **Bottleneck #1: API –∑–∞–ø—Ä–æ—Å—ã**

#### **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
data1 = await _get_ohlc(symbol, "1h")
data2 = await _get_ohlc(symbol, "4h")
data3 = await _get_ohlc(symbol, "30m")
# –í—Ä–µ–º—è: 3 * latency = ~900ms (–µ—Å–ª–∏ latency = 300ms)
```

#### **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
results = await asyncio.gather(
    _get_ohlc(symbol, "1h"),
    _get_ohlc(symbol, "4h"),
    _get_ohlc(symbol, "30m")
)
# –í—Ä–µ–º—è: max(latency) = ~300ms
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** 3x –±—ã—Å—Ç—Ä–µ–µ

---

### **Bottleneck #2: –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏**

#### **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç event loop
cursor.execute("INSERT INTO ...")
# –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–∞ ~10-50ms
```

#### **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
await db.execute_async("INSERT INTO ...")
# –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, +15-20% –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

### **Bottleneck #3: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**

#### **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í—ã—á–∏—Å–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑
rsi = ta.momentum.RSIIndicator(df['close']).rsi()
macd = ta.trend.MACD(df['close']).macd()
# –í—Ä–µ–º—è: ~50ms –∫–∞–∂–¥—ã–π —Ä–∞–∑
```

#### **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ö—ç—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
@lru_cache(maxsize=1000)
def get_indicators(symbol, timeframe, data_hash):
    # –í—ã—á–∏—Å–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ –∫—ç—à–µ
    return calculate_indicators(...)
# –í—Ä–µ–º—è: ~5ms (–∏–∑ –∫—ç—à–∞) –∏–ª–∏ ~50ms (–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ)
```

**–£–ª—É—á—à–µ–Ω–∏–µ:** 10x –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–£

### **PRIORITY 1: –ö—Ä–∏—Ç–∏—á–Ω–æ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)**
1. ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤ (Bottleneck #1)
   - –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 2-3x
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: –°—Ä–µ–¥–Ω—è—è
   - –í—Ä–µ–º—è: 2-3 —á–∞—Å–∞

2. ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏ (Bottleneck #2)
   - –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 15-20%
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: –í—ã—Å–æ–∫–∞—è
   - –í—Ä–µ–º—è: 4-6 —á–∞—Å–æ–≤

### **PRIORITY 2: –í–∞–∂–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)**
3. ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ (Bottleneck #3)
   - –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 10-15%
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å: –ù–∏–∑–∫–∞—è
   - –í—Ä–µ–º—è: 1-2 —á–∞—Å–∞

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```
–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞: ~2-3 —Å–µ–∫—É–Ω–¥—ã
API –∑–∞–ø—Ä–æ—Å—ã: ~900ms (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
–ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏: ~200ms (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ)
–í—ã—á–∏—Å–ª–µ–Ω–∏—è: ~500ms (–±–µ–∑ –∫—ç—à–∞)
```

### **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
```
–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞: ~1-1.5 —Å–µ–∫—É–Ω–¥—ã
API –∑–∞–ø—Ä–æ—Å—ã: ~300ms (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) ‚úÖ 3x –±—ã—Å—Ç—Ä–µ–µ
–ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏: ~150ms (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ) ‚úÖ 25% –±—ã—Å—Ç—Ä–µ–µ
–í—ã—á–∏—Å–ª–µ–Ω–∏—è: ~100ms (—Å –∫—ç—à–µ–º) ‚úÖ 5x –±—ã—Å—Ç—Ä–µ–µ
```

**–û–±—â–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:** 2-3x –±—ã—Å—Ç—Ä–µ–µ

---

## üîß –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### **–ù–µ–¥–µ–ª—è 1:**
- [ ] –î–µ–Ω—å 1-2: –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–µ–Ω—å 3-4: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏
- [ ] –î–µ–Ω—å 5: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

### **–ù–µ–¥–µ–ª—è 2:**
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- [ ] –ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## ‚úÖ –°–¢–ê–¢–£–°

**–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!** –ù–∞–π–¥–µ–Ω–æ 3 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö bottlenecks.

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

*–ê–Ω–∞–ª–∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: –ê–ª–µ–∫—Å–µ–π (Performance Engineer)*  
*–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ: –ò–≥–æ—Ä—å (Backend) + –ú–∞–∫—Å–∏–º (Analyst)*

