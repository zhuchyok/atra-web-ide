#!/bin/bash

echo "๐ ะะตัะตะทะฐะฟััะบ ัะธััะตะผั ATRA..."

# ะฃะฑะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั main.py
echo "๐๏ธ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะฒัะต ะฟัะพัะตััั main.py..."
pkill -f "python.*main.py" 2>/dev/null || true

# ะะดะตะผ ะทะฐะฒะตััะตะฝะธั ะฟัะพัะตััะพะฒ
sleep 5

# ะฃะดะฐะปัะตะผ lock ัะฐะนะป
echo "๐ ะฃะดะฐะปัะตะผ lock ัะฐะนะป..."
rm -f atra.lock

# ะัะพะฒะตััะตะผ, ััะพ ะฟัะพัะตััั ะพััะฐะฝะพะฒะปะตะฝั
REMAINING=$(ps aux | grep "python.*main.py" | grep -v grep | wc -l)
if [ $REMAINING -gt 0 ]; then
    echo "โ๏ธ ะััะฐะปะพัั $REMAINING ะฟัะพัะตััะพะฒ, ะฟัะธะฝัะดะธัะตะปัะฝะพ ัะฑะธะฒะฐะตะผ..."
    ps aux | grep "python.*main.py" | grep -v grep | awk '{print $2}' | xargs kill -9 2>/dev/null || true
    sleep 3
fi

# ะะฐะฟััะบะฐะตะผ ัะธััะตะผั
echo "๐ ะะฐะฟััะบะฐะตะผ ัะธััะตะผั..."
python3 main.py &

echo "โ ะกะธััะตะผะฐ ะฟะตัะตะทะฐะฟััะตะฝะฐ!"
echo "๐ ะัะพะฒะตััะตะผ ััะฐััั ัะตัะตะท 10 ัะตะบัะฝะด..."

sleep 10
echo "๐ ะะบัะธะฒะฝัะต ะฟัะพัะตััั:"
ps aux | grep "python.*main.py" | grep -v grep | head -3
