#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è .cursorrules –≤ –Ω–æ–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./create-cursor-rules.sh <project-name> <project-path>

set -e

PROJECT_NAME="${1:-$(basename "$(pwd)")}"
PROJECT_PATH="${2:-$(pwd)}"
UNIVERSAL_RULES_PATH="$HOME/.cursor/universal-rules.md"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

echo -e "${GREEN}üöÄ –°–æ–∑–¥–∞–Ω–∏–µ .cursorrules –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞: $PROJECT_NAME${NC}"
echo -e "${YELLOW}–ü—É—Ç—å: $PROJECT_PATH${NC}"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -d "$PROJECT_PATH" ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è $PROJECT_PATH –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç${NC}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ .cursorrules
if [ -f "$PROJECT_PATH/.cursorrules" ]; then
    echo -e "${YELLOW}‚ö†Ô∏è  –§–∞–π–ª .cursorrules —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç${NC}"
    read -p "–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo -e "${YELLOW}–û—Ç–º–µ–Ω–µ–Ω–æ${NC}"
        exit 0
    fi
fi

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞
detect_project_type() {
    if [ -f "$PROJECT_PATH/package.json" ]; then
        echo "javascript/typescript"
    elif [ -f "$PROJECT_PATH/requirements.txt" ] || [ -f "$PROJECT_PATH/pyproject.toml" ]; then
        echo "python"
    elif [ -f "$PROJECT_PATH/Cargo.toml" ]; then
        echo "rust"
    elif [ -f "$PROJECT_PATH/go.mod" ]; then
        echo "go"
    elif [ -f "$PROJECT_PATH/pom.xml" ] || [ -f "$PROJECT_PATH/build.gradle" ]; then
        echo "java"
    else
        echo "generic"
    fi
}

PROJECT_TYPE=$(detect_project_type)
echo -e "${GREEN}üì¶ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ç–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: $PROJECT_TYPE${NC}"

# –°–æ–∑–¥–∞–µ–º .cursorrules
cat > "$PROJECT_PATH/.cursorrules" << EOF
---
description: "Rules for $PROJECT_NAME project"
alwaysApply: true
---

# –ü–†–ê–í–ò–õ–ê –ü–†–û–ï–ö–¢–ê: $PROJECT_NAME

## üåç –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∫–æ–º–∞–Ω–¥—ã —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
> –°–º. \`~/.cursor/universal-rules.md\` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

### –ö–æ–º–∞–Ω–¥–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç "–∫–æ–º–∞–Ω–¥—ã –∏–∑ 13 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤":
- –í–∏–∫—Ç–æ—Ä (Team Lead) - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ò–≥–æ—Ä—å (Backend Developer) - –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ —Ç–µ—Å—Ç—ã
- –ê–Ω–Ω–∞ (QA Engineer) - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–æ–∫—Ä—ã—Ç–∏–µ > 80%)
- –ò –¥—Ä—É–≥–∏–µ —ç–∫—Å–ø–µ—Ä—Ç—ã (—Å–º. —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞)

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: "–ß—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å –æ–± —ç—Ç–æ–º?"
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: "–ö–∞–∫–∏–µ —ç–∫—Å–ø–µ—Ä—Ç—ã –∏–∑ –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –æ–±—Å—É–¥–∏—Ç—å [—Ç–µ–º–∞]? –ß—Ç–æ –±—ã —Å–∫–∞–∑–∞–ª–∏ [–≠–∫—Å–ø–µ—Ä—Ç1], [–≠–∫—Å–ø–µ—Ä—Ç2] –∏ [–≠–∫—Å–ø–µ—Ä—Ç3]?"

---

## üéØ –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –î–õ–Ø –ü–†–û–ï–ö–¢–ê –ü–†–ê–í–ò–õ–ê

### –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: $PROJECT_TYPE

EOF

# –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø—Ä–æ–µ–∫—Ç–∞
case $PROJECT_TYPE in
    "python")
        cat >> "$PROJECT_PATH/.cursorrules" << 'PYTHON_EOF'

### Python Code Style:
- PEP 8 compliance
- Black formatting (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- Type hints –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- Docstrings –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –∫–ª–∞—Å—Å–æ–≤

### Python Testing:
- pytest –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fixtures –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- Mock –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### Python Dependencies:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å requirements.txt –∏–ª–∏ pyproject.toml
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### Python Structure:
```
src/          # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
tests/        # –¢–µ—Å—Ç—ã
docs/         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
scripts/      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
```

PYTHON_EOF
        ;;
    "javascript/typescript")
        cat >> "$PROJECT_PATH/.cursorrules" << 'JS_EOF'

### TypeScript/JavaScript Code Style:
- TypeScript strict mode (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TS)
- ESLint + Prettier
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (ES6+)
- –ò–∑–±–µ–≥–∞—Ç—å any —Ç–∏–ø–æ–≤

### Testing:
- Jest –∏–ª–∏ Vitest –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- React Testing Library (–µ—Å–ª–∏ React –ø—Ä–æ–µ–∫—Ç)
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

### Dependencies:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å package.json
- –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ (package-lock.json –∏–ª–∏ yarn.lock)
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

JS_EOF
        ;;
    "rust")
        cat >> "$PROJECT_PATH/.cursorrules" << 'RUST_EOF'

### Rust Code Style:
- –°–ª–µ–¥–æ–≤–∞—Ç—å rustfmt
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å clippy –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —è–≤–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Result –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### Rust Testing:
- Unit —Ç–µ—Å—Ç—ã –≤ –º–æ–¥—É–ª—è—Ö
- Integration —Ç–µ—Å—Ç—ã –≤ tests/
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å #[cfg(test)] –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

RUST_EOF
        ;;
    "go")
        cat >> "$PROJECT_PATH/.cursorrules" << 'GO_EOF'

### Go Code Style:
- –°–ª–µ–¥–æ–≤–∞—Ç—å gofmt
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å golint –∏ go vet
- –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ: —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —è–≤–Ω–æ

### Go Testing:
- go test –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å table-driven tests
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

GO_EOF
        ;;
    *)
        cat >> "$PROJECT_PATH/.cursorrules" << 'GENERIC_EOF'

### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
- –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —è–∑—ã–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–Ω—Ç–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã

GENERIC_EOF
        ;;
esac

# –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞
cat >> "$PROJECT_PATH/.cursorrules" << 'EOF'

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

[–û–ø–∏—à–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∑–¥–µ—Å—å]

## üîß –¢–ï–•–ù–û–õ–û–ì–ò–ò

[–ü–µ—Ä–µ—á–∏—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã]

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

- –§—Ä–µ–π–º–≤–æ—Ä–∫: [—É–∫–∞–∂–∏—Ç–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–æ–≤]
- –ü–æ–∫—Ä—ã—Ç–∏–µ: > 80%
- –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞: [make test / npm test / pytest / etc]

## üöÄ –î–ï–ü–õ–û–ô

[–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è –ø—Ä–æ–µ–∫—Ç–∞]

---

**–°–æ–∑–¥–∞–Ω–æ:** $(date +"%Y-%m-%d")
**–í–µ—Ä—Å–∏—è –ø—Ä–∞–≤–∏–ª:** 1.0
EOF

echo -e "${GREEN}‚úÖ –§–∞–π–ª .cursorrules —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!${NC}"
echo -e "${YELLOW}üìù –ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∞–≤–∏–ª–∞${NC}"
echo -e "${GREEN}üìÑ –ü—É—Ç—å: $PROJECT_PATH/.cursorrules${NC}"

# –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
if command -v code &> /dev/null; then
    read -p "–û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª –≤ VS Code? (y/N): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        code "$PROJECT_PATH/.cursorrules"
    fi
fi

