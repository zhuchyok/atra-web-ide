#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Singularity 8.0 –∫ –∑–∞–ø—É—Å–∫—É
"""

import sys
import os
from pathlib import Path

sys.path.insert(0, str(Path(__file__).parent.parent / "app"))

def check_imports():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"""
    print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –º–æ–¥—É–ª–µ–π...\n")
    
    modules = [
        "parallel_request_processor",
        "ml_router_v2",
        "session_context_manager",
        "rate_limiter",
        "secret_manager",
        "metrics_exporter",
        "usage_analytics",
        "report_generator",
        "file_processor",
        "voice_processor",
        "external_api_integration",
        "health_check",
        "embedding_optimizer",
        "cache_cleanup_task",
        "ml_router_trainer",
        "ml_router_data_collector",
    ]
    
    failed = []
    for module in modules:
        try:
            __import__(module)
            print(f"  ‚úÖ {module}")
        except Exception as e:
            print(f"  ‚ùå {module}: {e}")
            failed.append(module)
    
    return len(failed) == 0

def check_directory_structure():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π"""
    print("\nüìÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π...\n")
    
    dirs = [
        "knowledge_os/app",
        "knowledge_os/db/migrations",
        "knowledge_os/scripts",
        "docs",
        "logs",
    ]
    
    failed = []
    for dir_path in dirs:
        full_path = Path(__file__).parent.parent.parent / dir_path
        if full_path.exists():
            print(f"  ‚úÖ {dir_path}")
        else:
            print(f"  ‚ùå {dir_path} - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
            failed.append(dir_path)
    
    return len(failed) == 0

def check_env_file():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞"""
    print("\nüîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è...\n")
    
    env_file = Path(__file__).parent.parent.parent / ".env"
    if env_file.exists():
        print(f"  ‚úÖ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
        return True
    else:
        print(f"  ‚ö†Ô∏è .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (—Å–æ–∑–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ setup_environment.py)")
        return False

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏"""
    print("üîç Singularity 8.0: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏\n")
    print("=" * 50)
    print()
    
    results = []
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
    results.append(("–ò–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π", check_imports()))
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
    results.append(("–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π", check_directory_structure()))
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞
    results.append(("–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è", check_env_file()))
    
    # –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞
    print("\n" + "=" * 50)
    print("üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞:\n")
    
    all_ok = True
    for name, status in results:
        status_str = "‚úÖ OK" if status else "‚ùå FAILED"
        print(f"  {status_str}: {name}")
        if not status:
            all_ok = False
    
    print()
    if all_ok:
        print("‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã! –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∑–∞–ø—É—Å–∫—É.")
        return 0
    else:
        print("‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–≤–∞–ª–µ–Ω—ã. –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã –≤—ã—à–µ.")
        return 1

if __name__ == "__main__":
    sys.exit(main())

