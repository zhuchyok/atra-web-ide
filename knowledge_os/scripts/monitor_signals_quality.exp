#!/usr/bin/expect -f

set timeout 60
set server "185.177.216.15"
set user "root"
set password "u44Ww9NmtQj,XG"

spawn ssh ${user}@${server}

expect {
    "password:" {
        send "${password}\r"
    }
    "yes/no" {
        send "yes\r"
        expect "password:"
        send "${password}\r"
    }
}

expect "# "
send "cd /root/atra\r"
expect "# "

send "echo '=== –ú–û–ù–ò–¢–û–†–ò–ù–ì –°–ò–ì–ù–ê–õ–û–í –ò –ö–ê–ß–ï–°–¢–í–ê ==='\r"
expect "# "

send "echo '1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å:'\r"
expect "# "
send "grep -E 'SIGNAL|—Å–∏–≥–Ω–∞–ª.*LONG|—Å–∏–≥–Ω–∞–ª.*SHORT' bot_startup.log 2>/dev/null | grep -v 'BLOCK' | tail -20 | wc -l\r"
expect "# "

send "echo '2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Quality Score:'\r"
expect "# "
send "grep -E 'Quality.*[0-9]\\.[0-9]' bot_startup.log 2>/dev/null | tail -20 | grep -oE 'Quality [0-9]\\.[0-9]+' | sort | uniq -c | sort -rn\r"
expect "# "

send "echo '3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20):'\r"
expect "# "
send "grep -E 'BLOCK|üö´' bot_startup.log 2>/dev/null | tail -20 | grep -oE '(BLOCK|üö´).*' | sort | uniq -c | sort -rn\r"
expect "# "

send "echo '4. –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20):'\r"
expect "# "
send "grep -E 'PASS|‚úÖ.*PASS' bot_startup.log 2>/dev/null | tail -20\r"
expect "# "

send "echo '5. –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å - –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:'\r"
expect "# "
send "grep '–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞\|–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "echo '6. MTF –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:'\r"
expect "# "
send "grep 'MTF.*BLOCK' bot_startup.log 2>/dev/null | tail -10\r"
expect "# "

send "echo '7. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 30 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∞:'\r"
expect "# "
send "tail -30 bot_startup.log\r"
expect "# "

send "exit\r"
expect eof

