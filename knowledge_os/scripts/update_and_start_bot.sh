#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –∏ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

SERVER="root@185.177.216.15"
REMOTE_DIR="~/atra"

echo "üöÄ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò –ó–ê–ü–£–°–ö –ë–û–¢–ê –ù–ê –°–ï–†–í–ï–†–ï"
echo "========================================"

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
COMMANDS="
cd $REMOTE_DIR && \
echo 'üì• –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ —Å git...' && \
git pull && \
echo 'üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω)...' && \
pkill -f 'signal_live.py' || true && \
sleep 2 && \
echo 'üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞...' && \
nohup python3 signal_live.py > signal_live.log 2>&1 & \
sleep 3 && \
echo '‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤...' && \
ps aux | grep -E '(signal_live|main\.py)' | grep -v grep && \
echo 'üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞:' && \
tail -5 signal_live.log 2>/dev/null || echo '–õ–æ–≥ –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–Ω'
"

# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh -o StrictHostKeyChecking=no $SERVER "$COMMANDS"

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:"
echo "   ssh $SERVER 'cd $REMOTE_DIR && python3 check_signals_status.py'"

