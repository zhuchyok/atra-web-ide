# üîÑ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ - –§–ò–ù–ê–õ–¨–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

## üéØ **–¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô:**

### **üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 556251171 (SPOT):**
```json
{
  "deposit": 10200.0,
  "trade_mode": "spot",
  "filter_mode": "soft",
  "open_positions": [],
  "accepted_signals": [],
  "news_filter_mode": "aggressive",
  "total_risk_amount": 0,
  "free_deposit": 10200.0,
  "total_profit": 0
}
```

### **üìä –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 958930260 (FUTURES):**
```json
{
  "deposit": 200.0,
  "trade_mode": "futures",
  "filter_mode": "soft",
  "open_positions": [],
  "accepted_signals": [],
  "news_filter_mode": "aggressive",
  "total_risk_amount": 0,
  "free_deposit": 200.0,
  "total_profit": 0
}
```

---

## üîÑ **–ö–ê–ö –†–ê–ë–û–¢–ê–Æ–¢ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´:**

### **üìä –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
# –í signal_live.py
current_index = len(df) - 1

# 1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ (1.0% - 5.0%)
risk_pct = get_dynamic_risk_pct(df, current_index)

# 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ (1x - 20x)
base_leverage = user_data.get('leverage', 1) if user_data.get('trade_mode', 'spot') == 'futures' else 1
leverage = get_dynamic_leverage(df, current_index, base_leverage)

# 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP —É—Ä–æ–≤–Ω–∏
tp1_pct, tp2_pct = get_dynamic_tp_levels(df, current_index, side.lower())
```

### **üìä –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
# –í telegram_bot.py
# 1. –†–∏—Å–∫ –∏–∑ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
risk_pct = float(args[5]) if len(args) > 5 else user_data.get("risk_pct", 2.0)

# 2. –ü–ª–µ—á–æ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
leverage = user_data.get("leverage", 1) if trade_mode == "futures" else 1

# 3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
new_qty, avg_price_new, tp1, tp2, limit_reached = dca_calculate_next_qty_and_tp(
    entry_prices, qtys, entry_price, dca_count, deposit, risk_pct, leverage, side
)
```

---

## üéØ **–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ú–ï–†–´:**

### **–ü—Ä–∏–º–µ—Ä 1: SPOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (556251171)**
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
deposit = 10200.0
trade_mode = "spot"
filter_mode = "soft"

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã
risk_pct = get_dynamic_risk_pct(df, current_index)  # –ù–∞–ø—Ä–∏–º–µ—Ä: 2.3%
leverage = get_dynamic_leverage(df, current_index, 1)  # –í—Å–µ–≥–¥–∞ 1.0x –¥–ª—è SPOT

# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
base_qty = 10200.0 * 2.3 / 100 * 1.0 / 3245.67 = 0.072 ETH
```

### **–ü—Ä–∏–º–µ—Ä 2: FUTURES –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (958930260)**
```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
deposit = 200.0
trade_mode = "futures"
filter_mode = "soft"

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã
risk_pct = get_dynamic_risk_pct(df, current_index)  # –ù–∞–ø—Ä–∏–º–µ—Ä: 1.8%
leverage = get_dynamic_leverage(df, current_index, 1)  # –ù–∞–ø—Ä–∏–º–µ—Ä: 1.5x

# –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
base_qty = 200.0 * 1.8 / 100 * 1.5 / 3245.67 = 0.0017 ETH
```

---

## üîß **–õ–û–ì–ò–ö–ê –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–• –†–ê–°–ß–ï–¢–û–í:**

### **üìä –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫:**
```python
def get_dynamic_risk_pct(df, i):
    """
    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Ä–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
    """
    if i < 21:
        return 2.0  # —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–∏—Å–∫, –µ—Å–ª–∏ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö

    volatility = closes.std() / closes.mean()
    trend = (sma20_now - sma20_prev) / sma20_prev if sma20_prev != 0 else 0
    base_risk = 2.0
    dynamic_risk = base_risk * (1 + 2 * trend) / (1 + 5 * volatility)
    dynamic_risk = max(1.0, min(dynamic_risk, 5.0))  # –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 1% –¥–æ 5%
    return dynamic_risk
```

**–õ–æ–≥–∏–∫–∞:**
- **–ü—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ** ‚Üí —Ä–∏—Å–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è (–¥–æ 5%)
- **–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏** ‚Üí —Ä–∏—Å–∫ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è (–¥–æ 1%)
- **–ü—Ä–∏ –±–æ–∫–æ–≤–æ–º —Ä—ã–Ω–∫–µ** ‚Üí —Ä–∏—Å–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–º (2%)

### **üìà –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ:**
```python
def get_dynamic_leverage(df, i, base_leverage=1):
    """
    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø–ª–µ—á–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
    """
    if i < 21:
        return base_leverage  # –±–∞–∑–æ–≤–æ–µ –ø–ª–µ—á–æ, –µ—Å–ª–∏ –º–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö

    volatility = closes.std() / closes.mean()
    trend = (sma20_now - sma20_prev) / sma20_prev if sma20_prev != 0 else 0

    # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–Ω–¥–∞ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    trend_factor = 1 + abs(trend) * 2  # –¥–æ 3x –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
    volatility_factor = 1 / (1 + volatility * 3)  # —É–º–µ–Ω—å—à–∞–µ–º –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

    dynamic_leverage = base_leverage * trend_factor * volatility_factor
    dynamic_leverage = max(1, min(dynamic_leverage, 20))  # –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ—Ç 1 –¥–æ 20

    return round(dynamic_leverage, 1)
```

**–õ–æ–≥–∏–∫–∞:**
- **–ü—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ** ‚Üí –ø–ª–µ—á–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è (–¥–æ 20x)
- **–ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏** ‚Üí –ø–ª–µ—á–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è (–¥–æ 1x)
- **–î–ª—è SPOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Üí –≤—Å–µ–≥–¥–∞ 1x (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–∞—Å—á–µ—Ç–æ–≤)

---

## üìä **–ê–î–ê–ü–¢–ê–¶–ò–Ø –ö –†–´–ù–û–ß–ù–´–ú –£–°–õ–û–í–ò–Ø–ú:**

### **üü¢ –ë—ã—á–∏–π —Ç—Ä–µ–Ω–¥ + –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```
risk_pct = 4.5%  // –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
leverage = 3.2x  // –í—ã—Å–æ–∫–æ–µ –ø–ª–µ—á–æ (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
```

### **üî¥ –ú–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥ + –≤—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```
risk_pct = 1.2%  // –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫
leverage = 1.1x  // –ù–∏–∑–∫–æ–µ –ø–ª–µ—á–æ (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)
// –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
```

### **üü° –ë–æ–∫–æ–≤–æ–π —Ä—ã–Ω–æ–∫ + —Å—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:**
```
risk_pct = 2.0%  // –ë–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫
leverage = 1.5x  // –°—Ä–µ–¥–Ω–µ–µ –ø–ª–µ—á–æ (–¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤)
// –†–µ–∑—É–ª—å—Ç–∞—Ç: —É–º–µ—Ä–µ–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è
```

---

## üéØ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –î–ò–ù–ê–ú–ò–ß–ï–°–ö–û–ô –°–ò–°–¢–ï–ú–´:**

### **‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è:**
- **–†–∏—Å–∫** –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- **–ü–ª–µ—á–æ** –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ç—Ä–µ–Ω–¥—É –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- **TP —É—Ä–æ–≤–Ω–∏** –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

### **‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä—å:**
- **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Üí —Å–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –∏ –ø–ª–µ—á–∞
- **–°–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥** ‚Üí –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥** ‚Üí —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ –ø—Ä–∏–±—ã–ª–∏

### **‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å:**
- **SPOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** ‚Üí –≤—Å–µ–≥–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–ª–µ—á–æ 1x
- **FUTURES –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** ‚Üí –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ 1x-20x
- **–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** ‚Üí –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∏—Å–∫ 1%-5%

---

## üéØ **–ò–¢–û–ì:**

### **üîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
1. **–ù–∏–∫–∞–∫–∏—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π** `risk_pct` –∏ `leverage` –≤ `user_data.json`
2. **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
3. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è** –∫ —Ç—Ä–µ–Ω–¥—É –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
4. **SPOT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞—â–∏—â–µ–Ω—ã** –æ—Ç –≤—ã—Å–æ–∫–æ–≥–æ –ø–ª–µ—á–∞

### **üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:**
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 556251171** - SPOT, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 958930260** - FUTURES, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞**

### **üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:**
**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É—è—Å—å –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!** üöÄ