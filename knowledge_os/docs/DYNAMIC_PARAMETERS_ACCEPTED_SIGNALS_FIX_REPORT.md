# –û—Ç—á–µ—Ç –æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö

## **üìã –û–ë–ó–û–† –ó–ê–î–ê–ß–ò**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö:
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –Ω–æ–≤–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –¥–ª—è DCA

## **üîß –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. ‚úÖ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´**

**–ë–´–õ–û:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
dynamic_risk_pct = risk_pct  # –ë–∞–∑–æ–≤—ã–π —Ä–∏—Å–∫
dynamic_leverage = leverage  # –ë–∞–∑–æ–≤–æ–µ –ø–ª–µ—á–æ
dynamic_tp1_pct, dynamic_tp2_pct = 1.0, 2.0  # –ë–∞–∑–æ–≤—ã–µ TP
```

**–°–¢–ê–õ–û:**
```python
# –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
ohlc_data = get_ohlc_binance_sync(symbol, interval="1h", limit=100)
if ohlc_data and len(ohlc_data) > 50:
    # –°–æ–∑–¥–∞–µ–º DataFrame –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
    df = pd.DataFrame(ohlc_data)
    df['close'] = pd.to_numeric(df['close'])
    df['volume'] = pd.to_numeric(df['volume'])

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
    df['sma20'] = df['close'].rolling(window=20).mean()
    df['ema7'] = df['close'].ewm(span=7).mean()
    df['ema25'] = df['close'].ewm(span=25).mean()

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    df['volatility'] = df['close'].rolling(window=20).std() / df['close'].rolling(window=20).mean()

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
    df['bb_middle'] = df['close'].rolling(window=20).mean()
    bb_std = df['close'].rolling(window=20).std()
    df['bb_upper'] = df['bb_middle'] + (bb_std * 2)
    df['bb_lower'] = df['bb_middle'] - (bb_std * 2)

    current_index = len(df) - 1

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    dynamic_risk_pct = get_dynamic_risk_pct(df, current_index)
    dynamic_leverage = get_dynamic_leverage(df, current_index, leverage)
    dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, current_index, side)
```

### **2. ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–´–ô –†–ê–°–ß–ï–¢ –°–í–û–ë–û–î–ù–´–• –°–†–ï–î–°–¢–í**

**–ë–´–õ–û:**
```python
# –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç
total_positions = len(user_data.get("open_positions", []))
total_risk = sum(pos.get("risk_amount", 0) for pos in user_data.get("open_positions", []))
free_deposit = max(deposit - total_risk, 0)
```

**–°–¢–ê–õ–û:**
```python
# –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
open_positions = user_data.get("open_positions", [])
total_positions = len(open_positions)

# –°—É–º–º–∏—Ä—É–µ–º —Ä–∏—Å–∫ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
total_risk = sum(pos.get("risk_amount", 0) for pos in open_positions)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞
free_deposit = max(deposit - total_risk, 0)

print(f"[BUTTON] –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤: –¥–µ–ø–æ–∑–∏—Ç={deposit:.2f}, –æ–±—â–∏–π —Ä–∏—Å–∫={total_risk:.2f}, —Å–≤–æ–±–æ–¥–Ω–æ={free_deposit:.2f}")
```

### **3. ‚úÖ –ö–û–†–†–ï–ö–¢–ù–ê–Ø –ù–û–í–ê–Ø –°–†–ï–î–ù–Ø–Ø –¶–ï–ù–ê –î–õ–Ø DCA**

**–ë–´–õ–û:**
```python
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è DCA
new_qty = existing_position.get("risk_amount", 0) / current_price
```

**–°–¢–ê–õ–û:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ DCA –≤—Ö–æ–¥–∞
dca_risk_amount = free_deposit * dynamic_risk_pct / 100
new_qty = dca_risk_amount / current_price if current_price > 0 else 0

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—É—é —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É
if old_qty > 0 and old_price > 0:
    total_qty = old_qty + new_qty
    avg_price_new = (old_qty * old_price + new_qty * current_price) / total_qty
else:
    total_qty = new_qty
    avg_price_new = current_price

print(f"[BUTTON] DCA —Ä–∞—Å—á–µ—Ç: —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞={old_price:.2f}, –Ω–æ–≤–∞—è —Ü–µ–Ω–∞={current_price:.2f}, —Å—Ä–µ–¥–Ω—è—è={avg_price_new:.2f}")
print(f"[BUTTON] DCA –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: —Å—Ç–∞—Ä–æ–µ={old_qty:.4f}, –Ω–æ–≤–æ–µ={new_qty:.4f}, –æ–±—â–µ–µ={total_qty:.4f}")
```

### **4. ‚úÖ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–û–ó–ò–¶–ò–ò –° –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ú–ò –ü–ê–†–ê–ú–ï–¢–†–ê–ú–ò**

**–ë–´–õ–û:**
```python
# –û–±–Ω–æ–≤–ª—è–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
existing_position["qty"] = total_qty
existing_position["entry_price"] = avg_price_new
existing_position["n_dca"] = existing_position.get("n_dca", 0) + 1
```

**–°–¢–ê–õ–û:**
```python
# –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
existing_position["qty"] = total_qty
existing_position["entry_price"] = avg_price_new
existing_position["n_dca"] = existing_position.get("n_dca", 0) + 1
existing_position["risk_amount"] = existing_position.get("risk_amount", 0) + dca_risk_amount
existing_position["risk_pct"] = dynamic_risk_pct
existing_position["leverage"] = dynamic_leverage
```

## **üéØ –ö–õ–Æ–ß–ï–í–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø**

### **1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏:**
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –æ—Ç 1% –¥–æ 5%

### **2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏:**
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—é—Ç –±–∞–∑–æ–≤–æ–µ –ø–ª–µ—á–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –æ—Ç 0.5x –¥–æ 20x

### **3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã:**
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–æ—Å –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
- ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ —Å—Ç–æ—Ä–æ–Ω–µ —Å–¥–µ–ª–∫–∏ (long/short)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –æ—Ç 0.5% –¥–æ 15%

### **4. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### **5. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è DCA –ª–æ–≥–∏–∫–∞:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –Ω–æ–≤–æ–π —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
- ‚úÖ –£—á–µ—Ç –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—Ö–æ–¥–æ–≤
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–∏

## **üìä –ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´**

### **–ù–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:**
```
‚úÖ *–°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢!*

üí∞ **–î–µ–ø–æ–∑–∏—Ç:** `1000.00 USDT`
üìä **–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π:** `1` –Ω–∞ `25.50 USDT`
üíµ **–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è —Å–¥–µ–ª–æ–∫:** `974.50 USDT`
üéØ **–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É:** `2.85%` (`27.77 USDT`)
‚ö° **–ü–ª–µ—á–æ:** `x3`
üíé **–°—É–º–º–∞ –≤—Ö–æ–¥–∞:** `27.77 USDT`

üéØ *–¢–ï–ô–ö –ü–†–û–§–ò–¢–´:*
‚Ä¢ **TP1:** `51250.00` (`+2.5%`)
‚Ä¢ **TP2:** `52500.00` (`+5.0%`)
```

### **DCA —Å–∏–≥–Ω–∞–ª —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:**
```
‚úÖ *DCA –°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢!*

üí∞ **–î–µ–ø–æ–∑–∏—Ç:** `1000.00 USDT`
üìä **–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π:** `1` –Ω–∞ `53.27 USDT`
üíµ **–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è —Å–¥–µ–ª–æ–∫:** `946.73 USDT`
üéØ **–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É:** `2.85%` (`27.77 USDT`)
‚ö° **–ü–ª–µ—á–æ:** `x3`
üíé **–°—É–º–º–∞ –≤—Ö–æ–¥–∞:** `27.77 USDT`

üìä *–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ü–û–ó–ò–¶–ò–Ø `BTCUSDT`:*
‚Ä¢ **–ù–æ–≤–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞:** `49750.00`
‚Ä¢ **–û–±—â–∏–π –æ–±—ä—ë–º:** `0.0016`
‚Ä¢ **–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π:** `2/5`
‚Ä¢ **TP1:** `50993.75` (`+2.5%`)
‚Ä¢ **TP2:** `52237.50` (`+5.0%`)
```

## **üöÄ –†–ï–ó–£–õ–¨–¢–ê–¢**

**‚úÖ –í–°–ï –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ò–°–ü–†–ê–í–õ–ï–ù–´!**

### **–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**

1. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏** —Å —É—á–µ—Ç–æ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
3. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞** —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
5. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é —Å—Ä–µ–¥–Ω—é—é —Ü–µ–Ω—É** –¥–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤

### **–£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**

- üéØ **–ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã** —Ä–∏—Å–∫–∞ –∏ –ø–ª–µ—á–∞
- üìà **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã** –ø–æ–¥ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- üí∞ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- üîÑ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è DCA –ª–æ–≥–∏–∫–∞** —Å —Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω–æ–π
- üìä **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤

**–í—Å–µ –ø—Ä–∏–Ω—è—Ç—ã–µ —Å–∏–≥–Ω–∞–ª—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏!** üéØ

