# –û–¢–ß–ï–¢: –ü–†–û–ë–õ–ï–ú–ê –° –ö–≠–®–ï–ú –û–¢–ö–†–´–¢–´–• –ü–û–ó–ò–¶–ò–ô –ü–†–ò –ü–ï–†–ï–ó–ê–ü–£–°–ö–ï

## üö® –ü–†–û–ë–õ–ï–ú–ê
**–î–∞, –∫—ç—à –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞!**

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –≤ `run_telegram_bot()`:

```python
async def run_telegram_bot():
    app = ApplicationBuilder().token(TOKEN).build()
    # –ó–∞–≥—Ä—É–∂–∞–µ–º user_data.json –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    load_user_data(app)
    # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –û—á–∏—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–¥ –∑–∞–ª–∏–≤–∫–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    await clear_open_positions_and_history(app)
```

### –§—É–Ω–∫—Ü–∏—è `clear_open_positions_and_history()`:

```python
async def clear_open_positions_and_history(app):
    for user_id, user_data in app.user_data.items():
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        deposit = user_data.get("deposit", 0)
        trade_mode = user_data.get("trade_mode", "spot")
        filter_mode = user_data.get("filter_mode", "enhanced_bollinger")
        news_filter_mode = user_data.get("news_filter_mode", "conservative")

        # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        user_data["open_positions"] = []  # ‚Üê –í–û–¢ –ó–î–ï–°–¨ –°–ë–†–ê–°–´–í–ê–ï–¢–°–Ø!
        user_data["accepted_signals"] = []

        # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        if deposit > 0:
            user_data["deposit"] = deposit
        if trade_mode:
            user_data["trade_mode"] = trade_mode
        if filter_mode:
            user_data["filter_mode"] = filter_mode
        if news_filter_mode:
            user_data["news_filter_mode"] = news_filter_mode

    save_user_data(app)
```

## ‚ö†Ô∏è –ü–û–°–õ–ï–î–°–¢–í–ò–Ø

### 1. **–ü–æ—Ç–µ—Ä—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π**:
- –í—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–¥–µ–ª–∫–∞—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è

### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ä–∏—Å–∫–∞–º–∏**:
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
- –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç—ã —Ä–∏—Å–∫–∞
- –ù–µ—Ç–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞

### 3. **–ü–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤**:
- `accepted_signals` —Ç–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- –ü—Ä–æ–±–ª–µ–º—ã —Å DCA –ª–æ–≥–∏–∫–æ–π

## üîß –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–±—Ä–∞—Ç—å –æ—á–∏—Å—Ç–∫—É –ø–æ–∑–∏—Ü–∏–π (–†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ô)

```python
async def run_telegram_bot():
    app = ApplicationBuilder().token(TOKEN).build()
    # –ó–∞–≥—Ä—É–∂–∞–µ–º user_data.json –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    load_user_data(app)
    # ‚úÖ –£–ë–ò–†–ê–ï–ú: await clear_open_positions_and_history(app)
    # –¢–µ–ø–µ—Ä—å –ø–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£—Å–ª–æ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô)

```python
async def clear_open_positions_and_history(app, force_clear=False):
    if force_clear:  # –¢–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º —É–∫–∞–∑–∞–Ω–∏–∏
        for user_id, user_data in app.user_data.items():
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            deposit = user_data.get("deposit", 0)
            trade_mode = user_data.get("trade_mode", "spot")
            filter_mode = user_data.get("filter_mode", "enhanced_bollinger")
            news_filter_mode = user_data.get("news_filter_mode", "conservative")

            # –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ—Ä–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            user_data["open_positions"] = []
            user_data["accepted_signals"] = []

            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∞–∂–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            if deposit > 0:
                user_data["deposit"] = deposit
            if trade_mode:
                user_data["trade_mode"] = trade_mode
            if filter_mode:
                user_data["filter_mode"] = filter_mode
            if news_filter_mode:
                user_data["news_filter_mode"] = news_filter_mode

        save_user_data(app)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–ü–†–û–î–í–ò–ù–£–¢–´–ô)

```python
async def smart_clear_positions(app):
    """–£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ç–æ–ª—å–∫–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ–∑–∏—Ü–∏–π"""
    current_time = time.time()

    for user_id, user_data in app.user_data.items():
        open_positions = user_data.get("open_positions", [])

        # –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–∏ —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤
        updated_positions = []
        for pos in open_positions:
            entry_time = pos.get("entry_time", 0)
            if current_time - entry_time < 24 * 3600:  # 24 —á–∞—Å–∞
                updated_positions.append(pos)

        user_data["open_positions"] = updated_positions

    save_user_data(app)
```

## üìä –°–ò–°–¢–ï–ú–ê –°–û–•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–•

### –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **`save_user_data_to_file()`** - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **`load_user_data()`** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
3. **`user_data.json`** - —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ü—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ!

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. **–£–±—Ä–∞—Ç—å –≤—ã–∑–æ–≤** `clear_open_positions_and_history(app)` –∏–∑ `run_telegram_bot()`
2. **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É** –¥–ª—è —Ä—É—á–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–º–Ω—É—é –æ—á–∏—Å—Ç–∫—É** —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ–∑–∏—Ü–∏–π
3. **–î–æ–±–∞–≤–∏—Ç—å –±—ç–∫–∞–ø—ã** –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–∑–∏—Ü–∏—è–º–∏

## üîÑ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```python
# –í telegram_bot.py, —Å—Ç—Ä–æ–∫–∞ ~4370
async def run_telegram_bot():
    app = ApplicationBuilder().token(TOKEN).build()
    load_user_data(app)
    # –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨: await clear_open_positions_and_history(app)
```

### –≠—Ç–∞–ø 2: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ—á–∏—Å—Ç–∫–∏
```python
async def clear_positions_manual_cmd(update, context):
    """–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–π –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    user_id = update.effective_user.id
    user_data = context.application.user_data.get(user_id, {})

    old_count = len(user_data.get("open_positions", []))
    user_data["open_positions"] = []
    user_data["accepted_signals"] = []

    save_user_data_to_file(user_id, user_data)

    await update.message.reply_text(
        f"‚úÖ –û—á–∏—â–µ–Ω–æ {old_count} –ø–æ–∑–∏—Ü–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}"
    )
```

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/myreport`

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏
- ‚úÖ –¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∏—Å–∫–æ–≤ –∏ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ DCA
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ùå –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ–∑–∏—Ü–∏–π (—Ä–µ—à–∞–µ—Ç—Å—è —É–º–Ω–æ–π –æ—á–∏—Å—Ç–∫–æ–π)
- ‚ùå –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ `user_data.json` (—Ä–µ—à–∞–µ—Ç—Å—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π)

---

**–°—Ç–∞—Ç—É—Å**: üö® –¢–†–ï–ë–£–ï–¢ –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –í–´–°–û–ö–ò–ô
**–°–ª–æ–∂–Ω–æ—Å—Ç—å**: üü¢ –ü–†–û–°–¢–ê–Ø
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ‚è±Ô∏è 5-10 –º–∏–Ω—É—Ç
