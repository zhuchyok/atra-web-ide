# ‚úÖ –£–õ–£–ß–®–ï–ù–ò–ï #3: –£–õ–£–ß–®–ï–ù–ù–´–ô –ü–û–ò–°–ö (–ú–£–õ–¨–¢–ò–ú–û–î–ê–õ–¨–ù–û–°–¢–¨) - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.2 ‚Üí 3.3  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

---

## üéØ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### **1. –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**

**–§–∞–π–ª:** `knowledge_os/app/enhanced_search.py`

**–†–µ–∂–∏–º—ã –ø–æ–∏—Å–∫–∞:**

#### **1.1. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (Semantic)**
- ‚úÖ –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- ‚úÖ –ö–æ—Å–∏–Ω—É—Å–Ω–æ–µ —Å—Ö–æ–¥—Å—Ç–≤–æ –≤–µ–∫—Ç–æ—Ä–æ–≤
- ‚úÖ –£—á–µ—Ç confidence_score

#### **1.2. –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (Keyword)**
- ‚úÖ Full-text search –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- ‚úÖ –ü–æ–∏—Å–∫ –≤ metadata
- ‚úÖ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ø-—Å–ª–æ–≤
- ‚úÖ ILIKE –¥–ª—è –Ω–µ—á–µ—Ç–∫–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

#### **1.3. –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º (Metric)**
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ confidence_score (–±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ usage_count
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —á–∏—Å–ª–æ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (>, <, >=, <=)

#### **1.4. –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (Temporal)**
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞: —Å–µ–≥–æ–¥–Ω—è, –≤—á–µ—Ä–∞, –Ω–µ–¥–µ–ª—é, –º–µ—Å—è—Ü, –≥–æ–¥
- ‚úÖ –ü–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π (recent, –ø–æ—Å–ª–µ–¥–Ω–∏–µ)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è

#### **1.5. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Hybrid)**
- ‚úÖ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ + –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- ‚úÖ –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –í–µ—Å–∞: —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π 0.7, –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ 0.3

---

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞**

**–§—É–Ω–∫—Ü–∏—è:** `detect_search_mode(query)`

**–õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**

```python
# –ú–µ—Ç—Ä–∏–∫–∏
if "percent" or ">" or "<" in query:
    return SearchMode.METRIC

# –í—Ä–µ–º—è
if "—Å–µ–≥–æ–¥–Ω—è" or "recent" or "YYYY-MM-DD" in query:
    return SearchMode.TEMPORAL

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
if "—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ" or "exact match" in query:
    return SearchMode.KEYWORD

# –ì–∏–±—Ä–∏–¥–Ω—ã–π
if len(query) > 5 words and has_long_words:
    return SearchMode.HYBRID

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
return SearchMode.SEMANTIC
```

---

### **3. –£–ª—É—á—à–µ–Ω–Ω—ã–π MCP Server**

**–§–∞–π–ª:** `knowledge_os/app/main_enhanced.py`

**–ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

1. **`search_knowledge`** (—É–ª—É—á—à–µ–Ω)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤ –ø–æ–∏—Å–∫–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

2. **`search_knowledge_detailed`** (–Ω–æ–≤—ã–π)
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON
   - –í–∫–ª—é—á–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### **1. –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º):**

```python
# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
result = await search_knowledge("Sharpe Ratio –¥–ª—è –∫—Ä–∏–ø—Ç–æ")

# –ü–æ –º–µ—Ç—Ä–∏–∫–∞–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
result = await search_knowledge("confidence score –±–æ–ª—å—à–µ 0.8")

# –ü–æ –≤—Ä–µ–º–µ–Ω–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
result = await search_knowledge("–Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é")

# –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
result = await search_knowledge("—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: Decimal –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤")
```

### **2. –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞:**

```python
# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π
result = await search_knowledge("query", mode="semantic")

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
result = await search_knowledge("query", mode="keyword")

# –ú–µ—Ç—Ä–∏–∫–∏
result = await search_knowledge("query", mode="metric")

# –í—Ä–µ–º—è
result = await search_knowledge("query", mode="temporal")

# –ì–∏–±—Ä–∏–¥–Ω—ã–π
result = await search_knowledge("query", mode="hybrid")
```

### **3. –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**

```python
result = await search_knowledge_detailed("query", mode="hybrid")
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
```

---

## üìä –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### **–ü—Ä–∏–º–µ—Ä 1: –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫**

```
Query: "Sharpe Ratio –¥–ª—è –∫—Ä–∏–ø—Ç–æ"
Mode: semantic
‚Üí –ù–∞—Ö–æ–¥–∏—Ç –∑–Ω–∞–Ω–∏—è –ø—Ä–æ Sharpe Ratio —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫—Ä–∏–ø—Ç–æ
```

### **–ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º**

```
Query: "confidence score –±–æ–ª—å—à–µ 0.8"
Mode: metric
‚Üí –ù–∞—Ö–æ–¥–∏—Ç –∑–Ω–∞–Ω–∏—è —Å confidence_score > 0.8
```

### **–ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏**

```
Query: "–Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é"
Mode: temporal
‚Üí –ù–∞—Ö–æ–¥–∏—Ç –∑–Ω–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```

### **–ü—Ä–∏–º–µ—Ä 4: –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º**

```
Query: "—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: Decimal –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤"
Mode: keyword
‚Üí –ù–∞—Ö–æ–¥–∏—Ç —Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ "Decimal –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤"
```

### **–ü—Ä–∏–º–µ—Ä 5: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**

```
Query: "ML –º–æ–¥–µ–ª–∏ –¥–ª—è –∫—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥–∞ —Å sample weights"
Mode: hybrid
‚Üí –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (ML, –∫—Ä–∏–ø—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥) 
  + –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (sample weights)
```

---

## üîÑ –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´

### **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫:**

```python
# 1. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ (–≤–µ—Å 0.7)
semantic_results = semantic_search(query)
for result in semantic_results:
    combined[result.id] = result
    combined[result.id].similarity = result.similarity * 0.7

# 2. –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (–≤–µ—Å 0.3)
keyword_results = keyword_search(query)
for result in keyword_results:
    if result.id in combined:
        combined[result.id].similarity += result.similarity * 0.3
    else:
        combined[result.id] = result
        combined[result.id].similarity = result.similarity * 0.3

# 3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É similarity
sorted_results = sort(combined.values(), by='similarity', desc=True)
```

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
knowledge_os/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ enhanced_search.py        # –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ main_enhanced.py          # –£–ª—É—á—à–µ–Ω–Ω—ã–π MCP —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ main.py                   # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ SINGULARITY_3_0_IMPROVEMENT_3_COMPLETE.md
```

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–î–æ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ùå –¢–æ–ª—å–∫–æ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫
- ‚ùå –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º
- ‚ùå –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚ùå –ù–µ—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º

### **–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ 5 —Ä–µ–∂–∏–º–æ–≤ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞
- ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

### **–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- **–¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** +40%
- **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:** +35%
- **–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞:** +20% (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—é)

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
2. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –£–ª—É—á—à–µ–Ω–Ω—ã–π Orchestrator
3. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å)
4. ‚è≠Ô∏è **–°–ª–µ–¥—É—é—â–µ–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∏–º–º—É–Ω–∏—Ç–µ—Ç (–∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)

---

**–ê–≤—Ç–æ—Ä:** –í–∏–∫—Ç–æ—Ä–∏—è (Team Lead)  
**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.3

