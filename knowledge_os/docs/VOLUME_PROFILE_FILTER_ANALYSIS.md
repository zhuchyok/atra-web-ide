# üìä –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó VOLUME PROFILE –§–ò–õ–¨–¢–†–ê

## 1. –¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –§–ò–õ–¨–¢–†–û–í

### 1.1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ config.py

```python
# config.py, —Å—Ç—Ä–æ–∫–∏ 821-824
USE_VP_FILTER = os.getenv("USE_VP_FILTER", "true").lower() in ("1", "true", "yes")
USE_VWAP_FILTER = os.getenv("USE_VWAP_FILTER", "true").lower() in ("1", "true", "yes")
```

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `USE_VP_FILTER`: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `true` (–≤–∫–ª—é—á–µ–Ω)
- `USE_VWAP_FILTER`: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `true` (–≤–∫–ª—é—á–µ–Ω)
- `DISABLE_EXTRA_FILTERS`: –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (Order Flow, Microstructure, Momentum, Trend Strength, AMT)

### 1.2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```python
# scripts/optimize_filter_params.py
OPTIMIZATION_PARAMS = {
    'volume_profile': {
        'param_name': 'volume_profile_threshold',
        'values': [0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
        'default': 0.6
    }
}
```

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ—Ä–æ–≥–∏:** `[0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]`

---

## 2. –õ–û–ì–ò–ö–ê VOLUME PROFILE –§–ò–õ–¨–¢–†–ê

### 2.1. –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞

**–§–∞–π–ª:** `src/signals/filters_volume_vwap.py`, —Ñ—É–Ω–∫—Ü–∏—è `check_volume_profile_filter()`

### 2.2. –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```python
# –°—Ç—Ä–æ–∫–∏ 58-71
volume_profile_threshold = float(os.environ.get('volume_profile_threshold', '1.0'))

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ threshold –≤ tolerance_pct
# threshold=0.3 -> tolerance=10% (–±–æ–ª–µ–µ –º—è–≥–∫–∏–π)
# threshold=1.0 -> tolerance=3% (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π)
tolerance_pct = max(1.0, min(10.0, (1.0 / volume_profile_threshold) * 3.0))

# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ threshold –≤ value_area_pct
# threshold=0.3 -> value_area=50% (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π)
# threshold=1.0 -> value_area=70% (–±–æ–ª–µ–µ –º—è–≥–∫–∏–π)
value_area_pct = max(0.5, min(0.8, 0.5 + volume_profile_threshold * 0.2))
```

**–§–æ—Ä–º—É–ª—ã:**
- `tolerance_pct = (1.0 / threshold) * 3.0` (–∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
- `value_area_pct = 0.5 + threshold * 0.2` (–ø—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)

### 2.3. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

#### –î–ª—è LONG —Å–∏–≥–Ω–∞–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 118-137):

```python
if side.lower() == "long":
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –≤–±–ª–∏–∑–∏ VAL (Value Area Low)
    if val:
        distance_from_val_pct = abs(current_price - val) / current_price * 100
        if distance_from_val_pct <= tolerance_pct:
            return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –Ω–∏–∂–µ POC
    if current_price <= poc:
        return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area (—Ç–æ–ª—å–∫–æ –≤ –º—è–≥–∫–æ–º —Ä–µ–∂–∏–º–µ)
    if not strict_mode and vah and val:
        if val <= current_price <= vah:
            return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 4. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ - –ë–õ–û–ö–ò–†–£–ï–¢
    return False, "LONG: —Ü–µ–Ω–∞ –Ω–µ –≤–±–ª–∏–∑–∏ VAL –∏–ª–∏ –Ω–∏–∂–µ POC"
```

#### –î–ª—è SHORT —Å–∏–≥–Ω–∞–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 139-157):

```python
if side.lower() == "short":
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –≤–±–ª–∏–∑–∏ VAH (Value Area High)
    if vah:
        distance_from_vah_pct = abs(current_price - vah) / current_price * 100
        if distance_from_vah_pct <= tolerance_pct:
            return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 2. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –≤—ã—à–µ POC
    if current_price >= poc:
        return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ü–µ–Ω–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area (—Ç–æ–ª—å–∫–æ –≤ –º—è–≥–∫–æ–º —Ä–µ–∂–∏–º–µ)
    if not strict_mode and vah and val:
        if val <= current_price <= vah:
            return True, None  # ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
    
    # 4. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–¥–æ—à–ª–æ - –ë–õ–û–ö–ò–†–£–ï–¢
    return False, "SHORT: —Ü–µ–Ω–∞ –Ω–µ –≤–±–ª–∏–∑–∏ VAH –∏–ª–∏ –≤—ã—à–µ POC"
```

### 2.4. –†–∞—Å—á–µ—Ç Volume Profile

**–§–∞–π–ª:** `src/analysis/volume_profile.py`, –∫–ª–∞—Å—Å `VolumeProfileAnalyzer`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. **Lookback –ø–µ—Ä–∏–æ–¥:** 30 —Å–≤–µ—á–µ–π (soft mode) –∏–ª–∏ 50 —Å–≤–µ—á–µ–π (strict mode)
2. **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—ä–µ–º–∞:** –û–±—ä–µ–º –∫–∞–∂–¥–æ–π —Å–≤–µ—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ 3-5 —Ç–æ—á–∫–∞–º –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ —Ü–µ–Ω—ã
3. **–ë–∏–Ω—ã:** 50 –±–∏–Ω–æ–≤ –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã
4. **POC (Point of Control):** –ë–∏–Ω —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –æ–±—ä–µ–º–æ–º
5. **Value Area:** –ó–æ–Ω–∞, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è `value_area_pct` (50%-70%) –æ—Ç –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞

**–§–æ—Ä–º—É–ª–∞ Value Area:**
```python
target_volume = total_volume * value_area_pct
# –ù–∞—Ö–æ–¥–∏–º –±–∏–Ω—ã —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –æ–±—ä–µ–º–æ–º –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è target_volume
```

---

## 3. –ü–†–ò–ú–ï–† –°–´–†–´–• –î–ê–ù–ù–´–•

### 3.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Volume Profile

```python
volume_profile = {
    "poc": 43250.5,              # Point of Control (—Ü–µ–Ω–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –æ–±—ä–µ–º–æ–º)
    "poc_volume": 1250000.0,     # –û–±—ä–µ–º –≤ POC
    "value_area_high": 43500.0,  # –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ Value Area
    "value_area_low": 43000.0,   # –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ Value Area
    "high_volume_zones": [       # –¢–æ–ø-5 –∑–æ–Ω –≤—ã—Å–æ–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
        {
            "price": 43250.5,
            "volume": 1250000.0,
            "volume_pct": 15.2
        },
        # ... –µ—â–µ 4 –∑–æ–Ω—ã
    ],
    "total_volume": 8200000.0     # –û–±—â–∏–π –æ–±—ä–µ–º –∑–∞ –ø–µ—Ä–∏–æ–¥
}
```

### 3.2. –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–≥–Ω–∞–ª–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```python
symbol = "BTCUSDT"
current_price = 43100.0
side = "long"
volume_profile_threshold = 0.6
strict_mode = False
```

**–†–∞—Å—á–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```python
tolerance_pct = (1.0 / 0.6) * 3.0 = 5.0%  # –î–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
value_area_pct = 0.5 + 0.6 * 0.2 = 0.62 = 62%  # –†–∞–∑–º–µ—Ä Value Area
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç VAL
val = 43000.0
distance_from_val_pct = abs(43100.0 - 43000.0) / 43100.0 * 100 = 0.23%
# 0.23% <= 5.0% ‚Üí ‚úÖ –ü–†–û–ü–£–°–ö–ê–ï–¢
```

---

## 4. –ú–ï–¢–†–ò–ö–ò –ò –†–ï–ó–£–õ–¨–¢–ê–¢–´

### 4.1. Baseline (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞)

```python
baseline_results = {
    'total_return': +5.57%,
    'total_trades': 244,
    'total_signals': 470,
    'total_executed': 244,
    'rejection_rate': 48.1%,
    'avg_win_rate': 84.6%,
    'avg_profit_factor': 2.39,
    'avg_sharpe': 9.56
}
```

### 4.2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å Volume Profile —Ñ–∏–ª—å—Ç—Ä–æ–º

**–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```python
current_results = {
    'total_return': -0.79%,      # ‚ö†Ô∏è –£–•–£–î–®–ï–ù–ò–ï –Ω–∞ -6.36%
    'total_trades': 70,           # ‚ö†Ô∏è –£–ú–ï–ù–¨–®–ï–ù–ò–ï –Ω–∞ -71%
    'total_signals': 2536,        # ‚ö†Ô∏è –£–í–ï–õ–ò–ß–ï–ù–ò–ï —Å–∏–≥–Ω–∞–ª–æ–≤ (—Å—Ç—Ä–∞–Ω–Ω–æ!)
    'total_executed': 70,
    'rejection_rate': 97.2%,      # ‚ö†Ô∏è –û–ì–†–û–ú–ù–û–ï —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π
    'avg_win_rate': 63.1%,        # ‚ö†Ô∏è –£–•–£–î–®–ï–ù–ò–ï –Ω–∞ -21.5%
    'avg_profit_factor': 0.99,   # ‚ö†Ô∏è –£–•–£–î–®–ï–ù–ò–ï –Ω–∞ -58.6%
    'avg_sharpe': 2.27            # ‚ö†Ô∏è –£–•–£–î–®–ï–ù–ò–ï –Ω–∞ -76.3%
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ 8 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (0.3-1.0) –¥–∞—é—Ç **–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** (-0.79%, 70 —Å–¥–µ–ª–æ–∫)

---

## 5. –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### 5.1. –ü–æ—á–µ–º—É –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?

**–ì–∏–ø–æ—Ç–µ–∑–∞ 1: –§–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π –≤ soft mode**

–í —Å—Ç—Ä–æ–∫–µ 128-130 `check_volume_profile_filter()`:
```python
# –ï—Å–ª–∏ —Ü–µ–Ω–∞ –≤—ã—à–µ POC, –Ω–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area - OK –≤ –º—è–≥–∫–æ–º —Ä–µ–∂–∏–º–µ
if not strict_mode and vah and val:
    if val <= current_price <= vah:
        return True, None  # ‚úÖ –í–°–ï–ì–î–ê –ü–†–û–ü–£–°–ö–ê–ï–¢!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í soft mode (`strict_mode=False`) —Ñ–∏–ª—å—Ç—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç** –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `threshold`!

**–ì–∏–ø–æ—Ç–µ–∑–∞ 2: –ü–∞—Ä–∞–º–µ—Ç—Ä threshold –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É**

–ü–∞—Ä–∞–º–µ—Ç—Ä `threshold` –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞:
- `tolerance_pct` (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç VAL/VAH)
- `value_area_pct` (—Ä–∞–∑–º–µ—Ä Value Area)

–ù–æ **–Ω–µ –≤–ª–∏—è–µ—Ç** –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É "—Ü–µ–Ω–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area" (—Å—Ç—Ä–æ–∫–∞ 129), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã!

### 5.2. –ü–æ—á–µ–º—É —Ñ–∏–ª—å—Ç—Ä —É—Ö—É–¥—à–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã?

1. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:** 97.2% —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è (vs 48.1% –≤ baseline)
2. **–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ö–æ—Ä–æ—à–∏–µ —Å–∏–≥–Ω–∞–ª—ã:** –§–∏–ª—å—Ç—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤ baseline –±—ã–ª–∏ –ø—Ä–∏–±—ã–ª—å–Ω—ã–º–∏
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–¥–µ–ª–æ–∫:** 70 —Å–¥–µ–ª–æ–∫ vs 244 –≤ baseline (-71%)

### 5.3. –ü–æ—á–µ–º—É —É–≤–µ–ª–∏—á–∏–ª–æ—Å—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤?

**–°—Ç—Ä–∞–Ω–Ω–æ—Å—Ç—å:** 2536 —Å–∏–≥–Ω–∞–ª–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º vs 470 –≤ baseline (+439%)!

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:** –§–∏–ª—å—Ç—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–¥–æ** –¥—Ä—É–≥–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤, –∏ –≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

---

## 6. –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 6.1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. **–û—Ç–∫–ª—é—á–∏—Ç—å Volume Profile —Ñ–∏–ª—å—Ç—Ä** - –æ–Ω —É—Ö—É–¥—à–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å baseline** –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ (+5.57%, 244 —Å–¥–µ–ª–∫–∏)

### 6.2. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä

**–ü—Ä–æ–±–ª–µ–º–∞ 1: –°–ª–∏—à–∫–æ–º –º—è–≥–∫–∞—è –ª–æ–≥–∏–∫–∞ –≤ soft mode**

```python
# –¢–ï–ö–£–©–ê–Ø –õ–û–ì–ò–ö–ê (—Å—Ç—Ä–æ–∫–∞ 128-130):
if not strict_mode and vah and val:
    if val <= current_price <= vah:
        return True, None  # –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –í–°–ï –≤ Value Area

# –ü–†–ï–î–õ–ê–ì–ê–ï–ú–ê–Ø –õ–û–ì–ò–ö–ê:
if not strict_mode and vah and val:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç POC
    distance_from_poc_pct = abs(current_price - poc) / current_price * 100
    if val <= current_price <= vah and distance_from_poc_pct <= tolerance_pct * 2:
        return True, None  # –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±–ª–∏–∑–∫–æ –∫ POC
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–∞—Ä–∞–º–µ—Ç—Ä threshold –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É**

–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã `threshold` –≤–ª–∏—è–ª –Ω–∞ —Å—Ç—Ä–æ–≥–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ "–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö Value Area".

**–ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–∏–ª–∞ Volume Profile**

–¢–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç:
- –°–∏–ª—É POC (–æ–±—ä–µ–º –≤ POC)
- –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –æ–±—ä–µ–º–∞
- –î–∏–Ω–∞–º–∏–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è Volume Profile

### 6.3. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–í–º–µ—Å—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Volume Profile –¥–ª—è:
1. **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏** (–º–µ–Ω—å—à–µ –ø–æ–∑–∏—Ü–∏—è –≤ –∑–æ–Ω–∞—Ö –Ω–∏–∑–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
2. **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ TP/SL** (–±–ª–∏–∂–µ –∫ POC/Value Area)
3. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤** (–≤—ã—à–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ Value Area)

---

## 7. –õ–û–ì–ò –ë–õ–û–ö–ò–†–û–í–û–ö (–ø—Ä–∏–º–µ—Ä—ã)

### 7.1. –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π

```python
# –ü—Ä–∏–º–µ—Ä 1: LONG —Å–∏–≥–Ω–∞–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω
{
    'symbol': 'BTCUSDT',
    'side': 'long',
    'current_price': 43500.0,
    'poc': 43250.0,
    'val': 43000.0,
    'vah': 43500.0,
    'tolerance_pct': 5.0,
    'reason': 'LONG: —Ü–µ–Ω–∞ –Ω–µ –≤–±–ª–∏–∑–∏ VAL –∏–ª–∏ –Ω–∏–∂–µ POC (price=43500.00, POC=43250.00, VAL=43000.00)'
}

# –ü—Ä–∏–º–µ—Ä 2: SHORT —Å–∏–≥–Ω–∞–ª –æ—Ç–∫–ª–æ–Ω–µ–Ω
{
    'symbol': 'ETHUSDT',
    'side': 'short',
    'current_price': 2450.0,
    'poc': 2500.0,
    'val': 2400.0,
    'vah': 2550.0,
    'tolerance_pct': 5.0,
    'reason': 'SHORT: —Ü–µ–Ω–∞ –Ω–µ –≤–±–ª–∏–∑–∏ VAH –∏–ª–∏ –≤—ã—à–µ POC (price=2450.00, POC=2500.00, VAH=2550.00)'
}
```

### 7.2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π

- **–í—Å–µ–≥–æ —Å–∏–≥–Ω–∞–ª–æ–≤:** 2536
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–æ:** 2466 (97.2%)
- **–ü—Ä–æ–ø—É—â–µ–Ω–æ:** 70 (2.8%)

**–ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π:**
- –¶–µ–Ω–∞ –Ω–µ –≤–±–ª–∏–∑–∏ VAL/VAH: ~60%
- –¶–µ–Ω–∞ –Ω–µ –Ω–∏–∂–µ/–≤—ã—à–µ POC: ~30%
- –¶–µ–Ω–∞ —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –æ—Ç Value Area: ~10%

---

## 8. –í–´–í–û–î–´

1. **Volume Profile —Ñ–∏–ª—å—Ç—Ä —É—Ö—É–¥—à–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
   - –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: +5.57% ‚Üí -0.79% (-6.36%)
   - –°–¥–µ–ª–æ–∫: 244 ‚Üí 70 (-71%)
   - Win Rate: 84.6% ‚Üí 63.1% (-21.5%)

2. **–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –ü—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∏–∫–µ —Ñ–∏–ª—å—Ç—Ä–∞, –∞ –Ω–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
   - –í soft mode —Ñ–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–π (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –≤ Value Area)

3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
   - **–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** Volume Profile —Ñ–∏–ª—å—Ç—Ä –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å baseline –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ (+5.57%, 244 —Å–¥–µ–ª–∫–∏)

4. **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:**
   - –£–∂–µ—Å—Ç–æ—á–∏—Ç—å –ª–æ–≥–∏–∫—É –≤ soft mode
   - –°–¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `threshold` –≤–ª–∏—è—é—â–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
   - –î–æ–±–∞–≤–∏—Ç—å —É—á–µ—Ç —Å–∏–ª—ã Volume Profile

---

## 9. –ö–û–î –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

```python
# –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
import os
os.environ['USE_VP_FILTER'] = 'True'
os.environ['volume_profile_threshold'] = '0.6'

from src.signals.filters_volume_vwap import check_volume_profile_filter
import pandas as pd

# –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
df = pd.DataFrame({
    'close': [43100.0],
    'high': [43200.0],
    'low': [43000.0],
    'volume': [1000000.0]
})

# –¢–µ—Å—Ç
vp_ok, reason = check_volume_profile_filter(df, 0, 'long', strict_mode=False)
print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {vp_ok}, –ü—Ä–∏—á–∏–Ω–∞: {reason}")
```

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-29  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚ùå –§–∏–ª—å—Ç—Ä —É—Ö—É–¥—à–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–∏—Ç—å

