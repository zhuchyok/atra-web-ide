Архитектура
===========

Обзор архитектуры торгового бота ATRA.

Модульная структура
-------------------

Система построена на принципах модульной архитектуры с четким разделением ответственности:

.. code-block:: text

   src/
   ├── signals/          # Основная логика сигналов
   │   ├── core.py       # Генерация сигналов
   │   ├── indicators.py # Технические индикаторы
   │   ├── risk.py       # Управление рисками
   │   ├── generation.py # Генерация и отправка
   │   └── validation.py # Валидация данных
   ├── filters/          # Фильтры сигналов
   │   ├── news.py       # Новостные фильтры
   │   ├── btc_trend.py  # BTC тренд фильтры
   │   └── whale.py      # Китовые фильтры
   ├── data/             # Провайдеры данных
   │   └── providers.py  # Источники данных
   └── utils/            # Утилиты
       └── helpers.py    # Вспомогательные функции

Основные компоненты
-------------------

Система сигналов
~~~~~~~~~~~~~~~~

Центральный компонент системы, отвечающий за генерацию торговых сигналов.

**Основные функции:**
- Анализ рыночных данных
- Применение технических индикаторов
- Генерация сигналов на покупку/продажу
- Валидация качества сигналов

**Модули:**
- `core.py` - основная логика генерации
- `indicators.py` - технические индикаторы
- `validation.py` - валидация данных

Фильтры сигналов
~~~~~~~~~~~~~~~~

Система фильтрации для отбора качественных сигналов.

**Типы фильтров:**
- **Технические** - Bollinger Bands, EMA, RSI
- **Объемные** - анализ объемов торгов
- **Временные** - торговые часы
- **AI/ML** - машинное обучение

**Модули:**
- `news.py` - новостные фильтры
- `btc_trend.py` - анализ тренда BTC
- `whale.py` - отслеживание китов

Управление рисками
~~~~~~~~~~~~~~~~~~

Динамическое управление рисками на основе рыночных условий.

**Функции:**
- Расчет динамического риска
- Определение размера позиции
- Управление плечом
- Расчет TP/SL

**Модули:**
- `risk.py` - основная логика рисков
- `position_sizing.py` - расчет размера позиции

Провайдеры данных
~~~~~~~~~~~~~~~~~

Система получения и валидации рыночных данных.

**Источники данных:**
- Binance API
- CoinGecko API
- CoinMarketCap API
- Локальные источники

**Функции:**
- Получение OHLC данных
- Валидация качества данных
- Кэширование данных
- Обработка ошибок

Поток данных
------------

.. code-block:: text

   Источники данных → Валидация → Индикаторы → Фильтры → Сигналы → Отправка
   
   1. Получение данных из API
   2. Валидация качества данных
   3. Расчет технических индикаторов
   4. Применение фильтров
   5. Генерация сигналов
   6. Валидация сигналов
   7. Отправка через Telegram

AI/ML интеграция
----------------

Система использует машинное обучение для оптимизации параметров.

**Компоненты:**
- **Обучение** - анализ исторических данных
- **Оптимизация** - автоматическая настройка параметров
- **Предсказание** - прогнозирование рыночных движений
- **Адаптация** - подстройка под текущие условия

**Модули:**
- `ai_learning_system.py` - система обучения
- `ai_optimizer.py` - оптимизация параметров
- `ai_predictor.py` - предсказания

Мониторинг и логирование
-------------------------

Комплексная система мониторинга и логирования.

**Компоненты:**
- **Логирование** - детальные логи всех операций
- **Метрики** - статистика производительности
- **Алерты** - уведомления о проблемах
- **Дашборд** - визуализация состояния системы

**Модули:**
- `enhanced_logging.py` - система логирования
- `monitoring_system.py` - мониторинг
- `alert_system.py` - система алертов

Безопасность
-------------

Многоуровневая система безопасности.

**Уровни:**
1. **Валидация данных** - проверка всех входных данных
2. **Авторизация** - контроль доступа к функциям
3. **Шифрование** - защита чувствительных данных
4. **Аудит** - логирование всех операций

**Модули:**
- `security.py` - основная логика безопасности
- `encryption.py` - шифрование данных
- `audit.py` - система аудита

Масштабируемость
----------------

Архитектура поддерживает горизонтальное и вертикальное масштабирование.

**Горизонтальное масштабирование:**
- Множественные экземпляры бота
- Распределенная обработка данных
- Балансировка нагрузки

**Вертикальное масштабирование:**
- Оптимизация производительности
- Кэширование данных
- Асинхронная обработка

**Модули:**
- `scaling.py` - логика масштабирования
- `load_balancer.py` - балансировка нагрузки
- `cache_manager.py` - управление кэшем
