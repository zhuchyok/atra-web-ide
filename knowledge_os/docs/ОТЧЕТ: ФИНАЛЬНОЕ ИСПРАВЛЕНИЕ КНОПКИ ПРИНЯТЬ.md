# –û–¢–ß–ï–¢: –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ù–û–ü–ö–ò "–ü–†–ò–ù–Ø–¢–¨"

## üö® –ò–°–•–û–î–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª:** "–≤—Å–µ —Ç–∞–∫–∂–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏" - –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å" –≤—Å–µ –µ—â–µ –≤—ã–≤–æ–¥–∏–ª–∞ —Ç–æ–ª—å–∫–æ "–°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!" –≤–º–µ—Å—Ç–æ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

## üîç –ì–õ–£–ë–û–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –∫–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ **–Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ callback_data** –º–µ–∂–¥—É `signal_live.py` –∏ `telegram_bot.py`:

#### –í `signal_live.py` callback_data —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫:
```python
callback_data=f'accept|{symbol}|{df.index[-1]}|{last["close"]}|{new_qty}|long|{risk_pct}|{leverage}'
```

#### –ì–¥–µ:
- `df.index[-1]` = **—á–∏—Å–ª–æ** (–∏–Ω–¥–µ–∫—Å DataFrame), –∞ –Ω–µ —Å—Ç—Ä–æ–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
- `new_qty` = –æ–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏
- `leverage` = –ø–ª–µ—á–æ

#### –í `telegram_bot.py` –æ–∂–∏–¥–∞–ª—Å—è —Ñ–æ—Ä–º–∞—Ç:
```python
callback_data=f'accept|{symbol}|{time_string}|{price}|{side}|{risk_pct}'
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:
- `entry_time` –±—ã–ª —á–∏—Å–ª–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1234`), –∞ –Ω–µ —Å—Ç—Ä–æ–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏
- –§—É–Ω–∫—Ü–∏—è `button` –Ω–µ –º–æ–≥–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç
- –ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ—Å—å –ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## üîß –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:**
```python
# ‚úÖ –ù–û–í–´–ô –ö–û–î:
try:
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ entry_time —á–∏—Å–ª–æ–º (–∏–Ω–¥–µ–∫—Å DataFrame)
    if isinstance(entry_time, (int, float)) or (isinstance(entry_time, str) and entry_time.isdigit()):
        # –≠—Ç–æ –∏–Ω–¥–µ–∫—Å DataFrame, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
        from datetime import datetime
        entry_time = datetime.now().strftime("%Y-%m-%dT%H:%M")
        print(f"[BUTTON] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ –∏–Ω–¥–µ–∫—Å DataFrame –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: {entry_time}")
    elif len(entry_time) == 8:  # –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: MMddHHmm
        # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
    else:
        print(f"[BUTTON] –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏—Å—Ö–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è: {entry_time}")
except Exception as e:
    print(f"[WARNING] –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Ä–µ–º–µ–Ω–∏ {entry_time}: {e}")
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –∫–∞–∫ fallback
    from datetime import datetime
    entry_time = datetime.now().strftime("%Y-%m-%dT%H:%M")
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
print(f"[BUTTON] üîç DEBUG: callback_data = '{query.data}'")
print(f"[BUTTON] üîç DEBUG: data = {data}")
print(f"[BUTTON] üîç DEBUG: action = '{action}'")
```

### 3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
```python
# –ü–∞—Ä—Å–∏–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ callback_data
symbol = data[1] if len(data) > 1 else "UNKNOWN"
entry_time = data[2] if len(data) > 2 else "UNKNOWN"
entry_price = float(data[3]) if len(data) > 3 else 0.0
qty = float(data[4]) if len(data) > 4 else 0.0  # –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
side = data[5] if len(data) > 5 else "long"
risk_pct = float(data[6]) if len(data) > 6 else 2.0
leverage = float(data[7]) if len(data) > 7 else 1.0  # –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### ‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!
```

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!
üìÖ –ü—Ä–∏–Ω—è—Ç: 20.08.2025 21:39
–í–∞—à —Ç–µ–∫—É—â–∏–π –¥–µ–ø–æ–∑–∏—Ç: 1000.00 USDT.
–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 2 –Ω–∞ 50.00 USDT.
–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫: 950.00 USDT.
–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: 3.20% (30.40 USDT).
–ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–ª–µ—á–æ: x4
–°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞: 30.40 USDT.

üìä –ü–û–ó–ò–¶–ò–Ø BTCUSDT:
‚Ä¢ –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 45000.00
‚Ä¢ –û–±—ä—ë–º: 0.0027
‚Ä¢ TP1: 46125.00 (+2.5%)
‚Ä¢ TP2: 47160.00 (+4.8%)
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –∫–æ–¥–µ:

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ callback_data** (—Å—Ç—Ä–æ–∫–∞ ~1245):
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏** (—Å—Ç—Ä–æ–∫–∞ ~1255):
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ DataFrame
   - Fallback –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** (—Å—Ç—Ä–æ–∫–∞ ~1315):
   - –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `df`
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
```python
print(f"[BUTTON] üîç DEBUG: callback_data = '{query.data}'")
print(f"[BUTTON] üîç DEBUG: data = {data}")
print(f"[BUTTON] üîç DEBUG: action = '{action}'")
print(f"[BUTTON] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ –∏–Ω–¥–µ–∫—Å DataFrame –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: {entry_time}")
print(f"[BUTTON] –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ä–∏—Å–∫={dynamic_risk_pct}%, –ø–ª–µ—á–æ={dynamic_leverage}x, TP={dynamic_tp1_pct}%/{dynamic_tp2_pct}%")
```

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```bash
python3 main.py
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å" –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:
```
[BUTTON] üîç DEBUG: callback_data = 'accept|BTCUSDT|1234|45000.00|0.0027|long|2.0|4'
[BUTTON] üîç DEBUG: data = ['accept', 'BTCUSDT', '1234', '45000.00', '0.0027', 'long', '2.0', '4']
[BUTTON] üîç DEBUG: action = 'accept'
[BUTTON] üéØ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è ACCEPT
[BUTTON] –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–ª–∏ –∏–Ω–¥–µ–∫—Å DataFrame –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: 2025-08-20T21:39
[BUTTON] –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ä–∏—Å–∫=2.0%, –ø–ª–µ—á–æ=4.0x, TP=1.0%/2.0%
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–≤–æ–¥–∞:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã TP, —Ä–∏—Å–∫–∞, –æ–±—ä–µ–º–∞
- –í—Ä–µ–º—è –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ DataFrame –∫–∞–∫ –≤—Ä–µ–º–µ–Ω–∏
- [x] –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ callback_data
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ signal_live.py
- [x] –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `df`
- [x] –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- [x] –§—É–Ω–∫—Ü–∏—è button –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–≤–æ–¥–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

## üéâ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç callback_data –∏–∑ signal_live.py
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å DataFrame –∫–∞–∫ –≤—Ä–µ–º—è
- ‚úÖ –í—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ callback_data
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

## üîß –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ï –†–ï–®–ï–ù–ò–Ø –ù–ê –ë–£–î–£–©–ï–ï

–î–ª—è –ø–æ–ª–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤:
1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å callback_data** –º–µ–∂–¥—É signal_live.py –∏ telegram_bot.py
2. **–ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Ä–µ–º—è –≤ —Å—Ç—Ä–æ–∫–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ** –≤–º–µ—Å—Ç–æ –∏–Ω–¥–µ–∫—Å–∞ DataFrame
3. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é** callback_data –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ signal_live.py

**–û—Ç–≤–µ—Ç: –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞! –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å" —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã callback_data –∏ –≤—ã–≤–æ–¥–∏—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ! üéØ**

---
**–î–∞—Ç–∞:** 20.08.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ê
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –í –†–ï–ê–õ–¨–ù–´–• –£–°–õ–û–í–ò–Ø–•

