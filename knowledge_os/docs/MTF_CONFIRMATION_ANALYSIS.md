# üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ MTF CONFIRMATION

**–î–∞—Ç–∞:** 2025-12-01  
**–ü—Ä–æ–±–ª–µ–º–∞:** MTF confirmation –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `confidence=0.00` –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ SHORT —Å–∏–≥–Ω–∞–ª—ã

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú–´

### –ß—Ç–æ –≤–∏–¥–Ω–æ –≤ –ª–æ–≥–∞—Ö:
```
üéØ –ì–∏–±—Ä–∏–¥–Ω—ã–π MTF LUNAUSDT SELL: H4=0.00, H1=0.00, market=0.30, final=0.00
```

### –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:

#### 1. **–õ–æ–≥–∏–∫–∞ H4 confirmation –¥–ª—è SHORT:**
```python
# –í hybrid_mtf.py, —Å—Ç—Ä–æ–∫–∏ 219-244
if signal_type.upper() == "SHORT":
    if current_price < ema_fast and ema_fast < ema_slow:
        confidence = 0.85  # –°–∏–ª—å–Ω—ã–π –º–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥
    elif current_price < ema_slow and ema_fast < ema_slow:
        confidence = 0.75  # –ú–µ–¥–≤–µ–∂–∏–π —Ç—Ä–µ–Ω–¥
    elif current_price < ema_slow:
        confidence = 0.65  # –¶–µ–Ω–∞ –Ω–∏–∂–µ –º–µ–¥–ª–µ–Ω–Ω–æ–π EMA
    else:
        confidence = 0.4   # –ù–µ –º–µ–¥–≤–µ–∂–∏–π
        confirmed = False
    
    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: 0.6
    min_confidence = 0.6
    confirmed = confirmed and confidence >= min_confidence
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, `confidence = 0.4`, –Ω–æ –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∞ `confidence >= 0.6` –¥–µ–ª–∞–µ—Ç `confirmed = False`.

#### 2. **–õ–æ–≥–∏–∫–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏:**
```python
# –í hybrid_mtf.py, —Å—Ç—Ä–æ–∫–∏ 469-499
# Boost –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏:
# - h1_trend_strength >= 0.6 (—Å–ª–∞–±—ã–π boost)
# - market_momentum >= 0.6 (—É–º–µ—Ä–µ–Ω–Ω—ã–π boost)

# –ï—Å–ª–∏ market_momentum = 0.30 (< 0.6), boost –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è!
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ `market_momentum = 0.30` boost –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É `final_confidence` –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∏–∑–∫–∏–º.

#### 3. **–ü–æ—á–µ–º—É H4=0.00?**
–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- –î–∞–Ω–Ω—ã–µ H4 –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã (`df_h4 is None`)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–∫, NaN –∑–Ω–∞—á–µ–Ω–∏—è)
- –£—Å–ª–æ–≤–∏—è –¥–ª—è SHORT –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –∏ `confidence = 0.4`, –Ω–æ –∑–∞—Ç–µ–º —á—Ç–æ-—Ç–æ –æ–±–Ω—É–ª—è–µ—Ç –µ–≥–æ

---

## üí° –†–ï–®–ï–ù–ò–Ø (–†–ê–ó–ù–´–ï –ü–û–î–•–û–î–´)

### **–ü–û–î–•–û–î 1: –°–Ω–∏–∑–∏—Ç—å min_h4_confidence –¥–ª—è SHORT**

**–ò–¥–µ—è:** SHORT —Å–∏–≥–Ω–∞–ª—ã —Ç—Ä–µ–±—É—é—Ç –±–æ–ª–µ–µ –º—è–≥–∫–∏—Ö —É—Å–ª–æ–≤–∏–π, —Ç–∞–∫ –∫–∞–∫ —Ä—ã–Ω–æ–∫ —á–∞—â–µ —Ä–∞—Å—Ç–µ—Ç.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í hybrid_mtf.py, _check_h4_confirmation
if signal_type.upper() == "SHORT":
    min_confidence = self.mtf_config.get('min_h4_confidence_short', 0.4)  # –°–Ω–∏–∂–µ–Ω–æ —Å 0.6
else:
    min_confidence = self.mtf_config.get('min_h4_confidence', 0.6)
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É SHORT —Å–∏–≥–Ω–∞–ª–æ–≤

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã

---

### **–ü–û–î–•–û–î 2: –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π boost –¥–ª—è –Ω–∏–∑–∫–æ–≥–æ market_momentum**

**–ò–¥–µ—è:** –î–∞–∂–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º market_momentum –¥–∞–≤–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π boost.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í hybrid_mtf.py, _apply_hybrid_compensation
# –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π boost –¥–ª—è market_momentum < 0.6
if market_momentum >= 0.3:  # –î–∞–∂–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∏–º–ø—É–ª—å—Å–µ
    boost_amount = min(max_boost * 0.1, 0.035)  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π boost
    hybrid_boost += boost_amount
    reason_parts.append(f"–†—ã–Ω–æ–∫ –±–∞–∑–æ–≤—ã–π +{boost_amount:.2f}")
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã

---

### **–ü–û–î–•–û–î 3: –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –¥–ª—è SHORT**

**–ò–¥–µ—è:** –î–ª—è SHORT —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∏–º–µ–Ω—è—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—É—é –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í hybrid_mtf.py, _apply_hybrid_compensation
if signal_type.upper() == "SHORT":
    # –î–ª—è SHORT: –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è
    if h1_trend_strength >= 0.5:  # –°–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ —Å 0.6
        boost_amount = min(max_boost * 0.3, 0.105)
        hybrid_boost += boost_amount
    if market_momentum >= 0.3:  # –°–Ω–∏–∂–µ–Ω –ø–æ—Ä–æ–≥ —Å 0.6
        boost_amount = min(max_boost * 0.2, 0.07)
        hybrid_boost += boost_amount
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫—É SHORT —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã

---

### **–ü–û–î–•–û–î 4: Fallback –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ h4_confidence=0.00**

**–ò–¥–µ—è:** –ï—Å–ª–∏ H4 confidence = 0.00, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –ª–æ–≥–∏–∫—É.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –í hybrid_mtf.py, check_hybrid_mtf_confirmation
if h4_confidence == 0.0:
    # Fallback: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ H1 –∏ market momentum
    if h1_trend_strength >= 0.6 and market_momentum >= 0.3:
        final_confidence = 0.5  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
        final_confirmed = True
        reason = "Fallback: H1 + market momentum"
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç edge cases
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å —Å–ª–∞–±—ã–µ —Å–∏–≥–Ω–∞–ª—ã

---

### **–ü–û–î–•–û–î 5: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

**–ò–¥–µ—è:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥–æ–≤ 1, 2 –∏ 3.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
1. –°–Ω–∏–∑–∏—Ç—å `min_h4_confidence` –¥–ª—è SHORT –¥–æ 0.4
2. –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π boost –¥–ª—è `market_momentum >= 0.3`
3. –£–ª—É—á—à–∏—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –¥–ª—è SHORT —Å–∏–≥–Ω–∞–ª–æ–≤

**–ü–ª—é—Å—ã:**
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –ø—Ä–æ–±–ª–µ–º—ã
- ‚úÖ –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –ª–æ–≥–∏–∫–∞
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã

**–ú–∏–Ω—É—Å—ã:**
- ‚ö†Ô∏è –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ü–û–î–•–û–î 5 (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π):**
1. –°–Ω–∏–∑–∏—Ç—å `min_h4_confidence` –¥–ª—è SHORT –¥–æ 0.4
2. –î–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π boost –¥–ª—è `market_momentum >= 0.3`
3. –£–ª—É—á—à–∏—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é –¥–ª—è SHORT —Å–∏–≥–Ω–∞–ª–æ–≤
4. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
2. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å —Ç–µ–∫—É—â–∏–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

