# ‚úÖ –£–õ–£–ß–®–ï–ù–ò–ï #1: –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ë–≠–ö–ê–ü–´ –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.0 ‚Üí 3.1  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

---

## üéØ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### **1. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

**–§–∞–π–ª:** `knowledge_os/app/enhanced_monitor.py`

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, RAM, Disk)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (connections, size, activity)
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API (health, response time)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –≤ Telegram
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ –ë–î –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ú–µ—Ç—Ä–∏–∫–∏:**
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (%)
- RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (GB, %)
- Disk –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (GB, %)
- Database connections
- Database size (GB)
- Knowledge nodes count
- Experts count
- API response time (ms)
- API health status

**–ü–æ—Ä–æ–≥–∏ –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤:**
- CPU > 85%
- RAM > 85%
- Disk > 90%
- DB connections > 80
- API response time > 1000ms

---

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±—ç–∫–∞–ø–æ–≤**

**–§–∞–π–ª—ã:**
- `knowledge_os/scripts/backup_db.sh` (—É–ª—É—á—à–µ–Ω)
- `knowledge_os/scripts/setup_automated_backups.sh` (–Ω–æ–≤—ã–π)

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã (3:00)
- ‚úÖ –°–∂–∞—Ç–∏–µ –±—ç–∫–∞–ø–æ–≤ (gzip)
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (> 30 –¥–Ω–µ–π)
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å S3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

### **3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞**

**–§–∞–π–ª:** `knowledge_os/scripts/restore_from_backup.sh` (–Ω–æ–≤—ã–π)

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –±—ç–∫–∞–ø–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å–ø–∞–∫–æ–≤–∫–∞ (gzip)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

### **4. –°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

**–§–∞–π–ª—ã:**
- `knowledge_os/scripts/setup_automated_backups.sh`
- `knowledge_os/scripts/setup_monitoring.sh`
- `knowledge_os/scripts/setup_all_monitoring.sh` (–≥–ª–∞–≤–Ω—ã–π)

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ crontab
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### **–ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–≤—Å–µ —Å—Ä–∞–∑—É):**

```bash
cd /root/knowledge_os
bash scripts/setup_all_monitoring.sh
```

### **–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–∞–ø–æ–≤
bash scripts/setup_automated_backups.sh

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
bash scripts/setup_monitoring.sh
```

### **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**

```bash
# –ë—ç–∫–∞–ø
bash scripts/backup_db.sh

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
python3 app/enhanced_monitor.py

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
bash scripts/restore_from_backup.sh
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –ò –ê–õ–ï–†–¢–´

### **–ú–µ—Ç—Ä–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î:**

```sql
CREATE TABLE system_metrics (
    id SERIAL PRIMARY KEY,
    timestamp TIMESTAMP DEFAULT NOW(),
    metrics JSONB NOT NULL
);
```

### **–ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫:**

```json
{
  "system": {
    "cpu": {"percent": 45.2, "count": 4},
    "ram": {"total_gb": 8.0, "used_gb": 3.2, "percent": 40.0},
    "disk": {"total_gb": 50.0, "used_gb": 25.0, "percent": 50.0}
  },
  "database": {
    "active_connections": 5,
    "db_size_gb": 0.5,
    "knowledge_nodes": 1234,
    "experts": 22
  },
  "api": {
    "status": "healthy",
    "response_time_ms": 125.5
  }
}
```

### **–ê–ª–µ—Ä—Ç—ã –≤ Telegram:**

- üî¥ **High priority:** CPU > 85%, RAM > 85%, Disk > 90%, API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- üü° **Medium priority:** DB connections > 80, API response time > 1000ms

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
knowledge_os/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ enhanced_monitor.py          # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ backup_db.sh                 # –°–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ (—É–ª—É—á—à–µ–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ setup_automated_backups.sh   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–∞–ø–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ setup_monitoring.sh          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ setup_all_monitoring.sh      # –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ restore_from_backup.sh       # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ backups/                         # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –±—ç–∫–∞–ø–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ db_backup_YYYYMMDD_HHMMSS.sql.gz
‚îî‚îÄ‚îÄ logs/
    ‚îú‚îÄ‚îÄ monitor.log                  # –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    ‚îú‚îÄ‚îÄ cron_backup.log              # –õ–æ–≥–∏ –±—ç–∫–∞–ø–æ–≤
    ‚îî‚îÄ‚îÄ cron_monitor.log             # –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (cron)
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

### **1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á crontab:**

```bash
crontab -l | grep -E "(backup|monitor)"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
0 3 * * * /root/knowledge_os/scripts/backup_db.sh >> /root/knowledge_os/logs/cron_backup.log 2>&1
*/5 * * * * cd /root/knowledge_os && python3 app/enhanced_monitor.py >> /root/knowledge_os/logs/cron_monitor.log 2>&1
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**

```bash
# –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
tail -f /root/knowledge_os/logs/monitor.log

# –õ–æ–≥–∏ –±—ç–∫–∞–ø–æ–≤
tail -f /root/knowledge_os/logs/cron_backup.log
```

### **3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –≤ –ë–î:**

```sql
SELECT 
    timestamp,
    metrics->'system'->'cpu'->>'percent' as cpu_percent,
    metrics->'system'->'ram'->>'percent' as ram_percent,
    metrics->'database'->>'knowledge_nodes' as knowledge_nodes
FROM system_metrics
ORDER BY timestamp DESC
LIMIT 10;
```

### **4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–∞–ø–æ–≤:**

```bash
ls -lh /root/knowledge_os/backups/
```

---

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–î–æ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ùå –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
- ‚ùå –ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚ùå –ù–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –º–µ—Ç—Ä–∏–∫

### **–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –≤ Telegram
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç—Ä–∏–∫ –≤ –ë–î (7 –¥–Ω–µ–π)
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞

### **–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** +50%
- **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** -80% (—Å —á–∞—Å–æ–≤ –¥–æ –º–∏–Ω—É—Ç)
- **–í–∏–¥–∏–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã:** +100%

---

## üìö –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
2. ‚è≠Ô∏è **–°–ª–µ–¥—É—é—â–µ–µ:** –£–ª—É—á—à–µ–Ω–Ω—ã–π Orchestrator (–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á)
3. ‚è≠Ô∏è **–ü–æ—Ç–æ–º:** –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å)

---

**–ê–≤—Ç–æ—Ä:** –í–∏–∫—Ç–æ—Ä–∏—è (Team Lead)  
**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.1

