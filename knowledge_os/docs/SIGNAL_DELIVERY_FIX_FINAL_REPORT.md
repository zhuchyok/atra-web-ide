# üö® –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –î–û–°–¢–ê–í–ö–û–ô –°–ò–ì–ù–ê–õ–û–í - –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢

## üìã **–ü—Ä–æ–±–ª–µ–º–∞**
–°–∏–≥–Ω–∞–ª—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª–∏—Å—å, –Ω–æ –Ω–µ –¥–æ—Ö–æ–¥–∏–ª–∏ –¥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ Telegram.

## üîç **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤** - —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
2. **Telegram API** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –¥–∞–Ω–Ω—ã–µ –∏–∑ `user_data.json` –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### ‚ùå **–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** - —Ñ—É–Ω–∫—Ü–∏—è `notify_all` –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —Å–∏–≥–Ω–∞–ª—ã —Ç–æ–ª—å–∫–æ –≤ `CHAT_IDS`, –∞ –Ω–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ `user_data.json`
2. **Flood Control** - Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏** - –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –Ω–µ –±—ã–ª–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø–∞—É–∑

## üõ†Ô∏è **–í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `notify_all` –≤ `telegram_bot.py`**
```python
# –ë–´–õ–û:
for chat_id in CHAT_IDS:
    await bot.send_message(chat_id=chat_id, text=text, **kwargs)

# –°–¢–ê–õ–û:
# –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ user_data.json
user_data_dict = {}
if os.path.exists("user_data.json"):
    with open("user_data.json", "r", encoding="utf-8") as f:
        user_data_dict = json.load(f)

# –û–±—ä–µ–¥–∏–Ω—è–µ–º CHAT_IDS –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ user_data.json
all_user_ids = set(CHAT_IDS)
for user_id in user_data_dict.keys():
    all_user_ids.add(int(user_id))

for user_id in all_user_ids:
    await bot.send_message(chat_id=user_id, text=text, **kwargs)
```

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Flood Control**
```python
# –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º Flood Control
last_message_time = {}
min_interval = 2.0  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

for user_id in all_user_ids:
    current_time = time.time()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
    if user_id in last_message_time:
        time_since_last = current_time - last_message_time[user_id]
        if time_since_last < min_interval:
            wait_time = min_interval - time_since_last
            await asyncio.sleep(wait_time)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    await bot.send_message(chat_id=user_id, text=text, **kwargs)
    last_message_time[user_id] = time.time()

    # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    await asyncio.sleep(1.5)
```

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
```python
except Exception as e:
    if "Flood control" in str(e):
        print(f"üö® Flood control –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}, –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É 30 —Å–µ–∫—É–Ω–¥...")
        await asyncio.sleep(30)
    elif "Forbidden" in str(e) or "bot was blocked" in str(e):
        print(f"üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞")
    elif "chat not found" in str(e):
        print(f"üö´ –ß–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
```

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `notify_user`**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –£–º–µ–Ω—å—à–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_signal_delivery.py`
```bash
python3 test_signal_delivery.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ **notify_all** - —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–∏–≥–Ω–∞–ª—ã –æ–±–æ–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `user_data.json`
- ‚úÖ **Telegram API** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–æ—Ç—É —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è **Flood Control** - –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### –°–æ–∑–¥–∞–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `improved_signal_delivery.py`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Flood Control —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

## üìä **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

–ò–∑ `user_data.json`:
```json
{
  "958930260": {
    "deposit": 140.0,
    "trade_mode": "spot",
    "filter_mode": "balanced"
  },
  "556251171": {
    "deposit": 1000.0,
    "trade_mode": "spot",
    "filter_mode": "soft"
  }
}
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:**
1. **–°–∏–≥–Ω–∞–ª—ã —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** –∏–∑ `user_data.json`
2. **–î–æ–±–∞–≤–ª–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Flood Control** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
3. **–£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏** –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### üìà **–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã
- –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—à–∏–±–æ–∫ Flood Control
- –õ—É—á—à–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîß **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ Flood Control
2. **–†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_signal_delivery.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤** - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–≤–µ–ª–∏—á—å—Ç–µ `min_interval` –≤ –∫–æ–¥–µ
4. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã** - —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

## üìù **–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `telegram_bot.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `notify_all` –∏ `notify_user`
- `test_signal_delivery.py` - —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `improved_signal_delivery.py` - —Å–æ–∑–¥–∞–Ω —É–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏

---
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 30 –∏—é–ª—è 2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** ‚úÖ –ü–†–û–ô–î–ï–ù–û