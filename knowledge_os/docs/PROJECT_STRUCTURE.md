# üìÅ –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê ATRA

**–í–µ—Ä—Å–∏—è:** 2.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-19  
**–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π)
3. [–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–º–æ–¥—É–ª–∏)
4. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
5. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
7. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
8. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)

---

## üèóÔ∏è –û–ë–ó–û–† –ê–†–•–ò–¢–ï–ö–¢–£–†–´

ATRA (Algorithmic Trading Robot Assistant) ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω–æ–≥–æ —Ä—ã–Ω–∫–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ asyncio –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–∏–º–≤–æ–ª–æ–≤
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ fallback –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ observability –∏ –º–µ—Ç—Ä–∏–∫

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å          ‚îÇ
‚îÇ  (Telegram Bot, Web Dashboard, REST API)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞                       ‚îÇ
‚îÇ  (Signal Generation, Risk Management)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö                         ‚îÇ
‚îÇ  (Exchange API, Database, Cache)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÇ –°–¢–†–£–ö–¢–£–†–ê –î–ò–†–ï–ö–¢–û–†–ò–ô

```
atra/
‚îú‚îÄ‚îÄ üìÅ src/                          # –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ signals/                  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ filters/                  # –§–∏–ª—å—Ç—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ analysis/                 # –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ strategies/               # –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ indicators/               # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ patterns/                 # –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–≤–µ—á–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ market/                   # –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ technical/                # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ metrics/                 # –ú–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ optimization/             # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ data/                     # –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/                     # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ telegram/                 # Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ utils/                    # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÅ scripts/                      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ backtest_*.py             # –ë—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ monitor_*.py              # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ optimize_*.py             # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ fix_*.py                  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ deploy_*.sh               # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ üìÅ observability/                # –°–∏—Å—Ç–µ–º–∞ observability
‚îÇ   ‚îú‚îÄ‚îÄ agent_coordinator.py         # –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ tracing.py                   # –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py                    # –ú–µ—Ç—Ä–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ feedback.py                   # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
‚îÇ   ‚îî‚îÄ‚îÄ evolution_engine.py          # –≠–≤–æ–ª—é—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÅ monitoring/                   # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ infra_metrics.py             # –ú–µ—Ç—Ä–∏–∫–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÅ agent_gym/                    # –û—Ñ—Ñ–ª–∞–π–Ω —Å–∏–º—É–ª—è—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ scenarios.py                 # –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (SignalThroughput, ExecutionFallback)
‚îÇ   ‚îú‚îÄ‚îÄ configs/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (JSON)
‚îÇ   ‚îú‚îÄ‚îÄ reports/                     # –û—Ç—á–µ—Ç—ã –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ üìÅ risk_monitor/                 # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∏—Å–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ calculations.py              # –†–∞—Å—á–µ—Ç—ã —Ä–∏—Å–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py                    # –ú–µ—Ç—Ä–∏–∫–∏ —Ä–∏—Å–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ telegram.py                   # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ üìÅ data/                         # –î–∞–Ω–Ω—ã–µ –∏ –∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ historical_data_loader.py    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ cache/                    # –ö—ç—à –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ üìÅ backtests/                    # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ *.json                       # JSON –æ—Ç—á–µ—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÅ logs/                         # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ *.log                        # –§–∞–π–ª—ã –ª–æ–≥–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ üìÅ docs/                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ PROJECT_STRUCTURE.md         # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îÇ   ‚îî‚îÄ‚îÄ *.md                         # –î—Ä—É–≥–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ üìÅ archive/                      # –ê—Ä—Ö–∏–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ experimental/                # –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÅ infrastructure/               # –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ docker/                      # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ terraform/                   # Terraform –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ kubernetes/                  # Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ üìÅ tests/                        # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ unit/                        # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ integration/                 # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ performance/                 # –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÑ main.py                       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ üìÑ config.py                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ signal_live.py                # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îú‚îÄ‚îÄ üìÑ telegram_handlers.py          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram
‚îú‚îÄ‚îÄ üìÑ auto_execution.py             # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ üìÑ exchange_api.py               # API –±–∏—Ä–∂–∏
‚îú‚îÄ‚îÄ üìÑ db.py                         # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ üìÑ requirements.txt              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

---

## üîß –û–°–ù–û–í–ù–´–ï –ú–û–î–£–õ–ò

### 1. **main.py** ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å–∏—Å—Ç–µ–º—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞
- –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ graceful shutdown

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
```python
- run_hybrid_signal_system_fixed()    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- run_telegram_bot_in_existing_loop() # Telegram –±–æ—Ç
- run_optimization_system()           # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- run_ai_learning_system()            # AI –æ–±—É—á–µ–Ω–∏–µ
- run_rest_api_async()                # REST API
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
check_critical_dependencies()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
initialize_database_on_startup()
sync_user_data_from_json_to_db()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
initialize_system_integrations()
initialize_system_settings()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ —Ä—ã–Ω–æ—á–Ω–æ–π –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
initialize_market_cap_filtering()
```

**–ó–∞–ø—É—Å–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
```python
# –û—Å–Ω–æ–≤–Ω–æ–π event loop
loop = asyncio.get_event_loop()

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º
tasks = [
    run_telegram_bot_in_existing_loop(),      # Telegram –±–æ—Ç
    run_hybrid_signal_system_fixed(),          # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
    run_optimization_system(),                  # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    run_ai_learning_system(),                  # AI –æ–±—É—á–µ–Ω–∏–µ
    run_rest_api_async(),                      # REST API (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    _sync_positions_periodically(),            # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
    run_price_monitoring(),                    # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–µ–Ω
]

# Graceful shutdown
signal.signal(signal.SIGTERM, signal_handler)
signal.signal(signal.SIGINT, signal_handler)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞:**
- `--backtest`: –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞
- `--dca-backtest`: –ë—ç–∫—Ç–µ—Å—Ç DCA —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- `--env`: –£–∫–∞–∑–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (dev/prod)

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ `RotatingFileHandler`
- –£—Ä–æ–≤–Ω–∏: INFO, WARNING, ERROR
- –§–∞–π–ª—ã: `main.log`, `bot.log`, `atra.log`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Try-except –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- Graceful degradation –ø—Ä–∏ —Å–±–æ—è—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

### 2. **signal_live.py** ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (OHLCV)
- –†–∞—Å—á–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ (LONG/SHORT)
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ Telegram
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
- _generate_signal_impl()            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
- send_signal()                       # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
- process_symbol_signals()            # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
- run_hybrid_signal_system_fixed()   # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
```python
async def get_symbol_data(symbol: str, force_fresh: bool = False):
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ OHLCV –¥–∞–Ω–Ω—ã—Ö —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
    
    –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):
    1. Binance API
    2. Bybit API
    3. OKX API
    4. –ö—ç—à (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, "BTCUSDT")
    - force_fresh: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: timestamp, open, high, low, close, volume
    """
```

**–†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:**
```python
def add_technical_indicators(df: pd.DataFrame) -> pd.DataFrame:
    """
    –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫ DataFrame
    
    –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:
    - RSI (14 –ø–µ—Ä–∏–æ–¥–æ–≤)
    - MACD (12, 26, 9)
    - EMA Fast (12) / EMA Slow (26)
    - Bollinger Bands (20, 2.0)
    - ATR (14)
    - ADX (14)
    - Volume Profile
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - DataFrame —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    """
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
async def _generate_signal_impl(
    symbol: str,
    df: pd.DataFrame,
    user_data: Dict[str, Any],
    regime_data: Dict[str, Any] = None
) -> tuple:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
    
    –ü–∞—Ç—Ç–µ—Ä–Ω—ã:
    1. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π EMA –∫—Ä–æ—Å—Å–æ–≤–µ—Ä
       - LONG: EMA Fast > EMA Slow (–±—ã—á–∏–π)
       - SHORT: EMA Fast < EMA Slow (–º–µ–¥–≤–µ–∂–∏–π)
    
    2. Pullback Entry
       - –û—Ç–∫–∞—Ç –∫ EMA –ø–æ—Å–ª–µ –ø—Ä–æ–±–æ—è
       - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–º
    
    3. Zone-based
       - –í—Ö–æ–¥ –≤ –∑–æ–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
       - –§–∏–±–æ–Ω–∞—á—á–∏ —É—Ä–æ–≤–Ω–∏
    
    –§–∏–ª—å—Ç—Ä—ã (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ):
    1. BTC/ETH/SOL Trend Filter
    2. Volume Imbalance Filter
    3. False Breakout Detector
    4. RSI Warning Filter
    5. ML Filter Optimizer
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - (signal_data, None) –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
    - (None, reason) –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    """
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞:**
```python
async def send_signal(
    symbol: str,
    signal_type: str,  # "LONG" –∏–ª–∏ "SHORT"
    signal_price: float,
    user_data: Dict[str, Any],
    ...
) -> bool:
    """
    –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
    2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
    3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    4. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram (–æ–±–∞ –±–æ—Ç–∞: DEV –∏ PROD)
    5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (signals_log, accepted_signals)
    6. –ê–≤—Ç–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ –∏ PROD —Ä–µ–∂–∏–º)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - True –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
    - False –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å
    """
```

**–û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª:**
```python
async def run_hybrid_signal_system_fixed():
    """
    –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
    
    –ò–Ω—Ç–µ—Ä–≤–∞–ª: ~30-60 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–∏–º–≤–æ–ª–æ–≤)
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î
    2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ (AUTO_FETCH_COINS –∏–ª–∏ COINS)
    3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞:
       a. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
       b. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
       c. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
       d. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
       e. –û—Ç–ø—Ä–∞–≤–∫–∞ (–µ—Å–ª–∏ –ø—Ä–æ—à–µ–ª)
    4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    
    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
    - –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤
    - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤
    - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    """
```

**–§–∏–ª—å—Ç—Ä—ã:**
- **BTC/ETH/SOL Trend Filter**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–Ω–¥–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç
- **Volume Imbalance Filter**: –ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–æ–≤ —Å ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- **False Breakout Detector**: –î–µ—Ç–µ–∫—Ü–∏—è –ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–æ–µ–≤
- **RSI Filter**: –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö RSI
- **ML Filter Optimizer**: –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤

---

### 3. **telegram_handlers.py** ‚Äî –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Telegram

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ (`/start`, `/help`, `/positions`, etc.)
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ (`/accept`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
- notify_user()                      # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- handle_message()                  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- button_callback()                  # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫
- start_accept_button_ttl()         # TTL –¥–ª—è –∫–Ω–æ–ø–æ–∫
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:**
```python
/start          # –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/help           # –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
/positions      # –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
/trade_history  # –ò—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫
/balance        # –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
/settings       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/accept         # –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –≤—Ä—É—á–Ω—É—é
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫:**
```python
async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –∫–Ω–æ–ø–∫–∏
    
    –§–æ—Ä–º–∞—Ç callback_data:
    - accept|SYMBOL|TIMESTAMP|PRICE|QUANTITY|DIRECTION|RISK|LEVERAGE
    - close|POSITION_ID|PARTIAL|AMOUNT
    - dca|SYMBOL|TIMESTAMP|PRICE|QUANTITY
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –ü–∞—Ä—Å–∏–Ω–≥ callback_data
    2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–Ω–æ–ø–∫–∏)
    4. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
    5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    6. –£–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    """
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:**
```python
async def notify_user(user_id, text, **kwargs):
    """
    –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
    - text: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (HTML —Ñ–æ—Ä–º–∞—Ç)
    - _timeout: –¢–∞–π–º–∞—É—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 —Å–µ–∫)
    - _return_message: –í–µ—Ä–Ω—É—Ç—å message_id (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
    - _send_to_both_bots: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –æ–±–∞ –±–æ—Ç–∞ (DEV –∏ PROD)
    - reply_markup: –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    
    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    - Rate limiting (1 —Å–µ–∫ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏)
    - Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ Flood Control
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - True/False –ø—Ä–∏ —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
    - Dict —Å message_id –ø—Ä–∏ _return_message=True
    """
```

**TTL –¥–ª—è –∫–Ω–æ–ø–æ–∫:**
```python
async def start_accept_button_ttl(chat_id, message_id, expiry_iso, callback_data):
    """
    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - expiry_iso: –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (ISO —Ñ–æ—Ä–º–∞—Ç)
    - callback_data: –î–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å —Ç–∞–π–º–µ—Ä–æ–º
    2. –û–∂–∏–¥–∞–Ω–∏–µ –¥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è
    3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—É–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏)
    4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5 –º–∏–Ω—É—Ç
    """
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞:**
```python
async def handle_accept_signal(user_id, signal_data):
    """
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, —Ü–µ–Ω—ã)
    2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    3. –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
    4. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ (–µ—Å–ª–∏ —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º)
    5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (accepted_signals)
    6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ signals_log
    7. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    –†–µ–∂–∏–º—ã:
    - Manual: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
    - Auto: –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (PROD)
    """
```

---

### 4. **auto_execution.py** ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –Ω–∞ –±–∏—Ä–∂–µ

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–æ —Å–∏–≥–Ω–∞–ª–∞–º
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Stop Loss –∏ Take Profit
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–º –ø–æ–∑–∏—Ü–∏–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã:**
```python
class AutoExecutionService:
    - execute_and_open()             # –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    - place_stop_loss_order()        # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL
    - place_take_profit_order()      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
async def execute_and_open(...):
    """
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    
    –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–í–ï–†–ö–ò:
    1. ATRA_ENV == "prod" (—Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!)
       - DEV/TEST –æ–∫—Ä—É–∂–µ–Ω–∏—è –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏
       - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–∫–∏
    
    2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
       - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 0.0001
       - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: –±–∞–ª–∞–Ω—Å * leverage
       - –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ PositionSizeValidator
    
    3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
       - –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ observability.agent_identity
       - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
    """
```

**–ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏:**
```python
# 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
direction = "BUY" if direction.upper() == "LONG" else "SELL"

# 2. –†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
if trade_mode == 'futures' and leverage > 1:
    # –î–ª—è futures: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = (margin * leverage) / price
    amount = (quantity_usdt * leverage) / entry_price
else:
    # –î–ª—è spot: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ = —Å—É–º–º–∞ / price
    amount = quantity_usdt / entry_price

# 3. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
order_result = await adapter.place_order(
    symbol=symbol,
    side=direction,
    amount=amount,
    order_type='market'  # –∏–ª–∏ 'limit'
)

# 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL
if sl_price:
    await place_stop_loss_order(
        symbol, direction, amount, sl_price
    )

# 5. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP1/TP2
if tp1_price:
    await place_take_profit_order(
        symbol, direction, amount, tp1_price, tp_type='TP1'
    )
if tp2_price:
    await place_take_profit_order(
        symbol, direction, amount, tp2_price, tp_type='TP2'
    )

# 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
await acceptance_db.create_active_position(...)
await acceptance_db.update_signal_status(...)
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Stop Loss:**
```python
async def place_stop_loss_order(symbol, direction, amount, sl_price):
    """
    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Stop Loss –æ—Ä–¥–µ—Ä–∞
    
    –õ–æ–≥–∏–∫–∞:
    - LONG: SL –Ω–∏–∂–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
    - SHORT: SL –≤—ã—à–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
    
    –¢–∏–ø –æ—Ä–¥–µ—Ä–∞:
    - Stop Market (Bitget)
    - Stop Limit (Binance)
    
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
    - Retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
    - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ order_audit_log
    - Fallback –Ω–∞ —Ä—É—á–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É
    """
```

**–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Take Profit:**
```python
async def place_take_profit_order(symbol, direction, amount, tp_price, tp_type='TP1'):
    """
    –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Take Profit –æ—Ä–¥–µ—Ä–∞
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - tp_type: 'TP1' –∏–ª–∏ 'TP2'
    
    –õ–æ–≥–∏–∫–∞:
    - LONG: TP –≤—ã—à–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
    - SHORT: TP –Ω–∏–∂–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
    
    –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ:
    - TP1: 50% –ø–æ–∑–∏—Ü–∏–∏
    - TP2: 50% –ø–æ–∑–∏—Ü–∏–∏ (–æ—Å—Ç–∞—Ç–æ–∫)
    """
```

**–ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ order_audit_log
await audit_log.log_order(
    order_type='market',
    symbol=symbol,
    side=direction,
    amount=amount,
    price=entry_price,
    status='filled',
    user_id=user_id
)
```

---

### 5. **exchange_api.py** ‚Äî API –±–∏—Ä–∂–∏

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã–º–∏ –±–∏—Ä–∂–∞–º–∏

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –±–∏—Ä–∂–∏:**
- Binance
- Bybit
- OKX
- Bitget

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```python
- get_klines()                       # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ—á–µ–π
- get_current_price()                # –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
- get_filtered_top_usdt_pairs_fast() # –¢–æ–ø –ø–∞—Ä—ã
- place_order()                      # –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**Fallback –º–µ—Ö–∞–Ω–∏–∑–º:**
```python
async def get_klines(symbol, timeframe='1h', limit=300):
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ—á–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback
    
    –ü–æ—Ä—è–¥–æ–∫ –ø–æ–ø—ã—Ç–æ–∫:
    1. Binance API (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
    2. Bybit API (fallback)
    3. OKX API (fallback)
    4. –ö—ç—à (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    
    –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
    - Rate limiting: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ
    - Network errors: retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
    - Invalid symbol: –ø—Ä–æ–ø—É—Å–∫ —Å–∏–º–≤–æ–ª–∞
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: timestamp, open, high, low, close, volume
    - None –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    """
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø –ø–∞—Ä:**
```python
async def get_filtered_top_usdt_pairs_fast(top_n=500, final_limit=200):
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–ø —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
    
    –§–∏–ª—å—Ç—Ä—ã:
    1. –¢–æ–ª—å–∫–æ USDT –ø–∞—Ä—ã
    2. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º 24h (–Ω–∞–ø—Ä–∏–º–µ—Ä, $1M)
    3. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
    4. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–≤
    5. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ blacklist
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - top_n: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (500)
    - final_limit: –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ (200)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - List[str] —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ['BTCUSDT', 'ETHUSDT', ...])
    """
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã:**
```python
async def get_current_price_robust(symbol):
    """
    –ù–∞–¥–µ–∂–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
    
    –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
    1. Exchange API (real-time)
    2. Ticker cache (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
    3. –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–≤–µ—á–∞ (fallback)
    
    –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
    - TTL: 5 —Å–µ–∫—É–Ω–¥
    - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - float: —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
    - None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
```

**Rate Limiting:**
```python
class RateLimiter:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
    
    –õ–∏–º–∏—Ç—ã –ø–æ –±–∏—Ä–∂–∞–º:
    - Binance: 1200 requests/min (weighted)
    - Bybit: 120 requests/min
    - OKX: 20 requests/2sec
    
    –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
    - Token bucket –∞–ª–≥–æ—Ä–∏—Ç–º
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏
    - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
    """
```

**Exchange Adapter:**
```python
class ExchangeAdapter:
    """
    –ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏—Ä–∂–∞–º–∏
    
    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
    - place_order()           # –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
    - cancel_order()          # –û—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–∞
    - get_positions()         # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
    - get_balance()           # –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
    - get_open_orders()       # –û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ä–¥–µ—Ä–∞
    
    –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è:
    - –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –±–∏—Ä–∂
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ API
    """
```

---

### 6. **config.py** ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:**
- –§–∏–ª—å—Ç—Ä—ã (BTC/ETH/SOL trend, Volume, RSI)
- –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç (leverage, risk_pct)
- Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- API –∫–ª—é—á–∏
- ML –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```python
- COINS                              # –°–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç
- DEFAULT_RISK_PCT                   # –†–∏—Å–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- DEFAULT_LEVERAGE                   # –ü–ª–µ—á–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- TELEGRAM_TOKEN                     # –¢–æ–∫–µ–Ω –±–æ—Ç–∞
- VOLUME_IMBALANCE_FILTER_CONFIG     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

---

## üß© –ö–û–ú–ü–û–ù–ï–ù–¢–´ –°–ò–°–¢–ï–ú–´

### üìä –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

```
signal_live.py
‚îú‚îÄ‚îÄ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ get_symbol_data()
‚îÇ   ‚îî‚îÄ‚îÄ get_ohlc_with_fallback()
‚îú‚îÄ‚îÄ –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ add_technical_indicators()
‚îÇ   ‚îú‚îÄ‚îÄ RSI, MACD, EMA, Bollinger Bands
‚îÇ   ‚îî‚îÄ‚îÄ ATR, ADX, Volume Profile
‚îú‚îÄ‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ _generate_signal_impl()
‚îÇ   ‚îú‚îÄ‚îÄ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (EMA crossover)
‚îÇ   ‚îú‚îÄ‚îÄ Pullback entry
‚îÇ   ‚îî‚îÄ‚îÄ Zone-based signals
‚îú‚îÄ‚îÄ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ Trend filters (BTC/ETH/SOL)
‚îÇ   ‚îú‚îÄ‚îÄ Volume imbalance
‚îÇ   ‚îú‚îÄ‚îÄ False breakout
‚îÇ   ‚îú‚îÄ‚îÄ RSI warning
‚îÇ   ‚îî‚îÄ‚îÄ ML optimization
‚îî‚îÄ‚îÄ –û—Ç–ø—Ä–∞–≤–∫–∞
    ‚îú‚îÄ‚îÄ send_signal()
    ‚îú‚îÄ‚îÄ notify_user_enhanced()
    ‚îî‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
```

---

### üîç –°–∏—Å—Ç–µ–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/filters/`

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:**

1. **SmartTrendFilter** (`smart_trend_filter.py`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–Ω–¥–∞ BTC/ETH/SOL
   - Multi-timeframe confirmation
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä–æ–≥–∏
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class SmartTrendFilter:
       """
       –£–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä —Ç—Ä–µ–Ω–¥–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç
       
       –õ–æ–≥–∏–∫–∞:
       - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –º–æ–Ω–µ—Ç—É (BTC/ETH/SOL) –ø–æ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
       - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç—Ä–µ–Ω–¥ –Ω–∞ 1h –∏ 4h —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö
       - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç EMA (10/22 –¥–ª—è soft, 12/26 –¥–ª—è strict)
       - –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä-—Ç—Ä–µ–Ω–¥—ã (>1% —Ä–∞–∑–Ω–∏—Ü–∞ EMA)
       - –†–∞–∑—Ä–µ—à–∞–µ—Ç —Å–ª–∞–±—ã–µ —Ç—Ä–µ–Ω–¥—ã (<0.2% —Ä–∞–∑–Ω–∏—Ü–∞) –¥–ª—è –±–æ–∫–æ–≤–∏–∫–∞
       
       –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
       - BTC_TREND_EMA_SOFT = 50
       - BTC_TREND_EMA_STRICT = 200
       - BTC_TREND_USE_MULTITF = True
       
       –†–µ–∂–∏–º—ã:
       - Soft: –ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
       - Strict: –°—Ç—Ä–æ–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç—Ä–µ–Ω–¥—É
       """
   ```

2. **VolumeImbalanceFilter** (`volume_imbalance.py`)
   - –ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–æ–≤
   - ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class VolumeImbalanceFilter:
       """
       –§–∏–ª—å—Ç—Ä –¥–∏—Å–±–∞–ª–∞–Ω—Å–∞ –æ–±—ä–µ–º–æ–≤
       
       –õ–æ–≥–∏–∫–∞:
       - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –æ–±—ä–µ–º —Å —Å—Ä–µ–¥–Ω–∏–º
       - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–º–∞ (buy/sell)
       - ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤ –ø–æ–¥ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
       
       –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
       - min_volume_ratio = 1.2 (–æ–±—ä–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ 20% –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ)
       - require_volume_confirmation = True
       
       ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
       - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤ –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
       - –£—á–µ—Ç —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (—Ç—Ä–µ–Ω–¥/–±–æ–∫–æ–≤–∏–∫)
       - –†–µ–ª–∞–∫—Å–∞—Ü–∏—è –¥–ª—è –∏–Ω—Ç—Ä–∞–¥–µ–π —Ç–æ—Ä–≥–æ–≤–ª–∏
       
       –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
       - FilterResult(passed=True) –µ—Å–ª–∏ –æ–±—ä–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
       - FilterResult(passed=False, reason="LOW_VOLUME") –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç
       """
   ```

3. **FalseBreakoutDetector** (`false_breakout_detector.py`)
   - –î–µ—Ç–µ–∫—Ü–∏—è –ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–æ–µ–≤
   - –ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–∞, momentum, —É—Ä–æ–≤–Ω–µ–π
   - ML –≤–µ—Å–∞ –¥–ª—è —Ñ–∞–∫—Ç–æ—Ä–æ–≤
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class FalseBreakoutDetector:
       """
       –î–µ—Ç–µ–∫—Ç–æ—Ä –ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–æ–µ–≤
       
       –ê–Ω–∞–ª–∏–∑ —Ñ–∞–∫—Ç–æ—Ä–æ–≤:
       1. Volume (40% –≤–µ—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
          - –û–±—ä–µ–º –ø—Ä–∏ –ø—Ä–æ–±–æ–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ
          - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–æ—è
       
       2. Momentum (30% –≤–µ—Å–∞)
          - –°–∏–ª–∞ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã
          - RSI, MACD –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞
          - –°–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
       
       3. Level Quality (30% –≤–µ—Å–∞)
          - –ö–∞—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–æ—è —É—Ä–æ–≤–Ω—è
          - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Å–∞–Ω–∏–π —É—Ä–æ–≤–Ω—è
          - –í—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –≤—ã—à–µ/–Ω–∏–∂–µ —É—Ä–æ–≤–Ω—è
       
       ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
       - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤–µ—Å–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤
       - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
       - –£—á–µ—Ç —Ä—ã–Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
       
       –ü–æ—Ä–æ–≥–∏:
       - min_total_confidence = 0.20 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
       - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–æ–¥ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
       """
   ```

4. **AdaptiveRSI** (`adaptive_rsi.py`)
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π RSI
   - –†–µ–∂–∏–º—ã (soft/strict)
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class AdaptiveRSI:
       """
       –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä RSI
       
       –†–µ–∂–∏–º—ã:
       - Soft: RSI < 20 (–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å) –∏–ª–∏ > 80 (–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å)
       - Strict: RSI < 15 –∏–ª–∏ > 85
       
       –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
       - RSI –≤ –æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏–≥–Ω–∞–ª
       - LONG –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ RSI > 70
       - SHORT –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ RSI < 30
       
       –ê–¥–∞–ø—Ç–∞—Ü–∏—è:
       - –£—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
       - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ –ø–æ–¥ —Ç—Ä–µ–Ω–¥
       """
   ```

5. **InterestZoneFilter** (`interest_zone.py`)
   - –ó–æ–Ω—ã –∏–Ω—Ç–µ—Ä–µ—Å–∞
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class InterestZoneFilter:
       """
       –§–∏–ª—å—Ç—Ä –∑–æ–Ω –∏–Ω—Ç–µ—Ä–µ—Å–∞ (–ø–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ)
       
       –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–æ–Ω:
       - –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–∞–∫—Å–∏–º—É–º—ã/–º–∏–Ω–∏–º—É–º—ã
       - –ö–ª–∞—Å—Ç–µ—Ä—ã –æ–±—ä–µ–º–æ–≤
       - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏
       
       –õ–æ–≥–∏–∫–∞:
       - LONG: –í—Ö–æ–¥ –≤ –∑–æ–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
       - SHORT: –í—Ö–æ–¥ –≤ –∑–æ–Ω–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è
       - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–æ–±–æ–µ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
       """
   ```

6. **FibonacciZoneFilter** (`fibonacci_zone.py`)
   - –§–∏–±–æ–Ω–∞—á—á–∏ —É—Ä–æ–≤–Ω–∏
   - –ó–æ–Ω—ã –≤—Ö–æ–¥–∞
   
   **–î–µ—Ç–∞–ª–∏:**
   ```python
   class FibonacciZoneFilter:
       """
       –§–∏–ª—å—Ç—Ä –∑–æ–Ω –§–∏–±–æ–Ω–∞—á—á–∏
       
       –£—Ä–æ–≤–Ω–∏:
       - 0.236, 0.382, 0.5, 0.618, 0.786
       
       –õ–æ–≥–∏–∫–∞:
       - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ swing high/low
       - –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π –§–∏–±–æ–Ω–∞—á—á–∏
       - –í—Ö–æ–¥ –≤ –∑–æ–Ω–µ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
       """
   ```

---

### ü§ñ AI/ML –°–∏—Å—Ç–µ–º–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **ml_filter_optimizer.py**
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

2. **lightgbm_predictor.py**
   - LightGBM –º–æ–¥–µ–ª–∏
   - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏—è

3. **ai_signal_generator.py**
   - AI –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

4. **adaptive_parameter_controller.py**
   - –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**ML Filter Optimizer:**
```python
class MLFilterOptimizer:
    """
    ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    
    –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    1. Volume Imbalance Filter
       - min_volume_ratio (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–æ—Ä–æ–≥)
       - require_volume_confirmation (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
    
    2. False Breakout Detector
       - false_breakout_threshold (–ø–æ—Ä–æ–≥ –¥–µ—Ç–µ–∫—Ü–∏–∏)
       - false_breakout_weights (–≤–µ—Å–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤)
       - volume_weight, momentum_weight, level_weight
    
    –†—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:
    - regime: LOW_VOL_RANGE, MEDIUM_VOL, HIGH_VOL, TREND
    - volatility: –ø—Ä–æ—Ü–µ–Ω—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    - trend_strength: —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞
    
    –ê–¥–∞–ø—Ç–∞—Ü–∏—è:
    - –†–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤ –¥–ª—è –∏–Ω—Ç—Ä–∞–¥–µ–π —Ç–æ—Ä–≥–æ–≤–ª–∏
    - –£—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
    - –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
    
    –ú–µ—Ç–æ–¥—ã:
    - optimize_filter_parameters() - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    - get_optimal_weights() - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –≤–µ—Å–∞ –¥–ª—è false_breakout
    """
```

**LightGBM Predictor:**
```python
class LightGBMPredictor:
    """
    LightGBM –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
    
    –ú–æ–¥–µ–ª–∏:
    1. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (—É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–∏–≥–Ω–∞–ª–∞)
       - –í—Ö–æ–¥: —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
       - –í—ã—Ö–æ–¥: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞ (0-1)
    
    2. –†–µ–≥—Ä–µ—Å—Å–∏—è (–ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å)
       - –í—Ö–æ–¥: —Ç–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
       - –í—ã—Ö–æ–¥: –æ–∂–∏–¥–∞–µ–º–∞—è –ø—Ä–∏–±—ã–ª—å (%)
    
    –ü—Ä–∏–∑–Ω–∞–∫–∏ (features):
    - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (RSI, MACD, EMA, etc.)
    - –û–±—ä–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR)
    - –†—ã–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
    - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å BTC/ETH/SOL
    
    –û–±—É—á–µ–Ω–∏–µ:
    - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ signals_log
    - –ú–∏–Ω–∏–º—É–º 1000 –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
    """
```

**AI Signal Generator:**
```python
class AISignalGenerator:
    """
    AI –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–∏–≥–Ω–∞–ª–æ–≤
    
    –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - AILearningSystem: –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö
    - AIIntegration: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–æ—Ä–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
    - AIMonitor: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    
    –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:
    1. –ê–Ω–∞–ª–∏–∑ —Å–∏–º–≤–æ–ª–∞
       - –ü–æ–ª—É—á–µ–Ω–∏–µ OHLC –¥–∞–Ω–Ω—ã—Ö
       - –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
       - –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
    
    2. AI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
       - –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
       - –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏
       - –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤
    
    3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
       - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ (LONG/SHORT)
       - –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π (TP1, TP2, SL)
       - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    
    4. –û—Ç–ø—Ä–∞–≤–∫–∞
       - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
       - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
       - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    """
```

**Adaptive Parameter Controller:**
```python
class AdaptiveParameterController:
    """
    –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    
    –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - Risk % (—Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏)
    - Leverage (–ø–ª–µ—á–æ)
    - TP1/TP2 —É—Ä–æ–≤–Ω–∏
    - Stop Loss
    - Preferred Symbols (–ª—É—á—à–∏–µ –º–æ–Ω–µ—Ç—ã)
    - Trading Hours (–ª—É—á—à–∏–µ —á–∞—Å—ã)
    
    –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
    - Win Rate (–ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫)
    - Profit Factor (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —É–±—ã—Ç–∫–∞–º)
    - Sharpe Ratio
    - Max Drawdown
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –∑–∞ –ø–µ—Ä–∏–æ–¥
    2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ai_learning_data/optimized_parameters.json
    5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ
    
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
    - –ü—Ä–∏ –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–µ
    - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
    """
```

---

### üíæ –°–∏—Å—Ç–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

1. **signals_log**
   - –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–¥–µ–ª–æ–∫

2. **accepted_signals**
   - –ü—Ä–∏–Ω—è—Ç—ã–µ —Å–∏–≥–Ω–∞–ª—ã
   - –°—Ç–∞—Ç—É—Å—ã (pending/accepted/closed)
   - PnL

3. **active_positions**
   - –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π
   - SL/TP —É—Ä–æ–≤–Ω–∏

4. **users_data**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ë–∞–ª–∞–Ω—Å—ã
   - –†–µ–∂–∏–º—ã —Ç–æ—Ä–≥–æ–≤–ª–∏

5. **risk_signal_history**
   - –ò—Å—Ç–æ—Ä–∏—è —Ä–∏—Å–∫–æ–≤
   - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
   - –ì—Ä—É–ø–ø—ã –∞–∫—Ç–∏–≤–æ–≤

**–ú–æ–¥—É–ª–∏:**
- `db.py` ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ë–î
- `acceptance_database.py` ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Å–∏–≥–Ω–∞–ª–æ–≤
- `database_initialization.py` ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**signals_log:**
```sql
CREATE TABLE signals_log (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,
    entry REAL,                    -- –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞
    stop REAL,                     -- Stop Loss
    tp1 REAL,                      -- Take Profit 1
    tp2 REAL,                      -- Take Profit 2
    entry_time TEXT,               -- –í—Ä–µ–º—è –≤—Ö–æ–¥–∞ (ISO)
    exit_time TEXT,                -- –í—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞
    result TEXT,                   -- PENDING/OPEN/CLOSED/WIN/LOSS
    net_profit REAL,               -- –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å
    user_id INTEGER,               -- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    created_at DATETIME,           -- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
    -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    trade_mode TEXT,               -- spot/futures
    leverage_used INTEGER,
    risk_pct_used REAL,
    quality_score REAL,            -- –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–∏–≥–Ω–∞–ª–∞
    confidence REAL                 -- –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–∏–≥–Ω–∞–ª–µ
);
```

**accepted_signals:**
```sql
CREATE TABLE accepted_signals (
    signal_key TEXT PRIMARY KEY,   -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á —Å–∏–≥–Ω–∞–ª–∞
    symbol TEXT NOT NULL,
    direction TEXT,                -- LONG/SHORT
    entry_price REAL,
    signal_time DATETIME,
    user_id INTEGER,
    chat_id INTEGER,
    message_id INTEGER,            -- ID —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
    status TEXT,                  -- pending/accepted/closed
    accepted_time DATETIME,
    closed_time DATETIME,
    close_price REAL,
    pnl REAL,                     -- –ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫
    pnl_pct REAL,                 -- –ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ –≤ %
    created_at DATETIME,
    accepted_by TEXT              -- manual/auto
);
```

**active_positions:**
```sql
CREATE TABLE active_positions (
    id INTEGER PRIMARY KEY,
    symbol TEXT NOT NULL,
    direction TEXT,               -- BUY/SELL
    entry_price REAL,
    user_id INTEGER,
    signal_key TEXT,              -- –°–≤—è–∑—å —Å accepted_signals
    status TEXT,                  -- open/closed
    sl_price REAL,
    tp1_price REAL,
    tp2_price REAL,
    created_at DATETIME,
    updated_at DATETIME
);
```

**users_data:**
```sql
CREATE TABLE users_data (
    user_id INTEGER PRIMARY KEY,
    deposit REAL,                 -- –î–µ–ø–æ–∑–∏—Ç
    balance REAL,                 -- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
    trade_mode TEXT,              -- spot/futures
    leverage INTEGER,             -- –ü–ª–µ—á–æ
    risk_pct REAL,                -- –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∏—Å–∫–∞
    filter_mode TEXT,             -- soft/strict
    settings TEXT,                -- JSON —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    created_at DATETIME,
    updated_at DATETIME
);
```

**risk_signal_history:**
```sql
CREATE TABLE risk_signal_history (
    id INTEGER PRIMARY KEY,
    signal_key TEXT,
    symbol TEXT,
    group_name TEXT,              -- BTC_HIGH/ETH_HIGH/SOL_HIGH/OTHER
    correlation REAL,             -- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–Ω–µ—Ç–æ–π
    risk_level TEXT,              -- LOW/MEDIUM/HIGH
    created_at DATETIME
);
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `order_audit_log` ‚Äî –ê—É–¥–∏—Ç –≤—Å–µ—Ö –æ—Ä–¥–µ—Ä–æ–≤
- `filter_checks` ‚Äî –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `false_breakout_events` ‚Äî –°–æ–±—ã—Ç–∏—è –ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–æ–µ–≤
- `position_sizing_events` ‚Äî –°–æ–±—ã—Ç–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
- `backtest_results` ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—ç–∫—Ç–µ—Å—Ç–æ–≤

**–ú–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î:**

**db.py:**
```python
class Database:
    """
    –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
    
    –ú–µ—Ç–æ–¥—ã:
    - get_user_data() - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - save_user_data() - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - get_signals() - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
    - save_signal() - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞
    """
```

**acceptance_database.py:**
```python
class AcceptanceDatabase:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Å–∏–≥–Ω–∞–ª–æ–≤
    
    –ú–µ—Ç–æ–¥—ã:
    - accept_signal() - –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞
    - get_signal_data() - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞
    - create_active_position() - —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    - update_signal_status() - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    - get_user_positions() - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **WAL mode**: Write-Ahead Logging –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **READONLY mode**: –î–ª—è dashboard –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Backup**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –≤ `backups/`
- **–ú–∏–≥—Ä–∞—Ü–∏–∏**: –ß–µ—Ä–µ–∑ `database_initialization.py`

---

### üì± Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **telegram_handlers.py**
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
   - –ö–Ω–æ–ø–∫–∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏

2. **enhanced_telegram_delivery.py**
   - –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
   - Rate limiting
   - Retry –ª–æ–≥–∏–∫–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–∞ –±–æ—Ç–∞ (DEV/PROD)

3. **src/telegram/bot.py**
   - –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

4. **messaging_service.py**
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –®–∞–±–ª–æ–Ω—ã —Å–∏–≥–Ω–∞–ª–æ–≤
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

### üîÑ –°–∏—Å—Ç–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **scripts/sync_positions_with_exchange.py**
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

2. **main.py** ‚Äî `_sync_positions_periodically()`
   - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
   - Trailing stop management
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ TP1/TP2

---

### üõ°Ô∏è –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **correlation_risk_manager.py**
   - –ê–Ω–∞–ª–∏–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–æ–≤
   - –õ–∏–º–∏—Ç—ã –Ω–∞ –≥—Ä—É–ø–ø—É

2. **portfolio_risk_manager.py**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º
   - –ê–Ω–∞–ª–∏–∑ —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
   - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

3. **risk_monitor/**
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∏—Å–∫–æ–≤
   - –†–∞—Å—á–µ—Ç—ã –º–µ—Ç—Ä–∏–∫
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**Correlation Risk Manager:**
```python
class CorrelationRiskManager:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ä–∏—Å–∫–∞–º–∏
    
    –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–æ–≤:
    - BTC_HIGH: correlation > 0.75 –∫ BTC
    - ETH_HIGH: correlation > 0.75 –∫ ETH
    - SOL_HIGH: correlation > 0.75 –∫ SOL
    - OTHER: –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞–∫—Ç–∏–≤—ã
    
    –õ–∏–º–∏—Ç—ã –Ω–∞ –≥—Ä—É–ø–ø—É:
    - SECTOR_MAX_PER_GROUP = 2 (–º–∞–∫—Å–∏–º—É–º 2 —Å–∏–≥–Ω–∞–ª–∞ –≤ –≥—Ä—É–ø–ø–µ)
    - CORRELATION_LOOKBACK_HOURS = 24 (–∞–Ω–∞–ª–∏–∑ –∑–∞ 24 —á–∞—Å–∞)
    - CORRELATION_COOLDOWN_SEC = 3600 (–∫—É–ª–¥–∞—É–Ω 1 —á–∞—Å)
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –†–∞—Å—á–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Å BTC/ETH/SOL
    2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –∞–∫—Ç–∏–≤–∞
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
    4. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –µ—Å–ª–∏ –ª–∏–º–∏—Ç –ø—Ä–µ–≤—ã—à–µ–Ω
    
    –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:
    - risk_signal_history —Ç–∞–±–ª–∏—Ü–∞
    - –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    """
```

**Portfolio Risk Manager:**
```python
class PortfolioRiskManager:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–º–∏ —Ä–∏—Å–∫–∞–º–∏
    
    –ê–Ω–∞–ª–∏–∑:
    1. –û–±—â–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è
    2. –ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º
    3. –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –ø–æ–∑–∏—Ü–∏—è–º–∏
    4. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π drawdown
    
    –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:
    - –í—ã—Å–æ–∫–∞—è –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º —Å–µ–∫—Ç–æ—Ä–µ
    - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
    - –í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π
    
    –î–µ–π—Å—Ç–≤–∏—è:
    - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–∏ —Ä–∏—Å–∫–∞—Ö
    - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∑–∞–∫—Ä—ã—Ç–∏—é –ø–æ–∑–∏—Ü–∏–π
    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
    """
```

**Risk Monitor:**
```python
# risk_monitor/calculations.py
def calculate_portfolio_risk(positions):
    """
    –†–∞—Å—á–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
    
    –ú–µ—Ç—Ä–∏–∫–∏:
    - Total Exposure: —Å—É–º–º–∞ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π
    - Sector Concentration: –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–µ–∫—Ç–æ—Ä–∞–º
    - Correlation Matrix: –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –ø–æ–∑–∏—Ü–∏—è–º–∏
    - Max Drawdown: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - Dict —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ —Ä–∏—Å–∫–∞
    - –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ (LOW/MEDIUM/HIGH/CRITICAL)
    """
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ send_signal:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
correlation_result = await correlation_manager.check_correlation_risk_async(
    symbol=symbol,
    direction=signal_type,
    user_id=user_id
)

if not correlation_result.get('allowed'):
    logger.warning("üö´ –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫: %s", correlation_result.get('reason'))
    return False

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
portfolio_risk = await portfolio_manager.check_portfolio_risk(
    user_id=user_id,
    new_symbol=symbol,
    new_direction=signal_type
)

if portfolio_risk.get('risk_level') == 'CRITICAL':
    logger.warning("üö´ –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π —Ä–∏—Å–∫: %s", portfolio_risk.get('reason'))
    return False
```

---

### üìà Trailing Stop —Å–∏—Å—Ç–µ–º–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **trailing_stop_manager.py**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ trailing stop
   - –ü–µ—Ä–µ–Ω–æ—Å SL –≤ –±–µ–∑—É–±—ã—Ç–æ–∫
   - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

2. **AdvancedTrailingStopManager**
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
   - –£—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
   - –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–∞

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**

**–û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
```python
class TrailingStopManager:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø–∞–º–∏
    
    –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
    - tp1_activation_progress = 0.5 (50% –ø—É—Ç–∏ –∫ TP1)
    - tp1_sl_progress_ratio = 1.0 (SL –¥–≤–∏–∂–µ—Ç—Å—è –Ω–∞ —Ç–∞–∫–æ–µ –∂–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
    - tp1_min_atr_multiplier = 2.0 (–º–∏–Ω–∏–º—É–º ATR * 2.0)
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ TP1
    2. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 50% –ø—É—Ç–∏ –∫ TP1:
       - –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ SL
       - –ü–µ—Ä–µ–Ω–æ—Å SL –Ω–∞ —Ç–∞–∫–æ–µ –∂–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
    3. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP1:
       - –ü–µ—Ä–µ–Ω–æ—Å SL –≤ –±–µ–∑—É–±—ã—Ç–æ–∫ + offset
    """
```

**–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:**
```python
class AdvancedTrailingStopManager:
    """
    –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ trailing stop
    
    –§–∞–∫—Ç–æ—Ä—ã –∞–¥–∞–ø—Ç–∞—Ü–∏–∏:
    
    1. –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ)
       - LOW: ratio = 1.0 (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ SL)
       - MEDIUM: ratio = 0.8
       - HIGH: ratio = 0.6
       - EXTREME: ratio = 0.4 (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
    
    2. –°–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞ (ADX, –Ω–∞–∫–ª–æ–Ω MA)
       - STRONG: +30% –∫ ratio
       - MEDIUM: +10%
       - WEAK: –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
       - RANGING: -30%
       - REVERSAL: -50%
    
    3. –†—ã–Ω–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
       - –¢—Ä–µ–Ω–¥: –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ
       - –ë–æ–∫–æ–≤–∏–∫: –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ
    
    4. –í—Ä–µ–º—è —Å—É—Ç–æ–∫
       - –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (9-10, 16-17): -20%
       - –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: +20%
       - –ù–æ—á–Ω—ã–µ —á–∞—Å—ã: -30%
    
    –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
    - min_ratio = 0.15 (–º–∏–Ω–∏–º—É–º)
    - max_ratio = 1.2 (–º–∞–∫—Å–∏–º—É–º)
    - min_safe_distance_atr = 1.5 (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)
    """
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# –í main.py, —Ñ—É–Ω–∫—Ü–∏—è _sync_positions_periodically()

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
trailing_mgr.setup_position(
    symbol=symbol,
    entry_price=entry_price,
    initial_sl=sl_price,
    side=direction,
    tp1_price=tp1_price
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–Ω–æ—Å SL
trailing_result = trailing_mgr.calculate_tp1_trailing_stop(
    symbol=symbol,
    current_price=current_price,
    df=df_for_trailing,  # OHLC –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏
    direction=direction,
    entry_price=entry_price,
    tp1_price=tp1_price
)

if trailing_result and trailing_result.get('stop_moved'):
    new_sl_price = trailing_result.get('new_stop')
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SL –Ω–∞ –±–∏—Ä–∂–µ
    await adapter.place_stop_loss_order(...)
```

---

### üß™ Agent Gym ‚Äî –°–∏—Å—Ç–µ–º–∞ –æ—Ñ—Ñ–ª–∞–π–Ω —Å–∏–º—É–ª—è—Ü–∏–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `agent_gym/`

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**

1. **scenarios.py**
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `Scenario`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
     - `SignalThroughputScenario` ‚Äî –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
     - `ExecutionFallbackScenario` ‚Äî –∞–Ω–∞–ª–∏–∑ fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

2. **configs/**
   - JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–∏–º–µ—Ä: `sample_scenarios.json`

3. **reports/**
   - –û—Ç—á–µ—Ç—ã –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö —Å–∏–º—É–ª—è—Ü–∏–π
   - JSON —Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```bash
# –ó–∞–ø—É—Å–∫ —Å–∏–º—É–ª—è—Ü–∏–π
python3 scripts/run_agent_gym.py --scenarios agent_gym/configs/sample_scenarios.json

# –ù–æ—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
python3 scripts/run_agent_gym_nightly.py
```

**–ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:**

- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏–≥–Ω–∞–ª–æ–≤:**
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
  - –°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å

- **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã:**
  - –£—Å–ø–µ—à–Ω–æ—Å—Ç—å limit/market –æ—Ä–¥–µ—Ä–æ–≤
  - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö/–Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
  - –ê–Ω–∞–ª–∏–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –û—Ñ—Ñ–ª–∞–π–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ production
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –í—ã—è–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline –º–µ—Ç—Ä–∏–∫–∞–º–∏

---

## üîÑ –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞:

```
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
   ‚îî‚îÄ> exchange_api.get_klines()
       ‚îî‚îÄ> Fallback: Binance ‚Üí Bybit ‚Üí OKX

2. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   ‚îî‚îÄ> add_technical_indicators()
       ‚îú‚îÄ> RSI, MACD, EMA
       ‚îú‚îÄ> Bollinger Bands
       ‚îî‚îÄ> ATR, ADX

3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è candidate
   ‚îî‚îÄ> _generate_signal_impl()
       ‚îú‚îÄ> –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
       ‚îú‚îÄ> Pullback entry
       ‚îî‚îÄ> Zone-based

4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
   ‚îî‚îÄ> –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
       ‚îú‚îÄ> Trend (BTC/ETH/SOL)
       ‚îú‚îÄ> Volume imbalance
       ‚îú‚îÄ> False breakout
       ‚îú‚îÄ> RSI warning
       ‚îî‚îÄ> ML optimization

5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤
   ‚îî‚îÄ> correlation_risk_manager
       ‚îî‚îÄ> portfolio_risk_manager

6. –û—Ç–ø—Ä–∞–≤–∫–∞
   ‚îî‚îÄ> send_signal()
       ‚îú‚îÄ> notify_user_enhanced()
       ‚îÇ   ‚îú‚îÄ> PROD –±–æ—Ç
       ‚îÇ   ‚îî‚îÄ> DEV –±–æ—Ç
       ‚îî‚îÄ> –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

7. –ê–≤—Ç–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
   ‚îî‚îÄ> auto_execution.execute_and_open()
       ‚îú‚îÄ> –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
       ‚îú‚îÄ> –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL
       ‚îî‚îÄ> –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TP1/TP2
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏:**

**1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä –¥–ª—è BTCUSDT):**
```python
# –ó–∞–ø—Ä–æ—Å –∫ API
df = await get_klines("BTCUSDT", timeframe="1h", limit=300)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# timestamp    open      high      low       close     volume
# 1698768000   35000.0   35100.0   34900.0   35050.0   1234.56
# 1698771600   35050.0   35200.0   35000.0   35150.0   1456.78
# ...

# Fallback –º–µ—Ö–∞–Ω–∏–∑–º:
# –ü–æ–ø—ã—Ç–∫–∞ 1: Binance API ‚Üí —É—Å–ø–µ—Ö ‚úÖ
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: –ü–æ–ø—ã—Ç–∫–∞ 2: Bybit API
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: –ü–æ–ø—ã—Ç–∫–∞ 3: OKX API
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
```

**2. –†–∞—Å—á–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:**
```python
df = add_technical_indicators(df)

# –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
# rsi: 45.2 (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞)
# macd: 12.5 (–±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª)
# ema_fast: 35025.0
# ema_slow: 34980.0 (EMA Fast > EMA Slow ‚Üí –±—ã—á–∏–π —Ç—Ä–µ–Ω–¥)
# bb_upper: 35200.0
# bb_lower: 34800.0
# atr: 150.0
# adx: 28.5 (—Å—Ä–µ–¥–Ω–∏–π —Ç—Ä–µ–Ω–¥)
```

**3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞:**
```python
# –û–±–Ω–∞—Ä—É–∂–µ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω: EMA Fast –ø–µ—Ä–µ—Å–µ–∫ EMA Slow —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö
# ‚Üí –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª (LONG)

signal_data = {
    "symbol": "BTCUSDT",
    "direction": "LONG",
    "entry_price": 35050.0,
    "confidence": 0.75,
    "pattern": "ema_crossover"
}
```

**4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ):**
```python
# –§–∏–ª—å—Ç—Ä 1: BTC Trend
btc_trend_result = smart_trend_filter.filter_signal(...)
# ‚úÖ –ü–†–û–®–ï–õ: BTC –≤ –±—ã—á—å–µ–º —Ç—Ä–µ–Ω–¥–µ

# –§–∏–ª—å—Ç—Ä 2: Volume Imbalance
volume_result = volume_filter.filter_signal(...)
# ‚úÖ –ü–†–û–®–ï–õ: –û–±—ä–µ–º –Ω–∞ 25% –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ

# –§–∏–ª—å—Ç—Ä 3: False Breakout
false_breakout_result = false_breakout_detector.analyze(...)
# ‚úÖ –ü–†–û–®–ï–õ: –ù–µ –ª–æ–∂–Ω—ã–π –ø—Ä–æ–±–æ–π (confidence = 0.65)

# –§–∏–ª—å—Ç—Ä 4: RSI Warning
rsi_check = check_rsi_warning(...)
# ‚úÖ –ü–†–û–®–ï–õ: RSI = 45.2 (–Ω–µ –≤ –æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–µ)

# –§–∏–ª—å—Ç—Ä 5: ML Optimization
ml_result = ml_optimizer.optimize_filter_parameters(...)
# ‚úÖ –ü–†–û–®–ï–õ: ML —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–∏–≥–Ω–∞–ª
```

**5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤:**
```python
# –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫
correlation_check = await correlation_manager.check_correlation_risk_async(
    symbol="BTCUSDT",
    direction="LONG",
    user_id=958930260
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"allowed": True, "group": "BTC_HIGH", "active_in_group": 1}

# –ü–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π —Ä–∏—Å–∫
portfolio_check = await portfolio_manager.check_portfolio_risk(
    user_id=958930260,
    new_symbol="BTCUSDT",
    new_direction="LONG"
)
# –†–µ–∑—É–ª—å—Ç–∞—Ç: {"risk_level": "LOW", "total_exposure": 15.5}
```

**6. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞:**
```python
# –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
message = """
üü¢ –ù–û–í–´–ô –¢–û–†–ì–û–í–´–ô –°–ò–ì–ù–ê–õ

üìä –°–∏–º–≤–æ–ª: BTCUSDT
üìà –°—Ç–æ—Ä–æ–Ω–∞: LONG
üí∞ –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 35050.0
üéØ TP1: 35751.0 (+2.0%)
üéØ TP2: 36452.0 (+4.0%)
üõ°Ô∏è SL: 34349.0 (-2.0%)
üíµ –°—É–º–º–∞ –≤—Ö–æ–¥–∞: 50 USDT
üî¢ –ü–ª–µ—á–æ: 3x
"""

# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–∞ –±–æ—Ç–∞
success = await notify_user_enhanced(
    user_id=958930260,
    message=message,
    reply_markup=keyboard,
    _send_to_both_bots=True  # –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ DEV –∏ PROD
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ‚úÖ PROD –±–æ—Ç: message_id = 27469
# ‚úÖ DEV –±–æ—Ç: message_id = 12345
```

**7. –ê–≤—Ç–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (PROD —Ä–µ–∂–∏–º):**
```python
if ATRA_ENV == "prod" and success:
    # –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏
    execution_result = await auto_exec.execute_and_open(
        symbol="BTCUSDT",
        direction="LONG",
        entry_price=35050.0,
        quantity_usdt=50.0,  # –ú–∞—Ä–∂–∞
        leverage=3,
        sl_price=34349.0,
        tp1_price=35751.0,
        tp2_price=36452.0
    )
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç:
    # ‚úÖ –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞: order_id = "12345678"
    # ‚úÖ SL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: order_id = "12345679"
    # ‚úÖ TP1 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: order_id = "12345680"
    # ‚úÖ TP2 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: order_id = "12345681"
```

---

### –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
   ‚îî‚îÄ> telegram_handlers.button_callback()

2. –í–∞–ª–∏–¥–∞—Ü–∏—è
   ‚îî‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
       ‚îú‚îÄ> –°–∏–º–≤–æ–ª
       ‚îú‚îÄ> –¶–µ–Ω–∞
       ‚îî‚îÄ> –í—Ä–µ–º—è

3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
   ‚îî‚îÄ> acceptance_database.accept_signal()
       ‚îî‚îÄ> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

4. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (–µ—Å–ª–∏ —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º)
   ‚îî‚îÄ> telegram_handlers.handle_accept()
       ‚îî‚îÄ> exchange_adapter.place_order()
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏:**

**1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å":**
```python
# callback_data: "accept|BTCUSDT|1763581081|35050.0|0.0014|LONG|2.0|3.0"

# –ü–∞—Ä—Å–∏–Ω–≥
parts = callback_data.split("|")
# parts[0] = "accept"
# parts[1] = "BTCUSDT"
# parts[2] = "1763581081" (timestamp)
# parts[3] = "35050.0" (—Ü–µ–Ω–∞)
# parts[4] = "0.0014" (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
# parts[5] = "LONG"
# parts[6] = "2.0" (—Ä–∏—Å–∫ %)
# parts[7] = "3.0" (–ø–ª–µ—á–æ)
```

**2. –í–∞–ª–∏–¥–∞—Ü–∏—è:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ (TTL –∫–Ω–æ–ø–∫–∏)
current_time = time.time()
signal_time = float(parts[2])
if current_time - signal_time > 300:  # 5 –º–∏–Ω—É—Ç
    # –ö–Ω–æ–ø–∫–∞ –∏—Å—Ç–µ–∫–ª–∞
    await update.message.answer("‚è∞ –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –∫–Ω–æ–ø–∫–∏ –∏—Å—Ç–µ–∫–ª–æ")
    return

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –±–æ–ª–µ–µ 1%)
current_price = await get_current_price("BTCUSDT")
signal_price = float(parts[3])
price_diff = abs(current_price - signal_price) / signal_price
if price_diff > 0.01:
    # –¶–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ
    await update.message.answer("‚ö†Ô∏è –¶–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª.")
    return
```

**3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
```python
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î
await acceptance_db.accept_signal(
    signal_key="BTCUSDT_1763581081.666965",
    user_id=958930260,
    accepted_time=datetime.now(),
    accepted_by="manual"  # –∏–ª–∏ "auto"
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:
# accepted_signals:
#   status: "pending" ‚Üí "accepted"
#   accepted_time: "2025-11-19 23:05:00"
```

**4. –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ (—Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º):**
```python
# –ï—Å–ª–∏ trade_mode = "manual"
if user_data.get("trade_mode") == "manual":
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –±–∏—Ä–∂–µ
    # –ë–æ—Ç —Ç–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    await update.message.answer(
        "‚úÖ –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç! –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –±–∏—Ä–∂–µ:\n"
        f"–°–∏–º–≤–æ–ª: BTCUSDT\n"
        f"–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: LONG\n"
        f"–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 35050.0\n"
        f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 0.0014 BTC"
    )
else:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
    await auto_exec.execute_and_open(...)
```

---

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π:

```
1. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)
   ‚îî‚îÄ> main._sync_positions_periodically()

2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏
   ‚îî‚îÄ> exchange_adapter.get_positions()

3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ë–î
   ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∏–≥–Ω–∞–ª–∞
   ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   ‚îî‚îÄ> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ/–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ

4. Trailing Stop
   ‚îî‚îÄ> trailing_stop_manager
       ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ TP1
       ‚îî‚îÄ> –ü–µ—Ä–µ–Ω–æ—Å SL –ø—Ä–∏ 50%
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏:**

**1. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
```python
# –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
async def _sync_positions_periodically():
    while True:
        await asyncio.sleep(60)
        
        # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        for user_id in active_users:
            await sync_user_positions(user_id)
```

**2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å –±–∏—Ä–∂–∏:**
```python
# –ó–∞–ø—Ä–æ—Å –∫ –±–∏—Ä–∂–µ
positions = await adapter.get_positions(user_id=958930260)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# [
#   {
#     "symbol": "BTCUSDT",
#     "side": "long",
#     "size": 0.0014,
#     "entry_price": 35050.0,
#     "unrealized_pnl": 2.5
#   },
#   {
#     "symbol": "ETHUSDT",
#     "side": "short",
#     "size": 0.05,
#     "entry_price": 2500.0,
#     "unrealized_pnl": -1.2
#   }
# ]
```

**3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ë–î:**
```python
# –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ —Å –±–∏—Ä–∂–∏
for position in positions:
    symbol = position["symbol"]
    direction = "BUY" if position["side"] == "long" else "SELL"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∏–≥–Ω–∞–ª–∞
    signal_data = await adb.get_signal_data(user_id, symbol)
    
    if not signal_data:
        # –†—É—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–æ—Ç–∫—Ä—ã—Ç–∞ –Ω–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
        logger.info("üìù –†—É—á–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è: %s", symbol)
        await adb.upsert_active_position(
            user_id, symbol, direction, entry_price, "open",
            signal_key=None  # None = manual
        )
    else:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        signal_direction = signal_data.get("direction")
        if signal_direction != direction:
            # –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞
            logger.warning("üö´ –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: %s", symbol)
            continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º
        
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è
        await adb.upsert_active_position(
            user_id, symbol, direction, entry_price, "open",
            signal_key=signal_data.get("signal_key")
        )
```

**4. Trailing Stop:**
```python
# –î–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
for position in active_positions:
    symbol = position["symbol"]
    entry_price = position["entry_price"]
    tp1_price = position["tp1_price"]
    current_price = await get_current_price(symbol)
    
    # –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ TP1
    if direction == "LONG":
        progress = (current_price - entry_price) / (tp1_price - entry_price)
    else:  # SHORT
        progress = (entry_price - current_price) / (entry_price - tp1_price)
    
    # –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ 50% –ø—É—Ç–∏ –∫ TP1
    if progress >= 0.5:
        # –†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ SL
        trailing_result = trailing_mgr.calculate_tp1_trailing_stop(
            symbol=symbol,
            current_price=current_price,
            df=df,  # OHLC –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏
            direction=direction,
            entry_price=entry_price,
            tp1_price=tp1_price
        )
        
        if trailing_result.get("stop_moved"):
            new_sl = trailing_result.get("new_stop")
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SL –Ω–∞ –±–∏—Ä–∂–µ
            await adapter.place_stop_loss_order(
                symbol, direction, size, new_sl
            )
            
            logger.info(
                "üéØ SL –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω –≤ –±–µ–∑—É–±—ã—Ç–æ–∫: %s @ %.8f "
                "(–ø—Ä–æ–≥—Ä–µ—Å—Å –∫ TP1: %.1f%%)",
                symbol, new_sl, progress * 100
            )
```

---

## ‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. **config.py**
   - –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –§–∏–ª—å—Ç—Ä—ã
   - –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç

2. **env.prod** / **env.dev**
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - API –∫–ª—é—á–∏
   - –¢–æ–∫–µ–Ω—ã Telegram

3. **hybrid_config.py**
   - –ì–∏–±—Ä–∏–¥–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```python
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
ATRA_ENV = "prod"  # –∏–ª–∏ "dev"

# Telegram
TELEGRAM_TOKEN = "..."      # PROD —Ç–æ–∫–µ–Ω
TELEGRAM_TOKEN_DEV = "..."  # DEV —Ç–æ–∫–µ–Ω

# –¢–æ—Ä–≥–æ–≤–ª—è
DEFAULT_RISK_PCT = 2.0
DEFAULT_LEVERAGE = 1.0
TRADING_MODE = "futures"    # –∏–ª–∏ "spot"

# –§–∏–ª—å—Ç—Ä—ã
USE_BTC_TREND_FILTER = True
USE_ETH_TREND_FILTER = True
USE_SOL_TREND_FILTER = True

# ML
USE_ML_OPTIMIZATION = True
LIGHTGBM_ENABLED = True
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

**–§–∏–ª—å—Ç—Ä—ã:**
```python
# BTC Trend Filter
BTC_TREND_EMA_SOFT = 50              # EMA –ø–µ—Ä–∏–æ–¥ –¥–ª—è soft —Ä–µ–∂–∏–º–∞
BTC_TREND_EMA_STRICT = 200           # EMA –ø–µ—Ä–∏–æ–¥ –¥–ª—è strict —Ä–µ–∂–∏–º–∞
BTC_TREND_LOOKBACK = 50               # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–µ—á–µ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
BTC_TREND_MAX_DROP_PCT = 8.0         # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
BTC_TREND_USE_MULTITF = True          # Multi-timeframe –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

# Volume Imbalance Filter
VOLUME_IMBALANCE_FILTER_CONFIG = {
    'enabled': True,
    'min_volume_ratio': 1.2,          # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –æ–±—ä–µ–º–æ–≤
    'require_volume_confirmation': True,  # –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    'use_ml_optimization': True,      # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
    'lookback_periods': 20            # –ü–µ—Ä–∏–æ–¥ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ä–µ–¥–Ω–µ–≥–æ
}

# False Breakout Detector
FALSE_BREAKOUT_CONFIG = {
    'enabled': True,
    'min_total_confidence': 0.20,     # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    'volume_weight': 0.40,             # –í–µ—Å —Ñ–∞–∫—Ç–æ—Ä–∞ –æ–±—ä–µ–º–∞
    'momentum_weight': 0.30,           # –í–µ—Å —Ñ–∞–∫—Ç–æ—Ä–∞ momentum
    'level_weight': 0.30               # –í–µ—Å —Ñ–∞–∫—Ç–æ—Ä–∞ —É—Ä–æ–≤–Ω—è
}

# RSI Filter
RSI_OVERSOLD = 20                     # –£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç–∏
RSI_OVERBOUGHT = 80                   # –£—Ä–æ–≤–µ–Ω—å –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç–∏
RSI_WARNING_OVERSOLD = 15             # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (—Å—Ç—Ä–æ–≥–∏–π)
RSI_WARNING_OVERBOUGHT = 85           # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (—Å—Ç—Ä–æ–≥–∏–π)
```

**–†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç:**
```python
# –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏
DEFAULT_RISK_PCT = 2.0                # –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∏—Å–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
MIN_RISK_PCT = 0.1                    # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
MAX_RISK_PCT = 10.0                   # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫

# –ü–ª–µ—á–æ
DEFAULT_LEVERAGE = 1.0                # –ü–ª–µ—á–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
MIN_LEVERAGE = 1                      # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–ª–µ—á–æ
MAX_LEVERAGE = 20                     # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–ª–µ—á–æ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∏—Ä–∂–∏)

# –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏
CORRELATION_COOLDOWN_ENABLED = True
CORRELATION_LOOKBACK_HOURS = 24       # –ê–Ω–∞–ª–∏–∑ –∑–∞ 24 —á–∞—Å–∞
SECTOR_MAX_PER_GROUP = 2              # –ú–∞–∫—Å–∏–º—É–º —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
CORRELATION_COOLDOWN_SEC = 3600       # –ö—É–ª–¥–∞—É–Ω 1 —á–∞—Å
```

**Trailing Stop:**
```python
ADAPTIVE_TRAILING_CONFIG = {
    'enabled': True,
    'volatility_regimes': {
        'LOW': {'max_ratio': 1.0, 'min_ratio': 0.8, 'atr_threshold': 0.01},
        'MEDIUM': {'max_ratio': 0.8, 'min_ratio': 0.5, 'atr_threshold': 0.025},
        'HIGH': {'max_ratio': 0.6, 'min_ratio': 0.3, 'atr_threshold': 0.05},
        'EXTREME': {'max_ratio': 0.4, 'min_ratio': 0.2, 'atr_threshold': 0.1}
    },
    'trend_strength': {
        'STRONG': 1.3,                 # +30% –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
        'MEDIUM': 1.1,                 # +10% –ø—Ä–∏ —Å—Ä–µ–¥–Ω–µ–º —Ç—Ä–µ–Ω–¥–µ
        'WEAK': 1.0,                   # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        'RANGING': 0.7,                # -30% –ø—Ä–∏ –±–æ–∫–æ–≤–∏–∫–µ
        'REVERSAL': 0.5                # -50% –ø—Ä–∏ —Ä–∞–∑–≤–æ—Ä–æ—Ç–µ
    },
    'time_factors': {
        'HIGH_VOLATILITY_HOURS': [9, 10, 16, 17],
        'high_vol_multiplier': 0.8,
        'low_vol_multiplier': 1.2
    },
    'min_safe_distance_atr': 1.5,     # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ ATR
    'max_ratio': 1.2,
    'min_ratio': 0.15
}
```

**–°–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥–±–æ—Ä –º–æ–Ω–µ—Ç
AUTO_FETCH_COINS = True               # –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä

# –ò–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
COINS = [
    "BONKUSDT", "NEIROUSDT", "SUIUSDT",
    "POLUSDT", "WIFUSDT", "ADAUSDT",
    # ... –∏ —Ç.–¥.
]

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–≤—Ç–æ-–ø–æ–¥–±–æ—Ä–∞
TOP_N = 500                            # –¢–æ–ø N –ø–∞—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
FINAL_LIMIT = 200                     # –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫
MIN_24H_VOLUME = 1000000              # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º 24h ($)
```

**Telegram:**
```python
# –í—ã–±–æ—Ä —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = (
    TELEGRAM_TOKEN if ATRA_ENV == "prod" else (
        TELEGRAM_TOKEN_DEV or TELEGRAM_TOKEN
    )
)

# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –æ–±–∞ –±–æ—Ç–∞
# –í signal_live.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä _send_to_both_bots=True
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
```python
DATABASE = "trading.db"               # –ü—É—Ç—å –∫ –ë–î
BACKUP_DIR = "backups/"               # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –±—ç–∫–∞–ø–æ–≤
BACKUP_INTERVAL_HOURS = 24            # –ò–Ω—Ç–µ—Ä–≤–∞–ª –±—ç–∫–∞–ø–æ–≤
```

**ML/AI:**
```python
# LightGBM
LIGHTGBM_ENABLED = True
LIGHTGBM_MODEL_PATH = "models/lightgbm_model.pkl"
LIGHTGBM_RETRAIN_INTERVAL_DAYS = 7    # –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é

# ML Filter Optimizer
USE_ML_OPTIMIZATION = True
ML_OPTIMIZATION_INTERVAL_HOURS = 6    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
```

---

## üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –°—Ö–µ–º–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

**signals_log:**
- `id`, `symbol`, `entry`, `stop`, `tp1`, `tp2`
- `entry_time`, `exit_time`, `result`
- `net_profit`, `user_id`, `created_at`

**accepted_signals:**
- `signal_key`, `symbol`, `direction`
- `entry_price`, `signal_time`
- `user_id`, `chat_id`, `message_id`
- `status`, `accepted_time`, `pnl`

**active_positions:**
- `symbol`, `direction`, `entry_price`
- `user_id`, `signal_key`
- `status`, `sl_price`, `tp1_price`, `tp2_price`

**users_data:**
- `user_id`, `deposit`, `balance`
- `trade_mode`, `leverage`, `risk_pct`
- `filter_mode`, `settings`

**risk_signal_history:**
- `signal_key`, `symbol`, `group`
- `correlation`, `risk_level`
- `created_at`

---

## üöÄ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

**–°–µ—Ä–≤–µ—Ä:** `185.177.216.15`  
**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** `root`  
**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `/root/atra`  
**–ü–∞—Ä–æ–ª—å SSH:** `u44Ww9NmtQj,XG`

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:**
   ```bash
   ssh root@185.177.216.15
   cd /root/atra
   ```

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞:**
   ```bash
   # –ß–µ—Ä–µ–∑ git (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   git stash                    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   git pull origin main
   git stash pop               # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
   
   # –ò–ª–∏ —á–µ—Ä–µ–∑ scp (–µ—Å–ª–∏ git –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
   scp config.py signal_live.py root@185.177.216.15:/root/atra/
   ```

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   pip3 install -r requirements.txt
   
   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
   pip3 install lightgbm scikit-learn
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ env.prod
   cat env.prod | grep ATRA_ENV
   cat env.prod | grep TELEGRAM_TOKEN
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
   ps aux | grep "python3 main.py"
   cat /proc/PID/environ | tr "\0" "\n" | grep ATRA_ENV
   ```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:**
   ```bash
   # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
   pkill -f "python3 main.py"
   sleep 2
   
   # –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
   nohup python3 main.py > main.log 2>&1 &
   
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞
   sleep 3
   ps aux | grep "python3 main.py" | grep -v grep
   ```

### –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

**deploy_to_production.sh:**
```bash
#!/bin/bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å–µ—Ä–≤–µ—Ä

SERVER="root@185.177.216.15"
PASSWORD="u44Ww9NmtQj,XG"
REMOTE_DIR="/root/atra"

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
sshpass -p "$PASSWORD" scp -o StrictHostKeyChecking=no \
    config.py signal_live.py telegram_handlers.py \
    "$SERVER:$REMOTE_DIR/"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no "$SERVER" \
    "cd $REMOTE_DIR && pkill -f 'python3 main.py' && \
     sleep 2 && nohup python3 main.py > main.log 2>&1 &"
```

**restart_bot_on_server.sh:**
```bash
#!/bin/bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

sshpass -p 'u44Ww9NmtQj,XG' ssh -o StrictHostKeyChecking=no \
    root@185.177.216.15 \
    'cd /root/atra && pkill -f "python3 main.py" && \
     sleep 2 && nohup python3 main.py > main.log 2>&1 &'
```

**update_and_restart.sh:**
```bash
#!/bin/bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

# 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
git pull origin main

# 2. –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
./deploy_to_production.sh

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sshpass -p 'u44Ww9NmtQj,XG' ssh -o StrictHostKeyChecking=no \
    root@185.177.216.15 'ps aux | grep "python3 main.py"'
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ sshpass:

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ sshpass –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ sshpass (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
# Ubuntu/Debian: sudo apt-get install sshpass
# macOS: brew install sshpass

# –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã —Å sshpass
sshpass -p 'u44Ww9NmtQj,XG' ssh -o StrictHostKeyChecking=no \
    root@185.177.216.15 'command'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "python3 main.py" | grep -v grep

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -f /root/atra/main.log

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
python3 -c "import config; print(config.TOKEN[:20])"

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -c "import config; print(config.ATRA_ENV)"

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sqlite3 trading.db "SELECT COUNT(*) FROM signals_log;"
```

### –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:

```bash
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
cd /root/atra
git stash                    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git checkout HEAD~1          # –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
# –∏–ª–∏
git reset --hard origin/main # –ñ–µ—Å—Ç–∫–∏–π —Å–±—Ä–æ—Å –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∫–æ–º–º–∏—Ç—É
pkill -f "python3 main.py"
nohup python3 main.py > main.log 2>&1 &
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –õ–æ–≥–∏:

- `main.log` ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥
- `bot.log` ‚Äî –õ–æ–≥ Telegram –±–æ—Ç–∞
- `atra.log` ‚Äî –û–±—â–∏–π –ª–æ–≥ —Å–∏—Å—Ç–µ–º—ã

### –ú–µ—Ç—Ä–∏–∫–∏:

- **Observability —Å–∏—Å—Ç–µ–º–∞** (`observability/`)
  - –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
  - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

- **Monitoring —Å–∏—Å—Ç–µ–º–∞** (`monitoring/`)
  - –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
  - –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

```bash
# –ü—Ä–æ—Ü–µ—Å—Å
ps aux | grep "python3 main.py"

# –õ–æ–≥–∏
tail -f main.log

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
sqlite3 trading.db "SELECT COUNT(*) FROM signals_log;"
```

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.INFO      # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
logging.WARNING   # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
logging.ERROR     # –û—à–∏–±–∫–∏
logging.DEBUG     # –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

# –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
RotatingFileHandler(
    filename='main.log',
    maxBytes=10*1024*1024,  # 10 MB
    backupCount=5            # 5 —Ñ–∞–π–ª–æ–≤ –±—ç–∫–∞–ø–∞
)

# –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
'%(asctime)s | %(levelname)-8s | %(name)-20s | %(message)s'
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–≥–Ω–∞–ª–æ–≤:**
   ```python
   # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ PipelineMonitor
   - –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞ —Ü–∏–∫–ª
   - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤
   - –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ü–∏–∫–ª–∞
   - Success rate —Ñ–∏–ª—å—Ç—Ä–æ–≤
   ```

2. **Telegram –¥–æ—Å—Ç–∞–≤–∫–∞:**
   ```python
   # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ EnhancedTelegramDelivery
   - –í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏
   - –£—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–ø—Ä–∞–≤–æ–∫
   - Success rate (%)
   - Flood control –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
   - –¢–∞–π–º–∞—É—Ç—ã
   - API –æ—à–∏–±–∫–∏
   ```

3. **–¢–æ—Ä–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
   ```python
   # –ò–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
   - –û–±—â–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è
   - PnL –∑–∞ –ø–µ—Ä–∏–æ–¥
   - Win Rate
   - Profit Factor
   - Max Drawdown
   ```

4. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
   ```python
   # –ò–∑ monitoring/infra_metrics.py
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
   - –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∑–∞–ø—Ä–æ—Å–æ–≤
   - Latency API –∑–∞–ø—Ä–æ—Å–æ–≤
   ```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:**

```bash
# 1. –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω
ps aux | grep "python3 main.py" | grep -v grep

# 2. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
tail -100 main.log | grep -i "error\|exception\|traceback" | tail -10

# 3. –°–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è
tail -200 main.log | grep -E "(—Å–∏–≥–Ω–∞–ª|signal|SEND)" | tail -5

# 4. Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç
tail -100 main.log | grep -E "(Telegram|bot)" | tail -5

# 5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
sqlite3 trading.db "SELECT COUNT(*) FROM signals_log WHERE created_at > datetime('now', '-1 hour');"

# 6. –ü–æ–∑–∏—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è
sqlite3 trading.db "SELECT COUNT(*) FROM active_positions WHERE status='open';"
```

**–ê–ª–µ—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**

```python
# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram
- –û—à–∏–±–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ä–∏—Å–∫–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å API –±–∏—Ä–∂–∏
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Å–∏—Å—Ç–µ–º—ã

# –ß–µ—Ä–µ–∑ alert_system.py
await alert_system.send_critical_alert(
    message="–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞",
    severity="HIGH"
)
```

**Dashboard (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω):**

```python
# Web Dashboard –Ω–∞ FastAPI
# –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://server:8000/dashboard

# –ú–µ—Ç—Ä–∏–∫–∏:
- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- –ò—Å—Ç–æ—Ä–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ì—Ä–∞—Ñ–∏–∫–∏ PnL
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:

- **API –∫–ª—é—á–∏:** –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `key_encryption.py`
- **–¢–æ–∫–µ–Ω—ã:** –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ `env.prod` / `env.dev`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite —Å WAL mode

### –î–æ—Å—Ç—É–ø:

- **SSH:** –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- **Telegram:** –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ user_id
- **REST API:** (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω) —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω

**–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**

**–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π:**
```python
# key_encryption.py
from cryptography.fernet import Fernet

class KeyEncryption:
    """
    –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π –±–∏—Ä–∂–∏
    
    –ü—Ä–æ—Ü–µ—Å—Å:
    1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
    2. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
    3. –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
    
    –•—Ä–∞–Ω–µ–Ω–∏–µ:
    - –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è: ATRA_ENCRYPTION_KEY (–≤ env —Ñ–∞–π–ª–µ)
    - –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏: –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (user_exchange_keys)
    """
    
    def encrypt_key(self, api_key: str) -> str:
        """–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–∞"""
        # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Fernet (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
        return encrypted_key
    
    def decrypt_key(self, encrypted_key: str) -> str:
        """–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ API –∫–ª—é—á–∞"""
        return decrypted_key
```

**–ó–∞—â–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤:**
```python
# –¢–æ–∫–µ–Ω—ã –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è –≤ git
# .gitignore –≤–∫–ª—é—á–∞–µ—Ç:
# - env.prod
# - env.dev
# - .env
# - *.key
# - *.pem

# –•—Ä–∞–Ω–µ–Ω–∏–µ:
# - env.prod: PROD —Ç–æ–∫–µ–Ω
# - env.dev: DEV —Ç–æ–∫–µ–Ω
# - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Ñ–∞–π–ª–∞–º–∏
```

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```python
# Telegram –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
def is_authorized_user(user_id: int) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    –ü—Ä–æ–≤–µ—Ä–∫–∏:
    1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ users_data
    2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    - True –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    - False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    user_data = db.get_user_data(user_id)
    if not user_data:
        return False
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    if user_data.get('blocked', False):
        return False
    
    return True
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è:**
```python
# –í auto_execution.py
if ATRA_ENV != "prod":
    # –ö–†–ò–¢–ò–ß–ù–û: DEV/TEST –æ–∫—Ä—É–∂–µ–Ω–∏—è –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –ø–æ–∑–∏—Ü–∏–∏
    logger.error("üö´ –ê–í–¢–û-–ò–°–ü–û–õ–ù–ï–ù–ò–ï –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û –≤ %s –æ–∫—Ä—É–∂–µ–Ω–∏–∏", ATRA_ENV)
    return False
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
```python
# position_size_validator.py
class PositionSizeValidator:
    """
    –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
    
    –ü—Ä–æ–≤–µ—Ä–∫–∏:
    1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (0.0001)
    2. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–±–∞–ª–∞–Ω—Å * leverage)
    3. –†–∏—Å–∫ –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
    4. –û–±—â–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞
    
    –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏:
    - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∏—Å–∫–∞
    - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ
    - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏
    """
```

**–ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π:**
```python
# order_audit_log.py
# –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
# - –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π
# - –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π
# - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SL/TP
# - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
await audit_log.log_order(
    order_type='market',
    symbol='BTCUSDT',
    side='BUY',
    amount=0.001,
    price=35050.0,
    status='filled',
    user_id=958930260,
    timestamp=datetime.now()
)
```

**–ó–∞—â–∏—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```python
# WAL mode –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
conn.execute("PRAGMA journal_mode=WAL")

# READONLY mode –¥–ª—è dashboard
conn.execute("PRAGMA query_only=ON")

# –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞
# –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ backups/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞:**
```python
# SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π SSH (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)

# Telegram:
# - –ü—Ä–æ–≤–µ—Ä–∫–∞ user_id –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–º–∞–Ω–¥
# - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞

# REST API (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω):
# - –¢—Ä–µ–±—É–µ—Ç —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
# - Rate limiting
# - HTTPS —Ç–æ–ª—å–∫–æ
```

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

- `docs/ARCHITECTURE_AUDIT_REPORT.md` ‚Äî –ê—É–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- `docs/COMPLETE_INTEGRATION_CHECKLIST.md` ‚Äî –ß–µ–∫–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `docs/DEPLOYMENT_QUICK_START.md` ‚Äî –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- `docs/FILTERS_LOGIC_AND_PARAMETERS.md` ‚Äî –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `docs/ML_LIGHTGBM_INTEGRATION_COMPLETE.md` ‚Äî ML –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

---

## üõ†Ô∏è –†–ê–ó–†–ê–ë–û–¢–ö–ê

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞:

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `src/filters/`
2. –ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç `BaseFilter`
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `filter_signal()`
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `signal_live.py`

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞:**
```python
# src/filters/my_custom_filter.py
from src.filters.base import BaseFilter
from typing import Dict, Any, Optional
import pandas as pd

class MyCustomFilter(BaseFilter):
    """–ú–æ–π –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä"""
    
    def __init__(self, config: Dict[str, Any]):
        super().__init__(config)
        self.threshold = config.get('threshold', 0.5)
    
    async def filter_signal(
        self,
        df: pd.DataFrame,
        symbol: str,
        direction: str,
        **kwargs
    ) -> Optional[FilterResult]:
        """
        –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞
        
        Args:
            df: DataFrame —Å –¥–∞–Ω–Ω—ã–º–∏
            symbol: –¢–æ—Ä–≥–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            direction: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (LONG/SHORT)
        
        Returns:
            FilterResult(passed=True) –µ—Å–ª–∏ —Å–∏–≥–Ω–∞–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç
            FilterResult(passed=False, reason="...") –µ—Å–ª–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç
            None –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º
        """
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        if some_condition:
            return FilterResult(
                passed=True,
                reason="Custom filter passed"
            )
        else:
            return FilterResult(
                passed=False,
                reason="Custom filter blocked: condition not met"
            )
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ signal_live.py:**
```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ _generate_signal_impl()

# –ò–º–ø–æ—Ä—Ç —Ñ–∏–ª—å—Ç—Ä–∞
from src.filters.my_custom_filter import MyCustomFilter

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
my_filter = MyCustomFilter(config.get('MY_CUSTOM_FILTER_CONFIG', {}))

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
custom_result = await my_filter.filter_signal(
    df=df,
    symbol=symbol,
    direction=signal_type
)

if custom_result is None or not custom_result.passed:
    logger.debug("üö´ %s: MyCustomFilter –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª", symbol)
    return None, custom_result.reason if custom_result else "Custom filter failed"
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤ `src/strategies/`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `signal_live.py`

**–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
```python
# src/strategies/my_strategy.py
from typing import Dict, Any, Optional, Tuple
import pandas as pd

async def generate_my_strategy_signal(
    df: pd.DataFrame,
    symbol: str,
    user_data: Dict[str, Any]
) -> Optional[Dict[str, Any]]:
    """
    –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ –ø–æ –º–æ–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    
    Returns:
        Dict —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞ –∏–ª–∏ None
    """
    # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    if condition_for_long:
        return {
            "direction": "LONG",
            "entry_price": current_price,
            "confidence": 0.75,
            "pattern": "my_pattern"
        }
    elif condition_for_short:
        return {
            "direction": "SHORT",
            "entry_price": current_price,
            "confidence": 0.70,
            "pattern": "my_pattern"
        }
    return None
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# –í signal_live.py, —Ñ—É–Ω–∫—Ü–∏—è _generate_signal_impl()

# –ü–æ–ø—ã—Ç–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
from src.strategies.my_strategy import generate_my_strategy_signal

my_signal = await generate_my_strategy_signal(df, symbol, user_data)
if my_signal:
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
    signal_type = my_signal["direction"]
    signal_price = my_signal["entry_price"]
    # ... –¥–∞–ª—å–Ω–µ–π—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

**–Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã:**
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤
pytest tests/unit/ -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/unit/test_filters.py::test_volume_filter -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/unit/ --cov=src/filters --cov-report=html
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
```bash
# –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–∏—Ä–∂–µ–π (–∏—Å–ø–æ–ª—å–∑—É—é—Ç mock)
pytest tests/integration/ -v

# –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pytest tests/integration/test_database.py -v
```

**–ë—ç–∫—Ç–µ—Å—Ç:**
```bash
# –ë—ç–∫—Ç–µ—Å—Ç –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
python3 backtest_cli.py --symbol BTCUSDT --days 30

# –ë—ç–∫—Ç–µ—Å—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è
python3 backtest_cli.py --portfolio --days 90

# –ë—ç–∫—Ç–µ—Å—Ç —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python3 backtest_cli.py \
    --symbol ETHUSDT \
    --days 60 \
    --risk 2.0 \
    --leverage 3
```

**Smoke —Ç–µ—Å—Ç—ã:**
```bash
# –¢–µ—Å—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π (–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∏—Ä–∂–µ)
python3 scripts/live_smoke_test_tp_sl.py

# –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤
python3 scripts/diagnostic_test_filters.py
```

**–ü—Ä–∏–º–µ—Ä —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞:**
```python
# tests/unit/test_volume_filter.py
import pytest
from src.filters.volume_imbalance import VolumeImbalanceFilter
import pandas as pd

def test_volume_filter_passes():
    """–¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞"""
    filter_instance = VolumeImbalanceFilter({
        'min_volume_ratio': 1.2,
        'require_volume_confirmation': True
    })
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    df = pd.DataFrame({
        'volume': [100, 150, 200, 180],  # –û–±—ä–µ–º –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ
        'close': [100, 101, 102, 103]
    })
    
    result = await filter_instance.filter_signal(
        df=df,
        symbol="BTCUSDT",
        direction="LONG"
    )
    
    assert result is not None
    assert result.passed == True
```

### –û—Ç–ª–∞–¥–∫–∞:

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –í–∫–ª—é—á–µ–Ω–∏–µ DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
import logging
logging.basicConfig(level=logging.DEBUG)

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
logger = logging.getLogger('signal_live')
logger.setLevel(logging.DEBUG)
```

**–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tracer –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
from observability.tracing import get_tracer

tracer = get_tracer()
trace = tracer.start(
    agent="my_module",
    mission="debug_signal",
    metadata={"symbol": "BTCUSDT"}
)

trace.record(step="think", name="analysis", metadata={"result": "..."})
trace.record(step="act", name="action", status="success")
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
from db import Database
db = Database()
user_data = db.get_user_data(user_id=958930260)
print(user_data)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
import sqlite3
conn = sqlite3.connect('trading.db')
cursor = conn.execute(
    "SELECT * FROM signals_log ORDER BY created_at DESC LIMIT 5"
)
for row in cursor.fetchall():
    print(row)
```

---

## üìù –ó–ê–ú–ï–¢–ö–ò

- –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–≤–∞ —Ä–µ–∂–∏–º–∞**: DEV (—Ä—É—á–Ω–æ–π) –∏ PROD (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)
- –°–∏–≥–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **–æ–±–∞ –±–æ—Ç–∞** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è **–º–Ω–æ–∂–µ—Å—Ç–≤–æ –±–∏—Ä–∂** —Å fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
- –°–∏—Å—Ç–µ–º–∞ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞** –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

1. **–î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã:**
   - **DEV**: –†—É—á–Ω–æ–π —Ä–µ–∂–∏–º, —Å–∏–≥–Ω–∞–ª—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - **PROD**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º, –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –°–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –æ–±–∞ –±–æ—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

2. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:**
   - ML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
   - –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - Graceful degradation –ø—Ä–∏ —Å–±–æ—è—Ö
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
   - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

---

## üîß TROUBLESHOOTING

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

**1. –°–∏–≥–Ω–∞–ª—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
tail -200 main.log | grep -E "(NO SIGNAL|–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω|BLOCK)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
tail -200 main.log | grep -E "(—Ñ–∏–ª—å—Ç—Ä|filter)" | tail -20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
python3 -c "
import sqlite3
conn = sqlite3.connect('trading.db')
cursor = conn.execute('SELECT COUNT(*) FROM signals_log WHERE created_at > datetime(\"now\", \"-1 hour\")')
print(f'–°–∏–≥–Ω–∞–ª–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å: {cursor.fetchone()[0]}')
"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –§–∏–ª—å—Ç—Ä—ã —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ (RSI, Volume, Trend)
- –†—ã–Ω–æ–∫ –≤ –±–æ–∫–æ–≤–∏–∫–µ (–Ω–µ—Ç —á–µ—Ç–∫–æ–≥–æ —Ç—Ä–µ–Ω–¥–∞)
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö (API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `config.py`
- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Å–ª–∞–±–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –±–∏—Ä–∂

---

**2. –°–∏–≥–Ω–∞–ª—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
python3 -c "import config; print(f'TOKEN: {config.TOKEN[:20] if config.TOKEN else None}...')"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –æ—Ç–ø—Ä–∞–≤–∫–∏
tail -200 main.log | grep -E "(–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω|SEND|Telegram)" | tail -20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep "python3 main.py" | grep -v grep
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω (DEV –≤–º–µ—Å—Ç–æ PROD)
- Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- Flood Control –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
- –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ –æ—Ç–ø—Ä–∞–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `env.prod` –∏ `env.dev` —Ñ–∞–π–ª—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `ATRA_ENV`
- –ü–æ–¥–æ–∂–¥–∞—Ç—å —Å–Ω—è—Ç–∏—è Flood Control (–æ–±—ã—á–Ω–æ 1-10 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

---

**3. –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3 -c "import config; print(f'ATRA_ENV: {config.ATRA_ENV}')"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∞–≤—Ç–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
tail -200 main.log | grep -E "(AUTO|auto_exec)" | tail -20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
sqlite3 trading.db "SELECT symbol, status FROM accepted_signals WHERE status='pending' LIMIT 5;"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- `ATRA_ENV != "prod"` (–∞–≤—Ç–æ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ PROD)
- –°–∏–≥–Ω–∞–ª –Ω–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –±–∏—Ä–∂–µ
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –±–∞–ª–∞–Ω—Å

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `ATRA_ENV=prod` –≤ `env.prod`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∏–≥–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `auto_execution.py`

---

**4. SL –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –≤ –±–µ–∑—É–±—ã—Ç–æ–∫:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
sqlite3 trading.db "SELECT symbol, entry_price, tp1_price, sl_price FROM active_positions WHERE status='open';"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ trailing stop
tail -200 main.log | grep -E "(TRAILING|SL‚ÜíBE)" | tail -20
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ü–æ–∑–∏—Ü–∏—è –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∞ 50% –ø—É—Ç–∏ –∫ TP1
- Trailing stop –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ SL –Ω–∞ –±–∏—Ä–∂–µ
- –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö OHLC –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–∑–∏—Ü–∏–∏ –∫ TP1
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ trailing stop –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –±–∏—Ä–∂–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏

---

**5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
sqlite3 trading.db "PRAGMA database_list;"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
lsof trading.db 2>/dev/null
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- WAL —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
- –ë–î –≤ —Ä–µ–∂–∏–º–µ exclusive lock

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pkill -f "python3 main.py"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ WAL —Ñ–∞–π–ª–∞
ls -la trading.db-wal

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
sqlite3 trading.db "PRAGMA integrity_check;"
```

---

**6. –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
ps aux | grep "python3 main.py" | awk '{print $6/1024 " MB"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
# (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫—ç—à–µ
- –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ –≤ —Ü–∏–∫–ª–∞—Ö
- –ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞ (–æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤)

---

**7. API –±–∏—Ä–∂–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:**

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
curl -s https://api.binance.com/api/v3/ping

# –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limits
tail -200 main.log | grep -E "(rate limit|429)" | tail -10
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ rate limits
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ fallback –±–∏—Ä–∂ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- –û–∂–∏–¥–∞–Ω–∏–µ —Å–Ω—è—Ç–∏—è rate limit
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
ps aux | grep "python3 main.py"
tail -50 main.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
sqlite3 trading.db "SELECT symbol, direction, created_at FROM signals_log ORDER BY created_at DESC LIMIT 10;"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
sqlite3 trading.db "SELECT symbol, direction, entry_price, status FROM active_positions WHERE status='open';"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
sqlite3 trading.db "SELECT user_id, trade_mode, leverage, risk_pct FROM users_data;"

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
find logs/ -name "*.log" -mtime +7 -delete

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
cp trading.db backups/trading.db_$(date +%Y%m%d_%H%M%S)
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:

- **–°–µ—Ä–≤–µ—Ä:** `185.177.216.15`
- **–õ–æ–≥–∏:** `/root/atra/main.log`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** `/root/atra/trading.db`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-19  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.0  
**–ê–≤—Ç–æ—Ä:** ATRA Development Team

