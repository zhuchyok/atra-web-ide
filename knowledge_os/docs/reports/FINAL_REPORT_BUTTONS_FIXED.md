# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –°–ò–°–¢–ï–ú–ê –ö–ù–û–ü–û–ö –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ê

## ‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. **–ü—Ä–æ–±–ª–µ–º–∞ —Å message_id=0**
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–∏–≥–Ω–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ –±–∞–∑—É —Å `message_id=0`, —á—Ç–æ –¥–µ–ª–∞–ª–æ –∫–Ω–æ–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `update_signal_message_id` –≤ `acceptance_database.py`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å `message_id` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

### 2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å timestamp –≤ callback_data**
- **–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ timestamp –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–æ–π –∏ —Å–∏–≥–Ω–∞–ª–æ–º –≤ –±–∞–∑–µ
- **–†–µ—à–µ–Ω–∏–µ**: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã timestamp –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö —Å–∏—Å—Ç–µ–º—ã
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–Ω–æ–ø–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Ö–æ–¥—è—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã

### 3. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º—ã**
- **–ü—Ä–∏—á–∏–Ω–∞**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∞ pending —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `initialize()` –≤ `SignalAcceptanceManager`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –æ–∂–∏–¥–∞—é—â–∏–µ —Å–∏–≥–Ω–∞–ª—ã

### 4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π**
- **–ü—Ä–∏—á–∏–Ω–∞**: Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞
- **–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `update_acceptance_status` –≤ `TelegramMessageUpdater`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–æ–±—â–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å –Ω–æ–≤—ã–º —Å—Ç–∞—Ç—É—Å–æ–º

## üîß –ö–õ–Æ–ß–ï–í–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### `acceptance_database.py`
```python
async def update_signal_message_id(self, symbol: str, signal_timestamp, message_id: int) -> bool:
    """–û–±–Ω–æ–≤–ª—è–µ—Ç message_id –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞"""
    try:
        with sqlite3.connect(self.db_path) as conn:
            cursor = conn.cursor()
            
            # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥ - –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ symbol –∏ status=pending
            cursor.execute("""
                UPDATE accepted_signals 
                SET message_id = ? 
                WHERE symbol = ? AND status = 'pending' AND message_id = 0
                ORDER BY created_at DESC 
                LIMIT 1
            """, (message_id, symbol))
            
            conn.commit()
            updated_rows = cursor.rowcount
            
            if updated_rows > 0:
                logger.info(f"‚úÖ Message ID –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è {symbol}: {message_id}")
                return True
            else:
                logger.warning(f"‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è {symbol}")
                return False
                
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è message_id: {e}")
        return False
```

### `signal_acceptance_manager.py`
```python
async def accept_signal(self, symbol: str, signal_timestamp: float, user_id: str) -> bool:
    """–ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    try:
        signal_key = f"{symbol}_{signal_timestamp}"
        self.logger.info(f"üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞ {symbol} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º {user_id}")
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª–∞ –∏–∑ –±–∞–∑—ã
        signal_data_db = self.acceptance_db.get_signal_by_symbol(symbol)
        if not signal_data_db:
            self.logger.error(f"‚ùå –°–∏–≥–Ω–∞–ª {symbol} –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ")
            return False

        # –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã message_id –∏ chat_id, –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –±–∞–∑—ã
        message_id = signal_data_db.get('message_id')
        chat_id = signal_data_db.get('chat_id')

        if not message_id or not chat_id:
            self.logger.error(f"‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã message_id –∏–ª–∏ chat_id –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞ {symbol}")
            return False

        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        success = self.acceptance_db.update_signal_status(
            symbol, 
            'accepted', 
            user_id
        )
        
        if not success:
            self.logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–ª—è {symbol}")
            return False

        # –û–¢–ö–†–´–í–ê–ï–ú –ü–û–ó–ò–¶–ò–Æ
        position_data = {
            'symbol': symbol,
            'direction': signal_data_db['direction'],
            'entry_price': signal_data_db.get('entry_price'),
            'user_id': user_id,
            'message_id': message_id,
            'chat_id': chat_id
        }
        
        position_result = self.position_manager.open_position(position_data)
        
        if position_result:
            self.logger.info(f"‚úÖ –ü–æ–∑–∏—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è {symbol}")
            
            # üî• –ì–õ–ê–í–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–ë–ù–û–í–õ–Ø–ï–ú –°–û–û–ë–©–ï–ù–ò–ï –í TELEGRAM
            update_success = await self.telegram_updater.update_acceptance_status(
                chat_id=chat_id,
                message_id=message_id,
                symbol=symbol,
                direction=signal_data_db['direction'],
                accepted_by=user_id
            )
            
            if update_success:
                self.logger.info(f"‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ Telegram –æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è {symbol}")
            else:
                self.logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ Telegram –¥–ª—è {symbol}")
            
            return True
        else:
            self.logger.error(f"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –¥–ª—è {symbol}")
            return False
            
    except Exception as e:
        self.logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Å–∏–≥–Ω–∞–ª–∞: {e}")
        return False
```

### `telegram_message_updater.py`
```python
async def update_acceptance_status(self, chat_id, message_id, symbol, direction, accepted_by):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞"""
    try:
        if not self.bot:
            self.logger.error("‚ùå –ë–æ—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ TelegramMessageUpdater")
            return False

        new_text = f"""
üéØ <b>–°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢</b>
‚îú –°–∏–≥–Ω–∞–ª: {symbol} {direction}
‚îú –ü—Ä–∏–Ω—è–ª: {accepted_by}
‚îú –°—Ç–∞—Ç—É—Å: <b>‚úÖ –í –†–ê–ë–û–¢–ï</b>
‚îî –í—Ä–µ–º—è: {datetime.now().strftime('%H:%M:%S')}
        """
        
        new_keyboard = InlineKeyboardMarkup([
            [InlineKeyboardButton(
                "‚úÖ –í –†–ê–ë–û–¢–ï (LONG)" if direction.upper() == 'BUY' else "üî¥ –í –†–ê–ë–û–¢–ï (SHORT)", 
                callback_data="position_open"
            )],
            [InlineKeyboardButton(
                "üî¥ –ó–∞–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é", 
                callback_data=f"close_{symbol}"
            )]
        ])
        
        await self.bot.edit_message_text(
            chat_id=chat_id,
            message_id=message_id,
            text=new_text,
            reply_markup=new_keyboard,
            parse_mode='HTML'
        )
        
        self.logger.info(f"‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–∏–Ω—è—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è {symbol}")
        return True
        
    except Exception as e:
        self.logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: {e}")
        return False
```

## üöÄ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### ‚úÖ –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞: –ü–†–û–ô–î–ï–ù
- –°–∏–≥–Ω–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ
- `message_id` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π

### ‚úÖ –¢–µ—Å—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞: –ü–†–û–ô–î–ï–ù
- –°–∏–≥–Ω–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–∞–∑–µ
- `message_id` —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### ‚úÖ –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π: –ü–†–û–ô–î–ï–ù
- Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–í –†–ê–ë–û–¢–ï"
- –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—è—é—Ç—Å—è –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–µ–π

## üéØ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –†–ê–ë–û–¢–ï

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤** - —Å–∏–≥–Ω–∞–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É
2. ‚úÖ **–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** - Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∫–Ω–æ–ø–∫–∞–º–∏
3. ‚úÖ **–ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤** - –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å" —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** - —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è
5. ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏** - –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
1. üîÑ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å** - `python3 main.py`
2. üì± **–î–æ–∂–¥–∞—Ç—å—Å—è –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞** - —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
3. üéØ **–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å"** - –æ–Ω–∞ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–°–∏—Å—Ç–µ–º–∞ –∫–Ω–æ–ø–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!**

–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –±—ã–ª–∏ —Ä–µ—à–µ–Ω—ã:
- ‚ùå –ö–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–∂–∏–º–∞–ª–∏—Å—å ‚Üí ‚úÖ –ö–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ùå message_id=0 ‚Üí ‚úÖ message_id –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- ‚ùå –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å ‚Üí ‚úÖ –°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚ùå –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–ª–∏—Å—å ‚Üí ‚úÖ –ü–æ–∑–∏—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å–∏—Å—Ç–µ–º–æ–π!**
