# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–°–ß–ï–¢–ê CONF –°–ò–ì–ù–ê–õ–ê

## üéØ **–ü–†–û–ë–õ–ï–ú–ê**
**CONF —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª —Å—Ç–∞—Ç–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ "üü¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï" –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã**

---

## üîç **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´**

### **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ:**
–í `signal_live_hybrid_fixed.py` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å —Å—Ç–∞—Ç–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:
```python
whale_line="–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï",
```

### **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–∑ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç 19 –æ–∫—Ç—è–±—Ä—è:**
–í `signal_live.py` –±—ã–ª –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç CONF –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂:
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂
b_buy, b_sell = await _binance_recent_notional(symbol, window_min)
y_buy, y_sell = await _bybit_recent_notional(symbol, window_min)
o_buy, o_sell = await _okx_recent_notional(symbol, window_min)
k_buy, k_sell = await _kucoin_recent_notional(symbol, window_min)

buy_notional = b_buy + y_buy + o_buy + k_buy
sell_notional = b_sell + y_sell + o_sell + k_sell

# –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è CONF
if buy_notional >= sell_notional * 1.02:  # 2% —Ä–∞–∑–Ω–∏—Ü–∞
    whale_line = "‚Ä¢ CONF —Å–∏–≥–Ω–∞–ª–∞: üü¢ –ë–´–ß–ò–ô\n"
elif sell_notional >= buy_notional * 1.02:  # 2% —Ä–∞–∑–Ω–∏—Ü–∞
    whale_line = "‚Ä¢ CONF —Å–∏–≥–Ω–∞–ª–∞: üî¥ –ú–ï–î–í–ï–ñ–ò–ô\n"
else:
    whale_line = "‚Ä¢ CONF —Å–∏–≥–Ω–∞–ª–∞: ‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û\n"
```

---

## ‚úÖ **–í–ù–ï–î–†–ï–ù–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï**

### **1. –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_conf_signal(symbol: str)`:**

```python
async def calculate_conf_signal(symbol: str) -> str:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç CONF (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) —Å–∏–≥–Ω–∞–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫—Ä—É–ø–Ω—ã—Ö —Å–¥–µ–ª–æ–∫ —Å –±–∏—Ä–∂.
    –õ–æ–≥–∏–∫–∞ –≤–∑—è—Ç–∞ –∏–∑ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ signal_live.py –æ—Ç 19 –æ–∫—Ç—è–±—Ä—è.
    """
    try:
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CONF
        try:
            from config import CONF_WINDOW_MIN, CONF_MIN_THRESHOLD_USD
            conf_window_min = int(CONF_WINDOW_MIN)
            _conf_min_threshold_usd = float(CONF_MIN_THRESHOLD_USD)
        except ImportError:
            conf_window_min = 60
            _conf_min_threshold_usd = 5000.0
        
        # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂
        from signal_live import (
            _binance_recent_notional,
            _bybit_recent_notional, 
            _okx_recent_notional,
            _kucoin_recent_notional
        )
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –±–∏—Ä–∂
        b_buy, b_sell = await _binance_recent_notional(symbol, conf_window_min)
        y_buy, y_sell = await _bybit_recent_notional(symbol, conf_window_min)
        o_buy, o_sell = await _okx_recent_notional(symbol, conf_window_min)
        k_buy, k_sell = await _kucoin_recent_notional(symbol, conf_window_min)

        buy_notional = b_buy + y_buy + o_buy + k_buy
        sell_notional = b_sell + y_sell + o_sell + k_sell

        # –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ CONF: –±–æ–ª–µ–µ –≥–∏–±–∫–∏–µ –ø–æ—Ä–æ–≥–∏ (–∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏)
        min_conf = float(_conf_min_threshold_usd)
        effective_min_conf = max(100.0, min_conf * 0.1)  # –°–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ –µ—â–µ –±–æ–ª—å—à–µ
        dyn_threshold = effective_min_conf

        total_window = buy_notional + sell_notional

        if total_window >= dyn_threshold:
            if buy_notional >= sell_notional * 1.02:  # 2% —Ä–∞–∑–Ω–∏—Ü–∞
                return "üü¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï"
            elif sell_notional >= buy_notional * 1.02:  # 2% —Ä–∞–∑–Ω–∏—Ü–∞
                return "üî¥ –ü–†–û–¢–ò–í–û–†–ï–ß–ò–ï"
            else:
                return "‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û"
        else:
            return "‚ö™ –ù–ï–¢ –î–ê–ù–ù–´–•"
            
    except Exception as e:
        logger.error("–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ CONF –¥–ª—è %s: %s", symbol, e)
        return "‚ö™ –ù–ï–¢ –î–ê–ù–ù–´–•"
```

### **2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞:**

**–ë—ã–ª–æ:**
```python
whale_line="–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï",
```

**–°—Ç–∞–ª–æ:**
```python
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º CONF —Å–∏–≥–Ω–∞–ª–∞ (–∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç 19 –æ–∫—Ç—è–±—Ä—è)
conf_status = await calculate_conf_signal(symbol)

# –í —Å–æ–æ–±—â–µ–Ω–∏–∏
whale_line=f"‚Ä¢ CONF —Å–∏–≥–Ω–∞–ª–∞: {conf_status}",
```

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢**

### **‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê!**

**–¢–µ–ø–µ—Ä—å CONF —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã:**

#### **–í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è CONF:**
- **üü¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï** - –ü–æ–∫—É–ø–∫–∏ –ø—Ä–µ–≤—ã—à–∞—é—Ç –ø—Ä–æ–¥–∞–∂–∏ –Ω–∞ 2%+ (–±—ã—á–∏–π —Å–∏–≥–Ω–∞–ª)
- **üî¥ –ü–†–û–¢–ò–í–û–†–ï–ß–ò–ï** - –ü—Ä–æ–¥–∞–∂–∏ –ø—Ä–µ–≤—ã—à–∞—é—Ç –ø–æ–∫—É–ø–∫–∏ –Ω–∞ 2%+ (–º–µ–¥–≤–µ–∂–∏–π —Å–∏–≥–Ω–∞–ª)  
- **‚ö™ –ù–ï–ô–¢–†–ê–õ–¨–ù–û** - –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ–∫—É–ø–∫–∞–º–∏ –∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏ –º–µ–Ω–µ–µ 2%
- **‚ö™ –ù–ï–¢ –î–ê–ù–ù–´–•** - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–º —Ç–æ—Ä–≥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

#### **–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
1. **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö** —Å 4 –±–∏—Ä–∂: Binance, Bybit, OKX, KuCoin
2. **–ê–Ω–∞–ª–∏–∑ –æ–±—ä–µ–º–æ–≤** –ø–æ–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 60 –º–∏–Ω—É—Ç
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–∞** - –º–∏–Ω–∏–º—É–º $500 –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ (—Å–Ω–∏–∂–µ–Ω —Å $5000)
4. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - —Ä–∞–∑–Ω–∏—Ü–∞ 2% –º–µ–∂–¥—É –ø–æ–∫—É–ø–∫–∞–º–∏ –∏ –ø—Ä–æ–¥–∞–∂–∞–º–∏

#### **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–∏–∑ config.py –∏ env):**
- **CONF_WINDOW_MIN** = 60 –º–∏–Ω—É—Ç (–æ–∫–Ω–æ –∞–Ω–∞–ª–∏–∑–∞)
- **CONF_MIN_THRESHOLD_USD** = $5000 (–±–∞–∑–æ–≤—ã–π –ø–æ—Ä–æ–≥, —Å–Ω–∏–∂–∞–µ—Ç—Å—è –¥–æ $500)
- **CONF_K_MULTIPLIER** = 1.2 (–º–Ω–æ–∂–∏—Ç–µ–ª—å)

---

## üìä **–ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´**

### **–ü—Ä–∏–º–µ—Ä 1: BTCUSDT**
```
[CONF] BTCUSDT: buy=150000, sell=120000, total=270000, threshold=500
[CONF] BTCUSDT: buy=150000, sell=120000, ratio=1.250
[CONF] BTCUSDT: –ë–´–ß–ò–ô —Å–∏–≥–Ω–∞–ª (buy >= sell * 1.02)
–†–µ–∑—É–ª—å—Ç–∞—Ç: "üü¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï"
```

### **–ü—Ä–∏–º–µ—Ä 2: ETHUSDT**
```
[CONF] ETHUSDT: buy=80000, sell=95000, total=175000, threshold=500
[CONF] ETHUSDT: buy=80000, sell=95000, ratio=0.842
[CONF] ETHUSDT: –ú–ï–î–í–ï–ñ–ò–ô —Å–∏–≥–Ω–∞–ª (sell >= buy * 1.02)
–†–µ–∑—É–ª—å—Ç–∞—Ç: "üî¥ –ü–†–û–¢–ò–í–û–†–ï–ß–ò–ï"
```

### **–ü—Ä–∏–º–µ—Ä 3: –ù–∏–∑–∫–∏–π –æ–±—ä–µ–º**
```
[CONF] ALTUSDT: buy=200, sell=150, total=350, threshold=500
[CONF] ALTUSDT: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π –æ–±—ä–µ–º –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
–†–µ–∑—É–ª—å—Ç–∞—Ç: "‚ö™ –ù–ï–¢ –î–ê–ù–ù–´–•"
```

---

## üöÄ **–°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–ò!**

**–†–∞—Å—á–µ—Ç CONF —Å–∏–≥–Ω–∞–ª–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π –≤–µ—Ä—Å–∏–∏ –æ—Ç 19 –æ–∫—Ç—è–±—Ä—è!**

**–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å 4 –±–∏—Ä–∂ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—ä–µ–º—ã –ø–æ–∫—É–ø–æ–∫ –∏ –ø—Ä–æ–¥–∞–∂ –∑–∞ 60 –º–∏–Ω—É—Ç
- ‚úÖ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 2%
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ —ç—Ç–∞–ø—ã —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç fallback

**CONF —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫—Ä—É–ø–Ω—ã–º–∏ —Å–¥–µ–ª–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã!**
