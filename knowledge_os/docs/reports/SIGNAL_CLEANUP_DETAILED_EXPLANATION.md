# üßπ SIGNAL CLEANUP - –ü–û–î–†–û–ë–ù–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï

## ‚ùì **–ß–¢–û –≠–¢–û –¢–ê–ö–û–ï:**

**Signal Cleanup** - —ç—Ç–æ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## üîç **–ß–¢–û –û–ù–ê –î–ï–õ–ê–ï–¢:**

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

#### **1. –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
# –£–¥–∞–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª—ã —Å—Ç–∞—Ä—à–µ X –¥–Ω–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü:
- signals (–æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–≥–Ω–∞–ª–æ–≤)
- signals_log (–ª–æ–≥ –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤)
- signal_accum_events (—Å–æ–±—ã—Ç–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è)
- active_signals (–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã)
```

#### **2. –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö:**
```python
# –°–∏–≥–Ω–∞–ª—ã —Å—Ç–∞—Ä—à–µ 24-48 —á–∞—Å–æ–≤:
UPDATE signals 
SET status = 'EXPIRED'
WHERE created_at < NOW() - INTERVAL '24 hours'
AND status = 'PENDING'
```

#### **3. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö:**
```python
# –°–∏–≥–Ω–∞–ª—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º TP1/TP2/SL —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π:
DELETE FROM signals
WHERE status IN ('TP1', 'TP2', 'SL', 'CLOSED')
AND created_at < NOW() - INTERVAL '7 days'
```

---

## ‚öôÔ∏è **–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:**

### **–ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å:**
```python
while True:
    await cleanup_old_signals()
    await asyncio.sleep(3600)  # –ö–∞–∂–¥—ã–π —á–∞—Å
```

### **–ß—Ç–æ –æ—á–∏—â–∞–µ—Ç—Å—è:**

| –¢–∞–±–ª–∏—Ü–∞ | –£—Å–ª–æ–≤–∏–µ —É–¥–∞–ª–µ–Ω–∏—è | –ü–µ—Ä–∏–æ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏—è |
|---------|------------------|-----------------|
| **signals** | status = 'EXPIRED' | 7 –¥–Ω–µ–π |
| **signals_log** | –õ—é–±—ã–µ –∑–∞–ø–∏—Å–∏ | 30 –¥–Ω–µ–π |
| **signal_accum_events** | –ò—Å—Ç–µ–∫ TTL | –ü–æ TTL |
| **active_signals** | status != 'ACTIVE' | 7 –¥–Ω–µ–π |
| **app_cache** | expires_at < NOW | –ü–æ expires |

---

## ‚ùå **–ü–û–ß–ï–ú–£ –û–¢–ö–õ–Æ–ß–ï–ù–û:**

### **–ü—Ä–∏—á–∏–Ω–∞ –∏–∑ –∫–æ–¥–∞ (—Å—Ç—Ä–æ–∫–∞ 585):**
```python
# –°–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Ç–∫–ª—é—á–µ–Ω–∞ - 
# —Å–∏–≥–Ω–∞–ª—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
```

### **–õ–æ–≥–∏–∫–∞:**

**–í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ —Å–∏–≥–Ω–∞–ª—ã - —ç—Ç–æ –†–£–ß–ù–ê–Ø —Ç–æ—Ä–≥–æ–≤–ª—è:**
1. ‚úÖ –ë–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–°–ê–ú** –ø—Ä–∏–Ω–∏–º–∞–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–°–ê–ú** –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é
4. ‚ùå –°–∏—Å—Ç–µ–º–∞ **–ù–ï** –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º–æ–∂–µ—Ç:**
- ‚ùå –£–¥–∞–ª–∏—Ç—å —Å–∏–≥–Ω–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç
- ‚ùå –ü–æ—Ç–µ—Ä—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º

---

## ‚úÖ **–ù–£–ñ–ù–û –õ–ò –í–ö–õ–Æ–ß–ê–¢–¨?**

### **–ê—Ä–≥—É–º–µ–Ω—Ç—ã –ó–ê:**
1. ‚úÖ **–ß–∏—Å—Ç–∞—è –ë–î** - —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –∑–∞–ø–∏—Å–µ–π = –±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—Ä–æ—Å—ã
3. ‚úÖ **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞** - –ë–î –Ω–µ —Ä–∞—Å—Ç–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

### **–ê—Ä–≥—É–º–µ–Ω—Ç—ã –ü–†–û–¢–ò–í:**
1. ‚ùå **–ü–æ—Ç–µ—Ä—è –∏—Å—Ç–æ—Ä–∏–∏** - —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
2. ‚ùå **–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –¥–æ–ª–≥–æ
3. ‚ùå **AI —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ** - –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è

---

## üéØ **–ú–û–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**

### **–ù–ï –í–ö–õ–Æ–ß–ê–¢–¨ Signal Cleanup!**

**–ü–æ—á–µ–º—É:**

#### **1. –£ –Ω–∞—Å –µ—Å—Ç—å retention_tasks:**
```python
# –°—Ç—Ä–æ–∫–∞ 561 –≤ main.py:
retention_task_local = asyncio.create_task(run_retention_tasks())

# –≠—Ç–æ –¥–µ–ª–∞–µ—Ç:
async def run_retention_tasks():
    # –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    stats = db.cleanup_old_data()  # –£–¥–∞–ª—è–µ—Ç –û–ß–ï–ù–¨ —Å—Ç–∞—Ä—ã–µ (30+ –¥–Ω–µ–π)
```

**–†–∞–∑–Ω–∏—Ü–∞:**
- `retention_tasks` - —É–¥–∞–ª—è–µ—Ç –û–ß–ï–ù–¨ —Å—Ç–∞—Ä—ã–µ (30+ –¥–Ω–µ–π) ‚úÖ
- `signal_cleanup` - —É–¥–∞–ª—è–µ—Ç –¥–∞–∂–µ —Å–≤–µ–∂–∏–µ (24 —á–∞—Å–∞) ‚ùå

#### **2. –†—É—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
  - –î–µ—Ä–∂–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π
  - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
  - –û—Ç–ª–æ–∂–∏—Ç—å –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞
  
Signal Cleanup –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Ç–∞–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã!
```

#### **3. AI –æ–±—É—á–µ–Ω–∏–µ:**
```
AI –Ω—É–∂–Ω–∞ –ü–û–õ–ù–ê–Ø –∏—Å—Ç–æ—Ä–∏—è:
  - –£—Å–ø–µ—à–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
  - –ù–µ—É—Å–ø–µ—à–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
  - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
  
Signal Cleanup —É–¥–∞–ª—è–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ!
```

---

## üí° **–ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï:**

### **–ï—Å–ª–∏ –ë–î —Ä–∞—Å—Ç–µ—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ:**

#### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å retention_tasks (–£–ñ–ï –†–ê–ë–û–¢–ê–ï–¢):**
```python
# –í config.py –∏–ª–∏ –≥–¥–µ –∑–∞–¥–∞—é—Ç—Å—è –ø–µ—Ä–∏–æ–¥—ã:
RETENTION_SIGNALS_LOG_DAYS = 60  # –•—Ä–∞–Ω–∏—Ç—å 60 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 30
RETENTION_APP_CACHE_DAYS = 7     # –û—á–∏—â–∞—Ç—å –∫—ç—à —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
```

#### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è:**
```python
# –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É archived_signals
# –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Ç—É–¥–∞ —Å—Ç–∞—Ä—ã–µ —Å–∏–≥–Ω–∞–ª—ã
# –£–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ –∞—Ä—Ö–∏–≤–∞ —á–µ—Ä–µ–∑ –≥–æ–¥
```

#### **–í–∞—Ä–∏–∞–Ω—Ç 3: –í—ã–±–æ—Ä–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞:**
```python
# –£–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ:
- REJECTED —Å–∏–≥–Ω–∞–ª—ã —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- EXPIRED —Å–∏–≥–Ω–∞–ª—ã —Å—Ç–∞—Ä—à–µ 14 –¥–Ω–µ–π
- –ö—ç—à —Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤

# –ù–ï —É–¥–∞–ª—è—Ç—å:
- ACCEPTED/OPEN —Å–∏–≥–Ω–∞–ª—ã (–ª—é–±–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞)
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Å–¥–µ–ª–∫–∏ (–¥–ª—è AI)
```

---

## üìä **–°–†–ê–í–ù–ï–ù–ò–ï:**

### **Retention Tasks (–ê–ö–¢–ò–í–ù–û):**
```
–ü–µ—Ä–∏–æ–¥: 30 –¥–Ω–µ–π
–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç: –û–ß–ï–ù–¨ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
–ß–∞—Å—Ç–æ—Ç–∞: 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å
–†–∏—Å–∫: –ù–∏–∑–∫–∏–π
–ü–æ–ª—å–∑–∞: –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–º–µ—Ä–∞ –ë–î
```

### **Signal Cleanup (–û–¢–ö–õ–Æ–ß–ï–ù–û):**
```
–ü–µ—Ä–∏–æ–¥: 24-48 —á–∞—Å–æ–≤
–ß—Ç–æ —É–¥–∞–ª—è–µ—Ç: –î–∞–∂–µ —Å–≤–µ–∂–∏–µ –Ω–µ–ø—Ä–∏–Ω—è–Ω—ã–µ
–ß–∞—Å—Ç–æ—Ç–∞: –ö–∞–∂–¥—ã–π —á–∞—Å
–†–∏—Å–∫: –í–´–°–û–ö–ò–ô (–ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö)
–ü–æ–ª—å–∑–∞: –ß–∏—Å—Ç–∞—è –ë–î (–Ω–æ —Ü–µ–Ω–æ–π –ø–æ—Ç–µ—Ä–∏ –∏—Å—Ç–æ—Ä–∏–∏)
```

---

## ‚úÖ **–ò–¢–û–ì–û–í–ê–Ø –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**

# **–ù–ï –í–ö–õ–Æ–ß–ê–¢–¨ Signal Cleanup!** ‚ùå

**–ü—Ä–∏—á–∏–Ω—ã:**
1. ‚úÖ –£ –Ω–∞—Å —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç `retention_tasks` (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä–æ–µ)
2. ‚ùå Signal Cleanup —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π
3. ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å —Ä—É—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ–π
4. ‚ùå AI —Ç–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
5. ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç –∏—Å—Ç–æ—Ä–∏—é

**–ï—Å–ª–∏ –ë–î —Ä–∞—Å—Ç–µ—Ç:**
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ retention periods
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VACUUM
- ‚úÖ –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è

**Signal Cleanup –ü–†–ê–í–ò–õ–¨–ù–û –æ—Ç–∫–ª—é—á–µ–Ω!** ‚úÖ

**–û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ!** üéØ

