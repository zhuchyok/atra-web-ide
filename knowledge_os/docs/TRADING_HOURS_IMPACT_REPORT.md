# ‚è∞ –í–õ–ò–Ø–ù–ò–ï –¢–û–†–ì–û–í–´–• –ß–ê–°–û–í –ù–ê –ü–†–ò–ù–Ø–¢–ò–ï –°–ò–ì–ù–ê–õ–û–í - –û–¢–ß–ï–¢

## üéØ **–û–¢–í–ï–¢ –ù–ê –í–ê–® –í–û–ü–†–û–°:**

### **‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–æ—Ä–≥–æ–≤–ª—è –ö–†–£–ì–õ–û–°–£–¢–û–ß–ù–ê–Ø!**

–ï—Å–ª–∏ –≤—ã **–Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã**, —Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç **–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ** –∏ **–ù–ï –≤–ª–∏—è–µ—Ç** –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤.

---

## üîç **–ö–ê–ö –†–ê–ë–û–¢–ê–Æ–¢ –¢–û–†–ì–û–í–´–ï –ß–ê–°–´:**

### **üìã –§—É–Ω–∫—Ü–∏—è `check_user_trading_hours`:**

```python
def check_user_trading_hours(user_data):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    th = user_data.get("trading_hours")
    if not th:
        return True  # ‚Üê –ö–õ–Æ–ß–ï–í–û–ï: –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã - —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é

    now = get_msk_now()
    hour = now.hour
    start = th.get("start", 0)
    end = th.get("end", 24)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π —á–∞—Å –≤—Ö–æ–¥–∏—Ç –≤ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã
    if start <= end:
        # –û–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π: 9-18
        return start <= hour < end
    else:
        # –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å: 23-7
        return hour >= start or hour < end
```

### **üéØ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**

1. **–ï—Å–ª–∏ `trading_hours` –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã** ‚Üí `return True` (—Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é)
2. **–ï—Å–ª–∏ `trading_hours` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã** ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è

---

## üìä **–ì–î–ï –ü–†–û–í–ï–†–Ø–Æ–¢–°–Ø –¢–û–†–ì–û–í–´–ï –ß–ê–°–´:**

### **üîç –í —Ñ—É–Ω–∫—Ü–∏–∏ `check_and_send_signals` (2 –º–µ—Å—Ç–∞):**

#### **üìç –ú–µ—Å—Ç–æ 1 - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if not check_user_trading_hours(user_data):
    print(f"[DEBUG] {symbol}: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –≤–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è DCA
    user_positions = user_data.get('open_positions', [])
    has_user_long = any(...)
    has_user_short = any(...)

    # –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è, —Å–æ—Ö—Ä–∞–Ω—è–µ–º DCA —Å–∏–≥–Ω–∞–ª
    if has_user_long or has_user_short:
        side = "long" if has_user_long else "short"
        save_pending_dca_signal(user_id, symbol, side, last['close'], now, user_data)

    continue  # ‚Üê –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
```

#### **üìç –ú–µ—Å—Ç–æ 2 - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
if not check_user_trading_hours(user_data):
    print(f"[DEBUG] –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–≥–Ω–∞–ª –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {target_user_id} (–≤–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤)")
    continue  # ‚Üê –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Å–∏–≥–Ω–∞–ª–∞
```

---

## üöÄ **–ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –í –†–ê–ó–ù–´–• –°–õ–£–ß–ê–Ø–•:**

### **‚úÖ –°–ª—É—á–∞–π 1: –¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã**
```
üìã user_data.get("trading_hours") ‚Üí None
üîç check_user_trading_hours() ‚Üí return True
‚úÖ –°–∏–≥–Ω–∞–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ö–†–£–ì–õ–û–°–£–¢–û–ß–ù–û
```

### **‚úÖ –°–ª—É—á–∞–π 2: –¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 9-18)**
```
üìã user_data.get("trading_hours") ‚Üí {"start": 9, "end": 18}
üîç check_user_trading_hours() ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â–∏–π —á–∞—Å
‚è∞ –ï—Å–ª–∏ —Å–µ–π—á–∞—Å 14:00 ‚Üí return True (–≤–Ω—É—Ç—Ä–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤)
‚è∞ –ï—Å–ª–∏ —Å–µ–π—á–∞—Å 22:00 ‚Üí return False (–≤–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤)
```

---

## üìà **–°–ò–°–¢–ï–ú–ê DCA –ü–†–ò –í–ù–ï –¢–û–†–ì–û–í–´–• –ß–ê–°–û–í:**

### **üéØ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤:**

1. **–ù–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è**
2. **–ù–û –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è** ‚Üí DCA —Å–∏–≥–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
3. **–ü—Ä–∏ –Ω–∞—á–∞–ª–µ —Ç–æ—Ä–≥–æ–≤–æ–π —Å–µ—Å—Å–∏–∏** ‚Üí –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ DCA —Å–∏–≥–Ω–∞–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

### **üí° –ü—Ä–∏–º–µ—Ä:**
```
‚è∞ 22:00 (–≤–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤)
üìä –ï—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç–∞—è –ø–æ–∑–∏—Ü–∏—è BTCUSDT
üîÑ –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DCA —Å–∏–≥–Ω–∞–ª
üíæ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ pending_dca_signals
‚ùå –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

‚è∞ 09:00 (–Ω–∞—á–∞–ª–æ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤)
üîÑ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç pending_dca_signals
üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ DCA —Å–∏–≥–Ω–∞–ª—ã
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–∏–≥–Ω–∞–ª—ã –¥–ª—è —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
```

---

## üõ† **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –¢–û–†–ì–û–í–´–ú–ò –ß–ê–°–ê–ú–ò:**

### **üìã –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤:**
```
/set_trading_hours 9 18    # 09:00-18:00 (–ú–°–ö)
/set_trading_hours 7 23    # 07:00-23:00 (–ú–°–ö)
/set_trading_hours 0 24    # –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ
/set_trading_hours 23 7    # 23:00-07:00 (—á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å)
```

### **üìã –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
```
/trading_hours
```

### **üìã –°–±—Ä–æ—Å —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤ (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ):**
```
/set_trading_hours 0 24
```

---

## üìä **–ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´:**

### **üîç –í–∞—à —Å–ª—É—á–∞–π (—Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã):**
```
üìã user_data.get("trading_hours") ‚Üí None
üîç check_user_trading_hours() ‚Üí return True
‚úÖ –°–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –ö–†–£–ì–õ–û–°–£–¢–û–ß–ù–û
‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
```

### **üîç –ï—Å–ª–∏ –±—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ 9-18:**
```
üìã user_data.get("trading_hours") ‚Üí {"start": 9, "end": 18}
‚è∞ 14:00 ‚Üí check_user_trading_hours() ‚Üí True ‚Üí —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç
‚è∞ 22:00 ‚Üí check_user_trading_hours() ‚Üí False ‚Üí —Å–∏–≥–Ω–∞–ª—ã –ù–ï –ø—Ä–∏—Ö–æ–¥—è—Ç
```

---

## üéØ **–ò–¢–û–ì:**

### **‚úÖ –î–ª—è –≤–∞—Å (—Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã):**
- **–°–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –ö–†–£–ì–õ–û–°–£–¢–û–ß–ù–û**
- **–ù–∏–∫–∞–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏**
- **–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ 24/7**

### **‚úÖ –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—Ä–µ–º—è:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/set_trading_hours 9 18` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 09:00-18:00)
- –°–∏–≥–Ω–∞–ª—ã –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- DCA —Å–∏–≥–Ω–∞–ª—ã –±—É–¥—É—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —Å–µ—Å—Å–∏–∏

### **‚úÖ –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/set_trading_hours 0 24`
- –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤

---

## üöÄ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:**

### **üìã –î–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:**
- –û—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ)
- –ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ –≤–∞–∂–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã

### **üìã –î–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –ø–æ–¥ –≤–∞—à –≥—Ä–∞—Ñ–∏–∫
- DCA —Å–∏–≥–Ω–∞–ª—ã –±—É–¥—É—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –ø—Ä–∏ –Ω–∞—á–∞–ª–µ —Å–µ—Å—Å–∏–∏

**–í –≤–∞—à–µ–º —Å–ª—É—á–∞–µ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ –∏ –ù–ï –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤!** ‚úÖ