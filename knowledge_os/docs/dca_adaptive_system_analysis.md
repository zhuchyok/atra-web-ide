# üß† –ê–ù–ê–õ–ò–ó –ê–î–ê–ü–¢–ò–í–ù–û–ô DCA –°–ò–°–¢–ï–ú–´

## ‚úÖ **–î–ê! DCA –°–ò–°–¢–ï–ú–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò "–î–´–®–ï–¢" –ò –û–ë–£–ß–ê–ï–¢–°–Ø!**

### üéØ **–ê–î–ê–ü–¢–ò–í–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò DCA –°–ò–°–¢–ï–ú–´:**

#### **1. –ê–î–ê–ü–¢–ò–í–ù–´–ô –†–ê–ó–ú–ï–† DCA** (`calculate_adaptive_dca_size`)

```python
def calculate_adaptive_dca_size(
    deposit: float, trade_mode: str, dca_count: int, base_risk_pct: float,
    current_price: float, avg_entry_price: float, volatility: float,
    trend_strength: float, market_regime: str = "neutral"
) -> Tuple[float, float]:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä DCA —Å —É—á–µ—Ç–æ–º:
    - –ù–æ–º–µ—Ä–∞ DCA (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ)
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
    - –†–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
    - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ü–µ–Ω
    """
    # –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä DCA
    dca_risk_multiplier = get_dca_risk_multiplier(deposit, trade_mode)
    base_dca_risk = base_risk_pct * dca_risk_multiplier

    # –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA
    decay_factor = math.exp(-dca_count * 0.3)  # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ
    adaptive_risk = base_dca_risk * decay_factor

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    volatility_factor = max(0.5, 1.0 - (volatility * 0.5))  # –°–Ω–∏–∂–∞–µ–º –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç—Ä–µ–Ω–¥—É
    trend_factor = max(0.7, 1.0 - (trend_strength * 0.3))  # –°–Ω–∏–∂–∞–µ–º –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É —Ä—ã–Ω–∫–∞
    regime_factor = MARKET_REGIME_MULTIPLIERS.get(market_regime, {}).get("entry_size_mult", 1.0)

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é —Ü–µ–Ω
    price_ratio = current_price / avg_entry_price if avg_entry_price > 0 else 1.0
    price_factor = 1.0 + (price_ratio - 1.0) * 0.1  # –£—á–∏—Ç—ã–≤–∞–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã

    # –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∏—Å–∫
    final_risk = adaptive_risk * volatility_factor * trend_factor * regime_factor * price_factor

    return position_size_usd, final_risk
```

#### **2. NEAR-DCA –°–ò–°–¢–ï–ú–ê** (–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ)

```python
def compute_dca_confluence_score(side: str, df=None, current_index=None) -> int:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥—Ä—É–±—É—é –æ—Ü–µ–Ω–∫—É (0..100) –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å–∞ —É—Ä–æ–≤–Ω–µ–π –¥–ª—è near-DCA.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ –ø—Ä–∏–∑–Ω–∞–∫–∏: BB-–ø–æ–∑–∏—Ü–∏—è, EMA7/EMA25 –Ω–∞–∫–ª–æ–Ω,
    –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ squeeze-–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Å–ª–∞–±—ã–π –∏–º–ø—É–ª—å—Å BTC.
    """
    # –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å–∞ —É—Ä–æ–≤–Ω–µ–π
    # - Bollinger Bands –ø–æ–∑–∏—Ü–∏—è
    # - EMA7/EMA25 –Ω–∞–∫–ª–æ–Ω
    # - Squeeze –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    # - BTC –∏–º–ø—É–ª—å—Å
    # - –û–±—ä–µ–º –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

    return confluence_score  # 0-100
```

#### **3. –ê–î–ê–ü–¢–ò–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´ NEAR-DCA**

```python
def _get_near_profile_params():
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã near-DCA —Å –ª—ë–≥–∫–∏–º —Ä–∞–∑–≤–µ–¥–µ–Ω–∏–µ–º –ø–æ —Ä–µ–∂–∏–º–∞–º.
    –î–ª—è strict ‚Äî –Ω–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–µ–µ; –¥–ª—è soft ‚Äî —á—É—Ç—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ.
    """
    mode = str(globals().get("_dca_near_mode", "soft") or "soft").lower()

    if mode == "strict":
        score_thr += 5            # —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å–∞
        k_min = max(k_min, 0.7)   # –ø–æ—Ä–æ–≥ —Å–Ω–∏–∂–µ–Ω–∏—è –≤—ã—à–µ (–º–µ–Ω—å—à–µ —Å–Ω–∏–∂–µ–Ω–∏–µ)
        step_frac = max(0.2, step_frac * 0.85)  # —á—É—Ç—å –º–µ–Ω—å—à–∏–π —à–∞–≥
    elif mode == "soft":
        score_thr = max(0, score_thr - 5)       # –ø–æ—Ä–æ–≥ –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ
        k_min = max(0.55, k_min)                # –¥–æ–ø—É—Å–∫–∞–µ–º –±–æ–ª—å—à–µ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ
        step_frac = min(0.5, step_frac * 1.1)  # —á—É—Ç—å –±–æ–ª—å—à–∏–π —à–∞–≥

    return {
        "score_thr": score_thr,
        "k_min": k_min,
        "k_max": k_max,
        "alpha": alpha,
        "step_frac": step_frac,
        "tp1_mult": tp1_mult,
        "tp2_mult": tp2_mult,
    }
```

### üß† **–°–ò–°–¢–ï–ú–ê –û–ë–£–ß–ï–ù–ò–Ø DCA:**

#### **1. –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û –í–û–õ–ê–¢–ò–õ–¨–ù–û–°–¢–ò:**
- **–í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Üí –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (volatility_factor = 0.5-1.0)
- **–ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Üí –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (volatility_factor = 1.0)

#### **2. –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û –¢–†–ï–ù–î–£:**
- **–°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥** ‚Üí –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (trend_factor = 0.7-1.0)
- **–°–ª–∞–±—ã–π —Ç—Ä–µ–Ω–¥** ‚Üí –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (trend_factor = 1.0)

#### **3. –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û –†–ï–ñ–ò–ú–£ –†–´–ù–ö–ê:**
- **Bull market** ‚Üí –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (+5%)
- **Bear market** ‚Üí –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA (-30%)
- **Neutral** ‚Üí –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä DCA

#### **4. –ê–î–ê–ü–¢–ê–¶–ò–Ø –ü–û –ö–û–ù–§–õ–Æ–≠–ù–°–£ –£–†–û–í–ù–ï–ô:**
- **–í—ã—Å–æ–∫–∏–π –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å** ‚Üí –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ DCA, —Å–±–ª–∏–∂–µ–Ω–∏–µ TP
- **–ù–∏–∑–∫–∏–π –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å** ‚Üí –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ DCA, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ TP

### üìä **–ü–†–ò–ú–ï–†–´ –ê–î–ê–ü–¢–ò–í–ù–û–ì–û –ü–û–í–ï–î–ï–ù–ò–Ø DCA:**

#### **–ü–†–ò–ú–ï–† 1: –í–´–°–û–ö–ê–Ø –í–û–õ–ê–¢–ò–õ–¨–ù–û–°–¢–¨**
```
–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 5% (–≤—ã—Å–æ–∫–∞—è)
–¢—Ä–µ–Ω–¥: 0.8 (—Å–∏–ª—å–Ω—ã–π)
–†–µ–∂–∏–º: bear
–ö–æ–Ω—Ñ–ª—é—ç–Ω—Å: 60 (–≤—ã—Å–æ–∫–∏–π)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –†–∞–∑–º–µ—Ä DCA: 50% –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ (volatility_factor = 0.5)
- –ü–æ—Ä–æ–≥ DCA: —Å–Ω–∏–∂–µ–Ω (–∫–æ–Ω—Ñ–ª—é—ç–Ω—Å –≤—ã—Å–æ–∫–∏–π)
- TP: —Å–±–ª–∏–∂–µ–Ω—ã (–±—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥)
```

#### **–ü–†–ò–ú–ï–† 2: –ù–ò–ó–ö–ê–Ø –í–û–õ–ê–¢–ò–õ–¨–ù–û–°–¢–¨**
```
–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 1% (–Ω–∏–∑–∫–∞—è)
–¢—Ä–µ–Ω–¥: 0.2 (—Å–ª–∞–±—ã–π)
–†–µ–∂–∏–º: bull
–ö–æ–Ω—Ñ–ª—é—ç–Ω—Å: 30 (–Ω–∏–∑–∫–∏–π)

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –†–∞–∑–º–µ—Ä DCA: 105% –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ (volatility_factor = 1.0, regime_factor = 1.05)
- –ü–æ—Ä–æ–≥ DCA: –ø–æ–≤—ã—à–µ–Ω (–∫–æ–Ω—Ñ–ª—é—ç–Ω—Å –Ω–∏–∑–∫–∏–π)
- TP: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
```

#### **–ü–†–ò–ú–ï–† 3: –ü–†–û–ì–†–ï–°–°–ò–í–ù–û–ï –£–ú–ï–ù–¨–®–ï–ù–ò–ï**
```
DCA #1: –†–∞–∑–º–µ—Ä = 100% (–±–∞–∑–æ–≤—ã–π)
DCA #2: –†–∞–∑–º–µ—Ä = 74% (decay_factor = 0.74)
DCA #3: –†–∞–∑–º–µ—Ä = 55% (decay_factor = 0.55)
DCA #4: –†–∞–∑–º–µ—Ä = 41% (decay_factor = 0.41)
DCA #5: –†–∞–∑–º–µ—Ä = 30% (decay_factor = 0.30)
```

### üéØ **–ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´ –ê–î–ê–ü–¢–ò–í–ù–û–ô DCA:**

#### **1. –ü–†–û–ì–†–ï–°–°–ò–í–ù–û–ï –£–ú–ï–ù–¨–®–ï–ù–ò–ï:**
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ç–æ—Ä–≥–æ–≤–ª–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞

#### **2. –ê–î–ê–ü–¢–ê–¶–ò–Ø –ö –†–´–ù–û–ß–ù–´–ú –£–°–õ–û–í–ò–Ø–ú:**
- ‚úÖ –£—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –£—á–µ—Ç —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –£—á–µ—Ç —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
- ‚úÖ –£—á–µ—Ç –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å–∞ —É—Ä–æ–≤–Ω–µ–π

#### **3. –ò–ù–¢–ï–õ–õ–ï–ö–¢–£–ê–õ–¨–ù–û–ï –£–°–†–ï–î–ù–ï–ù–ò–ï:**
- ‚úÖ Near-DCA –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å–µ
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ TP —É—Ä–æ–≤–Ω–∏
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤ –ø—Ä–∏ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

#### **4. –ó–ê–©–ò–¢–ê –ö–ê–ü–ò–¢–ê–õ–ê:**
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ DCA
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∏—Å–∫–æ–≤

## ‚úÖ **–í–´–í–û–î: DCA –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ê–î–ê–ü–¢–ò–í–ù–ê!**

**DCA —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. **–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç —Ä–∞–∑–º–µ—Ä** –ø–æ–¥ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, —Ç—Ä–µ–Ω–¥ –∏ —Ä–µ–∂–∏–º —Ä—ã–Ω–∫–∞
2. **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç** —Ä–∞–∑–º–µ—Ä —Å –∫–∞–∂–¥—ã–º —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ–º
3. **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª—é—ç–Ω—Å** —É—Ä–æ–≤–Ω–µ–π –¥–ª—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
4. **–°–±–ª–∏–∂–∞–µ—Ç TP** –ø—Ä–∏ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
5. **–ó–∞—â–∏—â–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª** –æ—Ç –ø–µ—Ä–µ—Ç–æ—Ä–≥–æ–≤–ª–∏
6. **–û–±—É—á–∞–µ—Ç—Å—è** –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

**DCA —Å–∏—Å—Ç–µ–º–∞ - —ç—Ç–æ –∂–∏–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –¥—ã—à–∏—Ç –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è! üß¨**
