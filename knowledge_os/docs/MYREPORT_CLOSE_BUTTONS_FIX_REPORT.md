# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –ö–ù–û–ü–û–ö –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô –í `myreport`

## ‚ùå **–ü–†–û–ë–õ–ï–ú–ê:**
–í –∫–æ–º–∞–Ω–¥–µ `/myreport` –∫–Ω–æ–ø–∫–∏ "–ó–∞–∫—Ä—ã—Ç—å" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–∫—Ä—ã—Ç—å" –ø–æ—è–≤–ª—è–ª–∏—Å—å –∫–Ω–æ–ø–∫–∏ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)" –∏ "–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é", –Ω–æ –æ–Ω–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ —Ç–æ –∂–µ —Å–∞–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

## üîç **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´:**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback_data** - –∫–Ω–æ–ø–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Ç–æ—Ç –∂–µ `action` —á—Ç–æ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤** - –Ω–µ –±—ã–ª–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
3. **–ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è** - –∫–æ–¥ –ø—ã—Ç–∞–ª—Å—è –≤—ã–∑–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `close_position_at_price`

### **–ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:**
```python
# –ë—ã–ª–æ:
InlineKeyboardButton("–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)", callback_data=f"choose_close_price|{symbol}|{auto_price}"),
InlineKeyboardButton("–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é", callback_data=f"choose_close_price|{symbol}|ask"),

# –ü—Ä–æ–±–ª–µ–º–∞: —Ç–æ—Ç –∂–µ action "choose_close_price" —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã callback_data –¥–ª—è –∫–Ω–æ–ø–æ–∫:**
```python
# –°—Ç–∞–ª–æ:
InlineKeyboardButton("–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)", callback_data=f"close_auto|{symbol}|{auto_price}"),
InlineKeyboardButton("–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é", callback_data=f"close_manual|{symbol}"),
InlineKeyboardButton("–û—Ç–º–µ–Ω–∞", callback_data=f"cancel_close|{symbol}"),
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**

#### **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `close_auto`:**
```python
elif action == "close_auto":
    symbol = data[1]
    auto_price = float(data[2])

    # –í—ã–ø–æ–ª–Ω—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
    open_positions = user_data.get("open_positions", [])
    pos = next((p for p in open_positions if p["symbol"] == symbol), None)

    if not pos:
        await query.message.reply_text(f"‚ùå –ù–µ—Ç –æ—Ç–∫—Ä—ã—Ç–æ–π –ø–æ–∑–∏—Ü–∏–∏ –ø–æ {symbol}.")
        await query.edit_message_reply_markup(reply_markup=None)
        return

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–±—ã–ª—å
    qty = pos.get("qty", 0)
    entry_price = pos.get("entry_price", 0)
    side = pos.get("side", "long")

    profit = (
        (auto_price - entry_price) * qty if side == "long"
        else (entry_price - auto_price) * qty
    )

    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
    open_positions = [p for p in open_positions if p["symbol"] != symbol]
    user_data["open_positions"] = open_positions

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
    # ... (–ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è)
```

#### **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `close_manual`:**
```python
elif action == "close_manual":
    symbol = data[1]

    await query.message.reply_text(
        f"–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è {symbol} –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
        f"<code>/close {symbol} –¶–ï–ù–ê</code>\n\n"
        f"–ù–∞–ø—Ä–∏–º–µ—Ä: <code>/close {symbol} 43250.50</code>",
        parse_mode='HTML'
    )
    await query.edit_message_reply_markup(reply_markup=None)
    return
```

#### **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ `cancel_close`:**
```python
elif action == "cancel_close":
    symbol = data[1]
    await query.message.reply_text(f"‚ùå –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ {symbol} –æ—Ç–º–µ–Ω–µ–Ω–æ.")
    await query.edit_message_reply_markup(reply_markup=None)
    return
```

### **3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `choose_close_price`:**
```python
elif action == "choose_close_price":
    symbol = data[1]

    # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç—Ä–µ—Ç–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä, —ç—Ç–æ –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    if len(data) > 2:
        price_type = data[2]

        if price_type == "ask":
            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –≤–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Ü–µ–Ω—É
            await query.message.reply_text(
                f"–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è {symbol} –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n"
                f"<code>/close {symbol} –¶–ï–ù–ê</code>\n\n"
                f"–ù–∞–ø—Ä–∏–º–µ—Ä: <code>/close {symbol} 43250.50</code>",
                parse_mode='HTML'
            )
            await query.edit_message_reply_markup(reply_markup=None)
            return
        else:
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —Ü–µ–Ω–µ —Å –±–∏—Ä–∂–∏
            try:
                auto_price = float(price_type)
                # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                # ... (–ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è)
            except ValueError:
                await query.message.reply_text(f"–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–∞—è —Ü–µ–Ω–∞ {price_type}")
                await query.edit_message_reply_markup(reply_markup=None)
                return

    # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é –≤—ã–±–æ—Ä–∞
    # ... (–ø–æ–∫–∞–∑ –º–µ–Ω—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ callback_data)
```

## üìä **–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ö–ù–û–ü–û–ö:**

### **–°—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã:**

#### **1. –ù–∞–∂–∞—Ç–∏–µ "–ó–∞–∫—Ä—ã—Ç—å" –≤ myreport:**
```
üü¢ –û–¢–ö–†–´–¢–´–ï –ü–û–ó–ò–¶–ò–ò:
‚Ä¢ BTCUSDT | –í—Ö–æ–¥: 43250.000000 | üéØ TP1: 43682.500000 | üöÄ TP2: 44115.000000 | –°—Ç–∞–¥–∏—è: open | –ü–ª–µ—á–æ: x2

[–ó–∞–∫—Ä—ã—Ç—å BTCUSDT] ‚Üê –Ω–∞–∂–∞—Ç–∏–µ
```

#### **2. –ü–æ—è–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –≤—ã–±–æ—Ä–∞:**
```
–ö–∞–∫—É—é —Ü–µ–Ω—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è BTCUSDT?
–¢–µ–∫—É—â–∞—è —Å –±–∏—Ä–∂–∏: 43500.2500

[–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)] [–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é]
[–û—Ç–º–µ–Ω–∞]
```

#### **3. –ù–∞–∂–∞—Ç–∏–µ "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)":**
```
üü¢ –ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–¢–ê –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò

–°–ò–ú–í–û–õ: BTCUSDT
–°—Ç–æ—Ä–æ–Ω–∞: LONG
–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 43250.000000
–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: 43500.2500
–ó–∞–∫—Ä—ã—Ç–æ: 0.0100
–ü—Ä–∏–±—ã–ª—å: 2.50 USDT
–†–µ–∂–∏–º: FUTURES
–ü–ª–µ—á–æ: x2

üí∞ –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ë–ê–õ–ê–ù–°:
–î–µ–ø–æ–∑–∏—Ç: 1002.50 USDT
–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: 47.70 USDT
–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 1
–ó–∞–Ω—è—Ç–æ —Ä–∏—Å–∫–∞–º–∏: 18.00 USDT
–°–≤–æ–±–æ–¥–Ω–æ: 984.50 USDT
```

#### **4. –ù–∞–∂–∞—Ç–∏–µ "–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é":**
```
–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è BTCUSDT –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
/close BTCUSDT –¶–ï–ù–ê

–ù–∞–ø—Ä–∏–º–µ—Ä: /close BTCUSDT 43250.50
```

#### **5. –ù–∞–∂–∞—Ç–∏–µ "–û—Ç–º–µ–Ω–∞":**
```
‚ùå –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ BTCUSDT –æ—Ç–º–µ–Ω–µ–Ω–æ.
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### ‚úÖ **–ö–Ω–æ–ø–∫–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- ‚úÖ **"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–±–∏—Ä–∂–∞)"** - –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é –ø–æ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ —Å –±–∏—Ä–∂–∏
- ‚úÖ **"–í–≤–µ—Å—Ç–∏ —Å–≤–æ—é"** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã
- ‚úÖ **"–û—Ç–º–µ–Ω–∞"** - –æ—Ç–º–µ–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback_data** - –∫–∞–∂–¥—ã–π action —É–Ω–∏–∫–∞–ª–µ–Ω
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è** - –≤–∫–ª—é—á–∞—è —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é** - –≤—Å–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- ‚úÖ **–ü–µ—Ä–µ—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π

### ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç:**
- üéØ **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - —á–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
- üí∞ **–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã** - –ø—Ä–∏–±—ã–ª—å, –±–∞–ª–∞–Ω—Å, —Ä–∏—Å–∫–∏
- üìä **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è

---

## üöÄ **–ö–ù–û–ü–ö–ò –ó–ê–ö–†–´–¢–ò–Ø –ü–û–ó–ò–¶–ò–ô –ò–°–ü–†–ê–í–õ–ï–ù–´!**

**–¢–µ–ø–µ—Ä—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤ –∫–æ–º–∞–Ω–¥–µ `/myreport` —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π.**