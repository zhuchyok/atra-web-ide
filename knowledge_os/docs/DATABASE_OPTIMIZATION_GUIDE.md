# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ATRA

## –î–∞—Ç–∞: 2025-01-09

## –û–±–∑–æ—Ä

ATRA –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQLite –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–∑ 13 –º–æ–¥—É–ª–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î:

```python
from src.database.db import Database

db = Database()  # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

### –†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
python3 scripts/apply_all_optimizations.py

# –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç –æ —Å—Ç–∞—Ç—É—Å–µ
python3 scripts/apply_all_optimizations.py --report

# –ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
python3 scripts/apply_all_optimizations.py --metrics
```

---

## üìã –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

### 1. CHECK Constraints (–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)

**–ú–æ–¥—É–ª—å:** `src/database/db.py` (–º–µ—Ç–æ–¥ `_add_validation_triggers`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü `quotes`, `signals_log`, `trades`
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≤—Å—Ç–∞–≤–∫—É –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—ã, –Ω–µ–≤–µ—Ä–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã)

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫: 100%
- –ó–∞—â–∏—Ç–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
db = Database()
```

---

### 2. –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ (Surrogate Keys)

**–ú–æ–¥—É–ª—å:** `src/database/db.py` (–º–µ—Ç–æ–¥ `_add_surrogate_time_keys`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –î–æ–±–∞–≤–ª—è–µ—Ç INTEGER –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
- –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ INTEGER –≤–º–µ—Å—Ç–æ TEXT
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤: 20-40%
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–Ω–¥–µ–∫—Å–æ–≤

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ INTEGER –∫–æ–ª–æ–Ω–∫–∏ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö:
# WHERE entry_time_surrogate > 1234567890
```

---

### 3. –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (Partial Indexes)

**–ú–æ–¥—É–ª—å:** `src/database/db.py` (–º–µ—Ç–æ–¥ `_create_partial_indexes`)

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ (BTCUSDT, ETHUSDT –∏ –¥—Ä.)
- –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–æ–≤
- –£—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤: 30-50% –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ë–î: 10-20%

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
# –ó–∞–ø—Ä–æ—Å—ã –∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º —Å–∏–º–≤–æ–ª–∞–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```

---

### 4. –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ú–æ–¥—É–ª—å:** `src/database/archive_manager.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∞—Ä—Ö–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- –£–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –ë–î: 30-80%
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –∞–∫—Ç–∏–≤–Ω—ã–º –¥–∞–Ω–Ω—ã–º

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.archive_manager import ArchiveManager

manager = ArchiveManager(db)

# –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 2 –ª–µ—Ç
manager.archive_table(
    table_name='signals_log',
    date_column='created_at',
    retention_days=730
)

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
# python3 scripts/archive_old_data.py --table signals_log --retention-days 730
```

---

### 5. Query Profiling (–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤)

**–ú–æ–¥—É–ª—å:** `src/database/query_profiler.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä—É–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (> 1 —Å–µ–∫)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.query_profiler import get_query_profiler

profiler = get_query_profiler()

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ execute_with_retry
# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

### 6. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Chunking

**–ú–æ–¥—É–ª—å:** `src/database/fetch_optimizer.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `fetchmany()` –≤–º–µ—Å—Ç–æ `fetchall()` –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—É—é –ø–∞–º—è—Ç—å

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –°–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏: 30-50%
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ OOM –æ—à–∏–±–æ–∫

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.fetch_optimizer import fetch_all_optimized

# –í–º–µ—Å—Ç–æ cursor.fetchall()
results = fetch_all_optimized(cursor, estimated_rows=10000)
```

---

### 7. –ê—É–¥–∏—Ç –∏–Ω–¥–µ–∫—Å–æ–≤

**–ú–æ–¥—É–ª—å:** `src/database/index_auditor.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –í—ã—è–≤–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –º–µ—Å—Ç–∞: 10-30%
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.index_auditor import IndexAuditor

auditor = IndexAuditor(db)

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
unused = auditor.get_unused_indexes()

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
# python3 scripts/optimize_database.py --audit-indexes
```

---

### 8. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

**–ú–æ–¥—É–ª—å:** `src/database/query_optimizer.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã –≤ JOIN
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤: 10-30%

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.query_optimizer import QueryOptimizer

optimizer = QueryOptimizer()

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
optimized = optimizer.optimize_query(original_query)

# –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
complexity = optimizer.analyze_query_complexity(query)
```

---

### 9. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ bloat —Ç–∞–±–ª–∏—Ü

**–ú–æ–¥—É–ª—å:** `src/database/table_maintenance.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
- –í—ã—è–≤–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å VACUUM
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.table_maintenance import TableMaintenance

maintenance = TableMaintenance(db)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å bloat
bloat_info = maintenance.check_table_bloat('signals_log')

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
# python3 scripts/optimize_database.py --check-bloat
```

---

### 10. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

**–ú–æ–¥—É–ª—å:** `src/database/materialized_views.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- –£—Å–∫–æ—Ä—è–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: 50-90%

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.materialized_views import MaterializedViewManager

manager = MaterializedViewManager(db)

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
manager.create_materialized_view(
    view_name='v_daily_stats',
    base_query='SELECT date, COUNT(*) FROM signals_log GROUP BY date',
    refresh_interval_minutes=60
)

# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
manager.refresh_all_views()
```

---

### 11. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –∫–æ–ª–æ–Ω–æ–∫

**–ú–æ–¥—É–ª—å:** `src/database/column_order_optimizer.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏)
- –£–ª—É—á—à–∞–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫: 5-15%
- –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.column_order_optimizer import ColumnOrderOptimizer

# –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü—ã
analysis = ColumnOrderOptimizer.analyze_table_column_order(db, 'signals_log')

if analysis['needs_reorder']:
    print(f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫: {analysis['optimized_order']}")
```

---

### 12. –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–ú–æ–¥—É–ª—å:** `src/database/temp_tables_optimizer.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –†–∞–∑–±–∏–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —á–∞—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –£—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: 20-50%

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.temp_tables_optimizer import TempTablesOptimizer

with TempTablesOptimizer(db) as optimizer:
    # –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
    optimizer.create_temp_table(
        table_name='temp_results',
        create_sql='CREATE TEMP TABLE temp_results (id INTEGER, value REAL)',
        data_query='INSERT INTO temp_results SELECT id, value FROM source_table'
    )
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

---

### 13. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–ú–æ–¥—É–ª—å:** `src/database/optimization_manager.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å –∏ –º–µ—Ç—Ä–∏–∫–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
from src.database.optimization_manager import DatabaseOptimizationManager

manager = DatabaseOptimizationManager(db)

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
results = manager.apply_all_optimizations()

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
status = manager.get_optimization_status()

# –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
metrics = manager.get_performance_metrics()

# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç
report = manager.generate_optimization_report()
print(report)
```

---

## üîß –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

```bash
# 1. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
python3 scripts/archive_old_data.py

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
python3 scripts/optimize_database.py --all

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
python3 scripts/apply_all_optimizations.py --report
```

### –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏

```bash
# 1. –ü–æ–ª–Ω—ã–π VACUUM (–µ—Å–ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
python3 scripts/optimize_database.py --vacuum

# 2. –ê—É–¥–∏—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é
python3 scripts/optimize_database.py --audit-indexes --suggest-removals

# 3. –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
python3 -c "
from src.database.db import Database
from src.database.materialized_views import MaterializedViewManager
db = Database()
if hasattr(db, 'materialized_views'):
    db.materialized_views.refresh_all_views(force=True)
"
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä –ë–î** - –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏ –º–µ–¥–ª–µ–Ω–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º (–∞—É–¥–∏—Ç –∏–Ω–¥–µ–∫—Å–æ–≤)
3. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Query Profiler
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** - —Å–Ω–∏–∂–µ–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–º—É chunking

### –ê–ª–µ—Ä—Ç—ã

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è:
- –†–∞–∑–º–µ—Ä –ë–î > 100 MB (—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä—Ö–∏–≤–∞—Ü–∏—é)
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã > 5 —Å–µ–∫ (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Query Profiler)
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã > 5 (—Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ)

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `execute_with_retry`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏** - –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `*_surrogate` –∫–æ–ª–æ–Ω–∫–∏
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π chunking** - –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `fetch_all_optimized`
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - Query Profiler –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∏—Ö

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. **–†–µ–≥—É–ª—è—Ä–Ω–∞—è –∞—Ä—Ö–∏–≤–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `apply_all_optimizations.py --metrics`
3. **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `optimize_database.py` –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π** - –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–î —Ä–∞—Å—Ç–µ—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü
python3 scripts/optimize_database.py --check-bloat

# –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
python3 scripts/archive_old_data.py --table signals_log --retention-days 365
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Query Profiler
# –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
from src.database.query_optimizer import QueryOptimizer
optimizer = QueryOptimizer()
optimized = optimizer.optimize_query(slow_query)
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π chunking
from src.database.fetch_optimizer import fetch_all_optimized
results = fetch_all_optimized(cursor, estimated_rows=10000)
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `docs/FINAL_ALL_OPTIMIZATIONS_REPORT.md` - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö
- `docs/COMPLETE_OPTIMIZATION_SYSTEM.md` - –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
- `src/database/optimization_manager.py` - –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ 13 –º–æ–¥—É–ª–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã.

