# üìä –°—Ç–∞—Ç—É—Å –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ TP/SL –≤ —Å–∏—Å—Ç–µ–º–µ

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2025-11-13

## ‚úÖ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä TP/SL –†–ê–ë–û–¢–ê–ï–¢!

### **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

#### 1. **TP1 –∏ TP2 - –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ** ‚úÖ
**–ú–µ—Å—Ç–æ –≤ –∫–æ–¥–µ:** `signal_live.py`, —Å—Ç—Ä–æ–∫–∏ 2999-3034

**–õ–æ–≥–∏–∫–∞:**
```python
if AI_TP_OPTIMIZER_AVAILABLE and AI_TP_OPTIMIZER:
    # ü§ñ –ò–ò-–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï TP
    tp1_pct, tp2_pct = AI_TP_OPTIMIZER.calculate_ai_optimized_tp(
        symbol=symbol,
        side=signal_type.upper(),
        df=df_for_tp,
        current_index=current_index,
        base_tp1=2.0,
        base_tp2=4.0
    )
else:
    # Fallback –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º TP –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR
    tp1_pct, tp2_pct = get_dynamic_tp_levels(...)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä:**
- ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç **3,236 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR)
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –æ–±—ä–µ–º
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–∞
- ‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç ML –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- TP1 –∏ TP2 —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
- –î–∏–∞–ø–∞–∑–æ–Ω: TP1 (0.5-5.0%), TP2 (1.0-8.0%)
- –ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ—Ö–æ–∂–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö

#### 2. **SL - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å AI-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π** ‚úÖ
**–ú–µ—Å—Ç–æ –≤ –∫–æ–¥–µ:** `signal_live.py`, —Å—Ç—Ä–æ–∫–∏ 3036-3045

**–õ–æ–≥–∏–∫–∞:**
```python
sl_pct_positive = get_dynamic_sl_level(
    df_for_tp, current_index, signal_type.lower(),
    base_sl_pct=2.0, symbol=symbol, use_ai_optimization=True
)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ai_sl_optimizer` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
- ‚úÖ Fallback –∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É SL –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR (ATR * 2.0)
- ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω: 1.0-8.0%

#### 3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TP/SL** ‚úÖ
**–ú–µ—Å—Ç–æ –≤ –∫–æ–¥–µ:** `signal_live.py`, —Å—Ç—Ä–æ–∫–∏ 3047-3051

**–õ–æ–≥–∏–∫–∞:**
```python
# –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º TP –Ω–∞ 20%, —É–º–µ–Ω—å—à–∞–µ–º SL –Ω–∞ 20% –¥–ª—è –ª—É—á—à–µ–≥–æ Profit Factor
tp1_pct_optimized = tp1_pct * 1.2
tp2_pct_optimized = tp2_pct * 1.2
sl_pct_optimized = sl_pct_positive * 0.8
```

**–¶–µ–ª—å:** –£–ª—É—á—à–µ–Ω–∏–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–∏—Å–∫/–ø—Ä–∏–±—ã–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–µ–∫—Ç–µ—Å—Ç–∞

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### **–°—Ç–∞—Ç—É—Å –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞:**
```bash
‚úÖ AI TP Optimizer –¥–æ—Å—Ç—É–ø–µ–Ω
–ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤: 3,236
```

### **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
```python
# signal_live.py, —Å—Ç—Ä–æ–∫–∏ 289-294
try:
    from ai_tp_optimizer import AITakeProfitOptimizer
    AI_TP_OPTIMIZER_AVAILABLE = True
    AI_TP_OPTIMIZER = AITakeProfitOptimizer()
except ImportError:
    AI_TP_OPTIMIZER_AVAILABLE = False
    AI_TP_OPTIMIZER = None
```

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TP

### **–ú–µ—Ç–æ–¥ `calculate_ai_optimized_tp()`:**

1. **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–∞:**
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ —Å–¥–µ–ª–∫–∏ –ø–æ —Å–∏–º–≤–æ–ª—É
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ TP1/TP2 –¥–ª—è —Å–∏–º–≤–æ–ª–∞

2. **–§–∞–∫—Ç–æ—Ä—ã:**
   - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (ATR) - –≤–µ—Å 30%
   - –°–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞ - –≤–µ—Å 25%
   - –ü—Ä–æ—Ñ–∏–ª—å –æ–±—ä–µ–º–∞ - –≤–µ—Å 20%
   - –£—Ä–æ–≤–Ω–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è - –≤–µ—Å 15%
   - –†—ã–Ω–æ—á–Ω—ã–π —Å–µ–Ω—Ç–∏–º–µ–Ω—Ç - –≤–µ—Å 10%

3. **ML-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:**
   - –ò—â–µ—Ç —Ç–æ–ø-1000 –ø–æ—Ö–æ–∂–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (WIN)
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ TP –∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
   - –û—Ü–µ–Ω–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–æ–∂–µ—Å—Ç–∏

4. **–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:**
   - –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ML > 0.5: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 60% –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤, 30% –∏—Å—Ç–æ—Ä–∏–∏, 10% –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - –ï—Å–ª–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ML < 0.5: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 70% –∏—Å—Ç–æ—Ä–∏–∏, 30% –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤, 10% –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

## üéØ –í—ã–≤–æ–¥—ã

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è TP1/TP2** - —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 3,236 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π SL** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR
3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - TP +20%, SL -20%

### ‚ö†Ô∏è **–ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:**

1. **SL –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ai_sl_optimizer` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
   - –ù–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å `ai_sl_optimizer`

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –í –ª–æ–≥–∞—Ö –Ω–µ –≤–∏–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π "ü§ñ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TP"
   - –í–æ–∑–º–æ–∂–Ω–æ, –ª–æ–≥–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è –∏–ª–∏ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:**
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
# –í signal_live.py —É–∂–µ –µ—Å—Ç—å:
logger.info("ü§ñ [%s] –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TP: %.2f%%, %.2f%%", ...)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
grep "ü§ñ.*–ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TP" logs/system.log | tail -10
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å ai_sl_optimizer:**
```python
# –í src/signals/risk.py, —Å—Ç—Ä–æ–∫–∞ 217
from ai_sl_optimizer import get_ai_sl_optimizer
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
python3 -c "from ai_sl_optimizer import get_ai_sl_optimizer; print('‚úÖ AI SL Optimizer –¥–æ—Å—Ç—É–ø–µ–Ω')"
```

### **3. –£–ª—É—á—à–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ò–ò vs fallback
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã fallback (–µ—Å–ª–∏ –µ—Å—Ç—å)

## üìã –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ú–µ—Ç–æ–¥ | –ü–∞—Ç—Ç–µ—Ä–Ω–æ–≤/–î–∞–Ω–Ω—ã—Ö |
|-----------|--------|-------|------------------|
| **TP1** | ‚úÖ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | `AITakeProfitOptimizer.calculate_ai_optimized_tp()` | 3,236 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ |
| **TP2** | ‚úÖ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π | `AITakeProfitOptimizer.calculate_ai_optimized_tp()` | 3,236 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ |
| **SL** | ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π (ATR) + AI | `get_dynamic_sl_level(use_ai_optimization=True)` | ATR + AI (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) |
| **–î–æ–ø. –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** | ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è | TP * 1.2, SL * 0.8 | –ù–∞ –æ—Å–Ω–æ–≤–µ –±–µ–∫—Ç–µ—Å—Ç–∞ |

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ò–ò-–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ TP1, TP2, SL –†–ê–ë–û–¢–ê–Æ–¢!**

–°–∏—Å—Ç–µ–º–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞:
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ 3,236 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ ATR (fallback)
3. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é (TP +20%, SL -20%)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ò–ò-–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

