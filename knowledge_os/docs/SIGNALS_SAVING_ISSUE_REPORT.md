# –û–¢–ß–ï–¢: –ü–†–ò–ß–ò–ù–ê –ù–ï–°–û–•–†–ê–ù–ï–ù–ò–Ø –¢–û–†–ì–û–í–´–• –°–ò–ì–ù–ê–õ–û–í

## üö® **–ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**

**–ü—Ä–∏—á–∏–Ω–∞:** –§—É–Ω–∫—Ü–∏—è `insert_signal` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `db.py`, –Ω–æ **–ù–ò–ì–î–ï –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø** –≤ –∫–æ–¥–µ!

### üìä **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑:**

#### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **`signals_log`: 36 –∑–∞–ø–∏—Å–µ–π** - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- **`active_signals`: 28 –∑–∞–ø–∏—Å–µ–π** - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è
- **–§—É–Ω–∫—Ü–∏—è `insert_signal`** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ)

#### ‚ùå **–ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **`signals: 0 –∑–∞–ø–∏—Å–µ–π`** - —Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞
- **–§—É–Ω–∫—Ü–∏—è `insert_signal`** - –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–¥–µ

## üîç **–¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê**

### **1. –§—É–Ω–∫—Ü–∏—è insert_signal —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**
```python
# db.py, —Å—Ç—Ä–æ–∫–∏ 1199-1214
def insert_signal(self, signal):
    self.cursor.execute(
        "INSERT INTO signals (ts, exchange, symbol, rsi, ema_fast, ema_slow, price) VALUES (?, ?, ?, ?, ?, ?, ?)",
        (
            datetime.utcnow().isoformat(),
            signal["exchange"],
            signal["symbol"],
            signal["rsi"],
            signal["ema_fast"],
            signal["ema_slow"],
            signal["price"],
        ),
    )
    self.conn.commit()
    print(f"[PiuX_Trade][DB] –°–∏–≥–Ω–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω: {signal}")
    backup_file(self.db_path)
```

### **2. –ù–æ –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–¥–µ:**
```bash
# –ü–æ–∏—Å–∫ –≤—ã–∑–æ–≤–æ–≤ insert_signal
grep -r "\.insert_signal(" /Users/zhuchyok/Documents/GITHUB/atra/
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–ï–¢ –°–û–í–ü–ê–î–ï–ù–ò–ô
```

### **3. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:**
- `insert_signal_log_entry` - –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `insert_signal_log` - –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- `save_signal_history` - –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

## üéØ **–ú–ï–°–¢–ê, –ì–î–ï –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨ –í–´–ó–û–í–´**

### **1. signal_live.py - —Ñ—É–Ω–∫—Ü–∏—è check_and_send_signals (—Å—Ç—Ä–æ–∫–∏ ~9000-10000):**
```python
# –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞:
if signal_generated:
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–∏–≥–Ω–∞–ª –≤ —Ç–∞–±–ª–∏—Ü—É signals
    try:
        signal_data = {
            "exchange": "binance",
            "symbol": symbol,
            "rsi": rsi_value,  # –≤—ã—á–∏—Å–ª–∏—Ç—å RSI
            "ema_fast": ema_fast_value,  # –≤—ã—á–∏—Å–ª–∏—Ç—å –±—ã—Å—Ç—Ä—É—é EMA
            "ema_slow": ema_slow_value,  # –≤—ã—á–∏—Å–ª–∏—Ç—å –º–µ–¥–ª–µ–Ω–Ω—É—é EMA
            "price": signal_price
        }
        db.insert_signal(signal_data)
        logger.info(f"‚úÖ –°–∏–≥–Ω–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î: {symbol}")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞: {e}")
```

### **2. signal_live.py - —Ñ—É–Ω–∫—Ü–∏—è process_pending_dca_signals (—Å—Ç—Ä–æ–∫–∏ ~10000-11000):**
```python
# –î–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤:
if dca_signal_generated:
    signal_data = {
        "exchange": "binance",
        "symbol": symbol,
        "rsi": rsi_value,
        "ema_fast": ema_fast_value,
        "ema_slow": ema_slow_value,
        "price": dca_price
    }
    db.insert_signal(signal_data)
```

### **3. signal_live.py - —Ñ—É–Ω–∫—Ü–∏—è log_dca_operation (—Å—Ç—Ä–æ–∫–∏ ~10380-10400):**
```python
# –î–ª—è DCA –æ–ø–µ—Ä–∞—Ü–∏–π:
signal_data = {
    "exchange": "binance",
    "symbol": symbol,
    "rsi": rsi_value,
    "ema_fast": ema_fast_value,
    "ema_slow": ema_slow_value,
    "price": avg_price_new
}
db.insert_signal(signal_data)
```

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –†–ï–®–ï–ù–ò–Ø**

### **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞:**
```
‚úÖ –§—É–Ω–∫—Ü–∏—è insert_signal —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
üìä –ó–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ signals: 2 (–ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∞)
‚úÖ –°–∏–≥–Ω–∞–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞:**
```
ID: 2, Symbol: BTCUSDT, RSI: 45.5, Price: 45000.0
```

## üí° **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ**

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. **–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã `db.insert_signal`** –≤ –º–µ—Å—Ç–∞—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
2. **–í—ã—á–∏—Å–ª–∏—Ç—å RSI –∏ EMA –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
3. **–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫–∏** –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** —Å–∏–≥–Ω–∞–ª–æ–≤

### **–ú–µ—Å—Ç–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è:**
1. **`check_and_send_signals`** - –æ—Å–Ω–æ–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
2. **`process_pending_dca_signals`** - DCA —Å–∏–≥–Ω–∞–ª—ã
3. **`log_dca_operation`** - DCA –æ–ø–µ—Ä–∞—Ü–∏–∏
4. **–î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤**

### **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è:**
- **RSI** - –∏–Ω–¥–µ–∫—Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–ª—ã
- **EMA Fast** - –±—ã—Å—Ç—Ä–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Å–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è
- **EMA Slow** - –º–µ–¥–ª–µ–Ω–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —Å–∫–æ–ª—å–∑—è—â–∞—è —Å—Ä–µ–¥–Ω—è—è
- **Price** - —Ü–µ–Ω–∞ —Å–∏–≥–Ω–∞–ª–∞

## üéØ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

**–ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê –ò –î–ò–ê–ì–ù–û–°–¢–ò–†–û–í–ê–ù–ê!**

### **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:**
–§—É–Ω–∫—Ü–∏—è `insert_signal` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ **–Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** –≤ –∫–æ–¥–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤.

### **–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã `db.insert_signal` –≤ –º–µ—Å—Ç–∞—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.

### **–°—Ç–∞—Ç—É—Å:**
üîß **–¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï** - –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü–∞ `signals` –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —Ç–æ—Ä–≥–æ–≤—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º–∏!**
