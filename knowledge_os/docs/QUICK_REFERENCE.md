# üöÄ –ë–´–°–¢–†–´–ô –°–ü–†–ê–í–û–ß–ù–ò–ö ATRA

## **‚ö° –≠–ö–°–¢–†–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **üîß –ü–†–û–ë–õ–ï–ú–ê: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –≤ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö**

**–ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï:**
```python
# –í telegram_bot.py - –∑–∞–º–µ–Ω–∏ –ø–µ—Ä–µ—Å—á–µ—Ç –Ω–∞ –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
# –ë–´–õ–û:
from signal_live import get_dynamic_leverage, get_dynamic_risk_pct
dynamic_risk_pct = get_dynamic_risk_pct(df, current_index)

# –°–¢–ê–õ–û:
dynamic_risk_pct = risk_pct  # –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
dynamic_leverage = leverage  # –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
```

### **üîß –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ TP –∏ –æ–±—ä–µ–º–∞**

**–ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï:**
```python
# –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è
current_price = ohlc[-1]["close"]  # –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
tp1 = current_price * (1 + dynamic_tp1_pct / 100)  # TP –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ
qty = risk_amount / current_price * dynamic_leverage  # –û–±—ä–µ–º –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ
```

### **üîß –ü–†–û–ë–õ–ï–ú–ê: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤**

**–ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
total_risk = sum(pos.get("risk_amount", 0) for pos in open_positions)
free_deposit = max(deposit - total_risk, 0)
```

---

## **üì± –°–¢–ê–ù–î–ê–†–¢–´ –°–û–û–ë–©–ï–ù–ò–ô**

### **HTML –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï:**
```python
msg = f"‚úÖ <b>–°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢!</b>\n\nüí∞ <b>–î–µ–ø–æ–∑–∏—Ç:</b> <code>{deposit:.2f} USDT</code>"
await query.message.reply_text(msg, parse_mode="HTML")
```

### **–ö–†–ê–¢–ö–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø:**
```python
# –ë–´–õ–û: "‚ö†Ô∏è *–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö*\n\nüéØ **–°–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç:**"
# –°–¢–ê–õ–û: "‚ö†Ô∏è –†–∏—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π!"
```

---

## **ü§ñ –ö–û–ú–ê–ù–î–´ BOTFATHER**

### **–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –°–ü–ò–°–û–ö:**
```
start - üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
help - ‚ùì –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
set_balance - üí∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç
balance - üíé –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
positions - üìä –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
myreport - üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
accept - ‚úÖ –ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª
set_trade_mode - ‚öôÔ∏è –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏
set_filter_mode - üéØ –†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
status - üìà –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
health - ü§ñ –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
report - üìã –û—Ç—á–µ—Ç –∑–∞ –¥–µ–Ω—å
report_week - üìä –û—Ç—á–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é
list_users - üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
add_user - ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
remove_user - ‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
signal_stats - üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
```

---

## **üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê**

### **–û–¢–õ–ê–î–û–ß–ù–´–ï –ü–†–ò–ù–¢–´:**
```python
print(f"[DEBUG] callback_data: {data}")
print(f"[DEBUG] –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: {current_price}")
print(f"[DEBUG] –†–∞—Å—á–µ—Ç TP: TP1={tp1:.2f}, TP2={tp2:.2f}")
print(f"[DEBUG] –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞: {free_deposit:.2f}")
```

### **–ü–†–û–í–ï–†–ö–ê –î–ê–ù–ù–´–•:**
```python
print(f"[DEBUG] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ: {user_data}")
print(f"[DEBUG] –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏: {open_positions}")
```

---

## **‚ö° –ë–´–°–¢–†–´–ï –®–ê–ë–õ–û–ù–´**

### **CALLBACK_DATA:**
```python
callback_data = f'accept|{symbol}|{short_time}|{short_price}|{side.lower()}|{short_risk}|{short_leverage}|{short_tp1}|{short_tp2}'
```

### **–ü–ê–†–°–ò–ù–ì:**
```python
risk_pct = float(data[5]) if len(data) > 5 else user_data.get("risk_pct", 2.0)
leverage = float(data[6]) if len(data) > 6 else user_data.get("leverage", 1)
tp1_pct = float(data[7]) if len(data) > 7 else 1.0
tp2_pct = float(data[8]) if len(data) > 8 else 2.0
```

### **–†–ê–°–ß–ï–¢ –°–†–ï–î–°–¢–í:**
```python
total_risk = sum(pos.get("risk_amount", 0) for pos in open_positions)
free_deposit = max(deposit - total_risk, 0)
```

### **–†–ê–°–ß–ï–¢ TP:**
```python
tp1 = current_price * (1 + dynamic_tp1_pct / 100)
tp2 = current_price * (1 + dynamic_tp2_pct / 100)
```

---

## **üö® –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò**

### **"string not found" –ø—Ä–∏ search_replace:**
1. –ò—Å–ø–æ–ª—å–∑—É–π `grep_search` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
2. –°–∫–æ–ø–∏—Ä—É–π –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ç–æ—á–Ω—ã–º–∏ –æ—Ç—Å—Ç—É–ø–∞–º–∏
3. –ü—Ä–∏–º–µ–Ω–∏ `search_replace`

### **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã:**
1. –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–¥–∞—á—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `callback_data`
2. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –≤ `telegram_bot.py`
3. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è

### **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
1. –î–æ–±–∞–≤—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ø—Ä–∏–Ω—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω
3. –£–±–µ–¥–∏—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤

---

## **‚úÖ –ß–ï–ö–õ–ò–°–¢**

### **–ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú:**
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `callback_data`
- [ ] –ù–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –≤ `telegram_bot.py`
- [ ] –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- [ ] HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã BotFather

### **–ü–†–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò:**
- [ ] –ù–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] DCA —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] TP —É—Ä–æ–≤–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ
- [ ] –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤–µ—Ä–Ω–æ
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## **üìû –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ü–û–ú–û–©–¨**

**–ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö:**
1. üîç –ü—Ä–æ–≤–µ—Ä—å —ç—Ç–æ—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
2. üìñ –û–±—Ä–∞—Ç–∏—Å—å –∫ `COMPREHENSIVE_SYSTEM_GUIDE.md`
3. üîß –ü—Ä–∏–º–µ–Ω–∏ –±—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ!** üöÄ

