# –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –õ–û–ì–ò–ö–ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –¢–ò–ü–ê –°–ò–ì–ù–ê–õ–ê

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π **–ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è** —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–æ–º—É, –∫–∞–∫–æ–π —Å–∏–≥–Ω–∞–ª –±—ã–ª –ø—Ä–∏–Ω—è—Ç:
- **–ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç –ù–û–í–´–ô —Å–∏–≥–Ω–∞–ª** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç "‚úÖ –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!"
- **–ï—Å–ª–∏ –ø—Ä–∏–Ω—è—Ç DCA —Å–∏–≥–Ω–∞–ª** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç "‚úÖ DCA —Å–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!"

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —Å–∏–≥–Ω–∞–ª–∞**

**–§–∞–π–ª:** `telegram_bot.py`
**–§—É–Ω–∫—Ü–∏—è:** `button()`
**–û–±—Ä–∞–±–æ—Ç—á–∏–∫:** `action == "accept"`

#### –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞:
```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Å–∏–≥–Ω–∞–ª–∞ (–Ω–æ–≤—ã–π –∏–ª–∏ DCA)
open_positions = user_data.get("open_positions", [])
existing_position = next((p for p in open_positions if p["symbol"] == symbol), None)
is_dca_signal = existing_position is not None
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏**

#### –î–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤:
```python
if is_dca_signal:
    # DCA —Å–∏–≥–Ω–∞–ª - –æ–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é
    old_qty = existing_position.get("qty", 0)
    old_price = existing_position.get("entry_price", 0)
    new_qty = existing_position.get("risk_amount", 0) / current_price if current_price > 0 else 0

    if old_qty > 0 and old_price > 0:
        total_qty = old_qty + new_qty
        avg_price_new = (old_qty * old_price + new_qty * current_price) / total_qty
    else:
        total_qty = new_qty
        avg_price_new = current_price

    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
    existing_position["qty"] = total_qty
    existing_position["entry_price"] = avg_price_new
    existing_position["n_dca"] = existing_position.get("n_dca", 0) + 1
```

#### –î–ª—è –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:
```python
else:
    # –ù–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
    new_position = {
        "symbol": symbol,
        "entry_price": current_price,
        "tp1": tp1,
        "tp2": tp2,
        "qty": qty,
        "stage": "open",
        "risk_amount": risk_amount,
        "risk_pct": dynamic_risk_pct,
        "leverage": dynamic_leverage,
        "side": side,
        "tp1_pct": dynamic_tp1_pct,
        "tp2_pct": dynamic_tp2_pct,
        "n_dca": 0
    }

    user_data["open_positions"].append(new_position)
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π**

#### –î–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤:
```python
if is_dca_signal:
    # –§–æ—Ä–º–∞—Ç –¥–ª—è DCA —Å–∏–≥–Ω–∞–ª–∞
    msg = (
        f"‚úÖ DCA —Å–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!\\n"
        f"–í–∞—à —Ç–µ–∫—É—â–∏–π –¥–µ–ø–æ–∑–∏—Ç: {deposit:.2f} USDT.\\n"
        f"–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: {total_positions} –Ω–∞ {total_risk:.2f} USDT.\\n"
        f"–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫: {free_deposit:.2f} USDT.\\n"
        f"–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: {dynamic_risk_pct:.2f}% ({risk_amount:.2f} USDT).\\n"
    )
    if trade_mode == "futures" and dynamic_leverage:
        msg += f"–ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–ª–µ—á–æ: x{dynamic_leverage}\\n"
    msg += f"–°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞: <b>{risk_amount:.2f} USDT</b>.\\n\\n"

    msg += (
        f"üìä <b>–û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ü–û–ó–ò–¶–ò–Ø {symbol}:</b>\\n"
        f"‚Ä¢ –ù–æ–≤–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: {entry_price:.2f}\\n"
        f"‚Ä¢ –û–±—â–∏–π –æ–±—ä—ë–º: {qty:.4f}\\n"
        f"‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: {dca_count}/5\\n"
        f"‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ TP1: {tp1:.2f} ({'+' if side == 'long' else '-'}{tp1_pct:.1f}%)\\n"
        f"‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ TP2: {tp2:.2f} ({'+' if side == 'long' else '-'}{tp2_pct:.1f}%)\\n"
    )
```

#### –î–ª—è –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:
```python
else:
    # –§–æ—Ä–º–∞—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
    msg = (
        f"‚úÖ –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!\\n"
        f"–í–∞—à —Ç–µ–∫—É—â–∏–π –¥–µ–ø–æ–∑–∏—Ç: {deposit:.2f} USDT.\\n"
        f"–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: {total_positions} –Ω–∞ {total_risk:.2f} USDT.\\n"
        f"–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫: {free_deposit:.2f} USDT.\\n"
        f"–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: {dynamic_risk_pct:.2f}% ({risk_amount:.2f} USDT).\\n"
    )
    if trade_mode == "futures" and dynamic_leverage:
        msg += f"–ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–ª–µ—á–æ: x{dynamic_leverage}\\n"
    msg += f"–°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞: <b>{risk_amount:.2f} USDT</b>.\\n\\n"

    msg += (
        f"üéØ <b>–¢–ï–ô–ö –ü–†–û–§–ò–¢–´:</b>\\n"
        f"‚Ä¢ TP1: {tp1:.2f} ({'+' if side == 'long' else '-'}{tp1_pct:.1f}%)\\n"
        f"‚Ä¢ TP2: {tp2:.2f} ({'+' if side == 'long' else '-'}{tp2_pct:.1f}%)\\n"
    )
```

## üìä –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —Å–∏–≥–Ω–∞–ª–∞

### üîç **–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø —Å–∏–≥–Ω–∞–ª–∞:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π:**
   ```python
   existing_position = next((p for p in open_positions if p["symbol"] == symbol), None)
   ```

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞:**
   - **–ï—Å–ª–∏ `existing_position` –Ω–∞–π–¥–µ–Ω** ‚Üí —ç—Ç–æ **DCA —Å–∏–≥–Ω–∞–ª**
   - **–ï—Å–ª–∏ `existing_position` –Ω–µ –Ω–∞–π–¥–µ–Ω** ‚Üí —ç—Ç–æ **–Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª**

3. **–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
   - **DCA —Å–∏–≥–Ω–∞–ª** ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ø–æ–∑–∏—Ü–∏—é
   - **–ù–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª** ‚Üí —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–ù–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª (–ø–µ—Ä–≤–∞—è –ø–æ–∑–∏—Ü–∏—è –ø–æ —Å–∏–º–≤–æ–ª—É):**
```
‚úÖ –°–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!
–í–∞—à —Ç–µ–∫—É—â–∏–π –¥–µ–ø–æ–∑–∏—Ç: 10000.00 USDT.
–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 1 –Ω–∞ 200.00 USDT.
–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫: 9800.00 USDT.
–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: 2.00% (196.00 USDT).
–ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–ª–µ—á–æ: x3.5
–°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞: 196.00 USDT.

üéØ –¢–ï–ô–ö –ü–†–û–§–ò–¢–´:
‚Ä¢ TP1: 46135.29 (+1.0%)
‚Ä¢ TP2: 46592.07 (+2.0%)
```

### ‚úÖ **DCA —Å–∏–≥–Ω–∞–ª (—É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏):**
```
‚úÖ DCA —Å–∏–≥–Ω–∞–ª –ø—Ä–∏–Ω—è—Ç!
–í–∞—à —Ç–µ–∫—É—â–∏–π –¥–µ–ø–æ–∑–∏—Ç: 10000.00 USDT.
–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π: 1 –Ω–∞ 400.00 USDT.
–°–≤–æ–±–æ–¥–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Å–¥–µ–ª–æ–∫: 9600.00 USDT.
–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: 2.00% (192.00 USDT).
–ò—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –ø–ª–µ—á–æ: x3.5
–°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Å —É—á—ë—Ç–æ–º –ø–ª–µ—á–∞: 192.00 USDT.

üìä –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –ü–û–ó–ò–¶–ò–Ø BTCUSDT:
‚Ä¢ –ù–æ–≤–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: 45200.75
‚Ä¢ –û–±—â–∏–π –æ–±—ä—ë–º: 0.0075
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: 2/5
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ TP1: 45652.76 (+1.0%)
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ TP2: 46104.76 (+2.0%)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞**
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–∏–≥–Ω–∞–ª –Ω–æ–≤—ã–º –∏–ª–∏ DCA
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ callback_data

### 2. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–π**
- DCA —Å–∏–≥–Ω–∞–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- –ù–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏

### 3. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π**
- –ö–∞–∂–¥—ã–π —Ç–∏–ø —Å–∏–≥–Ω–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Ç–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏

### 4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–∏–≥–Ω–∞–ª–∞**
- –í `accepted_signals` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ñ–ª–∞–≥ `is_dca`
- –î–ª—è –±—É–¥—É—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (–Ω–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏)
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ DCA —Å–∏–≥–Ω–∞–ª–∞ (–µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ø–æ–∑–∏—Ü–∏—è)
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
**–õ–û–ì–ò–ö–ê –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –¢–ò–ü–ê –°–ò–ì–ù–ê–õ–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ê!**

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Å–∏–≥–Ω–∞–ª–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.

---
*–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 21 –∞–≤–≥—É—Å—Ç–∞ 2025 –≥.*
*–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: ~20 –º–∏–Ω—É—Ç*
*–°—Ç–∞—Ç—É—Å: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞*
