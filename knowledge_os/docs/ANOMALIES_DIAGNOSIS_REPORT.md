# üîç –û–¢–ß–ï–¢ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò –ê–ù–û–ú–ê–õ–ò–ô

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–í —Ä–µ–∞–ª—å–Ω–æ–º —Å–∏–≥–Ω–∞–ª–µ TRXUSDT –≤ 8:18 –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å, —Ö–æ—Ç—è —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–æ–º–∞–ª–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. üìä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (15 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)
- **CoinGecko** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π)
- **CoinCap** (–±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π)
- **CoinLore**
- **CoinStats**
- **CoinCodex**
- **Binance 24h** ‚úÖ (—Ä–∞–±–æ—Ç–∞–µ—Ç)
- **CryptoCompare**
- **CoinPaprika**
- **CoinMarketCap**
- **Messari** (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- **CoinRanking**
- **Nomics** (–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π)
- **–ò –¥—Ä—É–≥–∏–µ...**

### 2. üîß –õ–æ–≥–∏–∫–∞ –∞–Ω–æ–º–∞–ª–∏–π
- **–§—É–Ω–∫—Ü–∏—è `calculate_anomaly_circles_with_fallback()`** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∞–Ω–æ–º–∞–ª–∏–∏** (5 –∫—Ä—É–∂–∫–æ–≤) –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤
- **–≠–º–æ–¥–∑–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ**: üî• –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–Ω–æ–º–∞–ª–∏–π
- **–î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è** –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ `binance_24h`

### 3. üìã –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–í `messaging_service.py`** –∞–Ω–æ–º–∞–ª–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **–û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫**: `‚Ä¢ –ê–Ω–æ–º–∞–ª–∏–∏: üî• üü¢üü¢üü¢üü¢üü¢`
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç** –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö

### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑–∞–ª–∞:
1. **‚úÖ –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç** - –ø–æ–ª—É—á–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Binance
2. **‚úÖ –õ–æ–≥–∏–∫–∞ –∞–Ω–æ–º–∞–ª–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç** - –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç 5 –∫—Ä—É–∂–∫–æ–≤
3. **‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —Ç–µ—Å—Ç–∞—Ö
4. **‚ùå –í —Ä–µ–∞–ª—å–Ω–æ–º —Å–∏–≥–Ω–∞–ª–µ TRXUSDT** –∞–Ω–æ–º–∞–ª–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å

### üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### 1. **‚è∞ –¢–∞–π–º–∞—É—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
```python
circles_count, _, circles_text, data_ok = await asyncio.wait_for(
    calculate_anomaly_circles_with_fallback(symbol, "LONG"),
    timeout=3.0,  # ‚Üê –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
)
```

#### 2. **‚ùå –û—à–∏–±–∫–∞ –≤ –ø–µ—Ä–µ–¥–∞—á–µ `anomalies_line`**
```python
anomalies_line = None  # ‚Üê –ú–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è None
```

#### 3. **üîß Fallback –ª–æ–≥–∏–∫–∞ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç**
```python
if anomalies_line is None:  # ‚Üê –ú–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å
    # –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–æ–º–∞–ª–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
```

#### 4. **üìä –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
```python
cached = _ANOMALY_FALLBACK_CACHE.get(ckey)
if cached and (now_ts - cached[0]) < ttl_seconds:
    return cached[1]  # ‚Üê –ú–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. **–£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç**
```python
timeout=10.0  # –í–º–µ—Å—Ç–æ 3.0 —Å–µ–∫—É–Ω–¥
```

### 2. **–î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**
```python
print(f"[DEBUG] {symbol}: anomalies_line = {anomalies_line}")
```

### 3. **–£–ª—É—á—à–∏—Ç—å fallback –ª–æ–≥–∏–∫—É**
```python
if anomalies_line is None or anomalies_line == "":
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –∞–Ω–æ–º–∞–ª–∏–∏
```

### 4. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**
```python
# –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
anomalies_line = "‚Ä¢ –ê–Ω–æ–º–∞–ª–∏–∏: ‚ö™ –ù–ï–¢ –î–ê–ù–ù–´–•"
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ê–Ω–æ–º–∞–ª–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –º–æ–≥—É—Ç –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö –∏–∑-–∑–∞:**
- –¢–∞–π–º–∞—É—Ç–æ–≤ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ
- –û—à–∏–±–æ–∫ –≤ –ø–µ—Ä–µ–¥–∞—á–µ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–±–ª–µ–º —Å fallback –ª–æ–≥–∏–∫–æ–π

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö!** üîß
