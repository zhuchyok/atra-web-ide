# üìä –û–¢–ß–ï–¢: –í–ù–ï–î–†–ï–ù–ò–ï STATELESS –ê–†–•–ò–¢–ï–ö–¢–£–†–´ –í ATRA

## ‚úÖ –°—Ç–∞—Ç—É—Å: –≠—Ç–∞–ø—ã 1-4 –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –≠—Ç–∞–ø 5 –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

**–î–∞—Ç–∞:** 2025-01-XX  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ –≠—Ç–∞–ø 1: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ (–ó–ê–í–ï–†–®–ï–ù)

1. **–î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª –≤ `.cursorrules`**
   - –ü—Ä–∏–Ω—Ü–∏–ø—ã stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –¥–ª—è Python-–º–æ–¥—É–ª–µ–π
   - –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞
   - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–¥—É–ª–µ–π
   - –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –≥–∞–π–¥

2. **–°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è `docs/STATELESS_ARCHITECTURE_GUIDE.md`**
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
   - –ü—Ä–∏–º–µ—Ä—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
   - Best practices
   - FAQ

---

### ‚úÖ –≠—Ç–∞–ø 2: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ó–ê–í–ï–†–®–ï–ù)

1. **–°–æ–∑–¥–∞–Ω `StatelessCacheManager`**
   - –§–∞–π–ª: `src/infrastructure/cache/stateless_cache.py`
   - –ö–ª–∞—Å—Å –¥–ª—è —è–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL
   - –ú–µ—Ç–æ–¥—ã: `get()`, `set()`, `clear()`, `cleanup_expired()`

2. **–°–æ–∑–¥–∞–Ω—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - –§–∞–π–ª: `src/signals/state_container.py`
   - `FilterState` - –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
   - `IndicatorState` - –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
   - `SignalState` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

---

### ‚úÖ –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (–ó–ê–í–ï–†–®–ï–ù)

#### 4. `src/ai/system_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `_ai_instances = {}`
- ‚úÖ –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `AISystemManager` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `run_ai_learning_system()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `AISystemManager`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `cleanup_ai_instances()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ singleton pattern

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–æ–¥—É–ª—å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —è–≤–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

#### 5. `src/telegram/handlers.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –º–æ–¥—É–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `pending_trades = {}`
- ‚úÖ –°–æ–∑–¥–∞–Ω –∫–ª–∞—Å—Å `SessionManager` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏—è–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω proxy-–æ–±—ä–µ–∫—Ç `_PendingTradesProxy` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ proxy

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–æ–¥—É–ª—å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ —á–µ—Ä–µ–∑ –º–µ–Ω–µ–¥–∂–µ—Ä
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ proxy-–æ–±—ä–µ–∫—Ç

---

### ‚úÖ –≠—Ç–∞–ø 4: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ä–µ–¥–Ω–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (–ó–ê–í–ï–†–®–ï–ù)

#### 1. `src/utils/cache_manager.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `_price_cache`, `_symbol_info_cache`, `_pairs_cache_safe`
- ‚úÖ –°–æ–∑–¥–∞–Ω `StatelessCacheManagerWrapper` –¥–ª—è —è–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏: `get_symbol_info()`, `get_dynamic_price_precision()`
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ singleton pattern

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ú–æ–¥—É–ª—å —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —è–≤–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

#### 2. `src/core/config.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `SENT_SIGNALS_CACHE`, `ANOMALY_CACHE`, `NEWS_CACHE`
- ‚úÖ –°–æ–∑–¥–∞–Ω –º–æ–¥—É–ª—å `src/core/cache.py` —Å `CacheRegistry`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã proxy-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –í—Å–µ –∫—ç—à–∏ —Ç–µ–ø–µ—Ä—å —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `CacheRegistry`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ö—ç—à–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ proxy-–æ–±—ä–µ–∫—Ç—ã

#### 3. `src/signals/filters_volume_vwap.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚ùå –£–¥–∞–ª–µ–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: `_vp_cache`, `_vp_stats`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `check_volume_profile_filter()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `FilterState`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `(passed, reason, filter_state)`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_update_vp_stats()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `FilterState`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `get_vp_filter_stats()` –∏ `reset_vp_filter_stats()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –§–∏–ª—å—Ç—Ä —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é stateless
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ fallback

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –£–¥–∞–ª–µ–Ω–æ –º–æ–¥—É–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:
- `_price_cache = {}` (cache_manager.py)
- `_symbol_info_cache = {}` (cache_manager.py)
- `_pairs_cache_safe = {}` (cache_manager.py)
- `SENT_SIGNALS_CACHE = {}` (config.py)
- `ANOMALY_CACHE = {}` (config.py)
- `NEWS_CACHE = {}` (config.py)
- `_vp_cache = {}` (filters_volume_vwap.py)
- `_vp_stats = {}` (filters_volume_vwap.py)
- `_ai_instances = {}` (system_manager.py)
- `pending_trades = {}` (handlers.py)

**–ò—Ç–æ–≥–æ:** 10 –º–æ–¥—É–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–¥–∞–ª–µ–Ω–æ

### –°–æ–∑–¥–∞–Ω–æ –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤:
- `StatelessCacheManager` - –º–µ–Ω–µ–¥–∂–µ—Ä –∫—ç—à–∞
- `StatelessCacheManagerWrapper` - –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `CacheRegistry` - —Ä–µ–µ—Å—Ç—Ä –∫—ç—à–µ–π
- `FilterState` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
- `IndicatorState` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- `SignalState` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- `AISystemManager` - –º–µ–Ω–µ–¥–∂–µ—Ä AI —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤
- `SessionManager` - –º–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ò—Ç–æ–≥–æ:** 8 –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü–∏–π:
- `get_symbol_info()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `cache_manager`
- `get_dynamic_price_precision()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `cache_manager`
- `check_volume_profile_filter()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `filter_state`
- `_update_vp_stats()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `filter_state`
- `get_vp_filter_stats()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `filter_state`
- `reset_vp_filter_stats()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `filter_state`
- `run_ai_learning_system()` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `ai_manager`
- `cleanup_ai_instances()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AISystemManager`

**–ò—Ç–æ–≥–æ:** 8 —Ñ—É–Ω–∫—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–æ

### –°–æ–∑–¥–∞–Ω–æ unit-—Ç–µ—Å—Ç–æ–≤:
- `test_stateless_cache.py` - —Ç–µ—Å—Ç—ã –¥–ª—è StatelessCacheManager
- `test_state_containers.py` - —Ç–µ—Å—Ç—ã –¥–ª—è FilterState, IndicatorState, SignalState
- `test_cache_manager_stateless.py` - —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω–Ω–æ–≥–æ cache_manager
- `test_ai_system_manager_stateless.py` - —Ç–µ—Å—Ç—ã –¥–ª—è AISystemManager
- `test_session_manager_stateless.py` - —Ç–µ—Å—Ç—ã –¥–ª—è SessionManager

**–ò—Ç–æ–≥–æ:** 5 —Ñ–∞–π–ª–æ–≤ —Å unit-—Ç–µ—Å—Ç–∞–º–∏

---

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

1. **cache_manager.py:**
   - –°—Ç–∞—Ä—ã–µ –≤—ã–∑–æ–≤—ã `get_symbol_info(symbol)` —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ singleton
   - –ù–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `cache_manager` —è–≤–Ω–æ

2. **config.py:**
   - –°—Ç–∞—Ä—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `SENT_SIGNALS_CACHE`, `ANOMALY_CACHE`, `NEWS_CACHE` —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ proxy-–æ–±—ä–µ–∫—Ç—ã
   - –ù–æ–≤—ã–π –∫–æ–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_cache_registry()`

3. **filters_volume_vwap.py:**
   - –°—Ç–∞—Ä—ã–µ –≤—ã–∑–æ–≤—ã `check_volume_profile_filter(df, i, side)` —Ä–∞–±–æ—Ç–∞—é—Ç (—Å–æ–∑–¥–∞–µ—Ç—Å—è `FilterState` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - –ù–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã –º–æ–≥—É—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `filter_state` —è–≤–Ω–æ

---

## ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã –≤ `src/signals/core.py`

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `FilterState` –∏–∑ `state_container`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ 4 –≤—ã–∑–æ–≤–∞ `check_volume_profile_filter()` –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö:
  - `strict_entry_signal()` - 2 –≤—ã–∑–æ–≤–∞ (long –∏ short, —Å—Ç—Ä–æ–∫–∏ ~305 –∏ ~374)
  - `soft_entry_signal()` - 2 –≤—ã–∑–æ–≤–∞ (long –∏ short, —Å—Ç—Ä–æ–∫–∏ ~665 –∏ ~680)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `filter_state` –≤ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –í—Å–µ –≤—ã–∑–æ–≤—ã —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç 3 –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è: `(passed, reason, filter_state)`

**–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:**
```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ (stateless)
filter_state = FilterState() if FILTER_STATE_AVAILABLE and FilterState else None

# –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
vp_ok, vp_reason, filter_state = check_volume_profile_filter(
    df, i, "long", strict_mode=True, filter_state=filter_state
)
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

1. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å:** –§—É–Ω–∫—Ü–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ª—é–±–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
2. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
4. **–û—Ç–ª–∞–¥–∫–∞:** –Ø–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É–ø—Ä–æ—â–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤—ã –≤ `core.py`** (4 –º–µ—Å—Ç–∞) - **–ó–ê–í–ï–†–®–ï–ù–û**
2. ‚úÖ **–ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã** –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ - **–ó–ê–í–ï–†–®–ï–ù–û**
3. ‚úÖ **–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–æ–≤** - **–ó–ê–í–ï–†–®–ï–ù–û**
4. ‚è≥ **–ü—Ä–æ–≤–µ—Å—Ç–∏ –±—ç–∫—Ç–µ—Å—Ç—ã** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫)
5. ‚è≥ **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫)
6. ‚è≥ **–î–µ–ø–ª–æ–π –Ω–∞ staging** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É)

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

- [x] –í—Å–µ –º–æ–¥—É–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã (10 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —è–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- [x] –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π –≤ `core.py`
- [x] Unit-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã (5 —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤)
- [x] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –±—ç–∫—Ç–µ—Å—Ç–æ–≤
- [ ] –ë—ç–∫—Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫)
- [ ] –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫)
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –î–µ–ø–ª–æ–π –Ω–∞ staging —É—Å–ø–µ—à–µ–Ω (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É)

---

**–ê–≤—Ç–æ—Ä:** –ö–æ–º–∞–Ω–¥–∞ ATRA  
**–î–∞—Ç–∞:** 2025-01-XX

