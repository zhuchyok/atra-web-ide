# üéØ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ì–ê–ô–î –°–ò–°–¢–ï–ú–´ ATRA

## **üìã –û–ë–©–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø**

**–¶–µ–ª—å:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, —Ä–µ—à–µ–Ω–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Å–∏—Å—Ç–µ–º—ã ATRA –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –æ—à–∏–±–æ–∫.

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 20.08.2025

---

## **üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. üö® –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ò CALLBACK_DATA**

#### **–ü–†–û–ë–õ–ï–ú–ê:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ä–∏—Å–∫, –ø–ª–µ—á–æ, TP) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –≤ `signal_live.py`
- –í `telegram_bot.py` —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –∑–∞–Ω–æ–≤–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–æ–º –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ–º

#### **–†–ï–®–ï–ù–ò–ï:**
```python
# –í signal_live.py - –ø–µ—Ä–µ–¥–∞–µ–º –≤—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
short_leverage = f"{dynamic_leverage:.1f}" if dynamic_leverage else "1.0"
short_tp1 = f"{tp1_pct:.1f}"
short_tp2 = f"{tp2_pct:.1f}"
callback_data = f'accept|{symbol}|{short_time}|{short_price}|{side.lower()}|{short_risk}|{short_leverage}|{short_tp1}|{short_tp2}'

# –í telegram_bot.py - –ø–∞—Ä—Å–∏–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
risk_pct = float(data[5]) if len(data) > 5 else user_data.get("risk_pct", 2.0)
leverage = float(data[6]) if len(data) > 6 else user_data.get("leverage", 1)
tp1_pct = float(data[7]) if len(data) > 7 else 1.0
tp2_pct = float(data[8]) if len(data) > 8 else 2.0

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞–ø—Ä—è–º—É—é
dynamic_risk_pct = risk_pct
dynamic_leverage = leverage
dynamic_tp1_pct = tp1_pct
dynamic_tp2_pct = tp2_pct
```

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ –í—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ `signal_live.py`
- ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `callback_data` –≤ `telegram_bot.py`
- ‚úÖ –í `telegram_bot.py` –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–Ω–æ–≤–æ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é

---

### **2. üïê –í–†–ï–ú–ï–ù–ù–´–ï –†–ê–ú–ö–ò –†–ê–°–ß–ï–¢–û–í**

#### **–ü–†–û–ë–õ–ï–ú–ê:**
- TP —É—Ä–æ–≤–Ω–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–Ω—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞
- –û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã –ø—Ä–∏–Ω—è—Ç–∏—è
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—é –º–µ–∂–¥—É –æ–∂–∏–¥–∞–µ–º–æ–π –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–∏–±—ã–ª—å—é

#### **–†–ï–®–ï–ù–ò–ï:**
```python
# –í telegram_bot.py - –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è
# –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
ohlc = get_ohlc_binance_sync(symbol, interval="1m", limit=1)
current_price = ohlc[-1]["close"]

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º TP –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
tp1 = current_price * (1 + dynamic_tp1_pct / 100)
tp2 = current_price * (1 + dynamic_tp2_pct / 100)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
qty = risk_amount / current_price * dynamic_leverage
```

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ **–ú–æ–º–µ–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
- ‚úÖ **–ú–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è:** –∞–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞, –æ–±—ä–µ–º, TP —É—Ä–æ–≤–Ω–∏, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ DCA
- ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è

---

### **3. üí∞ –†–ê–°–ß–ï–¢ –°–í–û–ë–û–î–ù–´–• –°–†–ï–î–°–¢–í**

#### **–ü–†–û–ë–õ–ï–ú–ê:**
- –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏

#### **–†–ï–®–ï–ù–ò–ï:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
open_positions = user_data.get("open_positions", [])
total_risk = sum(pos.get("risk_amount", 0) for pos in open_positions)
free_deposit = max(deposit - total_risk, 0)
```

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ –°—É–º–º–∏—Ä—É–µ–º `risk_amount` –∏–∑ –≤—Å–µ—Ö –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ = –¥–µ–ø–æ–∑–∏—Ç - –æ–±—â–∏–π —Ä–∏—Å–∫
- ‚úÖ –ú–∏–Ω–∏–º—É–º 0 (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)

---

### **4. üîÑ DCA –õ–û–ì–ò–ö–ê**

#### **–ü–†–û–ë–õ–ï–ú–ê:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç `new_qty` –¥–ª—è DCA
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ DCA

#### **–†–ï–®–ï–ù–ò–ï:**
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç DCA
dca_risk_amount = free_deposit * dynamic_risk_pct / 100
new_qty = dca_risk_amount / current_price if current_price > 0 else 0

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
existing_position["qty"] = total_qty
existing_position["entry_price"] = avg_price_new
existing_position["risk_amount"] = existing_position.get("risk_amount", 0) + dca_risk_amount
existing_position["risk_pct"] = dynamic_risk_pct
existing_position["leverage"] = dynamic_leverage
```

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ `new_qty` —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `dca_risk_amount` –∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
- ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ DCA
- ‚úÖ –ù–æ–≤–∞—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## **üì± –°–¢–ê–ù–î–ê–†–¢–´ –°–û–û–ë–©–ï–ù–ò–ô**

### **1. üé® –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï**

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º **HTML** –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (`parse_mode="HTML"`)
- ‚úÖ **–ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç:** `<b>—Ç–µ–∫—Å—Ç</b>`
- ‚úÖ **–ö–æ–¥:** `<code>–∫–æ–º–∞–Ω–¥–∞</code>`
- ‚úÖ **–≠–º–æ–¥–∑–∏:** –ø–µ—Ä–µ–¥ —Ç–µ–∫—Å—Ç–æ–º (üöÄ, üí∞, üìä, etc.)

#### **–ü–†–ò–ú–ï–†:**
```python
msg = (
    f"‚úÖ <b>–°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢!</b>\n\n"
    f"üí∞ <b>–î–µ–ø–æ–∑–∏—Ç:</b> <code>{deposit:.2f} USDT</code>\n"
    f"üìä <b>–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π:</b> <code>{total_positions}</code>\n"
    f"üíµ <b>–°–≤–æ–±–æ–¥–Ω–æ:</b> <code>{free_deposit:.2f} USDT</code>\n"
)
await query.message.reply_text(msg, parse_mode="HTML")
```

### **2. üìù –ö–†–ê–¢–ö–û–°–¢–¨ –°–û–û–ë–©–ï–ù–ò–ô**

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ –∏ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —ç–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –§–æ–∫—É—Å –Ω–∞ –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

#### **–ü–†–ò–ú–ï–†:**
```python
# –ë–´–õ–û:
"‚ö†Ô∏è *–ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö*\n\nüéØ **–°–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç:**\n‚Ä¢ –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞\n‚Ä¢ –¢—Ä–µ–Ω–¥ BTC\n‚Ä¢ –¢–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è\n\nüìä **–î–∏–∞–ø–∞–∑–æ–Ω —Ä–∏—Å–∫–∞:** 0.5% - 5%\nüîí –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."

# –°–¢–ê–õ–û:
"‚ö†Ô∏è –†–∏—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π!\n\n–°–∏—Å—Ç–µ–º–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç:\n‚Ä¢ –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞\n‚Ä¢ –¢—Ä–µ–Ω–¥ BTC\n‚Ä¢ –¢–µ–∫—É—â–∏–µ —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è\n\n–†–∏—Å–∫ –º–æ–∂–µ—Ç –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ—Ç 0.5% –¥–æ 5% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏.\n–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∏—Å–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏."
```

---

## **ü§ñ –ö–û–ú–ê–ù–î–´ BOTFATHER**

### **1. üìã –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –°–ü–ò–°–û–ö**

#### **–°–¢–ê–ù–î–ê–†–¢:**
- ‚úÖ –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –≠–º–æ–¥–∑–∏ **–ü–û–°–õ–ï** –¥–µ—Ñ–∏—Å–∞
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è

#### **–°–ü–ò–°–û–ö:**
```
start - üöÄ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
help - ‚ùì –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
set_balance - üí∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–ø–æ–∑–∏—Ç
balance - üíé –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å
positions - üìä –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
myreport - üë§ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
accept - ‚úÖ –ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª
set_trade_mode - ‚öôÔ∏è –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏
set_filter_mode - üéØ –†–µ–∂–∏–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
status - üìà –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞
health - ü§ñ –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã
report - üìã –û—Ç—á–µ—Ç –∑–∞ –¥–µ–Ω—å
report_week - üìä –û—Ç—á–µ—Ç –∑–∞ –Ω–µ–¥–µ–ª—é
list_users - üë• –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
add_user - ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
remove_user - ‚ûñ –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
signal_stats - üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
```

---

## **üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú**

### **1. üö® –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò**

#### **–û—à–∏–±–∫–∞: "string not found" –ø—Ä–∏ search_replace**
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–π `grep_search` –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –∑–∞—Ç–µ–º `search_replace`

#### **–û—à–∏–±–∫–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã –≤ –ø—Ä–∏–Ω—è—Ç—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö**
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–¥–∞—á—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `callback_data`

#### **–û—à–∏–±–∫–∞: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ TP –∏ –æ–±—ä–µ–º–∞**
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è

### **2. üîß –ü–†–û–¶–ï–î–£–†–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

#### **–®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**
```python
# –î–æ–±–∞–≤—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –ø—Ä–∏–Ω—Ç—ã
print(f"[DEBUG] –ü–∞—Ä—Å–∏–Ω–≥ callback_data: —Ä–∏—Å–∫={risk_pct}%, –ø–ª–µ—á–æ={leverage}x")
print(f"[DEBUG] –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: {current_price}")
print(f"[DEBUG] –†–∞—Å—á–µ—Ç TP: TP1={tp1:.2f}, TP2={tp2:.2f}")
```

#### **–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
```python
# –ü—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–¥–∞—á—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
print(f"[DEBUG] –ü–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {data}")
print(f"[DEBUG] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ: {user_data}")
```

#### **–®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**
- –ù–∞–π–¥–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥
- –ü—Ä–∏–º–µ–Ω–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ —ç—Ç–æ–≥–æ –≥–∞–π–¥–∞
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## **üìä –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í**

### **1. üéØ –û–°–ù–û–í–ù–´–ï –§–ê–ô–õ–´**

#### **signal_live.py**
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –†–∞—Å—á–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ `callback_data`

#### **telegram_bot.py**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ –∫–Ω–æ–ø–æ–∫
- ‚úÖ –ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –†–∞—Å—á–µ—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è

#### **shared_utils.py**
- ‚úÖ –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
- ‚úÖ –†–∞—Å—á–µ—Ç TP —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω

### **2. üìÅ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–ê–ô–õ–´**

#### **config.py**
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### **db.py**
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

## **üéØ –ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´**

### **1. üîÑ –ï–î–ò–ù–°–¢–í–ï–ù–ù–û–°–¢–¨ –ò–°–¢–û–ß–ù–ò–ö–ê**
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ `signal_live.py`
- ‚úÖ –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `callback_data`
- ‚úÖ –ù–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ `telegram_bot.py`

### **2. üïê –ê–ö–¢–£–ê–õ–¨–ù–û–°–¢–¨ –î–ê–ù–ù–´–•**
- ‚úÖ –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–∞
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∏–∑ API
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ–±—ä–µ–º—ã –∏ TP

### **3. üí∞ –¢–û–ß–ù–û–°–¢–¨ –†–ê–°–ß–ï–¢–û–í**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è DCA –ª–æ–≥–∏–∫–∞
- ‚úÖ –¢–æ—á–Ω—ã–µ TP —É—Ä–æ–≤–Ω–∏

### **4. üì± –ü–†–û–°–¢–û–¢–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê**
- ‚úÖ –ö—Ä–∞—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ú–∏–Ω–∏–º—É–º –∫–Ω–æ–ø–æ–∫

---

## **üöÄ –ë–´–°–¢–†–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. üîß –®–ê–ë–õ–û–ù–´ –ö–û–î–ê**

#### **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π callback_data:**
```python
callback_data = f'accept|{symbol}|{short_time}|{short_price}|{side.lower()}|{short_risk}|{short_leverage}|{short_tp1}|{short_tp2}'
```

#### **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:**
```python
risk_pct = float(data[5]) if len(data) > 5 else user_data.get("risk_pct", 2.0)
leverage = float(data[6]) if len(data) > 6 else user_data.get("leverage", 1)
tp1_pct = float(data[7]) if len(data) > 7 else 1.0
tp2_pct = float(data[8]) if len(data) > 8 else 2.0
```

#### **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤:**
```python
total_risk = sum(pos.get("risk_amount", 0) for pos in open_positions)
free_deposit = max(deposit - total_risk, 0)
```

#### **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç TP:**
```python
tp1 = current_price * (1 + dynamic_tp1_pct / 100)
tp2 = current_price * (1 + dynamic_tp2_pct / 100)
```

### **2. üìù –®–ê–ë–õ–û–ù–´ –°–û–û–ë–©–ï–ù–ò–ô**

#### **–ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞:**
```python
msg = (
    f"‚úÖ <b>–°–ò–ì–ù–ê–õ –ü–†–ò–ù–Ø–¢!</b>\n\n"
    f"üí∞ <b>–î–µ–ø–æ–∑–∏—Ç:</b> <code>{deposit:.2f} USDT</code>\n"
    f"üìä <b>–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π:</b> <code>{total_positions}</code>\n"
    f"üíµ <b>–°–≤–æ–±–æ–¥–Ω–æ:</b> <code>{free_deposit:.2f} USDT</code>\n"
    f"üéØ <b>–†–∏—Å–∫:</b> <code>{dynamic_risk_pct:.2f}%</code>\n"
)
```

#### **–û—à–∏–±–∫–∞:**
```python
await query.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {error_description}")
```

---

## **üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò**

### **1. ‚úÖ –ü–ï–†–ï–î –ó–ê–ü–£–°–ö–û–ú**

- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `callback_data`
- [ ] –í `telegram_bot.py` –Ω–µ—Ç –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- [ ] –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç–∏—è
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è DCA –ª–æ–≥–∏–∫–∞
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ö–æ–º–∞–Ω–¥—ã BotFather –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### **2. ‚úÖ –ü–†–ò –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò**

- [ ] –ù–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] DCA —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] TP —É—Ä–æ–≤–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ
- [ ] –°–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤–µ—Ä–Ω–æ
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

---

## **üéØ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

**–≠—Ç–æ—Ç –≥–∞–π–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Å–∏—Å—Ç–µ–º—ã ATRA.**

**–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:**
1. üîç –ü—Ä–æ–≤–µ—Ä—å —ç—Ç–æ—Ç –≥–∞–π–¥
2. üîß –ü—Ä–∏–º–µ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. üìù –û–±–Ω–æ–≤–∏ –≥–∞–π–¥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

**–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ —Ç–æ—á–Ω–æ!** üöÄ

