# –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í

## üö® –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç 3 —Ä–∞–∑–∞ (–¥—É–±–ª–∏—Ä—É—é—Ç—Å—è).

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Å callback data –ø–∞—Ä—Å–∏–Ω–≥–æ–º
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞**: –í —Ñ—É–Ω–∫—Ü–∏–∏ `button` –≤ `telegram_bot.py` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –ø–æ–ø—ã—Ç–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫—É 'long' –≤ `float`:

```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
qty_new = float(data[4]) if len(data) > 4 else 1  # data[4] = 'long'
side = data[5] if len(data) > 5 else "long"

# –ü–†–ê–í–ò–õ–¨–ù–û:
side = data[4] if len(data) > 4 else "long"  # data[4] = 'long'
qty_new = 1.0  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0
```

**–§–æ—Ä–º–∞—Ç callback data**: `accept|symbol|time|price|side|risk|leverage`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
```diff
- qty_new = float(data[4]) if len(data) > 4 else 1
- side = data[5] if len(data) > 5 else "long"
+ side = data[4] if len(data) > 4 else "long"
+ qty_new = 1.0  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 1.0
```

### 2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏–≥–Ω–∞–ª–æ–≤
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –±—ã–ª–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:

```python
def is_signal_already_sent(symbol, user_id, side, price, tolerance=0.001):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±—ã–ª –ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ö–æ–∂–∏–π —Å–∏–≥–Ω–∞–ª
    –ü–†–û–°–¢–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø
    """
    import time
    current_time = time.time()

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –∫–ª—é—á –¥–ª—è —Å–∏–≥–Ω–∞–ª–∞
    signal_key = f"{symbol}_{user_id}_{side}"

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Å–∏–≥–Ω–∞–ª –¥–ª—è —ç—Ç–æ–≥–æ —Å–∏–º–≤–æ–ª–∞/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Å—Ç–æ—Ä–æ–Ω—ã
    if signal_key in SENT_SIGNALS_CACHE:
        last_time = SENT_SIGNALS_CACHE[signal_key]
        # –ï—Å–ª–∏ –ø—Ä–æ—à–ª–æ –º–µ–Ω–µ–µ 60 —Å–µ–∫—É–Ω–¥, —Å—á–∏—Ç–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç–æ–º
        if current_time - last_time < 60:
            return True

    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –≤ –∫—ç—à
    SENT_SIGNALS_CACHE[signal_key] = current_time
    return False
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –∫—ç—à–∞
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞ –±—ã–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ**: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞ –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö:

1. **–û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã**:
```python
if is_signal_already_sent(symbol, target_user_id, side, price):
    print(f"[DEBUG] ‚ö†Ô∏è –°–∏–≥–Ω–∞–ª {side} –¥–ª—è {symbol} —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {target_user_id}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
    continue
```

2. **DCA LONG —Å–∏–≥–Ω–∞–ª—ã**:
```python
if is_signal_already_sent(symbol, user_id, "long", last['close']):
    print(f"[DEBUG] ‚ö†Ô∏è DCA —Å–∏–≥–Ω–∞–ª LONG –¥–ª—è {symbol} —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
    continue
```

3. **DCA SHORT —Å–∏–≥–Ω–∞–ª—ã**:
```python
if is_signal_already_sent(symbol, user_id, "short", last['close']):
    print(f"[DEBUG] ‚ö†Ô∏è DCA —Å–∏–≥–Ω–∞–ª SHORT –¥–ª—è {symbol} —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
    continue
```

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
[DEBUG] üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260...
[DEBUG] üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260...
[DEBUG] üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260...
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
[DEBUG] üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260...
[DEBUG] ‚ö†Ô∏è –°–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
[DEBUG] ‚ö†Ô∏è –°–∏–≥–Ω–∞–ª long –¥–ª—è BTCUSDT —É–∂–µ –±—ã–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 958930260, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
```

## üìã –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ Telegram
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (60 —Å–µ–∫—É–Ω–¥)
- –ü–∞—Ä—Å–∏–Ω–≥ callback data
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤

### ‚ùå –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:
- –û—à–∏–±–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ 'long' –≤ float
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:
- –ö–ª—é—á: `{symbol}_{user_id}_{side}`
- –¢–∞–π–º–∞—É—Ç: 60 —Å–µ–∫—É–Ω–¥
- –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ callback data:
- –§–æ—Ä–º–∞—Ç: `accept|symbol|time|price|side|risk|leverage`
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ float
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞:
```python
# –û–ß–ò–©–ê–ï–ú –ö–≠–® –°–ò–ì–ù–ê–õ–û–í –ü–†–ò –ó–ê–ü–£–°–ö–ï
global SENT_SIGNALS_CACHE
SENT_SIGNALS_CACHE.clear()
print("üßπ –ö—ç—à —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—á–∏—â–µ–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ")
```

## üìä –í—ã–≤–æ–¥—ã

**–ü–†–û–ë–õ–ï–ú–ê –° –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï–ú –°–ò–ì–ù–ê–õ–û–í –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê!**

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. ‚úÖ **–ü–∞—Ä—Å–∏–Ω–≥ callback data** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ 'long' –≤ float
2. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞** - –≤–∫–ª—é—á–µ–Ω—ã –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** - –∫—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –°–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–Ω—è—Ç–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
**–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê** - —Å–∏–≥–Ω–∞–ª—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!

## üì± –ü—Ä–æ–≤–µ—Ä–∫–∞
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram - —Å–∏–≥–Ω–∞–ª—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!** üéâ

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
1. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞ –∑–∞—â–∏—Ç—ã (—Å–µ–π—á–∞—Å 60 —Å–µ–∫—É–Ω–¥)

## üéâ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢
**–ü–†–û–ë–õ–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê!**

–°–∏–≥–Ω–∞–ª—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑. –í—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ callback data
- ‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—ç—à–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram - —Å–∏–≥–Ω–∞–ª—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!** üì±