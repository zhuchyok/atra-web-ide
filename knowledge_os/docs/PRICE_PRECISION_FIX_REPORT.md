# üéØ –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –¢–û–ß–ù–û–°–¢–¨–Æ –¶–ï–ù –í –°–ò–ì–ù–ê–õ–ê–•

## üìã –ü–†–û–ë–õ–ï–ú–ê

–£ –≤–∞—Å –æ–±—Ä–µ–∑–∞–ª–∏—Å—å —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞ –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, –∞ –Ω–∞ –±–∏—Ä–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 4-5 –∑–Ω–∞–∫–æ–≤. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—è–º –≤ —Å–∏–≥–Ω–∞–ª–∞—Ö –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Å–¥–µ–ª–æ–∫.

## üîç –ê–ù–ê–õ–ò–ó

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å —Ç–æ—á–Ω–æ—Å—Ç–∏** - —Ñ—É–Ω–∫—Ü–∏—è `safe_format_price` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–Ω–µ—Ç
2. **–ù–µ–ø–æ–ª–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å** - –º–Ω–æ–≥–∏–µ –Ω–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã –Ω–µ –±—ã–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å–ª–æ–≤–∞—Ä—å
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–ª—É—á–∞–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å —Å –±–∏—Ä–∂–∏

### –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_symbol_info()` - –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏–º–≤–æ–ª–µ —Å –±–∏—Ä–∂–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_price_precision_from_tick()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ç–∏–∫–∞
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_symbol_precision()` - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏
- ‚ùå –§—É–Ω–∫—Ü–∏—è `safe_format_price()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Å–ª–æ–≤–∞—Ä—å

## üõ†Ô∏è –†–ï–®–ï–ù–ò–ï

### 1. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_symbol_precision()` –≤ `exchange_api.py`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é:**

```python
precision_map = {
    # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–Ω–µ—Ç—ã (2 –∑–Ω–∞–∫–∞)
    'BTCUSDT': 2,    # 186.47
    'ETHUSDT': 2,    # 3245.67
    'BNBUSDT': 2,    # 245.89
    'LTCUSDT': 2,    # 67.89

    # –ú–æ–Ω–µ—Ç—ã —Å 3 –∑–Ω–∞–∫–∞–º–∏
    'SOLUSDT': 3,    # 98.456
    'UNIUSDT': 3,    # 8.456
    'ATOMUSDT': 3,   # 9.234
    'ETCUSDT': 3,    # 23.456
    'AVAXUSDT': 3,   # 32.456

    # –ú–æ–Ω–µ—Ç—ã —Å 4 –∑–Ω–∞–∫–∞–º–∏
    'XRPUSDT': 4,    # 0.5432
    'ADAUSDT': 4,    # 0.4321
    'LINKUSDT': 4,   # 15.4321
    'TONUSDT': 4,    # 2.3456
    'MATICUSDT': 4,  # 0.8765
    'DOTUSDT': 4,    # 7.2345
    'FILUSDT': 4,    # 5.4321
    'NEARUSDT': 4,   # 3.4567
    'APTUSDT': 4,    # 8.7654
    'OPUSDT': 4,     # 2.3456

    # –ú–æ–Ω–µ—Ç—ã —Å 5 –∑–Ω–∞–∫–∞–º–∏
    'TOWNUSDT': 5,   # 0.02716
    'ENAUSDT': 5,    # 0.64980
    'JUPUSDT': 5,    # 0.87654
    'WIFUSDT': 5,    # 2.34567

    # –ú–µ–º–∫–æ–∏–Ω—ã —Å 6 –∑–Ω–∞–∫–∞–º–∏
    'DOGEUSDT': 6,   # 0.078456
    'PEPEUSDT': 6,   # 0.000123
    'SHIBUSDT': 6,   # 0.000023
    'FLOKIUSDT': 6,  # 0.000045
    'PENGUUSDT': 6,  # 0.000078
    'BONKUSDT': 6,   # 0.000123
    'MEMEUSDT': 6,   # 0.000045
    'BOMEUSDT': 6,   # 0.000078
}
```

**–£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
```python
# –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö USDT –ø–∞—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
if any(high_precision in symbol for high_precision in ['PENGU', 'SHIB', 'DOGE', 'PEPE', 'FLOKI', 'BONK', 'MEME', 'BOME']):
    return 6  # –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –º–µ–º–∫–æ–∏–Ω–æ–≤
elif any(mid_precision in symbol for mid_precision in ['XRP', 'ADA', 'DOT', 'LINK', 'TOWN', 'ENA', 'JUP', 'WIF']):
    return 4  # –°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å
elif any(low_precision in symbol for low_precision in ['SOL', 'UNI', 'ATOM', 'ETC', 'AVAX']):
    return 3  # –ù–∏–∑–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
else:
    return 2  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_dynamic_price_precision()` –≤ `exchange_api.py`

```python
async def get_dynamic_price_precision(symbol):
    """
    –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Ü–µ–Ω—ã –¥–ª—è —Å–∏–º–≤–æ–ª–∞ —Å –±–∏—Ä–∂–∏
    """
    try:
        symbol_info = await get_symbol_info(symbol)
        return symbol_info.get("price_precision", 2)
    except Exception as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è {symbol}: {e}")
        # Fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é
        return get_symbol_precision(symbol)
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safe_format_price()` –≤ `signal_live.py`

```python
def safe_format_price(price, symbol):
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ
    """
    if price is None or pd.isna(price):
        return 'N/A'

    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º —Å–ª–æ–≤–∞—Ä–µ–º
        from exchange_api import get_symbol_precision
        precision = get_symbol_precision(symbol)
        return f"{price:.{precision}f}"

    except (ValueError, TypeError):
        try:
            # Fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 5 –∑–Ω–∞–∫–∞–º–∏
            return f"{price:.5f}"
        except (ValueError, TypeError):
            return 'N/A'
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safe_format_price()` –≤ `telegram_bot.py`

```python
def safe_format_price(price, symbol=None):
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ
    """
    if price is None or pd.isna(price):
        return 'N/A'

    try:
        if symbol is None:
            return f"{price:.5f}"  # Fallback –¥–ª—è —Å–ª—É—á–∞–µ–≤ –±–µ–∑ —Å–∏–º–≤–æ–ª–∞

        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
        from exchange_api import get_symbol_precision
        precision = get_symbol_precision(symbol)
        return f"{price:.{precision}f}"

    except (ValueError, TypeError):
        try:
            # Fallback —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 5 –∑–Ω–∞–∫–∞–º–∏
            return f"{price:.5f}"
        except (ValueError, TypeError):
            return 'N/A'
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test_price_precision_simple.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```
ü™ô BTCUSDT:
   –¶–µ–Ω–∞: 186.47
   –¢–æ—á–Ω–æ—Å—Ç—å: 2
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 186.47

ü™ô SOLUSDT:
   –¶–µ–Ω–∞: 98.456
   –¢–æ—á–Ω–æ—Å—Ç—å: 3
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 98.456

ü™ô XRPUSDT:
   –¶–µ–Ω–∞: 0.5432
   –¢–æ—á–Ω–æ—Å—Ç—å: 4
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 0.5432

ü™ô DOGEUSDT:
   –¶–µ–Ω–∞: 0.078456
   –¢–æ—á–Ω–æ—Å—Ç—å: 6
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 0.078456

ü™ô PENGUUSDT:
   –¶–µ–Ω–∞: 7.8e-05
   –¢–æ—á–Ω–æ—Å—Ç—å: 6
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 0.000078

ü™ô TOWNUSDT:
   –¶–µ–Ω–∞: 0.02716
   –¢–æ—á–Ω–æ—Å—Ç—å: 5
   –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞: 0.02716
```

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å —Ü–µ–Ω** - —Ç–µ–ø–µ—Ä—å —Ü–µ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–Ω–∞–∫–æ–≤
2. **‚úÖ –ù–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–Ω–µ—Ç
3. **‚úÖ Fallback —Å–∏—Å—Ç–µ–º–∞** - –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
4. **‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **üéØ –¢–æ—á–Ω–æ—Å—Ç—å** - —Ü–µ–Ω—ã —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –±–∏—Ä–∂–µ–≤—ã–º
- **üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- **üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–Ω–µ—Ç—ã

## üìÅ –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. **`exchange_api.py`**
   - –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_symbol_precision()`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_dynamic_price_precision()`

2. **`signal_live.py`**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safe_format_price()`
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

3. **`telegram_bot.py`**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safe_format_price()`

4. **`test_price_precision_simple.py`** (–Ω–æ–≤—ã–π)
   - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã

## üöÄ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–µ–∑–∞–Ω–∏–µ–º —Ü–µ–Ω –≤ —Å–∏–≥–Ω–∞–ª–∞—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å:

- **BTCUSDT** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `186.47` (2 –∑–Ω–∞–∫–∞)
- **SOLUSDT** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `98.456` (3 –∑–Ω–∞–∫–∞)
- **XRPUSDT** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `0.5432` (4 –∑–Ω–∞–∫–∞)
- **DOGEUSDT** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `0.078456` (6 –∑–Ω–∞–∫–æ–≤)
- **PENGUUSDT** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `0.000078` (6 –∑–Ω–∞–∫–æ–≤)

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ü–µ–Ω—ã —Ç–æ—á–Ω–æ –∫–∞–∫ –Ω–∞ –±–∏—Ä–∂–µ! üéâ
