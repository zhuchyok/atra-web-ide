# üë• –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø: –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∏—Å–∫–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1. **–†–∞—Å—à–∏—Ä–µ–Ω CorrelationRiskManager**

**–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã:**

#### `check_portfolio_correlation_risk()`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π —Ä–∏—Å–∫ –ø–æ—Ä—Ç—Ñ–µ–ª—è –∫ SOL
- –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω—é—é –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞ (LOW/MEDIUM/HIGH/CRITICAL)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'correlation_to_sol': float,      # –°—Ä–µ–¥–Ω—è—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∫ SOL
    'sol_positions_count': int,        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–π –≤ SOL_HIGH
    'risk_level': str,                 # –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞
    'alerts': List[str],               # –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
    'timestamp': int                   # –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
}
```

#### `calculate_dynamic_limit()`
- –í—ã—á–∏—Å–ª—è–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ª–∏–º–∏—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (>0.15) ‚Üí —É–º–µ–Ω—å—à–∞–µ—Ç –ª–∏–º–∏—Ç –¥–æ 60%
- –ù–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å (<0.05) ‚Üí –ø–æ–ª–Ω—ã–π –ª–∏–º–∏—Ç
- –°—Ä–µ–¥–Ω—è—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí 80% –ª–∏–º–∏—Ç–∞

#### `get_risk_alerts()`
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–ª–µ—Ä—Ç–æ–≤ –ø–æ —Ä–∏—Å–∫–∞–º
- –£—Ä–æ–≤–Ω–∏: CRITICAL, WARNING, INFO, ERROR
- –¢–∏–ø—ã: CORRELATION, CONCENTRATION, PORTFOLIO, SYSTEM

### 2. **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**

**`scripts/monitor_portfolio_risk.py`**

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ JSON –æ—Ç—á–µ—Ç–æ–≤ –≤ `data/reports/`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤
- Exit code 1 –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–∞—Ö

**–ü–æ—Ä–æ–≥–∏:**
```python
ALERT_THRESHOLDS = {
    "max_sol_positions": 8,           # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ 8+ –ø–æ–∑–∏—Ü–∏—è—Ö
    "max_concurrent_loss": 5,         # –ê–ª–µ—Ä—Ç –ø—Ä–∏ 5+ —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö
    "max_drawdown": 12.0,             # –ê–ª–µ—Ä—Ç –ø—Ä–∏ –ø—Ä–æ—Å–∞–¥–∫–µ >12%
    "sol_correlation": 0.85,          # –ê–ª–µ—Ä—Ç –ø—Ä–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ >0.85
    "critical_correlation": 0.9       # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç –ø—Ä–∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ >0.9
}
```

## üìä –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```bash
# –†–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python3 scripts/monitor_portfolio_risk.py

# –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
*/30 * * * * cd /path/to/atra && python3 scripts/monitor_portfolio_risk.py >> logs/risk_monitor.log 2>&1
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
================================================================================
üìä –û–¢–ß–ï–¢ –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –†–ò–°–ö–û–í –ü–û–†–¢–§–ï–õ–Ø
================================================================================
–í—Ä–µ–º—è: 2024-11-14T12:00:00

üìà –û–°–ù–û–í–ù–´–ï –ú–ï–¢–†–ò–ö–ò:
  –ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤: 7
  –ü–æ–∑–∏—Ü–∏–π –≤ SOL_HIGH: 7
  –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –∫ SOL: 0.82
  –£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: MEDIUM

‚ö†Ô∏è –ê–õ–ï–†–¢–´:
  ‚ö†Ô∏è [WARNING] –í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è: 0.82 –∫ SOL
     ‚Üí MONITOR: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

üéØ –ü–†–û–í–ï–†–ö–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ò–• –ü–û–†–û–ì–û–í:
  ‚úÖ –ü–æ–∑–∏—Ü–∏–π SOL_HIGH: 7 < 8 (–≤ –Ω–æ—Ä–º–µ)
  ‚ö†Ô∏è –í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è: 0.820 >= 0.85 (–ø–æ—Ä–æ–≥)
================================================================================
```

## üîÑ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–î–µ–Ω—å 0-7):

1. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏** - –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
2. ‚è≥ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ signal_live.py** - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
3. ‚è≥ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫** - –û–∂–∏–¥–∞–µ—Ç
4. ‚è≥ **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–∞—Ö** - –û–∂–∏–¥–∞–µ—Ç

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–î–µ–Ω—å 8-30):

1. ‚è≥ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏** - –ú–µ—Ç–æ–¥ –≥–æ—Ç–æ–≤, –Ω—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
2. ‚è≥ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —Ä–∏—Å–∫–æ–≤** - –û–∂–∏–¥–∞–µ—Ç
3. ‚è≥ **–î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ—Ä—Ç—Ñ–µ–ª—è** - –û–∂–∏–¥–∞–µ—Ç

## üìù –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –í signal_live.py

**–ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**

1. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ `check_portfolio_correlation_risk()` (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö
4. Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:**

```python
# –í signal_live.py –¥–æ–±–∞–≤–∏—Ç—å:

async def periodic_risk_check():
    """–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∏—Å–∫–æ–≤ –ø–æ—Ä—Ç—Ñ–µ–ª—è"""
    while True:
        try:
            if correlation_manager:
                portfolio_risk = await correlation_manager.check_portfolio_correlation_risk()
                alerts = await correlation_manager.get_risk_alerts()
                
                # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã ‚Üí –ª–æ–≥–∏—Ä—É–µ–º –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º
                critical = [a for a in alerts if a['level'] == 'CRITICAL']
                if critical:
                    logger.warning("üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò –ü–û–†–¢–§–ï–õ–Ø:")
                    for alert in critical:
                        logger.warning("  %s", alert['message'])
                        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
                
        except Exception as e:
            logger.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∏—Å–∫–æ–≤: %s", e)
        
        await asyncio.sleep(1800)  # 30 –º–∏–Ω—É—Ç
```

## ‚úÖ –°–¢–ê–¢–£–°

- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ –≥–æ—Ç–æ–≤–∞
- ‚úÖ –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–∑–¥–∞–Ω
- ‚è≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ signal_live.py - –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
- ‚è≥ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è - –æ–∂–∏–¥–∞–µ—Ç

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üöÄ

