# üõ†Ô∏è –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –ó–ê–ö–†–´–¢–ò–ï–ú –ü–û–ó–ò–¶–ò–ô –ù–ê 50%

## üìã **–ü–†–û–ë–õ–ï–ú–ê**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª, —á—Ç–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "üí∞ –ó–∞–∫—Ä—ã—Ç—å 50%" –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ –Ω–∞ 50% –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è.

## üîç **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´**

### **–ù–∞–π–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:**

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –ª–æ–≥–∏–∫–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —á–∏—Å–µ–ª —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `close_position`:

```python
# –ü–†–û–ë–õ–ï–ú–ù–ê–Ø –õ–û–ì–ò–ö–ê (–±—ã–ª–æ):
if actual_qty >= qty:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å—é –ø–æ–∑–∏—Ü–∏—é
    open_positions = [p for p in open_positions if p["symbol"] != symbol]
else:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
    remaining_qty = qty - actual_qty
    pos["qty"] = remaining_qty
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ 50% –ø–æ–∑–∏—Ü–∏–∏, `actual_qty = qty / 2`. –ò–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —á–∏—Å–µ–ª —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π, —É—Å–ª–æ–≤–∏–µ `actual_qty >= qty` –º–æ–≥–ª–æ –±—ã—Ç—å –∏—Å—Ç–∏–Ω–Ω—ã–º, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∑–∞–∫—Ä—ã—Ç–∏—é –≤—Å–µ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–º–µ—Å—Ç–æ 50%.

## ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π**
**–§–∞–π–ª:** `telegram_bot.py` (—Å—Ç—Ä–æ–∫–∞ ~1850)

**–ë—ã–ª–æ:**
```python
if actual_qty >= qty:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å—é –ø–æ–∑–∏—Ü–∏—é
    open_positions = [p for p in open_positions if p["symbol"] != symbol]
else:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
    remaining_qty = qty - actual_qty
    pos["qty"] = remaining_qty
```

**–°—Ç–∞–ª–æ:**
```python
if close_qty == "all" or actual_qty >= qty * 0.999:  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–±–æ–ª—å—à–æ–π –¥–æ–ø—É—Å–∫ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è float
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å—é –ø–æ–∑–∏—Ü–∏—é
    open_positions = [p for p in open_positions if p["symbol"] != symbol]
    print(f"[button] –ó–∞–∫—Ä—ã—Ç–∞ –≤—Å—è –ø–æ–∑–∏—Ü–∏—è {symbol}: {actual_qty:.6f} –∏–∑ {qty:.6f}")
else:
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
    remaining_qty = qty - actual_qty
    pos["qty"] = remaining_qty
    print(f"[button] –ó–∞–∫—Ä—ã—Ç–∞ —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ {symbol}: {actual_qty:.6f} –∏–∑ {qty:.6f}, –æ—Å—Ç–∞–ª–æ—Å—å {remaining_qty:.6f}")
```

### **2. –£–ª—É—á—à–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏**
**–§–∞–π–ª:** `telegram_bot.py` (—Å—Ç—Ä–æ–∫–∞ ~1920)

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–∫—Ä—ã—Ç–∏—è
if close_qty == "all" or actual_qty >= qty * 0.999:
    close_type = "–í–°–Ø –ü–û–ó–ò–¶–ò–Ø"
elif close_qty == "half":
    close_type = "50% –ü–û–ó–ò–¶–ò–ò"
else:
    close_type = f"–ß–ê–°–¢–¨ –ü–û–ó–ò–¶–ò–ò ({actual_qty/qty*100:.1f}%)"

msg = (
    f"{profit_emoji} *{close_type}*\n\n"
    f"–°–ò–ú–í–û–õ: {symbol}\n"
    f"–°—Ç–æ—Ä–æ–Ω–∞: {side.upper()}\n"
    f"–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: {fmt.format(entry_price)}\n"
    f"–¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: {fmt.format(close_price)}\n"
    f"–ó–∞–∫—Ä—ã—Ç–æ: {actual_qty:.4f} –∏–∑ {qty:.4f}\n"
    f"–ü—Ä–∏–±—ã–ª—å: {profit:.2f} USDT\n"
    f"–†–µ–∂–∏–º: {user_data.get('trade_mode', 'spot').upper()}"
)
```

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**

### **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏:**

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏–ª —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ–π –ø–æ–∑–∏—Ü–∏–∏ (`close_qty = "all"`)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ 50% –ø–æ–∑–∏—Ü–∏–∏ (`close_qty = "half"`)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ 30% –ø–æ–∑–∏—Ü–∏–∏ (`close_qty = "0.3"`)
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ 70% –ø–æ–∑–∏—Ü–∏–∏ (`close_qty = "0.7"`)

### **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```
==================================================
üìã –ó–∞–∫—Ä—ã—Ç–∏–µ 50% –ø–æ–∑–∏—Ü–∏–∏
==================================================
–ó–∞–∫—Ä—ã–≤–∞–µ–º: 0.005132
–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –ø–æ–∑–∏—Ü–∏–∏: 50.0%
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ß–ê–°–¢–¨ –ü–û–ó–ò–¶–ò–ò
   –û—Å—Ç–∞—Ç–æ–∫: 0.005132
   –¢–æ—á–Ω–æ—Å—Ç—å: 0.000000%
   ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ
```

**–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!**

## üìä **–õ–û–ì–ò –†–ê–ë–û–¢–´**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
[button] –ó–∞–∫—Ä—ã—Ç–∞ –≤—Å—è –ø–æ–∑–∏—Ü–∏—è ETHUSDT: 0.005132 –∏–∑ 0.010263
```

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```
[button] –ó–∞–∫—Ä—ã—Ç–∞ —á–∞—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏ ETHUSDT: 0.005132 –∏–∑ 0.010263, –æ—Å—Ç–∞–ª–æ—Å—å 0.005132
```

## üéØ **–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢**

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–ö–Ω–æ–ø–∫–∞ "üí∞ –ó–∞–∫—Ä—ã—Ç—å 50%"** —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ 50% –ø–æ–∑–∏—Ü–∏–∏
2. **–ö–Ω–æ–ø–∫–∞ "üî¥ –ó–∞–∫—Ä—ã—Ç—å"** –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å—é –ø–æ–∑–∏—Ü–∏—é
3. **–°–æ–æ–±—â–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏** —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ—á–Ω—ã–π —Ç–∏–ø –∑–∞–∫—Ä—ã—Ç–∏—è:
   - "–ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–¢–ê 50%" –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–ª–æ–≤–∏–Ω—ã
   - "–ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–¢–ê" –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
   - "–ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–¢–ê XX.X%" –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤
4. **–î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π

## üîß **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø**

1. **–û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é:** –ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª —á–µ—Ä–µ–∑ –±–æ—Ç–∞
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏:** `/positions`
3. **–ó–∞–∫—Ä—ã—Ç—å 50%:** –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üí∞ –ó–∞–∫—Ä—ã—Ç—å 50%" –≤ —Å–ø–∏—Å–∫–µ –ø–æ–∑–∏—Ü–∏–π
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–Ω–æ–≤–∞ –≤—ã–∑–≤–∞—Ç—å `/positions` - –ø–æ–∑–∏—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è, –Ω–æ —Å —É–º–µ–Ω—å—à–µ–Ω–Ω—ã–º –æ–±—ä–µ–º–æ–º
5. **–ó–∞–∫—Ä—ã—Ç—å –æ—Å—Ç–∞–≤—à—É—é—Å—è —á–∞—Å—Ç—å:** –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üî¥ –ó–∞–∫—Ä—ã—Ç—å" –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

## üìù **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π –Ω–∞ 50% –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞. –û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:

**–û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è** - –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —á–∏—Å–µ–ª —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π, —É—Å–ª–æ–≤–∏–µ `actual_qty >= qty` –º–æ–≥–ª–æ –±—ã—Ç—å –∏—Å—Ç–∏–Ω–Ω—ã–º –¥–∞–∂–µ –¥–ª—è 50% –ø–æ–∑–∏—Ü–∏–∏.

–í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç:
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ 50% –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –¢–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω—É—é —Ä–∞–±–æ—Ç—É —Å —á–∏—Å–ª–∞–º–∏ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**