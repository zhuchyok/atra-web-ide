# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∏ TP2

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ **–ù–ï –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞. –§—É–Ω–∫—Ü–∏—è `check_take_profits()` —Ç–æ–ª—å–∫–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –Ω–æ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–∞ –ø–æ–∑–∏—Ü–∏–∏.

## ‚ùå –ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- –ü–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ë–∞–ª–∞–Ω—Å –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª—Å—è
- –°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è
- –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –ø–µ—Ä–µ–º–µ—â–∞–ª–∏—Å—å –≤ –∏—Å—Ç–æ—Ä–∏—é —Å–¥–µ–ª–æ–∫

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ TP2
**–ë—ã–ª–æ:**
```python
# –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞–¥–∏—é –ø–æ–∑–∏—Ü–∏–∏
pos['stage'] = 'tp2_reached'

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
msg = f"‚úÖ –ü–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP"
await notify_user(int(user_id), msg)
```

**–°—Ç–∞–ª–æ:**
```python
# –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –ó–ê–ö–†–´–¢–ò–ï –ü–û–ó–ò–¶–ò–ò –ü–†–ò TP2
# –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫–∞–∫ –∑–∞–∫—Ä—ã—Ç—É—é
pos['stage'] = 'closed'
pos['exit_price'] = tp2
pos['exit_time'] = get_msk_now().strftime("%Y-%m-%dT%H:%M:%S")
pos['profit'] = profit

# –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏—é
trade_history = user_data.get('trade_history', [])
trade_history.append(pos.copy())
user_data['trade_history'] = trade_history

# –£–¥–∞–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö
open_positions.remove(pos)

# –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
total_profit = user_data.get('total_profit', 0) + profit
user_data['total_profit'] = total_profit

# –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç
deposit = user_data.get('deposit', 0)
free_deposit = deposit + total_profit
user_data['free_deposit'] = free_deposit

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
msg = f"‚úÖ –ü–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç–∞!"
await notify_user(int(user_id), msg)
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç get_msk_now
```python
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º get_msk_now –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
from utils import get_msk_now
```

## üîß –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP2:

### 1. **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏:**
- –°—Ç–∞–¥–∏—è –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `'closed'`
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω–∞ –≤—ã—Ö–æ–¥–∞ (`exit_price`)
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è (`exit_time`)
- –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–±—ã–ª—å (`profit`)

### 2. **–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é:**
- –ü–æ–∑–∏—Ü–∏—è –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ `trade_history`
- –£–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ `open_positions`

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `total_profit`
- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è `free_deposit`

### 4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç–∞!"

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é
- ‚úÖ –ü–æ–∑–∏—Ü–∏—è —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –ø—Ä–æ—Ñ–∏—Ç–∞
- ‚úÖ –ü–µ—Ä–µ—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- ‚úÖ –°—Ç–∞–¥–∏—è –ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –Ω–∞ 'closed'
- ‚úÖ –í—Ä–µ–º—è –∑–∞–∫—Ä—ã—Ç–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è
- ‚úÖ –¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –ò–º–ø–æ—Ä—Ç get_msk_now –¥–æ–±–∞–≤–ª–µ–Ω

## üéâ –ò—Ç–æ–≥
–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
- **–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP1** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, —Å—Ç–∞–¥–∏—è –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `tp1_reached`
- **–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ TP2** - –ø–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å
- **–í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è** - –±–∞–ª–∞–Ω—Å, –¥–µ–ø–æ–∑–∏—Ç, –æ—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ–∑–∏—Ü–∏–∏
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ** –æ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

**–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å!** üéØ –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
