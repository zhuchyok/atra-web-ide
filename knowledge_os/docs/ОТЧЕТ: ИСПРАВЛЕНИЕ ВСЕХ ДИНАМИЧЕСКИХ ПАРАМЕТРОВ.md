# –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–°–ï–• –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–• –ü–ê–†–ê–ú–ï–¢–†–û–í

## üö® –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª: "–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É–Ω–∫—Ç—ã —Ç–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—å —Ç–µ–π–∫ –ø–æ—Ñ–∏—Ç—ã —Ä–∏—Å–∫–∏ –ø–ª–µ—á–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ" - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: +1% –∏ +2% –¥–ª—è LONG, -1% –∏ -2% –¥–ª—è SHORT
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞ –∏ –ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞

2. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏**
   - –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –æ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥

3. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏**
   - –ü–ª–µ—á–æ –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π**
   - –í —Ñ—É–Ω–∫—Ü–∏–∏ `button` –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª–∞—Å—å –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

## üîß –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
if side == "long":
    tp1 = current_price * 1.01  # +1%
    tp2 = current_price * 1.02  # +2%
else:
    tp1 = current_price * 0.99  # -1%
    tp2 = current_price * 0.98  # -2%
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–≤–Ω–∏ TP
dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, len(df) - 1, side)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏
if side == "long":
    tp1 = current_price * (1 + dynamic_tp1_pct / 100)
    tp2 = current_price * (1 + dynamic_tp2_pct / 100)
else:
    tp1 = current_price * (1 - dynamic_tp1_pct / 100)
    tp2 = current_price * (1 - dynamic_tp2_pct / 100)
```

### 2. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
risk_amount = free_deposit * risk_pct / 100
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫
dynamic_risk_pct = get_dynamic_risk_pct(df, len(df) - 1)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º
risk_amount = free_deposit * dynamic_risk_pct / 100
```

### 3. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
qty = risk_amount / current_price if current_price > 0 else 0
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ
dynamic_leverage = get_dynamic_leverage(df, len(df) - 1, leverage)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∏—Å–∫–∞ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–µ—á–∞
if trade_mode == "futures" and dynamic_leverage > 1:
    qty = risk_amount / current_price * dynamic_leverage
else:
    qty = risk_amount / current_price if current_price > 0 else 0
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏
```python
new_position = {
    "symbol": symbol,
    "entry_price": current_price,
    "tp1": tp1,
    "tp2": tp2,
    "qty": qty,
    "stage": "open",
    "risk_amount": risk_amount,
    "risk_pct": dynamic_risk_pct,        # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫
    "leverage": dynamic_leverage,        # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ
    "side": side,
    "tp1_pct": dynamic_tp1_pct,         # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP
    "tp2_pct": dynamic_tp2_pct,         # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP
}
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **`get_dynamic_tp_levels`** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Ä—ã–Ω–∫–∞
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
   - –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ç—Ä–µ–Ω–¥—É

2. **`get_dynamic_risk_pct`** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
   - –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ç—Ä–µ–Ω–¥—É
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω –æ—Ç 1% –¥–æ 5%

3. **`get_dynamic_leverage`** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
   - –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ç—Ä–µ–Ω–¥—É
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –æ—Ç 0.5x –¥–æ 20x

### üìà –ü—Ä–∏–º–µ—Ä –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:

**–†—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è:** –í—ã—Å–æ–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –≤–æ—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–µ–Ω–¥
**–ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:** –†–∏—Å–∫ 2%, –ü–ª–µ—á–æ 3x, TP1 1%, TP2 2%

**–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫: 3.5% (—É–≤–µ–ª–∏—á–µ–Ω –∏–∑-–∑–∞ —Ç—Ä–µ–Ω–¥–∞)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ: 4x (—É–≤–µ–ª–∏—á–µ–Ω–æ –∏–∑-–∑–∞ —Ç—Ä–µ–Ω–¥–∞)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP: TP1 2.5%, TP2 4.8% (—É–≤–µ–ª–∏—á–µ–Ω—ã –∏–∑-–∑–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)

## üß™ –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ñ–∞–π–ª–∞:
```bash
python3 -m py_compile telegram_bot.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ (exit code: 0)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ BB
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```bash
python3 main.py
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" –≤ —Å–∏–≥–Ω–∞–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –∫–∞–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∞—Ü–∏—é –∫ —Ä–∞–∑–Ω—ã–º —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

- [x] –§—É–Ω–∫—Ü–∏—è button –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥
- [x] –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- [ ] –ê–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä–∞–∑–Ω—ã–º —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º (—Ç—Ä–µ–±—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)

## üéâ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥—É
- ‚úÖ –†–∏—Å–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä—ã–Ω–æ—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
- ‚úÖ –ü–ª–µ—á–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Ç–µ–∫—É—â–∏–µ —É—Å–ª–æ–≤–∏—è
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±–æ–ª–µ–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **`get_dynamic_tp_levels(df, i, side)`**:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 —Å–≤–µ—á–µ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
   - –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ BB –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö TP

2. **`get_dynamic_risk_pct(df, i)`**:
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
   - –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

3. **`get_dynamic_leverage(df, i, base_leverage)`**:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
   - –£–º–µ–Ω—å—à–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
```python
try:
    dynamic_risk_pct = get_dynamic_risk_pct(df, len(df) - 1)
    dynamic_leverage = get_dynamic_leverage(df, len(df) - 1, leverage)
    dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, len(df) - 1, side)
except Exception as e:
    # Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    dynamic_risk_pct = risk_pct
    dynamic_leverage = leverage
    dynamic_tp1_pct, dynamic_tp2_pct = 1.0, 2.0
```

---
**–î–∞—Ç–∞:** 20.08.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ò–°–ü–†–ê–í–õ–ï–ù–´
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–• –ü–ê–†–ê–ú–ï–¢–†–û–í
