# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã positions

## –ü—Ä–æ–±–ª–µ–º–∞
–í –∫–æ–º–∞–Ω–¥–µ `/positions` –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –∏–º–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

## –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª** - –∫–æ–¥ –ø—ã—Ç–∞–ª—Å—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å `entry_price`, `tp1`, `tp2` –∫–∞–∫ —á–∏—Å–ª–∞ —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é, –Ω–æ –µ—Å–ª–∏ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–≤–Ω—ã 0 –∏–ª–∏ None, —Ç–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ
2. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç P&L** - –µ—Å–ª–∏ `entry_price` —Ä–∞–≤–µ–Ω 0 –∏–ª–∏ None, —Ç–æ —Ä–∞—Å—á–µ—Ç P&L –ø—Ä–∏–≤–æ–¥–∏–ª –∫ –æ—à–∏–±–∫–∞–º
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** - –Ω–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ None –∏ 0 –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
4. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø–ª–µ—á–∞** - –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å "–ü–ª–µ—á–æ: xNone" –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–ª–µ—á–æ –≤–æ–æ–±—â–µ

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ë—ã–ª–æ:**
```python
entry_price = pos.get("entry_price", 0)
tp1 = pos.get("tp1", 0)
tp2 = pos.get("tp2", 0)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
price_precision = 8
fmt = f"{{:.{price_precision}f}}"

msg = (
    f"–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: <code>{fmt.format(entry_price)}</code>\n"
    f"TP1: <code>{fmt.format(tp1)}</code>\n"
    f"TP2: <code>{fmt.format(tp2)}</code>\n"
)
```

**–°—Ç–∞–ª–æ:**
```python
entry_price = pos.get("entry_price")
tp1 = pos.get("tp1")
tp2 = pos.get("tp2")

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞
if entry_price is not None and entry_price > 0:
    msg += f"–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: <code>{entry_price:.6f}</code>\n"
else:
    msg += f"–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: <code>–û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞</code>\n"

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TP1
if tp1 is not None and tp1 > 0:
    msg += f"TP1: <code>{tp1:.6f}</code> ({'+' if side == 'long' else '-'}1.0%)\n"
else:
    msg += f"TP1: <code>–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</code>\n"

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TP2
if tp2 is not None and tp2 > 0:
    msg += f"TP2: <code>{tp2:.6f}</code> ({'+' if side == 'long' else '-'}2.0%)\n"
else:
    msg += f"TP2: <code>–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</code>\n"
```

### 2. –£–ª—É—á—à–µ–Ω —Ä–∞—Å—á–µ—Ç P&L

**–ë—ã–ª–æ:**
```python
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º P&L
pnl = (
    (current_price - entry_price) * qty if side == "long"
    else (entry_price - current_price) * qty
)
total_pnl += pnl

# –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
pnl_percent = ((current_price - entry_price) / entry_price * 100) if side == "long" else ((entry_price - current_price) / entry_price * 100)
```

**–°—Ç–∞–ª–æ:**
```python
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º P&L —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ —Ü–µ–Ω—ã
pnl = 0
pnl_percent = 0

if entry_price is not None and entry_price > 0 and current_price is not None and current_price > 0 and qty > 0:
    pnl = (
        (current_price - entry_price) * qty if side == "long"
        else (entry_price - current_price) * qty
    )
    pnl_percent = ((current_price - entry_price) / entry_price * 100) if side == "long" else ((entry_price - current_price) / entry_price * 100)

total_pnl += pnl
```

### 3. –£–ª—É—á—à–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–µ—á–∞

**–ë—ã–ª–æ:**
```python
if user_data.get('trade_mode') == 'futures':
    leverage = pos.get('leverage', 1)
    msg += f"\n–ü–ª–µ—á–æ: x{leverage}"
```

**–°—Ç–∞–ª–æ:**
```python
if user_data.get('trade_mode') == 'futures':
    leverage = pos.get('leverage')
    if leverage:
        msg += f"\n–ü–ª–µ—á–æ: x{leverage}"
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã

**–ë—ã–ª–æ:**
```python
current_price = pos.get("entry_price", 0)

# –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
try:
    from ohlc_utils import get_ohlc_binance_sync
    ohlc = get_ohlc_binance_sync(symbol, interval="1m", limit=1)
    if ohlc and len(ohlc) > 0:
        current_price = ohlc[-1]["close"]
except Exception as e:
    print(f"[positions_cmd] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è {symbol}: {e}")
```

**–°—Ç–∞–ª–æ:**
```python
current_price = entry_price

# –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
if entry_price is not None and entry_price > 0:
    try:
        from ohlc_utils import get_ohlc_binance_sync
        ohlc = get_ohlc_binance_sync(symbol, interval="1m", limit=1)
        if ohlc and len(ohlc) > 0:
            current_price = ohlc[-1]["close"]
    except Exception as e:
        print(f"[positions_cmd] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è {symbol}: {e}")
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ü–µ–Ω—É –≤—Ö–æ–¥–∞ –∫–∞–∫ fallback
        current_price = entry_price
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤ positions:

**–ü–æ–∑–∏—Ü–∏—è —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:**
```
üü¢ BTCUSDT (LONG)

–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 45000.000000
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 117893.960000
–û–±—ä—ë–º: 0.0010
P&L: 72.89 USDT (+161.99%)
TP1: 46000.000000 (+1.0%)
TP2: 47000.000000 (+2.0%)
–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: 0
–†–µ–∂–∏–º: FUTURES
–ü–ª–µ—á–æ: x1.5
```

**–ü–æ–∑–∏—Ü–∏—è —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:**
```
üü¢ ETHUSDT (SHORT)

–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: –û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞
–û–±—ä—ë–º: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
P&L: –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω
TP1: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
TP2: –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: 1
–†–µ–∂–∏–º: FUTURES
–ü–ª–µ—á–æ: x2.0
```

**–ü–æ–∑–∏—Ü–∏—è –±–µ–∑ –ø–ª–µ—á–∞:**
```
üü¢ SOLUSDT (LONG)

–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 100.000000
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 184.180000
–û–±—ä—ë–º: 1.0000
P&L: 84.18 USDT (+84.18%)
TP1: 105.000000 (+1.0%)
TP2: 110.000000 (+2.0%)
–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: 2
–†–µ–∂–∏–º: FUTURES
```

### –û–±—â–∞—è —Å–≤–æ–¥–∫–∞:
```
üìä –û–¢–ö–†–´–¢–´–ï –ü–û–ó–ò–¶–ò–ò

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 3
–û–±—â–∏–π P&L: 157.07 USDT
–†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏: FUTURES

üí° –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è:
‚Ä¢ /close all - –∑–∞–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
‚Ä¢ /close SYMBOL - –∑–∞–∫—Ä—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
‚Ä¢ /close SYMBOL PRICE - –∑–∞–∫—Ä—ã—Ç—å –ø–æ —Ü–µ–Ω–µ
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ (–æ–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏ —Ç.–¥.)
3. **–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç P&L** - P&L —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
4. **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º** - –∫–æ–¥ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∏ –Ω–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
6. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–µ—á–∞** - –ø–ª–µ—á–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–§—É–Ω–∫—Ü–∏—è –±—ã–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏:
- –ü–æ–∑–∏—Ü–∏–∏ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ü–æ–∑–∏—Ü–∏–∏ —Å —á–∞—Å—Ç–∏—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–±–µ–∑ —Ü–µ–Ω—ã –≤—Ö–æ–¥–∞, TP, –æ–±—ä–µ–º–∞)
- –ü–æ–∑–∏—Ü–∏–∏ –±–µ–∑ –ø–ª–µ—á–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π

–í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.