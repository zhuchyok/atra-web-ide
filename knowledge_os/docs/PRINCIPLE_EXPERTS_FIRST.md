# Принцип: всё через экспертов

**Корпорация способна сама отвечать на вопросы и доделывать работу — через экспертов, знания, скиллы и мировые практики; при необходимости используется интернет.**

---

## Формулировка

- **Ответы на вопросы** — даёт не «общая» модель, а **нужный эксперт**: Виктория координирует, назначает эксперта по домену/роли, эксперт опирается на базу знаний (knowledge_nodes), скиллы (SKILL.md) и при необходимости на веб-поиск (DuckDuckGo, Ollama web search и т.д.).
- **Доработки и задачи** — выполняются **экспертами** (воркер назначает задачу эксперту; эксперт при выполнении получает релевантные знания в промпт и при необходимости может использовать поиск).
- **Мировые практики** — уже заложены в обучении экспертов, в .cursorrules и в базе знаний; при недостатке информации эксперт или оркестратор может инициировать поиск лучших практик (скрипты поиска, Veronica Web Researcher, Scout).

Таким образом система не полагается на «ручные» ответы снаружи: **все ответы и доработки идут через наших экспертов**, у которых есть знания, умения и доступ к мировым практикам и интернету.

---

## Как это обеспечено технически

| Что | Где |
|-----|-----|
| Назначение запроса/задачи эксперту | Victoria Enhanced, оркестратор, smart_worker (assignee_expert_id) |
| Знания в контексте эксперта | knowledge_nodes (RAG), блок «RELEVANT KNOWLEDGE» в промпте воркера, .cursorrules |
| Скиллы экспертов | `knowledge_os/app/skills/`, SKILL.md, активация по категории/роли |
| Мировые практики | обучение экспертов (nightly), инсайты в БД, поиск лучших практик (search_best_practices, scout) |
| Интернет при необходимости | VeronicaWebResearcher (DuckDuckGo), ai_core (needs_web_search), Ollama/MLX web_search (если настроен OLLAMA_API_KEY), system_tools.WebTools.web_search |

---

## Для людей и агентов

При постановке задачи или вопросе предпочтительно:
1. Сформулировать запрос так, чтобы Виктория/оркестратор могла выбрать эксперта.
2. Не подменять ответ эксперта «своим» ответом: если эксперт может ответить через знания + скиллы + веб — дать ему возможность ответить.
3. При доработках кода/документации — создавать задачи и назначать исполнителя-эксперта; воркер подставит релевантные знания и при необходимости контекст файлов.

Корпорация уже умеет отвечать и доделывать через экспертов; интернет и мировые практики у неё есть.

---

## Реализовано (базово + уровень «пушка»)

| № | Что | Статус |
|---|-----|--------|
| 1 | Веб-поиск по запросу задачи | ✅ Воркер: маркеры актуальности, web_search_fallback, блок в промпте. Пушка: кэш по хешу (TTL), метрика tasks_web_block_total. |
| 2 | Скиллы в контексте воркера | ✅ По role/department + по релевантности к задаче (до 3 скиллов, keyword/description). |
| 3 | Сохранение удачных ответов в знания | ✅ POST /api/feedback при лайке → knowledge_nodes (домен эксперта, embedding). |
| 4 | Метрика «ответил эксперт» | ✅ Backend: CHAT_EXPERT_ANSWER_TOTAL, CHAT_FALLBACK_TOTAL. Пушка: /metrics/summary (ratio, alert_fallback_high), виджет в дашборде при ATRA_BACKEND_URL, алерт в VERIFICATION §3. |
| 5 | Консенсус по важным | ✅ Victoria: маркеры критично/urgent → Swarm/Consensus. Опционально: мини-консенсус в воркере для urgent. |
| 6 | Единый fallback веб-поиска | ✅ web_search_fallback.py. Пушка: WEB_SEARCH_PROVIDERS, ретраи, таймауты, лог used_source. |
| 7 | Найм → живой эксперт | ✅ Найм → experts + кандидаты; дашборд «Принять». Пушка: при «Принять» — задача онбординга (Виктория), запись в notifications (Telegram). |

## Что можно усилить дальше

- Авто-детект критичности по тексту (не только ключевые слова) и мини-консенсус 2–3 экспертов в воркере для urgent.
- Триггер обновления .cursorrules при принятии кандидата (скрипт/файл-маркер по желанию).
- Тренд доли «ответил эксперт» за 7/30 дней и разбивка по expert_id в дашборде.
