# –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –û–®–ò–ë–ö–ò 'USER_DATA_FILE referenced before assignment'

## üö® –ü–†–û–ë–õ–ï–ú–ê
**–û—à–∏–±–∫–∞**: `local variable 'USER_DATA_FILE' referenced before assignment` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `setup_trade_mode_spot`

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:
- –í —Ñ–∞–π–ª–µ `telegram_bot.py` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `USER_DATA_FILE` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ (—Å—Ç—Ä–æ–∫–∞ 93)
- –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –±—ã–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- –í —Ñ—É–Ω–∫—Ü–∏–∏ `button` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –≥–ª–æ–±–∞–ª—å–Ω–∞—è `USER_DATA_FILE` –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏—è `global`

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –∫–æ–¥:
```python
# –ì–ª–æ–±–∞–ª—å–Ω–æ
USER_DATA_FILE = "user_data.json"

# –í —Ñ—É–Ω–∫—Ü–∏–∏ button
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # –ù–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è global USER_DATA_FILE
    if os.path.isfile(USER_DATA_FILE):  # ‚ùå –û—à–∏–±–∫–∞ –∑–¥–µ—Å—å
        # ...
    elif action == "setup_trade_mode_spot":
        # –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö
        USER_DATA_FILE = "user_data.json"  # ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç
```

## üîß –í–ù–ï–°–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–§–∞–π–ª**: `telegram_bot.py`
**–§—É–Ω–∫—Ü–∏—è**: `button()`

```diff
async def button(update: Update, context: ContextTypes.DEFAULT_TYPE):
+   global USER_DATA_FILE
    import os
    import json
    query = update.callback_query
    user_id = query.from_user.id
```

### 2. –£–±—Ä–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–§–∞–π–ª**: `telegram_bot.py`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**: –ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

```diff
-               USER_DATA_FILE = "user_data.json"
+               # USER_DATA_FILE —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ

-       USER_DATA_FILE = "user_data.json"
+       # USER_DATA_FILE —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ
```

### 3. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

**–§–∞–π–ª**: `telegram_bot.py`
**–§—É–Ω–∫—Ü–∏—è**: `button()`

```diff
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ñ–∞–π–ª–∞
-   user_data_file = "user_data.json"
    user_data = {}

-   if os.path.isfile(user_data_file):
+   if os.path.isfile(USER_DATA_FILE):
        try:
-           with open(user_data_file, 'r', encoding='utf-8') as f:
+           with open(USER_DATA_FILE, 'r', encoding='utf-8') as f:
```

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- ‚ùå `local variable 'USER_DATA_FILE' referenced before assignment`
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∏ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
- ‚ùå –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö

### –£–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞

## üîç –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. **–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã**: –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
2. **–§—É–Ω–∫—Ü–∏—è button**: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. **–ö–æ–º–∞–Ω–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: `/set_trade_mode_spot` —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
python3 main.py

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥
/start
/set_balance 1000
# –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "SPOT" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
```

## üìä –°–¢–†–£–ö–¢–£–†–ê –ü–ï–†–ï–ú–ï–ù–ù–´–•

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ telegram_bot.py:
```python
USER_DATA_FILE = "user_data.json"          # –§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
FUTURES_FEE = 0.1                          # –ö–æ–º–∏—Å—Å–∏—è —Ñ—å—é—á–µ—Ä—Å–æ–≤
GLOBAL_RISK_LIMIT_PCT = 30                 # –õ–∏–º–∏—Ç —Ä–∏—Å–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è
```

### –§—É–Ω–∫—Ü–∏–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ USER_DATA_FILE:
- `button()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ (‚úÖ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- `save_user_data_to_file()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `load_user_data()` - –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏

## üõ†Ô∏è –õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò

### –î–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã—Ö –æ—à–∏–±–æ–∫:
1. **–û–±—ä—è–≤–ª—è–π—Ç–µ global** –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö
2. **–ò–∑–±–µ–≥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π** –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã** –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
4. **–ü—Ä–æ–≤–æ–¥–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```python
# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
USER_DATA_FILE = "user_data.json"

def some_function():
    global USER_DATA_FILE  # –û–±—ä—è–≤–ª—è–µ–º –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º
    with open(USER_DATA_FILE, 'r') as f:
        # —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ñ–∞–π–ª–æ–º
```

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –û—à–∏–±–∫–∏ `referenced before assignment` —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–æ–º–∞–Ω–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–î–∞—Ç–∞**: $(date)
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ‚è±Ô∏è 5 –º–∏–Ω—É—Ç
**–í–ª–∏—è–Ω–∏–µ**: üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï (–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥)
**–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
