# –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–ö–æ–º–∞–Ω–¥–∞ `/positions` –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞**: "–û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞" (–≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã)
- **–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞**: "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞" (–≤–º–µ—Å—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã —Å –±–∏—Ä–∂–∏)
- **–û–±—ä—ë–º**: "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" (–≤–º–µ—Å—Ç–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–º–∞)
- **TP1/TP2**: "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω" (–≤–º–µ—Å—Ç–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã—Ö take profit)

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã
–ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Å–∏–≥–Ω–∞–ª–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `button` –ø–æ–∑–∏—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —Å –ø—É—Å—Ç—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
```python
new_position = {
    "symbol": symbol,
    "entry_price": None,  # ‚Üê –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∞—Å—å —Ä–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
    "tp1": None,          # ‚Üê –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å TP
    "tp2": None,          # ‚Üê –ü—Ä–æ–±–ª–µ–º–∞: –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª–∏—Å—å TP
    "stage": "open",
    "risk_amount": risk_amount,
    "risk_pct": risk_pct,
    "leverage": leverage if trade_mode == "futures" else None,
    "side": side,
}
```

### –õ–æ–≥–∏–∫–∞ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **–ü—Ä–∏–Ω—è—Ç–∏–µ —Å–∏–≥–Ω–∞–ª–∞**: –ü–æ–∑–∏—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —Å `entry_price: None`
2. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π**: –§—É–Ω–∫—Ü–∏—è `positions_cmd` –Ω–µ –º–æ–≥–ª–∞ –ø–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í—Å–µ –ø–æ–ª—è –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ" –∏–ª–∏ "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ"

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `button`:

**–ë—ã–ª–æ:**
```python
new_position = {
    "symbol": symbol,
    "entry_price": None,
    "tp1": None,
    "tp2": None,
    "stage": "open",
    "risk_amount": risk_amount,
    "risk_pct": risk_pct,
    "leverage": leverage if trade_mode == "futures" else None,
    "side": side,
}
```

**–°—Ç–∞–ª–æ:**
```python
# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏
if trade_mode == "futures" and leverage:
    qty = risk_amount / entry_price
else:
    qty = risk_amount / entry_price

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º TP1 –∏ TP2
if side == "long":
    tp1 = entry_price * 1.01  # +1%
    tp2 = entry_price * 1.02  # +2%
else:  # short
    tp1 = entry_price * 0.99  # -1%
    tp2 = entry_price * 0.98  # -2%

new_position = {
    "symbol": symbol,
    "entry_price": entry_price,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Ü–µ–Ω—É
    "tp1": tp1,
    "tp2": tp2,
    "qty": qty,  # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–º
    "stage": "open",
    "risk_amount": risk_amount,
    "risk_pct": risk_pct,
    "leverage": leverage if trade_mode == "futures" else None,
    "side": side,
}
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–∞—Å—á–µ—Ç –æ–±—ä–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏:
```python
qty = risk_amount / entry_price
```
- **–î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤**: `risk_amount` —É–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–µ—á–æ
- **–î–ª—è —Å–ø–æ—Ç–∞**: `risk_amount` = —Å—É–º–º–∞ –≤—Ö–æ–¥–∞

### –†–∞—Å—á–µ—Ç Take Profit:
```python
# –î–ª—è LONG –ø–æ–∑–∏—Ü–∏–π:
tp1 = entry_price * 1.01  # +1%
tp2 = entry_price * 1.02  # +2%

# –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π:
tp1 = entry_price * 0.99  # -1%
tp2 = entry_price * 0.98  # -2%
```

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω:
–§—É–Ω–∫—Ü–∏—è `positions_cmd` —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã —Å –±–∏—Ä–∂–∏:
```python
from ohlc_utils import get_ohlc_binance_sync
ohlc = get_ohlc_binance_sync(symbol, interval="1m", limit=1)
if ohlc and len(ohlc) > 0:
    current_price = ohlc[-1]["close"]
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: "–û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞"
- ‚ùå –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: "–ù–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
- ‚ùå –û–±—ä—ë–º: "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
- ‚ùå TP1/TP2: "–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
- ‚ùå P&L: "–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3484.84)
- ‚úÖ –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ —Å –±–∏—Ä–∂–∏
- ‚úÖ –û–±—ä—ë–º: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –æ–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ TP1/TP2: –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ take profit —É—Ä–æ–≤–Ω–∏
- ‚úÖ P&L: –†–µ–∞–ª—å–Ω—ã–π P&L –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. `/positions` - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–π
2. –ü—Ä–∏–Ω—è—Ç–∏–µ –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ - –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
üü¢ ETHUSDT (LONG)

–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞: 3484.84
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: 3485.12
–û–±—ä—ë–º: 0.0103
P&L: +0.29 USDT (+0.01%)
TP1: 3519.69 (+1.0%)
TP2: 3554.54 (+2.0%)
–£—Å—Ä–µ–¥–Ω–µ–Ω–∏–π: 0
–†–µ–∂–∏–º: FUTURES
–ü–ª–µ—á–æ: x3
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- **–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞** (–±—ã–ª–∞ `None`, —Å—Ç–∞–ª–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π)
- **Take Profit —É—Ä–æ–≤–Ω–∏** (–±—ã–ª–∏ `None`, —Å—Ç–∞–ª–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)
- **–û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏** (–Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è, —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
1. **–ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–π** –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** –≤ –∫–æ–º–∞–Ω–¥–µ `/positions`
3. **–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç P&L** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ü–µ–Ω
4. **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ take profit —É—Ä–æ–≤–Ω–∏** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏—è–º–∏

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–î–∞—Ç–∞**: 2024-08-02
**–í–µ—Ä—Å–∏—è**: 1.0