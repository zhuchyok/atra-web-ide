# üõ°Ô∏è –ê–ù–ê–õ–ò–ó –£–ü–†–ê–í–õ–ï–ù–ò–Ø –†–ò–°–ö–ê–ú–ò DCA –£–°–†–ï–î–ù–ï–ù–ò–ô

## ‚úÖ **–î–ê! DCA –£–°–†–ï–î–ù–ï–ù–ò–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –£–ß–ò–¢–´–í–ê–Æ–¢ –†–ò–°–ö–ò –ò –°–í–û–ë–û–î–ù–´–ô –ë–ê–õ–ê–ù–°**

### üìä **–ö–ê–ö DCA –£–ß–ò–¢–´–í–ê–ï–¢ –û–¢–ö–†–´–¢–´–ï/–ó–ê–ö–†–´–¢–´–ï –ü–û–ó–ò–¶–ò–ò:**

#### **1. –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–£–ü–ù–´–• –°–†–ï–î–°–¢–í –î–õ–Ø DCA**

```python
def validate_funds_for_dca(
    user_data: dict,
    required_amount: float,
    trade_mode: str = "spot"
) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è DCA.
    """
    available = get_available_funds(user_data, trade_mode)
    deposit = float(user_data.get("deposit", 0))

    # –ú–∏–Ω–∏–º—É–º 10% –¥–µ–ø–æ–∑–∏—Ç–∞ –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–≤–æ–±–æ–¥–Ω—ã–º
    min_required = deposit * 0.1
    if available < min_required:
        logger.warning("Insufficient funds for DCA: %s < %s", available, min_required)
        return False

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–±—É–µ–º—É—é —Å—É–º–º—É (–º–∞–∫—Å–∏–º—É–º 80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤)
    max_dca_amount = available * 0.8
    if required_amount > max_dca_amount:
        logger.warning("DCA amount %s exceeds available funds %s", required_amount, available)
        return False

    return True
```

#### **2. –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê DCA –î–û–°–¢–£–ü–ù–´–ú–ò –°–†–ï–î–°–¢–í–ê–ú–ò**

```python
# 5. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä DCA –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏
max_dca_size = available_funds * 0.8  # –ú–∞–∫—Å–∏–º—É–º 80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
if position_size_usd > max_dca_size:
    position_size_usd = max_dca_size
    logger.info("DCA size limited by available funds: %s", position_size_usd)
```

### üéØ **–ê–î–ê–ü–¢–ò–í–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ò–°–ö–ê–ú–ò DCA:**

#### **1. –ü–†–û–ì–†–ï–°–°–ò–í–ù–û–ï –£–ú–ï–ù–¨–®–ï–ù–ò–ï –†–ê–ó–ú–ï–†–ê DCA:**

```python
def calculate_adaptive_dca_size(
    deposit: float, trade_mode: str, dca_count: int, base_risk_pct: float,
    current_price: float, avg_entry_price: float, volatility: float,
    trend_strength: float, market_regime: str = "neutral"
) -> Tuple[float, float]:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä DCA —Å —É—á–µ—Ç–æ–º:
    - –ù–æ–º–µ—Ä–∞ DCA (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ)
    - –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
    - –†–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞
    """
    # –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä DCA
    dca_risk_multiplier = get_dca_risk_multiplier(deposit, trade_mode)
    base_dca_risk = base_risk_pct * dca_risk_multiplier

    # –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ DCA
    decay_factor = math.exp(-dca_count * 0.3)  # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ
    adaptive_risk = base_dca_risk * decay_factor

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    volatility_factor = max(0.5, 1.0 - (volatility * 0.5))  # –°–Ω–∏–∂–∞–µ–º –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç—Ä–µ–Ω–¥—É
    trend_factor = max(0.7, 1.0 - (trend_strength * 0.3))  # –°–Ω–∏–∂–∞–µ–º –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ

    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–∂–∏–º—É —Ä—ã–Ω–∫–∞
    regime_factor = MARKET_REGIME_MULTIPLIERS.get(market_regime, {}).get("entry_size_mult", 1.0)

    final_risk = adaptive_risk * volatility_factor * trend_factor * regime_factor
    position_size_usd = deposit * final_risk / 100.0

    return position_size_usd, final_risk
```

#### **2. –í–ê–õ–ò–î–ê–¶–ò–Ø –û–ë–©–ï–ì–û –†–ò–°–ö–ê DCA:**

```python
def validate_dca_risk(
    deposit: float,
    total_risk_usd: float,
    leverage: int,
    trade_mode: str = "spot"
) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏ DCA –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ª–∏–º–∏—Ç—ã —Ä–∏—Å–∫–∞."""
    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –¥–µ–ø–æ–∑–∏—Ç–∞ –≤ DCA
    max_dca_pct = 15.0 if trade_mode == "futures" else 25.0
    max_dca_usd = deposit * max_dca_pct / 100.0

    if total_risk_usd > max_dca_usd:
        logger.warning("DCA risk exceeds limit: %s > %s", total_risk_usd, max_dca_usd)
        return False

    return True
```

### üõ°Ô∏è **–ó–ê–©–ò–¢–ù–´–ï –ú–ï–•–ê–ù–ò–ó–ú–´ DCA:**

#### **1. –ú–ù–û–ñ–ò–¢–ï–õ–ò –†–ò–°–ö–ê –ü–û –¢–ò–†–£ –î–ï–ü–û–ó–ò–¢–ê:**

```python
DCA_RISK_MULTIPLIER_BY_DEPOSIT = {
    "spot": {
        100: 0.8,     # $100 - —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        500: 0.9,     # $500 - —Å–ª–µ–≥–∫–∞ —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        1000: 1.0,    # $1000 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∏—Å–∫
        5000: 1.1,    # $5000 - –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        10000: 1.2,   # $10000 - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
        50000: 1.3,   # $50000 - –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
        100000: 1.4,  # $100000+ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
    },
    "futures": {
        100: 0.6,     # $100 - –æ—á–µ–Ω—å —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        500: 0.7,     # $500 - —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        1000: 0.8,    # $1000 - —Å–ª–µ–≥–∫–∞ —Å–Ω–∏–∂–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        5000: 0.9,    # $5000 - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∏—Å–∫
        10000: 1.0,   # $10000 - –ø–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫
        50000: 1.1,   # $50000 - –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
        100000: 1.2,  # $100000+ - –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫
    }
}
```

#### **2. –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ï –ö–û–õ–ò–ß–ï–°–¢–í–û DCA:**

```python
MAX_DCA_BY_DEPOSIT = {
    "spot": {
        100: 2,       # $100 - –º–∞–∫—Å 2 DCA
        500: 3,       # $500 - –º–∞–∫—Å 3 DCA
        1000: 4,      # $1000 - –º–∞–∫—Å 4 DCA
        5000: 5,      # $5000 - –º–∞–∫—Å 5 DCA
        10000: 6,     # $10000 - –º–∞–∫—Å 6 DCA
        50000: 7,     # $50000 - –º–∞–∫—Å 7 DCA
        100000: 8,    # $100000+ - –º–∞–∫—Å 8 DCA
    },
    "futures": {
        100: 1,       # $100 - –º–∞–∫—Å 1 DCA
        500: 2,       # $500 - –º–∞–∫—Å 2 DCA
        1000: 3,      # $1000 - –º–∞–∫—Å 3 DCA
        5000: 4,      # $5000 - –º–∞–∫—Å 4 DCA
        10000: 5,     # $10000 - –º–∞–∫—Å 5 DCA
        50000: 6,     # $50000 - –º–∞–∫—Å 6 DCA
        100000: 7,    # $100000+ - –º–∞–∫—Å 7 DCA
    }
}
```

### üìà **–ü–†–ò–ú–ï–†–´ –†–ê–ë–û–¢–´ DCA –° –£–ß–ï–¢–û–ú –†–ò–°–ö–û–í:**

#### **–ü–†–ò–ú–ï–† 1: –ú–ê–õ–´–ô –î–ï–ü–û–ó–ò–¢ ($500), –°–ü–û–¢**

```python
user_data = {
    "deposit": 500,
    "positions": [
        {"status": "open", "qty": 1.0, "entry_price": 105.0, "margin": 0}
    ],
    "open_positions": []
}

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞: 425.0 (500 - 50 - 25 —Ä–µ–∑–µ—Ä–≤)
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä DCA: 340.0 (80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö)
# –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∏—Å–∫–∞: 0.9 (—Å–Ω–∏–∂–µ–Ω–Ω—ã–π –¥–ª—è –º–∞–ª–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞)
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ DCA: 3
# –ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 3.4 (340 / 100)
# –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: 102.5
# TP1: 103.5, TP2: 105.0
```

#### **–ü–†–ò–ú–ï–† 2: –°–†–ï–î–ù–ò–ô –î–ï–ü–û–ó–ò–¢ ($5000), –§–¨–Æ–ß–ï–†–°–´**

```python
user_data = {
    "deposit": 5000,
    "positions": [
        {"status": "open", "qty": 1.0, "entry_price": 105.0, "margin": 50.0},
        {"status": "open", "qty": 1.5, "entry_price": 102.0, "margin": 75.0}
    ],
    "open_positions": []
}

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞: 4150.0 (5000 - 125 - 500 —Ä–µ–∑–µ—Ä–≤)
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä DCA: 3320.0 (80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö)
# –ú–Ω–æ–∂–∏—Ç–µ–ª—å —Ä–∏—Å–∫–∞: 0.9 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞)
# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ DCA: 4
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ä–∂–∏: 3.6% (125/5000)
# –ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 33.2 (3320 / 100)
# –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: 102.5
# TP1: 103.5, TP2: 105.0
```

### üéØ **–ö–õ–Æ–ß–ï–í–´–ï –ü–†–ò–ù–¶–ò–ü–´ DCA:**

#### **1. –ó–ê–©–ò–¢–ê –ö–ê–ü–ò–¢–ê–õ–ê:**
- ‚úÖ –†–µ–∑–µ—Ä–≤—ã –∫–∞–ø–∏—Ç–∞–ª–∞ (10-15%)
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º (80%)
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–≤–æ–±–æ–¥–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–∞–º (10%)
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –æ–±—â–µ–≥–æ —Ä–∏—Å–∫–∞ (15-25%)

#### **2. –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨:**
- ‚úÖ –£—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ –¥–µ–ø–æ–∑–∏—Ç–∞
- ‚úÖ –£—á–µ—Ç —Ä–µ–∂–∏–º–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ (—Å–ø–æ—Ç/—Ñ—å—é—á–µ—Ä—Å—ã)
- ‚úÖ –£—á–µ—Ç –Ω–æ–º–µ—Ä–∞ DCA (–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ)
- ‚úÖ –£—á–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–∞
- ‚úÖ –£—á–µ—Ç —Ä–µ–∂–∏–º–∞ —Ä—ã–Ω–∫–∞

#### **3. –ö–û–ù–¢–†–û–õ–¨ –†–ò–°–ö–û–í:**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ DCA
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –æ–±—â–µ–≥–æ —Ä–∏—Å–∫–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º DCA
- ‚úÖ –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞

## ‚úÖ **–í–´–í–û–î: DCA –ü–û–õ–ù–û–°–¢–¨–Æ –£–ß–ò–¢–´–í–ê–ï–¢ –†–ò–°–ö–ò!**

**DCA —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. **–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞** —Å —É—á–µ—Ç–æ–º –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π
2. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä DCA** –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏
3. **–°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤—ã –∫–∞–ø–∏—Ç–∞–ª–∞** –¥–ª—è –∑–∞—â–∏—Ç—ã
4. **–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –ø–æ–¥ —É—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞
5. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Ç–æ—Ä–≥–æ–≤–ª—é** –∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
6. **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä** DCA —Å –∫–∞–∂–¥—ã–º —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ–º

**DCA —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–µ! üõ°Ô∏è**
