# –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–°–ß–ï–¢–ê –°–£–ú–ú–´ –í–•–û–î–ê –í –°–î–ï–õ–ö–£

## üö® –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–æ—Å–∏–ª: "—Å—É–º–º–∞ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É –≤ —Å–∏–≥–Ω–∞–ª–µ –∏ –≤ –¥—Ü–∞ —Ç–µ–ø–µ—Ä—å –≤–µ—Ä–Ω–æ —Å—á–∏—Ç–∞–µ—Ç?" - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∏ DCA —Å–∏–≥–Ω–∞–ª–æ–≤.

## üîç –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞**
   - –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –æ—Ç –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞: `risk_amount = deposit * risk_pct / 100`
   - –î–æ–ª–∂–µ–Ω —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞: `risk_amount = free_deposit * risk_pct / 100`

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞**
   - –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Ä–∞—Å—á–µ—Ç `free_deposit * risk_pct / 100`
   - –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π `risk_amount`

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏–∫–∏ DCA**
   - –í —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ `button` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤ (—É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è)
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –ø–æ —Ç–æ–º—É –∂–µ —Å–∏–º–≤–æ–ª—É

## üîß –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∏—Å–∫–∞
–°–æ–∑–¥–∞–Ω `fix_entry_amount_calculation.py` –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É.

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
risk_amount = deposit * risk_pct / 100  # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
risk_amount = free_deposit * risk_pct / 100  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞
**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
f"–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: {risk_pct:.2f}% ({free_deposit * risk_pct / 100:.2f} USDT).\\n"
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
f"–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: {risk_pct:.2f}% ({risk_amount:.2f} USDT).\\n"
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:

1. **–î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
   - –û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏ = —Ä–∏—Å–∫ / —Ü–µ–Ω–∞ –≤—Ö–æ–¥–∞
   - –î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ —Å –ø–ª–µ—á–æ–º: –æ–±—ä–µ–º = (—Ä–∏—Å–∫ / —Ü–µ–Ω–∞) * –ø–ª–µ—á–æ

2. **–î–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤:**
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
   - –ü–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `button`

3. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—É–º–º–∞ —Ä–∏—Å–∫–∞
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É

### üìà –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:

**–î–µ–ø–æ–∑–∏—Ç:** 1000 USDT
**–û—Ç–∫—Ä—ã—Ç—ã—Ö –ø–æ–∑–∏—Ü–∏–π:** 0
**–°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç:** 1000 USDT
**–†–∏—Å–∫:** 2%
**–¶–µ–Ω–∞ –≤—Ö–æ–¥–∞:** 45000 USDT

**–†–∞—Å—á–µ—Ç:**
- –†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É = 1000 * 2% = 20 USDT
- –û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏ = 20 / 45000 = 0.00044 BTC
- –°—É–º–º–∞ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É = 20 USDT

## üß™ –ü–†–û–í–ï–†–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ñ–∞–π–ª–∞:
```bash
python3 -m py_compile telegram_bot.py
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ (exit code: 0)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞:
- ‚úÖ –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º—ã —Ä–∏—Å–∫–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ–±—ä–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –£—á–µ—Ç –ø–ª–µ—á–∞ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
```bash
python3 main.py
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Å—É–º–º—ã –≤—Ö–æ–¥–∞
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" –≤ —Å–∏–≥–Ω–∞–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—É–º–º–∞ –≤—Ö–æ–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ä–∏—Å–∫ –±–µ—Ä–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ DCA
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è –¥–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

- [x] –§—É–Ω–∫—Ü–∏—è button –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º—ã —Ä–∏—Å–∫–∞
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ–±—ä–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏
- [ ] –û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—É–º–º—É –≤—Ö–æ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- [ ] DCA —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
- [ ] –í—Å–µ —Ä–∞—Å—á–µ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## üéâ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- ‚úÖ –†–∏—Å–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û–±—ä–µ–º –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–ª–µ—á–æ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–º —Ä–∞—Å—á–µ—Ç–∞–º

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:

1. **–†–∞—Å—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞:**
   ```python
   total_risk = sum(pos.get("risk_amount", 0) for pos in user_data["open_positions"])
   free_deposit = max(deposit - total_risk, 0)
   ```

2. **–†–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞ –Ω–∞ —Å–¥–µ–ª–∫—É:**
   ```python
   risk_amount = free_deposit * risk_pct / 100
   ```

3. **–†–∞—Å—á–µ—Ç –æ–±—ä–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏:**
   ```python
   if trade_mode == "futures" and leverage > 1:
       qty = risk_amount / current_price * leverage
   else:
       qty = risk_amount / current_price if current_price > 0 else 0
   ```

4. **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏:**
   ```python
   f"–†–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É: {risk_pct:.2f}% ({risk_amount:.2f} USDT).\\n"
   f"–°—É–º–º–∞ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É: <b>{risk_amount:.2f} USDT</b>.\\n\\n"
   ```

---
**–î–∞—Ç–∞:** 20.08.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ê–°–ß–ï–¢ –°–£–ú–ú–´ –í–•–û–î–ê –ò–°–ü–†–ê–í–õ–ï–ù
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –†–ê–°–ß–ï–¢–ê
