# ‚è∞ –ê–ù–ê–õ–ò–ó –°–ò–°–¢–ï–ú–´ –¢–û–†–ì–û–í–´–• –ß–ê–°–û–í

## üéØ **–ì–î–ï –ó–ê–î–ê–Æ–¢–°–Ø –¢–û–†–ì–û–í–´–ï –ß–ê–°–´:**

### üìã **1. Telegram –∫–æ–º–∞–Ω–¥—ã (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±):**

#### üéØ **–ö–æ–º–∞–Ω–¥–∞ `/set_trading_hours`:**
```python
async def set_trading_hours_cmd(update, context):
    # –§–æ—Ä–º–∞—Ç: /set_trading_hours 9 18
    # –ì–¥–µ: 9 - –Ω–∞—á–∞–ª–æ —Ç–æ—Ä–≥–æ–≤–ª–∏, 18 - –∫–æ–Ω–µ—Ü —Ç–æ—Ä–≥–æ–≤–ª–∏ (–ú–°–ö)

    if not context.args or len(context.args) < 2:
        await update.message.reply_text(
            "–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ: /set_trading_hours 9 18 (start < end, –ú–°–ö)"
        )
        return

    try:
        start = int(context.args[0])
        end = int(context.args[1])
        if not (0 <= start < end <= 24):
            await update.message.reply_text(
                "–û—à–∏–±–∫–∞: start –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–Ω—å—à–µ end, –æ–±–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 0‚Äì24. –ü—Ä–∏–º–µ—Ä: /set_trading_hours 7 23"
            )
            return

        user_data["trading_hours"] = {"start": start, "end": end}
        save_user_data(context)
        await update.message.reply_text(
            f"‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: {start:02d}:00‚Äì{end:02d}:00 (–ú–°–ö)"
        )
    except Exception:
        await update.message.reply_text(
            "–û—à–∏–±–∫–∞: —É–∫–∞–∂–∏—Ç–µ –¥–≤–∞ —á–∏—Å–ª–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: /set_trading_hours 9 18 (start < end, –ú–°–ö)"
        )
```

#### üéØ **–ö–æ–º–∞–Ω–¥–∞ `/trading_hours`:**
```python
async def trading_hours_cmd(update, context):
    th = user_data.get("trading_hours")
    if th:
        await update.message.reply_text(
            f"–í–∞—à–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã: {th['start']:02d}:00‚Äì{th['end']:02d}:00 (–ú–°–ö)"
        )
    else:
        await update.message.reply_text(
            "–¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –Ω–µ –∑–∞–¥–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /set_trading_hours <start> <end>"
        )
```

### üìã **2. –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (state.py):**

#### üéØ **–§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
TRADING_HOURS_FILE = "trading_hours.txt"

def set_trading_hours(start, end):
    try:
        with open(TRADING_HOURS_FILE, "w") as f:
            f.write(f"{int(start)} {int(end)}")
        backup_file(TRADING_HOURS_FILE)
    except Exception as e:
        logging.error(e, exc_info=True)

def get_trading_hours():
    try:
        with open(TRADING_HOURS_FILE, "r") as f:
            s, e = f.read().split()
            return int(s), int(e)
    except Exception as e:
        logging.error(e, exc_info=True)
        return 0, 24  # –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ
```

## üîß **–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –°–ò–°–¢–ï–ú–ê:**

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤:**
```python
def check_user_trading_hours(user_data):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    th = user_data.get("trading_hours")
    if not th:
        return True  # –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã - —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ—Ä–≥–æ–≤–ª—é

    now = get_msk_now()
    hour = now.hour
    start = th.get("start", 0)
    end = th.get("end", 24)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π —á–∞—Å –≤—Ö–æ–¥–∏—Ç –≤ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã
    if start <= end:
        # –û–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π: 9-18
        return start <= hour < end
    else:
        # –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å: 23-7
        return hour >= start or hour < end
```

### ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–∏–≥–Ω–∞–ª–∞—Ö:**
```python
# –í signal_live.py –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
if not check_user_trading_hours(user_data):
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª–æ–≤
    return

# –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ pending_dca_signals
if not check_user_trading_hours(user_data):
    save_pending_dca_signal(user_id, symbol, side, original_price, original_time, user_data)
    return
```

## üìä **–§–û–†–ú–ê–¢–´ –ò –ü–†–ò–ú–ï–†–´:**

### ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
```
/set_trading_hours 9 18    # 09:00-18:00 (–ú–°–ö)
/set_trading_hours 7 23    # 07:00-23:00 (–ú–°–ö)
/set_trading_hours 0 24    # –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ
/set_trading_hours 23 7    # 23:00-07:00 (—á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å)
```

### ‚ùå **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
```
/set_trading_hours 18 9    # –û—à–∏–±–∫–∞: start > end
/set_trading_hours 25 30   # –û—à–∏–±–∫–∞: > 24
/set_trading_hours abc     # –û—à–∏–±–∫–∞: –Ω–µ —á–∏—Å–ª–∞
/set_trading_hours 9       # –û—à–∏–±–∫–∞: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —á–∏—Å–ª–æ
```

## üéØ **–õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´:**

### ‚úÖ **–û–±—ã—á–Ω—ã–µ —á–∞—Å—ã (9-18):**
- **–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞:** 09:00, 10:00, ..., 17:00
- **–¢–æ—Ä–≥–æ–≤–ª—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞:** 18:00, 19:00, ..., 08:00

### ‚úÖ **–ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å (23-7):**
- **–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞:** 23:00, 00:00, 01:00, ..., 06:00
- **–¢–æ—Ä–≥–æ–≤–ª—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞:** 07:00, 08:00, ..., 22:00

### ‚úÖ **–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è (0-24):**
- **–¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞:** –í—Å–µ–≥–¥–∞

## üîß **–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–•:**

### üìä **–í user_data:**
```python
user_data["trading_hours"] = {
    "start": 9,
    "end": 18
}
```

### üìä **–í —Ñ–∞–π–ª–µ:**
```
trading_hours.txt
9 18
```

### üìä **–ë—ç–∫–∞–ø—ã:**
```
backups/trading_hours.txt_20240127_143022
```

## üéØ **–ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –°–ò–°–¢–ï–ú–û–ô:**

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:**
- **–ï—Å–ª–∏ —á–∞—Å—ã –Ω–µ –∑–∞–¥–∞–Ω—ã** ‚Üí —Ç–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞
- **–ï—Å–ª–∏ —á–∞—Å—ã –∑–∞–¥–∞–Ω—ã** ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
- **–í–Ω–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤** ‚Üí —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è

### ‚úÖ **DCA —Å–∏—Å—Ç–µ–º–∞:**
- **–í –Ω–µ—Ç–æ—Ä–≥–æ–≤–æ–µ –≤—Ä–µ–º—è** ‚Üí —Å–∏–≥–Ω–∞–ª—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è
- **–í —Ç–æ—Ä–≥–æ–≤–æ–µ –≤—Ä–µ–º—è** ‚Üí –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

### ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- **–ö–æ–º–∞–Ω–¥–∞ `/trading_hours`** ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–ö–æ–º–∞–Ω–¥–∞ `/set_trading_hours`** ‚Üí –∏–∑–º–µ–Ω—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üéØ **–ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø:**

### ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /set_trading_hours 9 18
–ë–æ—Ç: ‚úÖ –¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: 09:00‚Äì18:00 (–ú–°–ö)
```

### ‚úÖ **–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /trading_hours
–ë–æ—Ç: –í–∞—à–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã: 09:00‚Äì18:00 (–ú–°–ö)
```

### ‚úÖ **–ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /trading_hours
–ë–æ—Ç: –¢–æ—Ä–≥–æ–≤—ã–µ —á–∞—Å—ã –Ω–µ –∑–∞–¥–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /set_trading_hours <start> <end>
```

## üéØ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:**

### ‚úÖ **–î–ª—è –¥–Ω–µ–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:**
```
/set_trading_hours 9 18    # 09:00-18:00 (–ú–°–ö)
```

### ‚úÖ **–î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:**
```
/set_trading_hours 7 23    # 07:00-23:00 (–ú–°–ö)
```

### ‚úÖ **–î–ª—è –Ω–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:**
```
/set_trading_hours 23 7    # 23:00-07:00 (–ú–°–ö)
```

### ‚úÖ **–î–ª—è –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:**
```
/set_trading_hours 0 24    # –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ
```

## üéØ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:**

**‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö —á–∞—Å–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!**

### üìä **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- **–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** –≤—Ä–µ–º–µ–Ω–∏ —Ç–æ—Ä–≥–æ–≤–ª–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞** —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏–≥–Ω–∞–ª–∞–º–∏** –∏ DCA
- **–ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üöÄ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- **–ö–æ–º–∞–Ω–¥—ã Telegram** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏** –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- **–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤** –≤ –Ω–µ—Ç–æ—Ä–≥–æ–≤–æ–µ –≤—Ä–µ–º—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** –Ω–∞—Å—Ç—Ä–æ–µ–∫

---
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–î–∞—Ç–∞:** 2024-01-27
**–û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞:** `/set_trading_hours`
**–ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫:** `/trading_hours`