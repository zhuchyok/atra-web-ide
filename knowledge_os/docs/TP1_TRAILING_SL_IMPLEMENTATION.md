# üéØ –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø: –ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ SL –∫ TP1

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### **1. –†–∞—Å—à–∏—Ä–µ–Ω TrailingStopManager**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `calculate_tp1_trailing_stop()` - –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `settings`:
  - `tp1_trailing_enabled`: True (–≤–∫–ª—é—á–µ–Ω–æ)
  - `tp1_activation_progress`: 0.5 (–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ 50% –ø—É—Ç–∏ –∫ TP1)
  - `tp1_sl_progress_ratio`: 0.3 (–ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å SL –Ω–∞ 30% –æ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏)
  - `tp1_min_atr_multiplier`: 2.0 (–º–∏–Ω–∏–º—É–º ATR * 2.0 –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã)
- ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `setup_position()` –¥–ª—è –ø—Ä–∏–µ–º–∞ `tp1_price`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `update_trailing_stop()` —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º trailing

### **2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ PriceMonitorSystem**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞—Å—á–µ—Ç ATR –∏–∑ OHLC –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–∏—Ü–∏–π –≤ trailing manager
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SL –≤ –ë–î (signals_log, accepted_signals, active_positions)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π SL

---

## üîß –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´

### **–ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –∫ TP1:**

1. **–†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫ TP1:**
   ```python
   progress = (current_price - entry_price) / (tp1_price - entry_price)
   ```

2. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
   - –¢–æ–ª—å–∫–æ –ø—Ä–∏ `progress >= 0.5` (50% –ø—É—Ç–∏ –∫ TP1)
   - –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –µ—â–µ –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∞ TP1

3. **–†–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ SL:**
   ```python
   sl_progress = progress * 0.3  # 30% –æ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏
   new_sl = entry_price + (tp1_price - entry_price) * sl_progress
   ```

4. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
   - –ú–∏–Ω–∏–º—É–º: –±–µ–∑—É–±—ã—Ç–æ–∫ + –∫–æ–º–∏—Å—Å–∏–∏ (entry_price * 1.002)
   - –ú–∏–Ω–∏–º—É–º: —Ç–µ–∫—É—â–∞—è_—Ü–µ–Ω–∞ - ATR * 2.0
   - –°—Ç–æ–ø —Ç–æ–ª—å–∫–æ —É–ª—É—á—à–∞–µ—Ç—Å—è (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è)

5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –í trailing manager
   - –í –ë–î (signals_log, accepted_signals, active_positions)
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏

---

## üìä –ü–†–ò–ú–ï–† –†–ê–ë–û–¢–´

### **–°—Ü–µ–Ω–∞—Ä–∏–π: LONG –ø–æ–∑–∏—Ü–∏—è**

```
–í—Ö–æ–¥: 100.00 USDT
–ù–∞—á–∞–ª—å–Ω—ã–π SL: 98.00 USDT (-2%)
TP1: 102.75 USDT (+2.75%)
ATR: 0.50 USDT

–î–≤–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã:
1. –¶–µ–Ω–∞: 101.00 USDT (+1.0%)
   –ü—Ä–æ–≥—Ä–µ—Å—Å: (101-100)/(102.75-100) = 36.4% ‚Üí –ù–ï –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è (< 50%)

2. –¶–µ–Ω–∞: 101.38 USDT (+1.38%)
   –ü—Ä–æ–≥—Ä–µ—Å—Å: (101.38-100)/(102.75-100) = 50.2% ‚Üí ‚úÖ –ê–ö–¢–ò–í–ò–†–£–ï–¢–°–Ø
   SL –ø—Ä–æ–≥—Ä–µ—Å—Å: 50.2% * 0.3 = 15.06%
   –ù–æ–≤—ã–π SL: 100 + (102.75-100) * 0.1506 = 100.41 USDT
   –ú–∏–Ω–∏–º—É–º: max(100.41, 100.20, 101.38-1.0) = 100.41 USDT
   ‚úÖ SL –æ–±–Ω–æ–≤–ª–µ–Ω: 98.00 ‚Üí 100.41 USDT

3. –¶–µ–Ω–∞: 101.75 USDT (+1.75%)
   –ü—Ä–æ–≥—Ä–µ—Å—Å: (101.75-100)/(102.75-100) = 63.6%
   SL –ø—Ä–æ–≥—Ä–µ—Å—Å: 63.6% * 0.3 = 19.1%
   –ù–æ–≤—ã–π SL: 100 + (102.75-100) * 0.191 = 100.52 USDT
   –ú–∏–Ω–∏–º—É–º: max(100.52, 100.20, 101.75-1.0) = 100.52 USDT
   ‚úÖ SL –æ–±–Ω–æ–≤–ª–µ–Ω: 100.41 ‚Üí 100.52 USDT

4. –¶–µ–Ω–∞: 102.00 USDT (+2.0%)
   –ü—Ä–æ–≥—Ä–µ—Å—Å: (102-100)/(102.75-100) = 72.7%
   SL –ø—Ä–æ–≥—Ä–µ—Å—Å: 72.7% * 0.3 = 21.8%
   –ù–æ–≤—ã–π SL: 100 + (102.75-100) * 0.218 = 100.60 USDT
   –ú–∏–Ω–∏–º—É–º: max(100.60, 100.20, 102.00-1.0) = 101.00 USDT
   ‚úÖ SL –æ–±–Ω–æ–≤–ª–µ–Ω: 100.52 ‚Üí 101.00 USDT (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ATR)
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò

### **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Ç–µ–∫—É—â–∏–µ):**
```python
'tp1_trailing_enabled': True,         # –í–∫–ª—é—á–µ–Ω–æ
'tp1_activation_progress': 0.5,      # –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∏ 50% –ø—É—Ç–∏
'tp1_sl_progress_ratio': 0.3,        # 30% –æ—Ç –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏
'tp1_min_atr_multiplier': 2.0,       # ATR * 2.0 –º–∏–Ω–∏–º—É–º
```

### **–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
# –í trailing_stop_manager.py, –º–µ—Ç–æ–¥ __init__:
trailing_manager = get_trailing_manager()
trailing_manager.settings['tp1_activation_progress'] = 0.4  # 40% –≤–º–µ—Å—Ç–æ 50%
trailing_manager.settings['tp1_sl_progress_ratio'] = 0.4     # 40% –≤–º–µ—Å—Ç–æ 30%
```

---

## üîç –ú–û–ù–ò–¢–û–†–ò–ù–ì

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
üéØ [TP1_TRAILING] BTCUSDT: SL –ø–æ–¥—Ç—è–Ω—É—Ç –∫ TP1 98.00 ‚Üí 100.41 (–ø—Ä–æ–≥—Ä–µ—Å—Å: 50.2%, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: 0.99%)
üéØ [TRAILING] BTCUSDT: SL –æ–±–Ω–æ–≤–ª–µ–Ω 98.00 ‚Üí 100.41 (TP1 trailing: 50.2% progress)
```

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π SL –∫ TP1
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫ TP1 –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏
- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã –¥–æ SL

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ò

### **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
1. ‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
2. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º trailing stop
4. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### **–ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
1. ‚è≥ –¢–µ—Å—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (backtest)
2. ‚è≥ –¢–µ—Å—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö (1-2 –Ω–µ–¥–µ–ª–∏)
3. ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏–π
4. ‚è≥ –ê–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è Win Rate

---

## üöÄ –î–ï–ü–õ–û–ô

### **–ì–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é:**
- ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–µ—Ä–≤—ã–µ 1-2 –Ω–µ–¥–µ–ª–∏
3. –°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π SL
4. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ Win Rate
5. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

---

## üìù –ò–°–¢–û–†–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

**–í–µ—Ä—Å–∏—è 1.0 (2025-01-XX):**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –∫ TP1
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å TrailingStopManager
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

