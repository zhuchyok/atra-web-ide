# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –û–®–ò–ë–ö–ò VOLATILITY_PCT

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 4 –∞–≤–≥—É—Å—Ç–∞ 2025
**–ü—Ä–æ–±–ª–µ–º–∞:** `[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤: 'volatility_pct'`

## üêõ –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

–°–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞–≤–∞–ª–∞ –æ—à–∏–±–∫—É –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–æ–Ω–∫–µ `volatility_pct`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ –≤ DataFrame. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `check_trade_filters`, –∫–æ–≥–¥–∞ –æ–Ω–∞ –ø—ã—Ç–∞–ª–∞—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏.

## üîç –ê–ù–ê–õ–ò–ó –ü–†–ò–ß–ò–ù–´

1. **–§—É–Ω–∫—Ü–∏—è `check_trade_filters`** –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
2. **–ö–æ–ª–æ–Ω–∫–∞ `volatility_pct`** —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `add_enhanced_indicators`
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞** –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–¥ –µ—ë –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

## ‚úÖ –í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `check_trade_filters`

```python
def check_trade_filters(df, i, symbol):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏"""
    try:
        config = ENHANCED_STRATEGY_CONFIG["profit_distribution_config"]

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
        if config["volatility_filter"]:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–æ–ª–æ–Ω–∫–∞ volatility_pct
            if "volatility_pct" not in df.columns:
                # –°–æ–∑–¥–∞–µ–º volatility_pct –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                if "atr" in df.columns and "close" in df.columns:
                    df["volatility_pct"] = df["atr"] / df["close"] * 100
                else:
                    # –ï—Å–ª–∏ –Ω–µ—Ç ATR, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
                    print(f"[WARNING] –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –¥–ª—è {symbol}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ ATR")
                    return True, "–ü—Ä–æ–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏"

            volatility_pct = df["volatility_pct"].iloc[i]
            if pd.isna(volatility_pct):
                return True, "–ü—Ä–æ–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (NaN)"

            if volatility_pct < config["min_volatility_pct"] or volatility_pct > config["max_volatility_pct"]:
                return False, "–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞
        if config["market_regime_filter"]:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
            if "ema7" not in df.columns or "ema25" not in df.columns:
                print(f"[WARNING] –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞ –¥–ª—è {symbol}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ EMA")
                return True, "–ü—Ä–æ–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞"

            trend_strength = abs(df["ema7"].iloc[i] - df["ema25"].iloc[i]) / df["ema25"].iloc[i] * 100
            if pd.isna(trend_strength):
                return True, "–ü—Ä–æ–ø—É—â–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–ª—ã —Ç—Ä–µ–Ω–¥–∞ (NaN)"

            if trend_strength < config["trend_strength_threshold"]:
                return False, "–°–ª–∞–±–∞—è —Å–∏–ª–∞ —Ç—Ä–µ–Ω–¥–∞"

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é —Å BTC (–µ—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ)
        if config["correlation_filter"] and "btc_correlation" in df.columns:
            btc_corr = df["btc_correlation"].iloc[i]
            if not pd.isna(btc_corr) and abs(btc_corr) > config["max_correlation_threshold"]:
                return False, "–í—ã—Å–æ–∫–∞—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è —Å BTC"

        return True, "–í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã"

    except Exception as e:
        print(f"[ERROR] –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤: {e}")
        return True, "–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤"
```

### 2. –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `optimized_enhanced_bollinger_entry_signal`

```python
def optimized_enhanced_bollinger_entry_signal(df, i):
    """–û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª —Å –ø–æ–≤—ã—à–µ–Ω–Ω—ã–º –≤–∏–Ω—Ä–µ–π—Ç–æ–º"""
    try:
        if not ENHANCED_BOLLINGER_STRATEGY:
            return None, None

        # –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã
        if "volatility_pct" not in df.columns:
            df = add_enhanced_indicators(df)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã —Ç–æ—Ä–≥–æ–≤–ª–∏
        filters_ok, filter_message = check_trade_filters(df, i, "unknown")
        if not filters_ok:
            return None, None

        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
```

## üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
üß™ –¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –û–®–ò–ë–ö–ò VOLATILITY_PCT
==================================================
üìä –°–æ–∑–¥–∞–Ω DataFrame —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏: ['open', 'high', 'low', 'close', 'volume', 'ema7', 'ema25', 'atr', 'bb_upper', 'bb_lower', 'bb_middle', 'rsi']
‚úÖ volatility_pct –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–∫–∞–∫ –∏ –æ–∂–∏–¥–∞–ª–æ—Å—å)

üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º check_trade_filters...
‚úÖ check_trade_filters –≤—ã–ø–æ–ª–Ω–∏–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ
   –†–µ–∑—É–ª—å—Ç–∞—Ç: True
   –°–æ–æ–±—â–µ–Ω–∏–µ: –í—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø—Ä–æ–π–¥–µ–Ω—ã
‚úÖ volatility_pct –±—ã–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞
   –ó–Ω–∞—á–µ–Ω–∏–µ: 1.8095

üîß –¢–µ—Å—Ç–∏—Ä—É–µ–º add_enhanced_indicators...
‚úÖ add_enhanced_indicators —Å–æ–∑–¥–∞–ª–∞ volatility_pct
   –ó–Ω–∞—á–µ–Ω–∏–µ: 1.8095

üìã –†–ï–ó–Æ–ú–ï:
------------------------------
‚úÖ –û—à–∏–±–∫–∞ volatility_pct –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
‚úÖ –§—É–Ω–∫—Ü–∏—è check_trade_filters —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ
```

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
- –§—É–Ω–∫—Ü–∏—è `check_trade_filters` —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç `volatility_pct` –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∑–Ω–∞—á–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ NaN –∑–Ω–∞—á–µ–Ω–∏—è –≤ `volatility_pct`
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–∏—á–∏–Ω–∞—Ö –ø—Ä–æ–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
- Graceful fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö

## üìä –°–¢–ê–¢–£–° –°–ò–°–¢–ï–ú–´

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **check_trade_filters** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
- **optimized_enhanced_bollinger_entry_signal** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —É–ª—É—á—à–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ fallback

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–¢—Ä–µ–π–ª–∏–Ω–≥-—Å—Ç–æ–ø—ã** - –æ—Å—Ç–∞—é—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ (–∫–∞–∫ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å)
- **DCA —Å–∏—Å—Ç–µ–º–∞** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

## üöÄ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–û—à–∏–±–∫–∞ `volatility_pct` –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!**

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ