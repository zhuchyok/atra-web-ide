# ðŸ“– ÐŸÐžÐ”Ð ÐžÐ‘ÐÐžÐ• ÐžÐ‘ÐªÐ¯Ð¡ÐÐ•ÐÐ˜Ð•: ÐÐ²Ñ‚Ð¾ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ AUTO Ñ€ÐµÐ¶Ð¸Ð¼Ð°

## ðŸŽ¯ ÐžÐ¡ÐÐžÐ’ÐÐÐ¯ Ð˜Ð”Ð•Ð¯

Ð”Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð² **AUTO Ñ€ÐµÐ¶Ð¸Ð¼Ðµ** ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑÐ¼Ð¸ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ. Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ ÐµÑÑ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾, Ð½Ð¾ ÐµÑ‘ Ð½ÐµÑ‚ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ â€” Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ð¾Ð½Ð° Ð±Ñ‹Ð»Ð° Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ (Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ, Ð¿Ð¾ SL/TP, Ð¸Ð»Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼), Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ ÐµÑ‘ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾.

## ðŸ”„ ÐšÐÐš Ð­Ð¢Ðž Ð ÐÐ‘ÐžÐ¢ÐÐ•Ð¢ (Ð¿Ð¾ÑˆÐ°Ð³Ð¾Ð²Ð¾)

### Ð¨Ð°Ð³ 1: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
```python
# ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð² auto Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð˜ Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸
user_ids = await adb_local.get_users_by_mode('auto')
# Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸ (Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð²)
all_users_with_keys = [Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ñ API ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸]
user_ids = list(set(user_ids + all_users_with_keys))
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹, Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸.

---

### Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹ Ñ Ð±Ð¸Ñ€Ð¶Ð¸
```python
for uid in user_ids:
    # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ API ÐºÐ»ÑŽÑ‡Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    keys = await adb_local.get_active_exchange_keys(uid, 'bitget')
    
    # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð°Ð´Ð°Ð¿Ñ‚ÐµÑ€ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð±Ð¸Ñ€Ð¶ÐµÐ¹
    adapter = ExchangeAdapter('bitget', keys=keys or {}, sandbox=False)
    
    # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð’Ð¡Ð• Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ð±Ð¸Ñ€Ð¶Ð¸
    positions = await adapter.fetch_positions()
```

**Ð§Ñ‚Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ `fetch_positions()`:**
```python
[
    {
        'symbol': 'ETHFIUSDT',
        'contracts': 100.0,  # Ð Ð°Ð·Ð¼ÐµÑ€ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸
        'side': 'long',      # ÐÐ°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ
        'entryPrice': 0.829, # Ð¦ÐµÐ½Ð° Ð²Ñ…Ð¾Ð´Ð°
        'positionAmt': 100.0,
        'holdSide': 'long'   # Ð”Ð»Ñ hedge mode
    },
    {
        'symbol': 'BTCUSDT',
        'contracts': -50.0,  # ÐžÑ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ = SHORT
        'entryPrice': 65000,
        ...
    }
]
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ Ð´Ð»Ñ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.

---

### Ð¨Ð°Ð³ 3: Ð¡Ð±Ð¾Ñ€ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² Ñ Ð±Ð¸Ñ€Ð¶Ð¸
```python
# Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð½Ð°Ð±Ð¾Ñ€ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ð¸Ñ€Ð¶Ð° ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼Ð¸
open_symbols_remote = set()
for p in (positions or []):
    symbol = p.get('symbol')  # ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 'ETHFIUSDT'
    contracts = float(p.get('contracts') or 0)
    
    if contracts and abs(contracts) > 0:  # Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð½Ðµ Ð½ÑƒÐ»ÐµÐ²Ð°Ñ
        open_symbols_remote.add(symbol)  # Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² Ð½Ð°Ð±Ð¾Ñ€
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** `open_symbols_remote = {'ETHFIUSDT', 'BTCUSDT', ...}` â€” ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ.

---

### Ð¨Ð°Ð³ 4: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹
```python
# ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
local_open = set(await adb_local.get_user_active_symbols(uid))
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** `local_open = {'ETHFIUSDT', 'WLDUSDT', 'ARBUSDT'}` â€” ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼Ð¸.

---

### Ð¨Ð°Ð³ 5: Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ
```python
# ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÐµÑÑ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾, Ð½Ð¾ ÐÐ•Ð¢ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ
to_close = local_open - open_symbols_remote

# ÐŸÑ€Ð¸Ð¼ÐµÑ€:
# local_open = {'ETHFIUSDT', 'WLDUSDT', 'ARBUSDT'}
# open_symbols_remote = {'ETHFIUSDT', 'BTCUSDT'}
# to_close = {'WLDUSDT', 'ARBUSDT'}  # Ð­Ñ‚Ð¸Ñ… Ð½ÐµÑ‚ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ!

for sym in to_close:
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÐ¶Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    user_mode = await adb_local.get_user_mode(uid)
    
    if user_mode == 'manual':
        # Ð”Ð»Ñ manual Ñ€ÐµÐ¶Ð¸Ð¼Ð° ÐÐ• Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ (ÑÐ¸Ð³Ð½Ð°Ð»-Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€)
        continue
    
    # Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
    await adb_local.close_active_position_by_symbol(uid, sym)
    
    # ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
    await alert_svc.alert_position_closed_by_exchange(uid, sym)
```

---

## ðŸ“Š ÐŸÐ Ð˜ÐœÐ•Ð Ð« Ð¡Ð¦Ð•ÐÐÐ Ð˜Ð•Ð’

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

**Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ:**
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾: `ETHFIUSDT` Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°
- ÐÐ° Ð±Ð¸Ñ€Ð¶Ðµ: `ETHFIUSDT` Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ð±Ð¸Ñ€Ð¶Ð¸ â†’ `ETHFIUSDT` Ð½ÐµÑ‚ Ð² ÑÐ¿Ð¸ÑÐºÐµ
2. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚: `local_open = {'ETHFIUSDT'}`, `open_symbols_remote = {}`
3. ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚: `to_close = {'ETHFIUSDT'}`
4. **Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
5. **Ð”Ð»Ñ manual Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ (Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)

---

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾ Stop Loss

**Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ:**
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾: `WLDUSDT` Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°, SL = 0.70
- ÐÐ° Ð±Ð¸Ñ€Ð¶Ðµ: Ð¦ÐµÐ½Ð° ÑƒÐ¿Ð°Ð»Ð° Ð´Ð¾ 0.70, SL ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð», Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð°

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ð±Ð¸Ñ€Ð¶Ð¸ â†’ `WLDUSDT` Ð½ÐµÑ‚ Ð² ÑÐ¿Ð¸ÑÐºÐµ
2. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚: `local_open = {'WLDUSDT'}`, `open_symbols_remote = {}`
3. ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚: `to_close = {'WLDUSDT'}`
4. **Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
5. **Ð”Ð»Ñ manual Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ (Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)

---

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾ Take Profit

**Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ:**
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾: `ARBUSDT` Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°, TP2 = 0.85
- ÐÐ° Ð±Ð¸Ñ€Ð¶Ðµ: Ð¦ÐµÐ½Ð° Ð´Ð¾ÑÑ‚Ð¸Ð³Ð»Ð° 0.85, TP2 ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð», Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð°

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ð±Ð¸Ñ€Ð¶Ð¸ â†’ `ARBUSDT` Ð½ÐµÑ‚ Ð² ÑÐ¿Ð¸ÑÐºÐµ
2. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚: `local_open = {'ARBUSDT'}`, `open_symbols_remote = {}`
3. ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚: `to_close = {'ARBUSDT'}`
4. **Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
5. **Ð”Ð»Ñ manual Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°ÐµÑ‚ (Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð¹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)

---

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 4: ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ñ Ð²ÑÐµ ÐµÑ‰Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°

**Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ:**
- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾: `ETHFIUSDT` Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°
- ÐÐ° Ð±Ð¸Ñ€Ð¶Ðµ: `ETHFIUSDT` Ð²ÑÐµ ÐµÑ‰Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð°

**Ð§Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ñ Ð±Ð¸Ñ€Ð¶Ð¸ â†’ `ETHFIUSDT` ÐµÑÑ‚ÑŒ Ð² ÑÐ¿Ð¸ÑÐºÐµ
2. Ð¡Ñ€Ð°Ð²Ð½Ð¸Ð²Ð°ÐµÑ‚: `local_open = {'ETHFIUSDT'}`, `open_symbols_remote = {'ETHFIUSDT'}`
3. ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚: `to_close = {}` (Ð¿ÑƒÑÑ‚Ð¾)
4. **ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚** â€” Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ð¾Ð¹

---

## âš™ï¸ Ð”ÐžÐŸÐžÐ›ÐÐ˜Ð¢Ð•Ð›Ð¬ÐÐ«Ð• Ð¤Ð£ÐÐšÐ¦Ð˜Ð˜

### 1. ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ TP1/TP2
Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð¸ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚, ÐºÐ¾Ð³Ð´Ð° ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð» TP1:
```python
# Ð—Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°ÐµÐ¼ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸
if pos_key not in position_sizes:
    position_sizes[pos_key] = current_size  # ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: 100.0

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼: ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ¸Ð»Ð°ÑÑŒ Ð»Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð½Ð° 50%? (TP1 ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»)
if size_reduction_pct >= 40 and size_reduction_pct <= 60:
    # TP1 ÑÑ€Ð°Ð±Ð¾Ñ‚Ð°Ð»! ÐŸÐµÑ€ÐµÐ½Ð¾ÑÐ¸Ð¼ SL Ð² Ð±ÐµÐ·ÑƒÐ±Ñ‹Ñ‚Ð¾Ðº
    tp1_triggered.add(pos_key)
```

### 2. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ñ… Ð¾Ñ€Ð´ÐµÑ€Ð¾Ð²
ÐŸÑ€Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ð¸ Ð½Ð¾Ð²Ð¾Ð¹ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚:
- **TP1 Ð¾Ñ€Ð´ÐµÑ€** (50% Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸)
- **TP2 Ð¾Ñ€Ð´ÐµÑ€** (50% Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸)
- **SL Ð¾Ñ€Ð´ÐµÑ€** (100% Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸)

### 3. Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ hedge-Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹
Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð²Ð°ÐµÑ‚ Ð¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ hedge-Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ (LONG+SHORT Ð½Ð° Ð¾Ð´Ð¸Ð½ ÑÐ¸Ð¼Ð²Ð¾Ð»):
```python
hedge_conflicts = await detect_hedge_positions(positions)
if hedge_conflicts:
    # ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÐ¼ hedge Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸
    close_results = await close_hedge_positions(hedge_conflicts, adapter)
```

---

## ðŸ”„ Ð§ÐÐ¡Ð¢ÐžÐ¢Ð Ð¡Ð˜ÐÐ¥Ð ÐžÐÐ˜Ð—ÐÐ¦Ð˜Ð˜

```python
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ð´Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸
await asyncio.sleep(120)
```

**Ð­Ñ‚Ð¾ Ð·Ð½Ð°Ñ‡Ð¸Ñ‚:**
- ÐšÐ°Ð¶Ð´Ñ‹Ðµ 2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð²ÑÐµ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸
- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ, Ð¾Ð½Ð° Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð² Ñ‚ÐµÑ‡ÐµÐ½Ð¸Ðµ 2 Ð¼Ð¸Ð½ÑƒÑ‚
- Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð° ÑÑ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

---

## ðŸŽ¯ Ð ÐÐ—ÐÐ˜Ð¦Ð ÐœÐ•Ð–Ð”Ð£ MANUAL Ð˜ AUTO Ð Ð•Ð–Ð˜ÐœÐÐœÐ˜

### MANUAL Ñ€ÐµÐ¶Ð¸Ð¼ (ÑÐ¸Ð³Ð½Ð°Ð»-Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€):
- âœ… ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ **ÐÐ• Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ** Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸, ÐµÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ
- âœ… ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð±Ð¾Ñ‚Ð° Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð²
- âœ… ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ
- âœ… ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· `/positions`

### AUTO Ñ€ÐµÐ¶Ð¸Ð¼ (Ñ€ÐµÐ°Ð»ÑŒÐ½Ð°Ñ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ):
- âœ… ÐŸÐ¾Ð·Ð¸Ñ†Ð¸Ð¸ **Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ** Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸, ÐµÑÐ»Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ
- âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ñ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸ÑÐ¼Ð¸ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ
- âœ… ÐžÐ±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ â†’ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¾Ñ€Ð´ÐµÑ€Ð° (TP1, TP2, SL)

---

## ðŸ“ Ð’Ð«Ð’ÐžÐ”Ð«

1. **Ð”Ð»Ñ AUTO Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** ÐÐ²Ñ‚Ð¾ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð´Ð»Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
2. **Ð”Ð»Ñ MANUAL Ñ€ÐµÐ¶Ð¸Ð¼Ð°:** ÐÐ²Ñ‚Ð¾ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°, Ñ‚Ð°Ðº ÐºÐ°Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ
3. **Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð°:** ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð±Ñ‹ÑÑ‚Ñ€ÑƒÑŽ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ
4. **Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾:** Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð·Ð°Ñ‰Ð¸Ñ‚Ð½Ñ‹Ðµ Ð¾Ñ€Ð´ÐµÑ€Ð° Ð¸ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ TP1/TP2

---

**Ð˜Ñ‚Ð¾Ð³:** Ð”Ð»Ñ auto Ñ€ÐµÐ¶Ð¸Ð¼Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÐºÐ°Ðº "Ð·ÐµÑ€ÐºÐ°Ð»Ð¾" Ð±Ð¸Ñ€Ð¶Ð¸ â€” ÐµÑÐ»Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð° Ð½Ð° Ð±Ð¸Ñ€Ð¶Ðµ, Ð¾Ð½Ð° Ð·Ð°ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ð¸ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾. Ð­Ñ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸.

