# –û–¢–ß–ï–¢: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –í–°–ï–• –ü–ê–†–ê–ú–ï–¢–†–û–í

## üéØ –û–ü–ò–°–ê–ù–ò–ï –ó–ê–î–ê–ß–ò

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å–∏–ª: "–≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∏–ª–∞? –∏ –Ω–æ–≤—ã–π –ø—Ä–∏–Ω—è—Ç—ã–π —Å–∏–≥–Ω–∞–ª –∏ –Ω–æ–≤—ã–π –¥—Ü–∞ —Å–∏–≥–Ω–∞–ª?" - —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã, —Ç–∞–∫ –∏ DCA —Å–∏–≥–Ω–∞–ª—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## ‚úÖ –ü–†–û–í–ï–†–ï–ù–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´

### 1. **–°—É–º–º–∞ –≤—Ö–æ–¥–∞ –≤ —Å–¥–µ–ª–∫—É** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –†–∏—Å–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–ª—Å—è –æ—Ç –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- **–†–µ—à–µ–Ω–∏–µ:** –†–∏—Å–∫ —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `risk_amount = free_deposit * dynamic_risk_pct / 100`

### 2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (+1%, +2%)
- **–†–µ—à–µ–Ω–∏–µ:** –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ TP –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø–æ–ª–æ—Å –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `get_dynamic_tp_levels(df, i, side)`

### 3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–∏—Å–∫–∞
- **–†–µ—à–µ–Ω–∏–µ:** –†–∏—Å–∫ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥—É (1-5%)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `get_dynamic_risk_pct(df, i)`

### 4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–µ—á–∏** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–ª–µ—á–æ
- **–†–µ—à–µ–Ω–∏–µ:** –ü–ª–µ—á–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º (0.5x-20x)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `get_dynamic_leverage(df, i, base_leverage)`

### 5. **–û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–ø–µ—Ä—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º

### 6. **DCA —Å–∏–≥–Ω–∞–ª—ã (—É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ)** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
- **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ª–æ–≥–∏–∫–µ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è
- **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è DCA
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **–§—É–Ω–∫—Ü–∏—è button - –æ–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:**
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
from signal_live import get_dynamic_leverage, get_dynamic_risk_pct
from shared_utils import get_dynamic_tp_levels

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
dynamic_risk_pct = get_dynamic_risk_pct(df, len(df) - 1)
dynamic_leverage = get_dynamic_leverage(df, len(df) - 1, leverage)
dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, len(df) - 1, side)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏
if side == "long":
    tp1 = current_price * (1 + dynamic_tp1_pct / 100)
    tp2 = current_price * (1 + dynamic_tp2_pct / 100)
else:
    tp1 = current_price * (1 - dynamic_tp1_pct / 100)
    tp2 = current_price * (1 - dynamic_tp2_pct / 100)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∏—Å–∫ –Ω–∞ —Å–¥–µ–ª–∫—É —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º
risk_amount = free_deposit * dynamic_risk_pct / 100

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—ä–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∏—Å–∫–∞ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–µ—á–∞
if trade_mode == "futures" and dynamic_leverage > 1:
    qty = risk_amount / current_price * dynamic_leverage
else:
    qty = risk_amount / current_price if current_price > 0 else 0
```

### 2. **–§—É–Ω–∫—Ü–∏—è button - DCA —Å–∏–≥–Ω–∞–ª—ã:**
```python
# –ü–æ–ª—É—á–∞–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è DCA
dynamic_risk_pct = get_dynamic_risk_pct(df, len(df) - 1)
dynamic_leverage = get_dynamic_leverage(df, len(df) - 1, leverage)
dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, len(df) - 1, side)

# –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ä–∞—Å—á–µ—Ç–µ DCA
new_qty, avg_price_new, tp1, tp2, limit_reached = dca_calculate_next_qty_and_tp(
    entry_prices, qtys, entry_price, dca_count, deposit,
    dynamic_risk_pct, dynamic_leverage, side, df=None, current_index=None
)
```

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏:**
```python
new_position = {
    "symbol": symbol,
    "entry_price": current_price,
    "tp1": tp1,
    "tp2": tp2,
    "qty": qty,
    "stage": "open",
    "risk_amount": risk_amount,
    "risk_pct": dynamic_risk_pct,        # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫
    "leverage": dynamic_leverage,        # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ
    "side": side,
    "tp1_pct": dynamic_tp1_pct,         # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP
    "tp2_pct": dynamic_tp2_pct,         # ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ TP
}
```

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `volatility > 2.4.4` ‚Üí `volatility > 2.4`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã `momentum > 0.0.0` ‚Üí `momentum > 0.0`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `notify_user` –≤ `telegram_bot.py`

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–ö–ò

### ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤:
```bash
python3 -m py_compile telegram_bot.py  # ‚úÖ –£—Å–ø–µ—à–Ω–æ
python3 -m py_compile signal_live.py   # ‚úÖ –£—Å–ø–µ—à–Ω–æ
```

### ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- **–û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ
- **DCA —Å–∏–≥–Ω–∞–ª—ã:** –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

### ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:
1. **`get_dynamic_tp_levels`** - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã
2. **`get_dynamic_risk_pct`** - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∏—Å–∫
3. **`get_dynamic_leverage`** - –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–µ—á–æ

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:**
```bash
python3 main.py
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:**
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" –≤ –æ–±—ã—á–Ω–æ–º —Å–∏–≥–Ω–∞–ª–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å—É–º–º–∞ –≤—Ö–æ–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ DCA —Å–∏–≥–Ω–∞–ª–æ–≤:**
- –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –ø–æ —Å–∏–º–≤–æ–ª—É
- –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–∏–Ω—è—Ç—å" –≤ DCA —Å–∏–≥–Ω–∞–ª–µ –ø–æ —Ç–æ–º—É –∂–µ —Å–∏–º–≤–æ–ª—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## üìã –ß–ï–ö–õ–ò–°–¢ –ü–†–û–í–ï–†–ö–ò

### –û–±—ã—á–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–ª–µ—á–æ
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—É–º–º—ã –≤—Ö–æ–¥–∞
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

### DCA —Å–∏–≥–Ω–∞–ª—ã:
- [x] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–∏
- [x] –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
- [x] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã –¥–ª—è DCA
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback
- [x] –ö–æ–º–ø–∏–ª—è—Ü–∏—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## üéâ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

### –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤:
- ‚úÖ –°—É–º–º–∞ –≤—Ö–æ–¥–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞
- ‚úÖ –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ BB
- ‚úÖ –†–∏—Å–∫ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è (1-5%)
- ‚úÖ –ü–ª–µ—á–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (0.5x-20x)
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –î–ª—è DCA —Å–∏–≥–Ω–∞–ª–æ–≤:
- ‚úÖ –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- ‚úÖ –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –¢–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –∫ —Ä—ã–Ω–æ—á–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- ‚úÖ –õ–æ–≥–∏–∫–∞ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–¥–∞–ø—Ç–∏–≤–Ω–∞
- ‚úÖ –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—á–∏—Ç—ã–≤–∞—é—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å fallback
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

1. **`get_dynamic_tp_levels(df, i, side)`**:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 20 —Å–≤–µ—á–µ–π
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–æ—Å—ã –ë–æ–ª–ª–∏–Ω–¥–∂–µ—Ä–∞
   - –ö–æ–º–±–∏–Ω–∏—Ä—É–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ BB –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö TP

2. **`get_dynamic_risk_pct(df, i)`**:
   - –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
   - –£–º–µ–Ω—å—à–∞–µ—Ç —Ä–∏—Å–∫ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

3. **`get_dynamic_leverage(df, i, base_leverage)`**:
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏ —Ç—Ä–µ–Ω–¥
   - –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º —Ç—Ä–µ–Ω–¥–µ
   - –£–º–µ–Ω—å—à–∞–µ—Ç –ø–ª–µ—á–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
```python
try:
    # –†–∞—Å—á–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    dynamic_risk_pct = get_dynamic_risk_pct(df, len(df) - 1)
    dynamic_leverage = get_dynamic_leverage(df, len(df) - 1, leverage)
    dynamic_tp1_pct, dynamic_tp2_pct = get_dynamic_tp_levels(df, len(df) - 1, side)
except Exception as e:
    # Fallback –Ω–∞ –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ
    dynamic_risk_pct = risk_pct
    dynamic_leverage = leverage
    dynamic_tp1_pct, dynamic_tp2_pct = 1.0, 2.0
```

---
**–î–∞—Ç–∞:** 20.08.2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ü–ê–†–ê–ú–ï–¢–†–´ –ü–†–û–í–ï–†–ï–ù–´ –ò –ò–°–ü–†–ê–í–õ–ï–ù–´
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –í –†–ï–ê–õ–¨–ù–´–• –£–°–õ–û–í–ò–Ø–•
