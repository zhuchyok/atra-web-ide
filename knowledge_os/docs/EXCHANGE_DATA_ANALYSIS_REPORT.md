# üìä –û–¢–ß–ï–¢: –ê–ù–ê–õ–ò–ó –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ê–ù–ù–´–• –° –ë–ò–†–ñ

## üîç **–¢–ï–ö–£–©–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø**

### **‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã –ë–ï–ó API –∫–ª—é—á–µ–π:**

#### **1. Binance API (–ø—É–±–ª–∏—á–Ω—ã–π):**
```python
url = "https://api.binance.com/api/v3/klines"
params = {"symbol": symbol, "interval": interval, "limit": limit}
```
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞
- **–õ–∏–º–∏—Ç—ã:** –î–æ 1000 –∑–∞–ø–∏—Å–µ–π
- **–¢–∞–π–º–∞—É—Ç:** 15 —Å–µ–∫—É–Ω–¥

#### **2. Bybit API (–ø—É–±–ª–∏—á–Ω—ã–π):**
```python
url = "https://api.bybit.com/v5/market/kline"
params = {"symbol": symbol, "interval": bybit_interval, "limit": limit, "category": "spot"}
```
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞
- **–õ–∏–º–∏—Ç—ã:** –î–æ 1000 –∑–∞–ø–∏—Å–µ–π
- **–¢–∞–π–º–∞—É—Ç:** 15 —Å–µ–∫—É–Ω–¥

#### **3. Bitget API (–ø—É–±–ª–∏—á–Ω—ã–π):**
```python
url = "https://api.bitget.com/api/spot/v1/market/candles"
params = {"symbol": bitget_symbol, "period": interval, "limit": limit}
```
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞
- **–õ–∏–º–∏—Ç—ã:** –î–æ 1000 –∑–∞–ø–∏—Å–µ–π
- **–¢–∞–π–º–∞—É—Ç:** 30 —Å–µ–∫—É–Ω–¥ (3 –ø–æ–ø—ã—Ç–∫–∏)

#### **4. CoinGecko API (–ø—É–±–ª–∏—á–Ω—ã–π):**
```python
url = f"https://api.coingecko.com/api/v3/coins/{coingecko_id}/ohlc"
params = {"vs_currency": "usd", "days": str(days)}
```
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞
- **–õ–∏–º–∏—Ç—ã:** Rate limit (429 –æ—à–∏–±–∫–∞)
- **–¢–∞–π–º–∞—É—Ç:** 15 —Å–µ–∫—É–Ω–¥

---

## ‚ö†Ô∏è **–í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´**

### **üìä –ò–∑ –ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã:**

#### **1. –ü—Ä–æ–±–ª–µ–º—ã —Å BTCUSDT:**
```
[DEBUG] BTCUSDT: Binance –≤–µ—Ä–Ω—É–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (len=0)
[DEBUG] BTCUSDT: Bybit –≤–µ—Ä–Ω—É–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (len=0)
[DEBUG] BTCUSDT: Bitget –≤–µ—Ä–Ω—É–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (len=0)
[DEBUG] BTCUSDT: CoinGecko –≤–µ—Ä–Ω—É–ª –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö (len=48)
```

#### **2. –¢–∞–π–º–∞—É—Ç—ã:**
```
Binance OHLC timeout –¥–ª—è BTCUSDT 1h (1 –ø–æ–ø—ã—Ç–∫–∞)
Bybit OHLC timeout –¥–ª—è BTCUSDT 1h (1 –ø–æ–ø—ã—Ç–∫–∞)
Bitget OHLC HTTP 400 –¥–ª—è BTCUSDT 1h
```

#### **3. Rate Limits:**
```
ERROR:root:–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–ø –º–æ–Ω–µ—Ç —Å Binance
```

---

## üîß **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú**

### **üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

#### **1. –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- **–í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** API –±–∏—Ä–∂
- **–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞** —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

#### **2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API:**
- **Rate limits** –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ API
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏** –±–∏—Ä–∂
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è** –≤ API –±–∏—Ä–∂

#### **3. –ü—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—Ä–æ—Å–∞–º–∏:**
- **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –∑–∞–ø—Ä–æ—Å–æ–≤
- **SSL –ø—Ä–æ–±–ª–µ–º—ã** (–æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞)
- **–¢–∞–π–º–∞—É—Ç—ã** —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ

---

## üõ†Ô∏è **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ**

### **‚úÖ 1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã**

#### **–¢–µ–∫—É—â–∏–µ —Ç–∞–π–º–∞—É—Ç—ã:**
```python
timeout = aiohttp.ClientTimeout(total=15, connect=5)  # Binance, Bybit, CoinGecko
timeout = aiohttp.ClientTimeout(total=30, connect=10)  # Bitget
```

#### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–∞–π–º–∞—É—Ç—ã:**
```python
timeout = aiohttp.ClientTimeout(total=30, connect=10)  # –£–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –≤—Å–µ—Ö
```

### **‚úÖ 2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏**

#### **–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- **Binance, Bybit, CoinGecko:** 1 –ø–æ–ø—ã—Ç–∫–∞
- **Bitget:** 3 –ø–æ–ø—ã—Ç–∫–∏

#### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ª–æ–≥–∏–∫–∞:**
```python
for attempt in range(3):  # 3 –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –≤—Å–µ—Ö
    try:
        # –∑–∞–ø—Ä–æ—Å
        break
    except asyncio.TimeoutError:
        if attempt < 2:
            await asyncio.sleep(2 ** attempt)  # –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
            continue
```

### **‚úÖ 3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**

#### **–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
print(f"[DEBUG] {symbol}: –ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}/3 —Å {source}")
print(f"[DEBUG] {symbol}: —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ {resp.status}")
print(f"[DEBUG] {symbol}: —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö {len(data) if data else 0}")
```

### **‚úÖ 4. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**

#### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ API:**
- **OKX API** (–ø—É–±–ª–∏—á–Ω—ã–π)
- **KuCoin API** (–ø—É–±–ª–∏—á–Ω—ã–π)
- **Gate.io API** (–ø—É–±–ª–∏—á–Ω—ã–π)

---

## üìã **–¢–ï–ö–£–©–ò–ô –°–¢–ê–¢–£–°**

### **‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è (–±–µ–∑ API –∫–ª—é—á–µ–π)
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:** 4 –±–∏—Ä–∂–∏
- **Fallback –ª–æ–≥–∏–∫–∞:** –ï—Å—Ç—å
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ï—Å—Ç—å (60 —Å–µ–∫—É–Ω–¥)

### **‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è:**
- **–¢–∞–π–º–∞—É—Ç—ã:** –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:** –ù–µ –¥–ª—è –≤—Å–µ—Ö –±–∏—Ä–∂
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–∞—è
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ù–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

### **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑ –ª–æ–≥–æ–≤:**
- **BTCUSDT:** 0% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å (–≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
- **–î—Ä—É–≥–∏–µ –º–æ–Ω–µ—Ç—ã:** –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- **–°–∏—Å—Ç–µ–º–∞:** –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ BTC —Ñ–∏–ª—å—Ç—Ä–∞

---

## üéØ **–ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô**

### **üîß –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

#### **1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã:**
```python
# –í ohlc_utils.py
timeout = aiohttp.ClientTimeout(total=30, connect=10)  # –î–ª—è –≤—Å–µ—Ö –±–∏—Ä–∂
```

#### **2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏:**
```python
# –î–ª—è Binance, Bybit, CoinGecko
for attempt in range(3):
    try:
        # –∑–∞–ø—Ä–æ—Å
        break
    except asyncio.TimeoutError:
        if attempt < 2:
            await asyncio.sleep(2 ** attempt)
            continue
```

#### **3. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```python
print(f"[DEBUG] {symbol}: {source} –ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}/3")
print(f"[DEBUG] {symbol}: {source} —Å—Ç–∞—Ç—É—Å {resp.status}")
```

### **üìà –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

#### **1. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ –±–∏—Ä–∂–∞–º
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

#### **2. –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:**
- OKX API
- KuCoin API
- Gate.io API

#### **3. –£–ª—É—á—à–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –≤—Ä–µ–º—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

---

## üìã **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï**

### **‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**
- **–ë–µ–∑ API –∫–ª—é—á–µ–π** ‚úÖ
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏** ‚úÖ
- **Fallback –ª–æ–≥–∏–∫–∞** ‚úÖ
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚úÖ

### **‚ö†Ô∏è –¢—Ä–µ–±—É—é—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏—è:**
- **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤** –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- **–£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### **üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:**
–°–∏—Å—Ç–µ–º–∞ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –±–∏—Ä–∂ –±–µ–∑ API –∫–ª—é—á–µ–π. –ü—Ä–æ–±–ª–µ–º—ã —Å–≤—è–∑–∞–Ω—ã —Å **—Å–µ—Ç–µ–≤—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏** –∏ **–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–±–æ—è–º–∏** API –±–∏—Ä–∂, –∞ –Ω–µ —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã.

**–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã!** üöÄ