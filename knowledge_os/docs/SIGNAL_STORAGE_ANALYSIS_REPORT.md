# üîç –û–¢–ß–ï–¢: –ê–ù–ê–õ–ò–ó –ú–ï–°–¢ –•–†–ê–ù–ï–ù–ò–Ø –°–ò–ì–ù–ê–õ–û–í

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 18 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∏–≥–Ω–∞–ª—ã –æ—Ç 17.11.2025 –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

---

## üìä **–í–´–Ø–í–õ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**

### **–°–∏–≥–Ω–∞–ª—ã –æ—Ç 17.11.2025 (SUIUSDT, LINKUSDT) –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram, –Ω–æ:**
- ‚ùå **–ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ `signals_log`** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ—Ç 9 –Ω–æ—è–±—Ä—è)
- ‚ùå **–ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ `accepted_signals`** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ—Ç 26 –æ–∫—Ç—è–±—Ä—è)
- ‚ùå **–ù–ï –Ω–∞–π–¥–µ–Ω—ã –≤ `risk_signal_history`** (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –æ—Ç 10 –Ω–æ—è–±—Ä—è)

### **–í—ã–≤–æ–¥:**
–°–∏–≥–Ω–∞–ª—ã **–æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram**, –Ω–æ **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ!

---

## üîç **–ê–ù–ê–õ–ò–ó –ö–û–î–ê**

### **1. –§—É–Ω–∫—Ü–∏—è `send_signal` (signal_live.py):**

```python
async def send_signal(...):
    # ... —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è ...
    # ... –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram ...
    
    # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ signals_log
    # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ signal_acceptance_manager
    # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ accepted_signals
    
    # ‚úÖ –ï–°–¢–¨: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ correlation_manager (—Ç–æ–ª—å–∫–æ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∏—Å–∫–æ–≤)
    await correlation_manager.save_signal_to_history_async(...)
    
    # ‚úÖ –ï–°–¢–¨: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ signal_history (—Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏)
    signal_history.append(signal_data)
```

### **2. –ì–¥–µ –î–û–õ–ñ–ù–´ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è —Å–∏–≥–Ω–∞–ª—ã:**

#### **A. –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram:**
- **`accepted_signals`** - —á–µ—Ä–µ–∑ `signal_acceptance_manager.register_signal()`
- **`signals_log`** - —á–µ—Ä–µ–∑ `db.insert_signal_log_entry()` –∏–ª–∏ `db.insert_signal_log()`

#### **B. –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ (–∫–Ω–æ–ø–∫–∞ "–ü–†–ò–ù–Ø–¢–¨"):**
- **`accepted_signals`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "accepted"
- **`signals_log`** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ result –Ω–∞ "OPEN"
- **`active_positions`** - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏

### **3. –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**

**–°–∏–≥–Ω–∞–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏:**
- ‚úÖ –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ü–†–ò–ù–Ø–¢–¨" ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `accepted_signals` –∏ `signals_log`
- ‚ùå –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram ‚Üí **–ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∏–≥–¥–µ**

---

## üéØ **–†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´**

### **–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ `send_signal`:**

```python
async def send_signal(...):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # üÜï –î–û–ë–ê–í–ò–¢–¨: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–∏–Ω—è—Ç–∏—è
    if SIGNAL_ACCEPTANCE_AVAILABLE and signal_acceptance_manager:
        try:
            signal_data_obj = SignalData(
                symbol=symbol,
                direction=signal_type,
                entry_price=signal_price,
                signal_time=datetime.now(),
                user_id=str(user_data.get("user_id")),
                chat_id=user_data.get("user_id"),
                tp1_price=tp1_price,
                tp2_price=tp2_price,
                sl_price=sl_price,
                leverage=leverage,
                risk_percent=risk_pct,
                entry_amount=entry_amount_usdt,
                confidence=ai_confidence
            )
            
            # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª (—Å–æ—Ö—Ä–∞–Ω–∏—Ç –≤ accepted_signals)
            message_id = ...  # –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
            await signal_acceptance_manager.register_signal(
                signal_data_obj, 
                message_id, 
                user_data.get("user_id")
            )
        except Exception as e:
            logger.error("‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∞: %s", e)
    
    # üÜï –î–û–ë–ê–í–ò–¢–¨: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ signals_log
    try:
        from db import db
        db.insert_signal_log_entry({
            "symbol": symbol,
            "entry": signal_price,
            "stop": sl_price,
            "tp1": tp1_price,
            "tp2": tp2_price,
            "entry_time": datetime.now().isoformat(),
            "result": "PENDING",  # –°—Ç–∞—Ç—É—Å –¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è
            "user_id": user_data.get("user_id"),
            # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...
        })
    except Exception as e:
        logger.error("‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ signals_log: %s", e)
```

---

## üìã **–¢–ê–ë–õ–ò–¶–´ –ë–ê–ó–´ –î–ê–ù–ù–´–•**

### **1. `signals_log` (trading.db):**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- **–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:** ‚ùå –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- **–ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:** ‚úÖ –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ (PENDING ‚Üí OPEN)

### **2. `accepted_signals` (trading.db):**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏–≥–Ω–∞–ª—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø—Ä–∏–Ω—è—Ç–∏—è
- **–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:** ‚ùå –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ
- **–ö–æ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:** ‚úÖ –ü—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ (pending ‚Üí accepted)

### **3. `risk_signal_history` (trading.db):**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å—Ç–æ—Ä–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∏—Å–∫–æ–≤
- **–ö–æ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:** ‚úÖ –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (—á–µ—Ä–µ–∑ correlation_manager)
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏–≥–Ω–∞–ª–µ

---

## ‚úÖ **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò**

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**

1. **–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `send_signal`:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `signal_acceptance_manager.register_signal()`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `signals_log` —á–µ—Ä–µ–∑ `db.insert_signal_log_entry()`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `message_id` –¥–æ—Å—Ç—É–ø–µ–Ω:**
   - –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å `message_id` –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
   - –ü–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –≤ `register_signal()`

3. **–û–±–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å `accepted_signals` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–∞—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å `risk_signal_history` –¥–ª—è —Å–∏–≥–Ω–∞–ª–æ–≤ –±–µ–∑ –ø—Ä–∏–Ω—è—Ç–∏—è

### **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

1. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
   - –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `save_signal_to_all_storage()` 
   - –í—ã–∑—ã–≤–∞—Ç—å –µ—ë –∏–∑ `send_signal`

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üîó **–°–í–Ø–ó–ê–ù–ù–´–ï –§–ê–ô–õ–´**

- `signal_live.py` - —Ñ—É–Ω–∫—Ü–∏—è `send_signal()` (—Å—Ç—Ä–æ–∫–∏ 3099-4300)
- `signal_acceptance_manager.py` - —Ñ—É–Ω–∫—Ü–∏—è `register_signal()` (—Å—Ç—Ä–æ–∫–∞ 84)
- `acceptance_database.py` - —Ñ—É–Ω–∫—Ü–∏—è `save_signal()` (—Å—Ç—Ä–æ–∫–∞ 153)
- `db.py` - —Ñ—É–Ω–∫—Ü–∏—è `insert_signal_log_entry()` (—Å—Ç—Ä–æ–∫–∞ 1654)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ `send_signal` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Telegram.

