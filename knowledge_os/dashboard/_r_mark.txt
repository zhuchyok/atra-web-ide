def _render_marketing():
        with st.form("ad_gen_form"):
            product_desc = st.text_area("–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞–≥–∞–∑–∏–Ω —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤ –ú–°–ö")
            project_marketing = st.selectbox("–ü—Ä–æ–µ–∫—Ç", ["‚Äî –ù–µ —É–∫–∞–∑–∞–Ω / –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è ‚Äî"] + _get_project_slugs(), key="marketing_project")
            submitted = st.form_submit_button("–°–æ–∑–¥–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é")
            if submitted and product_desc:
                project_ctx_marketing = None if project_marketing == "‚Äî –ù–µ —É–∫–∞–∑–∞–Ω / –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è ‚Äî" else project_marketing
                with st.spinner("–û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ (–ê—Ä—Ç–µ–º, –õ–∏–∑–∞, –ö—Ä–∏—Å—Ç–∏–Ω–∞) –≥–æ—Ç–æ–≤–∏—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é..."):
                    strategy_done = False
                    try:
                        script_path = "/app/knowledge_os/app/ad_generator.py"
                        if not os.path.isfile(script_path):
                            script_path = os.path.join(os.path.dirname(os.path.dirname(__file__)), "app", "ad_generator.py")
                        cmd = ["python3", script_path, product_desc]
                        result = subprocess.run(cmd, capture_output=True, text=True, timeout=120,
                                                cwd=os.path.dirname(os.path.dirname(__file__)) if not script_path.startswith("/app") else "/app")
                        if result.returncode == 0 and (result.stdout or "").strip():
                            st.markdown("### üìã –§–∏–Ω–∞–ª—å–Ω—ã–π –ü–ª–∞–Ω –ö–∞–º–ø–∞–Ω–∏–∏")
                            st.markdown(result.stdout)
                            st.success("–°—Ç—Ä–∞—Ç–µ–≥–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!")
                            strategy_done = True
                        elif result.stderr:
                            st.warning(f"–°–∫—Ä–∏–ø—Ç –≤–µ—Ä–Ω—É–ª –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: {(result.stderr or '')[:300]}")
                    except (FileNotFoundError, subprocess.TimeoutExpired) as e:
                        st.warning(f"–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
                    except Exception as e:
                        st.warning(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞: {e}")
                    if not strategy_done:
                        try:
                            conn = get_db_connection()
                            with conn.cursor() as cur:
                                cur.execute("""
                                    INSERT INTO tasks (title, description, status, assignee_expert_id, creator_expert_id, metadata, project_context)
                                    SELECT %s, %s, 'pending',
                                        (SELECT id FROM experts WHERE name = '–ê—Ä—Ç–µ–º' LIMIT 1),
                                        (SELECT id FROM experts WHERE name = '–í–∏–∫—Ç–æ—Ä–∏—è' LIMIT 1),
                                        %s, %s
                                    WHERE EXISTS (SELECT 1 FROM experts WHERE name = '–ê—Ä—Ç–µ–º')
                                """, (
                                    "üì¢ –†–µ–∫–ª–∞–º–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è",
                                    f"–°–æ–∑–¥–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏: {product_desc[:200]}",
                                    json.dumps({"source": "dashboard_marketing", "product_desc": product_desc}),
                                    project_ctx_marketing
                                ))
                                conn.commit()
                            st.info("üìã –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞. –û—Ç–¥–µ–ª –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ (–ê—Ä—Ç–µ–º) –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –µ—ë —á–µ—Ä–µ–∑ worker.")
                        except Exception as e2:
                            st.error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –¥–ª—è –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞: {e2}")

        # üïµÔ∏è‚Äç‚ôÇÔ∏è –†–ê–ó–í–ï–î–ö–ê (ENHANCED)

