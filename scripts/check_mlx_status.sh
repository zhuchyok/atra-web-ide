#!/bin/bash
# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº MLX API Server
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: bash scripts/check_mlx_status.sh

echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ MLX API Server - ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸ ÑÑ‚Ğ°Ñ‚ÑƒÑ"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ MLX
if ! curl -sf --connect-timeout 2 http://localhost:11435/health >/dev/null 2>&1; then
    echo "âŒ MLX API Server Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ½Ğ° http://localhost:11435"
    echo "   Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ: bash scripts/start_mlx_api_server.sh"
    exit 1
fi

echo "ğŸ“Š ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº..."
echo ""

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· backend API (ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)
if curl -sf --connect-timeout 2 http://localhost:8080/api/chat/mlx/metrics >/dev/null 2>&1; then
    echo "âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ backend API (http://localhost:8080/api/chat/mlx/metrics)"
    echo ""
    curl -s http://localhost:8080/api/chat/mlx/metrics | python3 -m json.tool 2>/dev/null || curl -s http://localhost:8080/api/chat/mlx/metrics
else
    echo "âš ï¸  Backend Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº MLX"
    echo ""
    curl -s http://localhost:11435/health | python3 -m json.tool 2>/dev/null || curl -s http://localhost:11435/health
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ’¡ Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:"
echo "   curl http://localhost:11435/health | python3 -m json.tool"
echo "   curl http://localhost:8080/api/chat/mlx/metrics | python3 -m json.tool"
echo ""
