# Проверка: «В работе» 0 задач — отчёт 2026-02-03

## Результаты проверки

### 1. Контейнеры
| Сервис | Статус |
|--------|--------|
| knowledge_os_worker | Up ~1 hour |
| knowledge_postgres | Up, healthy |
| victoria-agent, veronica-agent | Up |
| corporation-dashboard | Up |

### 2. База данных (прямой запрос)
```
 completed   |  6150
 in_progress |     5   ← сейчас в БД 5 задач «в работе»
 pending     |  2008
```

### 3. Воркер
- **Работает**: в логах видны завершённые задачи (`Task ... COMPLETED`), запросы к Ollama (HTTP 200).
- **Ollama**: доступен (`host.docker.internal:11434` → 200).
- **MLX**: сервер отвечает (200 на /), но `mlx модели (0)` в логах — воркер использует только Ollama.
- **BACKPRESSURE**: в последних 500 строках логов не появлялся — воркер не блокируется перегрузкой.

### 4. Дашборд
- Запрос к задачам: `FROM tasks` без фильтра по проекту — те же данные, что и воркер.
- Кэш: `fetch_data_tasks` с TTL **15 сек**. Кнопка «Обновить» сбрасывает кэш и подставляет `_cache_bust` для нового запроса к БД.

---

## Почему вы могли видеть 0 «В работе»

1. **Кэш 15 сек** — дашборд мог показать старый снимок, в момент которого в БД было 0 in_progress (например, между батчами воркера).
2. **Момент между батчами** — воркер обрабатывает до 5 задач параллельно; после завершения батча переводит задачи в `completed` и только в следующем цикле ставит новые в `in_progress`. В момент запроса к БД могло быть 0.
3. **Разное подключение к БД** — если дашборд запускался не из Docker (например, локально с `localhost:5432`), а воркер в Docker писал в `knowledge_postgres`, то цифры могли расходиться. Сейчас и дашборд, и воркер в compose используют один и тот же `DATABASE_URL` → `knowledge_postgres`.

---

## Рекомендации

1. **Нажать «Обновить»** на странице «Автономные Задачи и Оркестрация» — после сброса кэша должны отобразиться актуальные цифры (в т.ч. 5 в работе).
2. **Семантический кэш (исправлено):** Ошибка «expected 384 dimensions, not 768» устранена: миграция `fix_embedding_dimensions_768.sql`, унификация размерности 768 в semantic_cache, дашборде, scout/tacit_knowledge_miner; проверка перед save в кэш. См. CHANGES_FROM_OTHER_CHATS §0.1, MASTER_REFERENCE § эмбеддинги.
3. **Веб-поиск (исправлено):** Пакет `duckduckgo-search>=6.0.0` добавлен в `knowledge_os/requirements.txt` и корневой `requirements.txt`. После `pip install -r requirements.txt` (или пересборки образа воркера) предупреждение «duckduckgo_search не установлен» исчезнет.

---

## Итог

- Воркер запущен и обрабатывает задачи.
- В БД в момент проверки было **5 задач в статусе in_progress**.
- Ollama доступен; MLX не используется воркером (0 моделей).
- Оценка «0 в работе» на дашборде связана с кэшем или моментом опроса; после «Обновить» счётчик должен совпадать с БД.
