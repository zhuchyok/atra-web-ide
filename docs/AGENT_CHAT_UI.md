# –û–∫–Ω–æ —á–∞—Ç–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —à–∞–≥–æ–≤ –∞–≥–µ–Ω—Ç–∞ (–∫–∞–∫ –≤ Cursor)

**–î–∞—Ç–∞:** 2026-01-29

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ß–∞—Ç –≤ Web IDE –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–≤—Å–µ –º—ã—Å–ª–∏ –∏ –¥–µ–π—Å—Ç–≤–∏—è –∞–≥–µ–Ω—Ç–∞** –≤ —Å—Ç–∏–ª–µ Cursor Agent: –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —à–∞–≥–∏ (–∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞, –ø–æ–∏—Å–∫ —ç–∫—Å–ø–µ—Ä—Ç–∞, –∑–∞–ø—Ä–æ—Å –∫ Victoria, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –∏ —Ç.–¥.).

### Backend (SSE)

- –í –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–±—ã—Ç–∏—è —Ç–∏–ø–∞ **`step`**:
  - `stepType`: `thought` | `exploration` | `action` | `clarification`
  - `title`: –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä ¬´–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞¬ª, ¬´–ó–∞–ø—Ä–æ—Å –∫ Victoria Agent¬ª)
  - `content`: –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞
  - `duration`: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä `"3s"`)

- –°–µ–π—á–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —à–∞–≥–∏:
  1. **thought** ‚Äî ¬´–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞¬ª (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—Ä–æ—Å–∞, –ø–æ–¥–±–æ—Ä —ç–∫—Å–ø–µ—Ä—Ç–∞ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ RAG)
  2. **exploration** ‚Äî ¬´–≠–∫—Å–ø–µ—Ä—Ç –Ω–∞–π–¥–µ–Ω¬ª (–µ—Å–ª–∏ —ç–∫—Å–ø–µ—Ä—Ç –Ω–∞–π–¥–µ–Ω –≤ Knowledge OS)
  3. **action** ‚Äî ¬´–ó–∞–ø—Ä–æ—Å –∫ Victoria Agent¬ª, –∑–∞—Ç–µ–º ¬´–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞¬ª
  4. –ü—Ä–∏ fallback –Ω–∞ MLX ‚Äî **action** ¬´–ó–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç¬ª

### Frontend

- **Store** (`stores/chat.js`):
  - –£ —Å–æ–æ–±—â–µ–Ω–∏–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –µ—Å—Ç—å –º–∞—Å—Å–∏–≤ `steps`.
  - –ü—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ `type === 'step'` —à–∞–≥ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (`appendStep`).
  - –†–µ–∂–∏–º —á–∞—Ç–∞ `chatMode`: `agent` | `plan` | `ask` (–ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ API –∫–∞–∫ `mode`).

- **Chat.svelte**:
  - **–†–µ–∂–∏–º—ã (–∫–∞–∫ –≤ Cursor):** –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å **‚àû –ê–≥–µ–Ω—Ç** | **üìã –ü–ª–∞–Ω** | **üí¨ Ask** –Ω–∞–¥ —á–∞—Ç–æ–º.
    - **–ê–≥–µ–Ω—Ç** ‚Äî –ø–æ–ª–Ω—ã–π Victoria (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø—Ä–∞–≤–∫–∏, –∫–æ–º–∞–Ω–¥—ã).
    - **–ü–ª–∞–Ω** ‚Äî —Ç–æ–ª—å–∫–æ –ø–ª–∞–Ω (–±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è), –æ—Ç–≤–µ—Ç —Å—Ç—Ä–∏–º–∏—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç.
    - **Ask** ‚Äî –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ MLX –±–µ–∑ Victoria.
  - **–ü–∞–Ω–µ–ª—å ¬´–®–∞–≥–∏ –∞–≥–µ–Ω—Ç–∞¬ª** –≤–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞: –Ω–∞–¥ –ª–µ–Ω—Ç–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–ª–æ–∫ —Å —à–∞–≥–∞–º–∏ (üí≠ üîç ‚ö°), —á—Ç–æ–±—ã —à–∞–≥–∏ –±—ã–ª–∏ –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω—ã.
  - –ù–∞–¥ —Ç–µ–∫—Å—Ç–æ–º –æ—Ç–≤–µ—Ç–∞ –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ ‚Äî –±–ª–æ–∫ —à–∞–≥–æ–≤ (–∏–∫–æ–Ω–∫–∞ + –∑–∞–≥–æ–ª–æ–≤–æ–∫ + –æ–ø–∏—Å–∞–Ω–∏–µ).
  - –¢–∏–ø—ã —à–∞–≥–æ–≤: üí≠ –º—ã—Å–ª—å, üîç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, ‚ö° –¥–µ–π—Å—Ç–≤–∏–µ, ‚ùì —É—Ç–æ—á–Ω–µ–Ω–∏–µ (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ).
  - –°—Ç–∏–ª—å: –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ —Å–ª–µ–≤–∞ (–∫–∞–∫ –≤ Cursor), —Ä–∞–∑–Ω—ã–µ —Ü–≤–µ—Ç–∞ –ø–æ —Ç–∏–ø—É —à–∞–≥–∞.

- –í–æ –≤—Ä–µ–º—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –ø–æ–¥–ø–∏—Å—å: ¬´–ê–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç‚Ä¶¬ª.

## –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã (–¥–∞–ª—å—à–µ)

–ß—Ç–æ–±—ã –∞–≥–µ–Ω—Ç **–∑–∞–¥–∞–≤–∞–ª —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã** –∏ –∂–¥–∞–ª –æ—Ç–≤–µ—Ç–∞ (–∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç):

1. **Backend**: –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É—Ç–æ—á–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   - `type: 'clarification'`, `content: '–ö–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —Ñ–∞–π–ª –∏–º–µ–µ—Ç—Å—è –≤ –≤–∏–¥—É?'`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `pause: true`.
2. **Frontend**: –ø—Ä–∏ `pause: true` (–∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–ª–∞–≥–µ) –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–∏–º–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø–æ–¥ –≤–æ–ø—Ä–æ—Å–æ–º; –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–æ–º –∂–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (—Ç–æ –∂–µ `conversation_id` –∏–ª–∏ —Ü–µ–ø–æ—á–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π) –∏ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∞–≥–µ–Ω—Ç–∞.

–°–µ–π—á–∞—Å —à–∞–≥ —Ç–∏–ø–∞ **clarification** –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ —à–∞–≥–æ–≤; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –≤ —á–∞—Ç–µ.

## –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —à–∞–≥–∏

–í `backend/app/routers/chat.py` –≤ `sse_generator` –≤—Å—Ç–∞–≤—å—Ç–µ:

```python
yield f"data: {json.dumps({
    'type': 'step',
    'stepType': 'thought',  # –∏–ª–∏ exploration, action, clarification
    'title': '–ó–∞–≥–æ–ª–æ–≤–æ–∫',
    'content': '–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞.',
    'duration': '3s'  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
})}\n\n"
```

–ù–∞ —Ñ—Ä–æ–Ω—Ç–µ –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –≤ –±–ª–æ–∫–µ —à–∞–≥–æ–≤ –Ω–∞–¥ –æ—Ç–≤–µ—Ç–æ–º.
