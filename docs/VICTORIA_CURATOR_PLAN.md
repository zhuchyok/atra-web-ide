# Куратор Victoria и корпорации на Mac Studio

**Назначение:** как агент в Cursor может ставить задачи Victoria, получать ответы, проверять цепочку и находить недостатки — «научить её быть как я», используя мощь локальных моделей. Роль: **куратор и наставник** Victoria и всей корпорации. Цель: **лучшая корпорация в своём деле** — точные ответы, правильная маршрутизация, эталоны в базе знаний.

**Обновлено:** 2026-02-08

---

## 1. Могу ли я это делать

**Да.** При условии что Victoria (и при необходимости backend) доступны:

- Я могу вызывать Victoria через **скрипты** (например `scripts/ask_victoria.py` или новый `scripts/curator_send_tasks_to_victoria.py`) из терминала.
- Скрипты делают **POST** на `http://localhost:8010/run` (или `VICTORIA_URL`) с `goal` и при необходимости `project_context`, получают **ответ** (output, knowledge, correlation_id).
- Я могу **читать результаты** из сохранённого отчёта (JSON/Markdown) и по ним анализировать цепочку, формулировать недостатки и рекомендации.

То есть: **ставить задачи → получать ответы → проверять цепочку и действия → находить минусы и предлагать улучшения** — технически возможно.

---

## 2. Что видно в цепочке сегодня

| Что нужно куратору | Где брать |
|--------------------|-----------|
| Итоговый ответ (output) | В ответе Victoria: `TaskResponse.output` |
| Маршрут (Victoria vs Veronica, quick_data) | В ответе: `TaskResponse.knowledge` → `execution_trace` (routed_to, task_type, delegated_to) |
| correlation_id для трассировки | В ответе 202 (async) или в заголовке/теле синхронного ответа; в логах Victoria по этому id можно искать шаги |
| Пошаговые шаги ReAct (думаю → инструмент → результат) | Сейчас в ответе не отдаются целиком; видны в **логах** Victoria (`docker logs victoria-agent` или файл логов по correlation_id) |

**Итог:** для «первого времени» достаточно: **goal → output + knowledge (trace)**. Для глубокого разбора цепочки — дочитать логи по `correlation_id` (скрипт может сохранять correlation_id в отчёт; разбор логов — отдельный шаг или доработка API на «verbose steps»).

---

## 3. Роль куратора

- **Ставить задачи** Victoria (и при необходимости — оркестратору/корпорации) по заранее составленному списку (простые, средние, сложные, пограничные).
- **Собирать ответы** в один отчёт (goal, output, knowledge, correlation_id, время).
- **Проверять цепочку и действия:** куда пошёл запрос (Veronica / Victoria / quick_data), что вернулось, насколько ответ соответствует задаче и стандартам (как бы сделал я — Cursor-агент: точность, полнота, без лишнего, по чеклисту).
- **Фиксировать недостатки и минусы:** неверный маршрут, пустой/неполный ответ, галлюцинации, игнор контекста, слабая декомпозиция и т.д.
- **Предлагать улучшения:** промпты, пороги маршрутизации, обучение по knowledge_nodes, форматы ответа — чтобы Victoria и корпорация на Mac Studio со временем работали «как я», на локальных моделях.

---

## 4. Как это организовано технически

1. **Список задач для кураторского прогона**  
   Файл с целями (по одной на строку или JSON-массив), например `scripts/curator_tasks.txt` или `docs/curator_tasks.json`. Можно расширять: простые («привет», «статус»), средние («покажи файлы в frontend»), сложные («найди потенциальные баги в backend/app»).

2. **Скрипт прогона**  
   **Одной командой:** `./scripts/run_curator.sh` — две задачи («привет», «что ты умеешь?»), async, отчёт в docs/curator_reports/.  
   Полный скрипт `scripts/curator_send_tasks_to_victoria.py`:
   - читает список задач;
   - для каждой: POST /run (sync или async с опросом статуса);
   - сохраняет в отчёт: goal, status, output (или превью), knowledge (trace), correlation_id, длительность, ошибки.

3. **Каталог отчётов**  
   Например `docs/curator_reports/` — один файл на прогон (дата + время), чтобы я мог открыть последний (или выбранный) отчёт и проанализировать.

4. **Анализ и выводы**  
   Я (Cursor-агент) по отчёту:
   - проверяю соответствие ответа задаче;
   - отмечаю сбои маршрутизации, пустые/слабые ответы, лишний текст;
   - записываю выводы в `docs/curator_reports/FINDINGS_YYYY-MM-DD.md` или в раздел «Куратор» в CHANGES / MASTER_REFERENCE.

5. **Периодичность**  
   По вашему запросу: «прогони кураторский набор» или «проверь Victoria» — я запускаю скрипт, читаю отчёт и пишу выводы. При желании можно добавить запуск по расписанию (cron/launchd) с сохранением отчётов.

---

## 5. Куратор как наставник: эталоны и обучение

Чтобы корпорация становилась **лучшей в своём деле**, куратор не только проверяет, но и **наставляет**:

1. **Эталон ответа**  
   Для типовых запросов куратор формулирует, «как бы ответил сам» (точность, тон, объём). Эталон сохраняется в FINDINGS или в `docs/curator_reports/standards/` и используется при сравнении с output Victoria.

2. **Передача в базу знаний**  
   Удачные пары «запрос → ответ» и стабильные формулировки (как у куратора) — кандидаты для добавления в **knowledge_nodes** (RAG). Так Victoria со временем опирается на эталонные ответы и мировые практики (MASTER_REFERENCE, чеклист).

3. **Единый источник возможностей**  
   Текст «что ты умеешь» хранится в **configs/victoria_capabilities.txt**; правки только там. Куратор при изменении формулировок правит этот файл и при необходимости обновляет эталон в чеклисте.

4. **Чеклист при разборе**  
   При анализе отчёта куратор идёт по **docs/curator_reports/CURATOR_CHECKLIST.md**: соответствие задаче, маршрутизация, эталон «как я», что зафиксировать в FINDINGS, что передать в обучение.

5. **Периодичность и цель**  
   По запросу: «прогони кураторский набор», «проверь Victoria», «сделаем лучшую корпорацию». Цель — не только искать баги, но и поднимать качество ответов и решений до уровня куратора (наставника).

---

## 6. Ограничения и развитие

- **Доступность:** Victoria должна быть запущена (Docker или локально, порт 8010). Если недоступна — скрипт пишет это в отчёт, я фиксирую в выводах.
- **Трассировка:** полные пошаговые шаги ReAct сейчас в логах; при необходимости можно добавить в API опцию `verbose=true` и возвращать steps в ответе.
- **Сравнение «как я»:** я могу описать эталон (как бы ответил/сделал сам) текстом в FINDINGS и сравнить с output Victoria; формализованный «diff» или скоринг при желании добавить позже.

---

## 7. Ссылки

- Victoria API: POST /run, GET /run/status/{task_id} — `src/agents/bridge/victoria_server.py`
- Чат из терминала: `scripts/ask_victoria.py`, `scripts/victoria_chat.py`
- Быстрый прогон: `./scripts/run_curator.sh` (по умолчанию 2 задачи, async)
- Скрипт куратора: `scripts/curator_send_tasks_to_victoria.py`
- Добавить эталон в RAG: `DATABASE_URL=... python3 scripts/curator_add_standard_to_knowledge.py` (эталон «что ты умеешь»)
- Отчёты: `docs/curator_reports/` (создаётся при первом прогоне)
- Чеклист куратора при разборе: `docs/curator_reports/CURATOR_CHECKLIST.md`