# MLX API Server ‚Äî –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–î–∞—Ç–∞:** 26.01.2026  
**–ü—Ä–æ–±–ª–µ–º–∞:** MLX API Server —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏

---

## üîç –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª—é—á–µ–Ω–∏—è

### 1. **–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (crash)**
- **–ü—Ä–∏—á–∏–Ω—ã:**
  - OOM (Out of Memory) ‚Äî –±–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (70B+) –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ RAM
  - –û—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ (–∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
  - –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤ (11434 –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º)
  - –ü—Ä–æ–±–ª–µ–º—ã —Å MLX –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π

### 2. **–ù–µ—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞**
- –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `nohup`, –Ω–æ –Ω–µ—Ç launchd –¥–ª—è –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ Mac Studio —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3. **–ú–æ–Ω–∏—Ç–æ—Ä –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**
- `monitor_mlx_api_server.sh` –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏, –Ω–æ –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ launchd

### 4. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–æ–º**
- **–ë—ã–ª–æ:** `start_mlx_api_server.sh` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ—Ä—Ç 11435, –Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∂–∏–¥–∞–ª–∞ 11434
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç 11434

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—Ç: 11435 ‚Üí 11434**
- ‚úÖ `scripts/start_mlx_api_server.sh` ‚Äî –ø–æ—Ä—Ç 11434
- ‚úÖ `scripts/monitor_mlx_api_server.sh` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 11434
- ‚úÖ `scripts/system_auto_recovery.sh` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 11434
- ‚úÖ `knowledge_os/app/mlx_api_server.py` ‚Äî –ø–æ—Ä—Ç 11434 –≤ `__main__`

### 2. **–°–æ–∑–¥–∞–Ω launchd plist –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞**
- ‚úÖ `scripts/setup_mlx_autostart.sh` ‚Äî —Å–æ–∑–¥–∞–µ—Ç `com.atra.mlx-api-server.plist`
- ‚úÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Mac Studio
- ‚úÖ KeepAlive ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- ‚úÖ –õ–æ–≥–∏: `~/Library/Logs/atra-mlx-api-server.log`

### 3. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ `mlx_api_server.py`: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ `get_model()`, `list_models()`
- ‚úÖ Graceful shutdown –ø—Ä–∏ SIGTERM/SIGINT
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

### 4. **–£–ª—É—á—à–µ–Ω —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PID –≤ `~/Library/Logs/atra/mlx_api_server.pid`
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –∏ retry –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- ‚úÖ –í—ã–≤–æ–¥ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ MLX API Server

```bash
cd /Users/bikos/Documents/atra-web-ide
bash scripts/setup_mlx_autostart.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç `~/Library/LaunchAgents/com.atra.mlx-api-server.plist`
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ launchd
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Mac Studio
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ (KeepAlive)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
bash scripts/setup_system_auto_recovery.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–∑–¥–∞–µ—Ç `com.atra.mlx-monitor.plist` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç MLX –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–¥–æ 5 —Ä–∞–∑/—á–∞—Å)

---

## üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
ps aux | grep mlx_api_server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞
lsof -i :11434

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:11434/api/tags

# –ü—Ä–æ–≤–µ—Ä–∫–∞ launchd
launchctl list | grep mlx
```

### –õ–æ–≥–∏

```bash
# –õ–æ–≥–∏ MLX API Server
tail -f ~/Library/Logs/atra/mlx_api_server.log

# –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∞
tail -f ~/Library/Logs/atra-mlx-monitor.log

# –û—à–∏–±–∫–∏
tail -f ~/Library/Logs/atra-mlx-api-server.error.log
```

### –†—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pkill -f "uvicorn.*mlx_api_server"
# –∏–ª–∏
launchctl stop com.atra.mlx-api-server

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
bash scripts/start_mlx_api_server.sh
# –∏–ª–∏
launchctl start com.atra.mlx-api-server
```

---

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. "–ü–æ—Ä—Ç 11434 —É–∂–µ –∑–∞–Ω—è—Ç"

```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
lsof -i :11434

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
kill $(lsof -ti:11434)

# –ò–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ launchd
launchctl stop com.atra.mlx-api-server
launchctl start com.atra.mlx-api-server
```

### 2. "–ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª–∏ –Ω–µ –≤ `~/mlx-models/` –∏–ª–∏ –ø—É—Ç–∏ –Ω–µ–≤–µ—Ä–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥–µ–ª–∏
ls -la ~/mlx-models/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
grep MODEL_PATHS knowledge_os/app/mlx_api_server.py
```

### 3. "Out of Memory"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (70B+) –∑–∞–Ω–∏–º–∞—é—Ç –≤—Å—é RAM

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–∏–µ –º–æ–¥–µ–ª–∏ (32B, 7B)
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 4. "–ü—Ä–æ—Ü–µ—Å—Å –ø–∞–¥–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞"

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -50 ~/Library/Logs/atra/mlx_api_server.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python3 -c "import mlx_lm, uvicorn, fastapi; print('OK')"
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `setup_mlx_autostart.sh` –∏ `setup_system_auto_recovery.sh`:

1. **MLX API Server** ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ launchd
2. **–ú–æ–Ω–∏—Ç–æ—Ä** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
3. **System Auto Recovery** ‚Äî –æ–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –°—Ç–∞—Ç—É—Å launchd —Å–µ—Ä–≤–∏—Å–æ–≤
launchctl list | grep -E "mlx|atra"

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# - com.atra.mlx-api-server (MLX API Server)
# - com.atra.mlx-monitor (–º–æ–Ω–∏—Ç–æ—Ä, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- [ ] –ü–æ—Ä—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω: –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç 11434
- [ ] `bash scripts/setup_mlx_autostart.sh` ‚Äî –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ MLX
- [ ] `bash scripts/setup_system_auto_recovery.sh` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: `launchctl list | grep mlx`
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: `curl http://localhost:11434/api/tags`
- [ ] –õ–æ–≥–∏: `tail -f ~/Library/Logs/atra/mlx_api_server.log`

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ launchd** –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ (–Ω–µ `nohup` –≤—Ä—É—á–Ω—É—é)
2. **–ú–æ–Ω–∏—Ç–æ—Ä –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –º–æ–¥–µ–ª–∏** ‚Äî –Ω–µ –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –≤—Å–µ —Å—Ä–∞–∑—É (—ç–∫–æ–Ω–æ–º–∏—è RAM)

---

*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: 26.01.2026*
