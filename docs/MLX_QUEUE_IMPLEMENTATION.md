# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –¥–ª—è MLX API Server

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. MLX Request Queue (`mlx_request_queue.py`)
- ‚úÖ –û—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ (HIGH, MEDIUM, LOW)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (max_concurrent)
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ MLX API Server
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Request-Priority`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
- ‚úÖ Fallback –Ω–∞ –ø—Ä—è–º—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

#### Extended Thinking (—á–∞—Ç —Å –í–∏–∫—Ç–æ—Ä–∏–µ–π)
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç `X-Request-Priority: high` –¥–ª—è —á–∞—Ç–æ–≤
- ‚úÖ –ß–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

#### ReActAgent (Task Distribution)
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç `X-Request-Priority: medium` –¥–ª—è –∑–∞–¥–∞—á
- ‚úÖ Task Distribution –º–æ–∂–µ—Ç –ø–æ–¥–æ–∂–¥–∞—Ç—å, –µ—Å–ª–∏ –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã —á–∞—Ç–æ–º

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. **HIGH** - –ß–∞—Ç —Å –í–∏–∫—Ç–æ—Ä–∏–µ–π
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º
   - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è Task Distribution
   - –ò—Å—Ç–æ—á–Ω–∏–∫: Extended Thinking, Local Router (–¥–ª—è —á–∞—Ç–æ–≤)

2. **MEDIUM** - Task Distribution
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ HIGH
   - –ú–æ–∂–µ—Ç –ø–æ–¥–æ–∂–¥–∞—Ç—å, –µ—Å–ª–∏ –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã
   - –ò—Å—Ç–æ—á–Ω–∏–∫: ReActAgent (—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏)

3. **LOW** - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º
   - –î–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

```
–ó–∞–ø—Ä–æ—Å ‚Üí MLX API Server
  ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (X-Request-Priority)
  ‚Üì
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
  ‚Üì
–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:
  - HIGH –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏
  - MEDIUM –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ HIGH
  - LOW –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏
  ‚Üì
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (max_concurrent = 5)
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
MLX_MAX_CONCURRENT=5        # –ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
MLX_MAX_QUEUE_SIZE=50      # –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏
```

### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
```http
X-Request-Priority: high    # –î–ª—è —á–∞—Ç–æ–≤ —Å –í–∏–∫—Ç–æ—Ä–∏–µ–π
X-Request-Priority: medium  # –î–ª—è Task Distribution (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
X-Request-Priority: low     # –î–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
```

## ‚ùì –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: –ß–∞—Ç —Å –í–∏–∫—Ç–æ—Ä–∏–µ–π –≤ –æ—á–µ—Ä–µ–¥–∏?

**–î–ê, –Ω–æ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º HIGH:**

1. **–ß–∞—Ç —Å –í–∏–∫—Ç–æ—Ä–∏–µ–π** –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º HIGH
2. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º** –ø—Ä–∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ —Å–ª–æ—Ç–∞
3. **Task Distribution** (MEDIUM) –∂–¥–µ—Ç, –µ—Å–ª–∏ –≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã —á–∞—Ç–æ–º
4. **–ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** Task Distribution - —á–∞—Ç –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:

```
–°—Ü–µ–Ω–∞—Ä–∏–π: 3 —á–∞—Ç–∞ + 5 –∑–∞–¥–∞—á Task Distribution

–û—á–µ—Ä–µ–¥—å:
1. –ß–∞—Ç 1 (HIGH) ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É
2. –ß–∞—Ç 2 (HIGH) ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É  
3. –ß–∞—Ç 3 (HIGH) ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É
4. –ó–∞–¥–∞—á–∞ 1 (MEDIUM) ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (–µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–ª–æ—Ç)
5. –ó–∞–¥–∞—á–∞ 2 (MEDIUM) ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ä–∞–∑—É (–µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–π —Å–ª–æ—Ç)
6. –ó–∞–¥–∞—á–∞ 3 (MEDIUM) ‚Üí –≤ –æ—á–µ—Ä–µ–¥–∏ (–≤—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã)
7. –ó–∞–¥–∞—á–∞ 4 (MEDIUM) ‚Üí –≤ –æ—á–µ—Ä–µ–¥–∏
8. –ó–∞–¥–∞—á–∞ 5 (MEDIUM) ‚Üí –≤ –æ—á–µ—Ä–µ–¥–∏

–ö–æ–≥–¥–∞ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —Å–ª–æ—Ç:
- –°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è HIGH (—á–∞—Ç—ã)
- –ó–∞—Ç–µ–º MEDIUM (Task Distribution)
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–ß–∞—Ç –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è** Task Distribution
2. ‚úÖ **Task Distribution –Ω–µ –ø–∞–¥–∞–µ—Ç** –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ (–∂–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏)
3. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º
4. ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏** (max_concurrent + max_queue_size)
5. ‚úÖ **–¢–∞–π–º–∞—É—Ç—ã** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
2. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (max_concurrent, max_queue_size)
