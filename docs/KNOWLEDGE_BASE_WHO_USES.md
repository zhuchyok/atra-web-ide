# Кто загружает и использует базу знаний (Knowledge OS)

## Одна или несколько баз?

**Одна.** Вся корпорация использует одну базу знаний: PostgreSQL (база `knowledge_os`, таблицы `knowledge_nodes`, `experts`, `domains`, `tasks` и др.). Оркестратор, Виктория и Вероника подключаются к одной и той же БД (переменная `DATABASE_URL`).

## Текущее состояние

| Компонент | Загружает БД? | Использует knowledge_nodes / экспертов? | Как |
|-----------|----------------|----------------------------------------|-----|
| **Оркестратор** (knowledge_os/app/orchestrator.py) | ✅ Да | ✅ Да | Подключается к PostgreSQL (DATABASE_URL), читает/пишет knowledge_nodes, читает experts. Всегда при запуске цикла оркестрации. |
| **Виктория** (src/agents/bridge/victoria_server.py) | ✅ Да (по умолчанию) | ✅ Да | По умолчанию `USE_KNOWLEDGE_OS=true`: пул к БД, загрузка экспертов (_load_expert_team), контекст из knowledge_nodes (_get_knowledge_context), запись после задачи (_learn_from_task). Выключить: `USE_KNOWLEDGE_OS=false`. |
| **Вероника** (src/agents/bridge/server.py) | ✅ Да (по умолчанию) | ✅ Да | Та же БД (DATABASE_URL): пул к PostgreSQL, перед задачей запрос релевантных знаний из knowledge_nodes и подстановка в промпт. Выключить: `USE_KNOWLEDGE_OS=false`. |
| **Сотрудники (эксперты)** | — | Через Викторию | Список экспертов загружает Виктория из таблицы experts (при USE_KNOWLEDGE_OS=true). Сами эксперты не подключаются к БД — Виктория подставляет контекст и выбор эксперта при оркестрации. |

## Итог

- **Оркестратор** — всегда использует базу знаний.
- **Виктория** — по умолчанию использует (эксперты + чтение/запись знаний). Можно отключить через `USE_KNOWLEDGE_OS=false`.
- **Вероника** — по умолчанию использует ту же базу (контекст из knowledge_nodes подставляется в промпт).
- **Сотрудники** — участвуют через Викторию (данные из БД), отдельного доступа к БД у них нет.

Чтобы все звенья (оркестратор, Виктория, контекст для сотрудников) опирались на базу знаний, нужно:

1. ~~Включить использование Knowledge OS для Виктории по умолчанию~~ — **сделано**: по умолчанию `USE_KNOWLEDGE_OS=true`.
2. ~~Добавить Веронике доступ к базе знаний~~ — **сделано**: Вероника подключается к той же БД и подставляет релевантные знания из knowledge_nodes в промпт.

## Использование базы знаний Викторией

По умолчанию Виктория использует Knowledge OS. Выключить: `USE_KNOWLEDGE_OS=false` в окружении.

При включённой интеграции Виктория будет:
- подгружать список экспертов из БД;
- подставлять релевантные знания из knowledge_nodes в контекст задачи;
- записывать результат выполнения в knowledge_nodes для обучения.
