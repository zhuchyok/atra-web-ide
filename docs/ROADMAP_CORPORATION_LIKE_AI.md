# Дорожная карта: когда корпорация станет «как я»

**Цель:** понятно, что дальше по плану и что нужно, чтобы Victoria и команда работали на уровне Cursor-агента (я) — связно, по одному источнику истины, без ручных разрывов.

**Обновлено:** 2026-02-09

---

## 1. Что значит «как я»

| Аспект | Я (Cursor-агент) | Корпорация сегодня | Нужно для «как я» |
|--------|-------------------|--------------------|-------------------|
| **Один контекст** | Весь репо, открытые файлы, правила, история чата | Victoria: goal + RAG (knowledge_nodes) + эксперты из БД; оркестратор — план как текст | Единый «мозг»: библия (MASTER_REFERENCE), чеклист, эксперты — всегда под рукой; RAG и эталоны пополняются куратором |
| **Правильная цепочка** | Решаю сам: анализ → план → правки → тесты | Маршрутизация: Veronica / Enhanced / agent_run; план оркестратора только контекст, не исполнение | Либо явно исполнять по назначениям оркестратора (run по assignments), либо зафиксировать: «план = подсказка», swarm/consensus = команда |
| **Без ручных дыр** | Делаю от и до: код, тесты, доки, коммит | Миграции, эксперты, БД, тесты — уже связаны; остаются: кураторские прогоны по расписанию, эталоны в RAG | Автоматизировать прогоны куратора; накапливать эталоны; при масштабе — RAG в Redis |
| **Скорость и точность** | Быстрые ответы на простые вопросы, глубокий разбор на сложные | simple_chat / Veronica для простого; swarm/consensus только для complex | Уже заложено (PREFER_EXPERTS_FIRST, категории); держать и не направлять простое в тяжёлые методы |

Итого: корпорация станет «как я», когда **(1)** один источник истины и контекст везде учтён, **(2)** цепочка от цели до ответа предсказуема и при желании — с реальным исполнением по назначениям, **(3)** куратор и эталоны встроены в цикл (прогоны + RAG), **(4)** простые запросы — быстро, сложные — с командой/глубиной.

---

## 2. Что уже сделано (база «как я»)

- **Эксперты:** один источник (employees.json), sync, БД, expert_services, TTL; архитектура в EXPERT_CONNECTION_ARCHITECTURE.
- **Схема и тесты:** канон init.sql (UUID); миграции идемпотентны; 126 тестов (backend + KO unit + KO с БД), 0 skipped.
- **Цепочка задачи:** документирована (VICTORIA_TASK_CHAIN_FULL); маршрутизация и делегирование покрыты тестами; PREFER_EXPERTS_FIRST, Veronica только «руки».
- **Куратор и эталоны:** скрипты прогона, отчёты, сравнение с эталоном (curator_compare_to_standard), эталоны в RAG (curator_standards); единый источник возможностей Victoria (configs/victoria_capabilities.txt).
- **Библия и методология:** MASTER_REFERENCE, CHANGES, VERIFICATION_CHECKLIST §5 «При следующих изменениях»; после правок — обновлять библию.

---

## 3. Что дальше по плану (приоритеты)

### Ближайшее (уже в планах)

| Шаг | Где в плане | Действие |
|-----|-------------|----------|
| **Кураторские прогоны по расписанию** | NEXT_STEPS §4, VICTORIA_CURATOR_PLAN | **Скрипт:** `./scripts/run_curator_scheduled.sh` (полный файл задач, async, max-wait 600). Cron: `0 9 * * * cd ... && ./scripts/run_curator_scheduled.sh >> logs/curator.log 2>&1`. Разбирать по CURATOR_RUNBOOK и CURATOR_CHECKLIST; при сбоях — CURATOR_LIST_FILES_FAILURES. |
| **Эталоны в RAG** | NEXT_STEPS §3 | Накапливать эталонные ответы в standards/ и добавлять в knowledge_nodes (домен curator_standards); скрипт curator_add_standard_to_knowledge уже есть. |
| **RAG-кэш в Redis** | NEXT_STEPS §2 | При втором инстансе Victoria или общем кэше — RAG_CACHE_BACKEND=redis, общий контекст между процессами. Пока один инстанс — memory достаточно. |

### Средний срок (разрывы и рост)

| Шаг | Где | Действие |
|-----|-----|----------|
| **План оркестратора → исполнение** | VICTORIA_TASK_CHAIN_FULL §6, §7 | Решить: оставить «план только контекст» или добавить реальное исполнение по assignments (вызов run_smart_agent по списку экспертов и сбор ответов). Зафиксировать в NEXT_STEPS при доработке. |
| **TODO/FIXME backlog** | PROJECT_GAPS §1 | Закрывать или приоритизировать по TODO_FIXME_BACKLOG при правках в оркестраторе, extended_thinking, agent_protocol. |
| **Покрытие и CI** | PROJECT_GAPS §2 | Поднимать COVERAGE_FAIL_UNDER в CI после замера; при необходимости — e2e «стратегический вопрос → board → Victoria». |

### Долгий срок (масштаб и надёжность)

| Шаг | Где | Действие |
|-----|-----|----------|
| **Секреты и прод** | PROJECT_GAPS §4, VERIFICATION §5 | В проде — секрет-менеджер (Vault/облако), не пароли в .env. |
| **Мониторинг и алерты** | PROJECT_GAPS §3 | Алерты deferred_to_human уже в Grafana; при росте — мониторинг здоровья пула БД, MLX/Ollama. |
| **Дублирование src/ и knowledge_os/** | SRC_AND_KNOWLEDGE_OS_BOUNDARIES | При правках сверять границы; при необходимости выносить общую логику в один модуль. |

---

## 4. Когда корпорация станет «как я» (условные вехи)

- **Уже «как я» по базе:** один источник истины по экспертам и схеме, предсказуемая цепочка, тесты и куратор с эталонами. На этом фундаменте можно наращивать.
- **Ближе к «как я» по циклу:** регулярные прогоны куратора (5/5), разбор по чеклисту, пополнение RAG эталонами — тогда ответы Victoria стабильно ближе к эталону «как бы сделал я».
- **Полноценно «как я» по контуру:** (1) план оркестратора при желании ведёт к реальному исполнению по назначениям; (2) RAG и контекст общие при нескольких инстансах (Redis); (3) нет ручных разрывов в деплое, миграциях, экспертах — всё по runbook и тестам.

Итого: **сейчас** корпорация уже «молодцы» по связности и тестам; **дальше** — систематические прогоны куратора + эталоны в RAG; **потом** — решение по исполнению по плану и масштаб (Redis, мониторинг). Когда это закрыто, корпорация по уровню связности и предсказуемости приближается к «как я».

---

## 5. Связь с документами

- **NEXT_STEPS_CORPORATION.md** — что сделано, RAG Redis, куратор, эталоны.
- **VICTORIA_CURATOR_PLAN.md** — роль куратора, прогоны, эталоны, «лучшая корпорация в своём деле».
- **VICTORIA_TASK_CHAIN_FULL.md** — цепочка, разрывы, рекомендации.
- **PROJECT_GAPS_ANALYSIS_2026_02_05.md** — недостатки по зонам, приоритеты.
- **MASTER_REFERENCE.md** — библия; при изменениях обновлять и сюда при необходимости.
