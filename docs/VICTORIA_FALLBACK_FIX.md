# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ MLX/Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Victoria

**–î–∞—Ç–∞:** 26.01.2026  
**–ü—Ä–æ–±–ª–µ–º–∞:** Victoria Agent –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ fallback –Ω–∞ MLX/Ollama –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–≥–¥–∞ Victoria Agent (–ø–æ—Ä—Ç 8010) –Ω–µ –∑–∞–ø—É—â–µ–Ω, —á–∞—Ç –ø–æ–∫–∞–∑—ã–≤–∞–ª —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
> "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –Ω–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Victoria Agent. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º —á–∞—Ç–∞."

**Fallback –Ω–∞ MLX/Ollama –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.**

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ MLX/Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Victoria:

### –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:

1. **Victoria** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
2. **MLX API Server** (fallback –µ—Å–ª–∏ Victoria –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞) ‚úÖ
3. **Ollama** (fallback –µ—Å–ª–∏ MLX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω) ‚úÖ
4. **–¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã)

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### `backend/app/routers/chat.py`

**–ë—ã–ª–æ:**
```python
if "error" in result:
    # –ü—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    fallback_response = "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –Ω–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è..."
```

**–°—Ç–∞–ª–æ:**
```python
if "error" in result:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ MLX
    if mlx_available.get("status") == "healthy":
        result = await mlx.generate(...)
    
    # Fallback –Ω–∞ Ollama –µ—Å–ª–∏ MLX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    if result is None or "error" in result:
        result = await ollama.generate(...)
    
    # –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if result is None or "error" in result:
        fallback_response = "–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã..."
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback:**
   - –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ "–ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º"
   - –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–∏—Å

2. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç MLX/Ollama
   - –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ: `üçé [MLX Fallback]` –∏–ª–∏ `üöÄ [Ollama Fallback]`

3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
   - –ß–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ Victoria Agent –Ω–µ –∑–∞–ø—É—â–µ–Ω
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª—É—á—à–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π —Å–µ—Ä–≤–∏—Å

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ Victoria Agent: –Ω–µ –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 8010)
- ‚úÖ MLX API Server: —Ä–∞–±–æ—Ç–∞–µ—Ç (4 –º–æ–¥–µ–ª–∏ –≤ –∫—ç—à–µ)
- ‚úÖ Ollama: —Ä–∞–±–æ—Ç–∞–µ—Ç (fallback)
- ‚úÖ Backend: –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º fallback

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø—Ä–∏–≤–µ—Ç")
3. –î–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ –æ—Ç–≤–µ—Ç –æ—Ç MLX –∏–ª–∏ Ollama
4. –í –ª–æ–≥–∞—Ö backend –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   ```
   üçé [MLX Fallback] –ò—Å–ø–æ–ª—å–∑—É–µ–º MLX API Server –≤–º–µ—Å—Ç–æ Victoria
   ```
   –∏–ª–∏
   ```
   üöÄ [Ollama Fallback] –ò—Å–ø–æ–ª—å–∑—É–µ–º Ollama –≤–º–µ—Å—Ç–æ Victoria
   ```

---

## üí° –ó–∞–ø—É—Å–∫ Victoria Agent (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Victoria Agent:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Victoria Agent
cd /path/to/atra
docker-compose up -d victoria

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
cd /path/to/atra/src/victoria
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8010
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ Victoria Agent –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: 26.01.2026*
