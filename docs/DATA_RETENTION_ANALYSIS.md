# –ê–Ω–∞–ª–∏–∑ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî —á—Ç–æ –º–æ–∂–Ω–æ –∏ —á—Ç–æ –Ω–µ–ª—å–∑—è

## üö® –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ **–ù–ï –¢–†–û–ì–ê–¢–¨**

| –¢–∞–±–ª–∏—Ü–∞/–ò—Å—Ç–æ—á–Ω–∏–∫ | –ü—Ä–∏—á–∏–Ω–∞ |
|------------------|---------|
| **knowledge_nodes** | –Ø–¥—Ä–æ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π. –£–¥–∞–ª–µ–Ω–∏–µ = –ø–æ—Ç–µ—Ä—è –∑–Ω–∞–Ω–∏–π. |
| **experts** | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤. |
| **domains** | –î–æ–º–µ–Ω—ã –∑–Ω–∞–Ω–∏–π. |
| **tasks** | –ó–∞–¥–∞—á–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏. |
| **interaction_logs** | –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è, feedback. |
| **feedback.db** (SQLite) | –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. |
| **Redis rag_ctx:*, plan:*** | TTL + maxmemory-policy —É–∂–µ —É–ø—Ä–∞–≤–ª—è—é—Ç. –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –º–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å. |

## ‚úÖ –î–∞–Ω–Ω—ã–µ, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)

| –¢–∞–±–ª–∏—Ü–∞ | –£—Å–ª–æ–≤–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|---------|---------|--------------|
| **real_time_metrics** | –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (cpu_temp, tokens/s –∏ —Ç.–¥.) | –£–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –æ—á–∏—â–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. |
| **semantic_ai_cache** | –ö—ç—à –æ—Ç–≤–µ—Ç–æ–≤ (query‚Üíresponse). –ö–æ–ª–æ–Ω–∫–∞ `last_used_at`. | –û—á–∏—â–∞—Ç—å –∑–∞–ø–∏—Å–∏, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏–µ—Å—è > 90 –¥–Ω–µ–π. –¢–∞–±–ª–∏—Ü–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π. |
| **embedding_cache** (–ë–î) | –ö—ç—à —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –≤ knowledge_os. `last_used_at`. | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è atra-web-ide backend (—Ç–∞–º in-memory). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –æ—á–∏—Å—Ç–∫–∞ –ø–æ `last_used_at` > 90 –¥–Ω–µ–π. |

## ‚ö†Ô∏è –£–∂–µ –µ—Å—Ç—å

- **CacheCleanupTask** (knowledge_os) ‚Äî –æ—á–∏—â–∞–µ—Ç `semantic_ai_cache` –ø–æ `expires_at`, –Ω–æ –∫–æ–ª–æ–Ω–∫–∏ `expires_at` –Ω–µ—Ç –≤ —Å—Ö–µ–º–µ ‚Üí —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç.
- **RAG Context Cache** ‚Äî Redis —Å TTL, –∏—Å—Ç–µ–∫–∞–µ—Ç —Å–∞–º.
- **Plan cache** ‚Äî Redis —Å TTL.
- **EmbeddingBatchProcessor** ‚Äî in-memory, –æ—á–∏—â–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POST /api/rag-optimization/cache/clear`.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

1. **–ù–µ –≤–Ω–µ–¥—Ä—è—Ç—å** –º–∞—Å—Å–æ–≤—É—é –æ—á–∏—Å—Ç–∫—É `knowledge_nodes`, –∞—Ä—Ö–∏–≤–∞—Ü–∏—é, VACUUM/REINDEX –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** ‚Äî `DataRetentionManager` –æ—á–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ `real_time_metrics` –∏ `semantic_ai_cache`:
   - DRY-RUN –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `POST /api/data-retention/cleanup?dry_run=true`
   - –†–µ–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞: `POST /api/data-retention/cleanup?dry_run=false`
   - `DATA_RETENTION_DAYS=90` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. **Redis** ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å; –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ TTL –∏ `maxmemory-policy allkeys-lru`.
4. **VACUUM** ‚Äî —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–π, –ø–æ —Ä–µ—à–µ–Ω–∏—é –∞–¥–º–∏–Ω–∞, –≤–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∏.
