# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º Telegram –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ –∫–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–∂–∏–º–∞—é—Ç—Å—è –∏ –∫–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /root/atra

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python3 test_server_telegram.py
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status myproject.service

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
journalctl -u myproject.service -f
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
grep -i "token" config.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env
```

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `systemctl status myproject.service` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `inactive`
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ –∑–∞–ø—É—Å–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl start myproject.service

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status myproject.service
```

### 2. –û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- `‚ùå –û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞`
- `‚ùå HTTP –æ—à–∏–±–∫–∞: 401`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ .env
cat .env | grep TELEGRAM_TOKEN

# –û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
nano .env
```

### 3. –û—à–∏–±–∫–∞ webhook

**–°–∏–º–ø—Ç–æ–º—ã:**
- `‚ùå –û—à–∏–±–∫–∞ webhook`
- `‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏: ...`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ webhook
curl -X POST "https://api.telegram.org/bot<YOUR_TOKEN>/deleteWebhook"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl restart myproject.service
```

### 4. –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- `‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤`
- `‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ telegram_handlers`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã
ls -la telegram_handlers.py telegram_commands.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
python3 -m py_compile telegram_handlers.py
python3 -m py_compile telegram_commands.py
```

### 5. –û—à–∏–±–∫–∞ callback –∫–Ω–æ–ø–æ–∫

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–∂–∏–º–∞—é—Ç—Å—è
- `‚ùå Callback —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ telegram_handlers.py
grep -n "def button" telegram_handlers.py
grep -n "def handle_close_button" telegram_handlers.py
grep -n "def handle_accept_button" telegram_handlers.py
```

## üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
./fix_telegram_bot.sh
```

### –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl stop myproject.service

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
python3 -c "from config import TOKEN; print('Token:', TOKEN[:10] + '...' if TOKEN else 'None')"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
python3 -c "import telegram_handlers; print('Handlers OK')"

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl start myproject.service

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo systemctl status myproject.service
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–æ–π

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç):
- ‚úÖ main.py –∑–∞–ø—É—â–µ–Ω
- ‚úÖ –ë–æ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã (24 —à—Ç.)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Callback —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ä–µ–¥–∞ (–ø—Ä–æ–±–ª–µ–º—ã):
- ‚ùå –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- ‚ùå –ö–Ω–æ–ø–∫–∏ –Ω–µ –Ω–∞–∂–∏–º–∞—é—Ç—Å—è
- ‚ùå –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç

## üöÄ –ü–æ—à–∞–≥–æ–≤–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –®–∞–≥ 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
cd /root/atra
python3 test_server_telegram.py
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
```bash
sudo systemctl status myproject.service
journalctl -u myproject.service -n 20
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω
python3 -c "from config import TOKEN; print('Token:', TOKEN[:10] + '...' if TOKEN else 'None')"

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env
cat .env
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
sudo systemctl restart myproject.service
sleep 10
sudo systemctl status myproject.service
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start –±–æ—Ç—É
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç
# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫–∏
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞

- [ ] –°–µ—Ä–≤–∏—Å –∞–∫—Ç–∏–≤–µ–Ω (`systemctl is-active myproject.service`)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö (`journalctl -u myproject.service`)
- [ ] –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤–∞–ª–∏–¥–µ–Ω
- [ ] –ö–æ–º–∞–Ω–¥—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- [ ] Callback —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞–π–¥–µ–Ω—ã
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- [ ] –ö–Ω–æ–ø–∫–∏ –Ω–∞–∂–∏–º–∞—é—Ç—Å—è

## üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

6 –æ–∫—Ç—è–±—Ä—è 2025

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
