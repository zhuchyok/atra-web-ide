# –£–º–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Ollama –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ MLX

**–î–∞—Ç–∞:** 2026-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

## üéØ –¶–µ–ª—å

–ü—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ MLX API Server –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ Ollama –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏.

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ Ollama –º–æ–¥–µ–ª–∏

- **phi3.5:3.8b** (2.5 GB) - –±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á
- **moondream** (1.6 GB) - –±—ã—Å—Ç—Ä–∞—è, –ª–µ–≥–∫–∞—è vision –º–æ–¥–µ–ª—å
- **llava:7b** (4.7 GB) - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è vision –º–æ–¥–µ–ª—å –¥–ª—è PDF

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á (`local_router.py`)

**–ú–µ—Ç–æ–¥:** `_is_simple_task()`

–ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏:
- –ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã (< 500 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü—Ä–æ—Å—Ç—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: `fast`, `simple_query`, `text_summarization`, `grammar_correction`
- –ü—Ä–æ—Å—Ç–æ–π —á–∞—Ç (–±–µ–∑ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏)
- –ù–µ —Ç—Ä–µ–±—É—é—Ç reasoning

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ MLX (`local_router.py`)

**–ú–µ—Ç–æ–¥:** `_is_mlx_overloaded()`

MLX –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –µ—Å–ª–∏:
- –í—Å–µ —Å–ª–æ—Ç—ã –∑–∞–Ω—è—Ç—ã (`active_requests >= max_concurrent`)
- –ï—Å—Ç—å –æ—á–µ—Ä–µ–¥—å (`queue_size > 0`)

### 3. –£–º–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (`local_router.py`)

**–õ–æ–≥–∏–∫–∞:**
```python
if is_simple_task and mlx_overloaded:
    # –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ ‚Üí Ollama (phi3.5:3.8b)
    use_ollama_for_simple = True
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É–∑–ª–æ–≤:**
1. Ollama (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ MLX)
2. MLX (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á –∏–ª–∏ –µ—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω)
3. Fallback –Ω–∞ Ollama (–µ—Å–ª–∏ MLX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)

### 4. Task Distribution (`react_agent.py`)

**–õ–æ–≥–∏–∫–∞ –¥–ª—è ReActAgent:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É MLX —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
- –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ –∏ MLX –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama
- –î–ª—è Ollama –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `phi3.5:3.8b` (–±—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å)

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: MLX –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω
```
–ó–∞–ø—Ä–æ—Å ‚Üí MLX API Server (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: MLX –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞
```
–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ ‚Üí Ollama (phi3.5:3.8b)
–°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Üí MLX (–∂–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: MLX –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```
–õ—é–±–∞—è –∑–∞–¥–∞—á–∞ ‚Üí Ollama (fallback)
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ MLX** - –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ –∏–¥—É—Ç –Ω–∞ Ollama
2. ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á** - –Ω–µ –∂–¥—É—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ MLX
3. ‚úÖ **MLX –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á** - reasoning, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Ollama –º–æ–¥–µ–ª–∏ (`OLLAMA_MODELS`)

```python
OLLAMA_MODELS = {
    "fast": "phi3.5:3.8b",      # –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å (2.5 GB)
    "vision": "moondream",      # Vision –º–æ–¥–µ–ª—å (1.6 GB)
    "vision_pdf": "llava:7b",    # Vision –¥–ª—è PDF (4.7 GB)
    "coding": "phi3.5:3.8b",    # –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–¥–∞
    "reasoning": "phi3.5:3.8b", # –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ reasoning
    "default": "phi3.5:3.8b"    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
}
```

### –ü–æ—Ä–æ–≥–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

- **MLX –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω:** `active_requests >= max_concurrent` –∏–ª–∏ `queue_size > 0`
- **Task Distribution:** `queue_size > 3` –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ (—á–∞—Ç)
```
–ü—Ä–æ–º–ø—Ç: "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?" (20 —Å–∏–º–≤–æ–ª–æ–≤)
‚Üí –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞
‚Üí –ï—Å–ª–∏ MLX –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω ‚Üí Ollama (phi3.5:3.8b)
```

### –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ (reasoning)
```
–ü—Ä–æ–º–ø—Ç: "–ü–æ–¥—É–º–∞–π –æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å–∏—Å—Ç–µ–º—ã..." (500+ —Å–∏–º–≤–æ–ª–æ–≤)
‚Üí –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞
‚Üí MLX (–¥–∞–∂–µ –µ—Å–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –∂–¥–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏)
```

### Vision –∑–∞–¥–∞—á–∞
```
–ü—Ä–æ–º–ø—Ç: "–ß—Ç–æ –Ω–∞ —ç—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏?" + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚Üí Vision –∑–∞–¥–∞—á–∞
‚Üí Ollama (moondream –∏–ª–∏ llava:7b)
```

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
2. ‚è≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Ä–æ–≥–æ–≤ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏
