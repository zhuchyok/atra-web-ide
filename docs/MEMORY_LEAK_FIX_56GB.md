# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (Python ~56 –ì–ë)

## –ü—Ä–∏—á–∏–Ω–∞

–û–¥–∏–Ω Python-–ø—Ä–æ—Ü–µ—Å—Å (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ **Victoria** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `victoria-agent`) –ø–æ—Ç—Ä–µ–±–ª—è–ª –¥–µ—Å—è—Ç–∫–∏ –≥–∏–≥–∞–±–∞–π—Ç –∏–∑‚Äë–∑–∞ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ –ø–∞–º—è—Ç–∏:

1. **CollectiveMemorySystem** (`knowledge_os/app/collective_memory.py`)
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ Victoria –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `record_action(..., result=..., location=...)`.
   - `result` ‚Äî –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ LLM (–¥–æ —Å–æ—Ç–µ–Ω KB –Ω–∞ –∑–∞–ø—Ä–æ—Å).
   - `self.traces[location]` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–ª–µ–¥–æ–≤ –ø–æ location –±–µ–∑ –ª–∏–º–∏—Ç–∞.
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ location (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∑–∞–¥–∞—á–∏) —Ç–æ–∂–µ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–ª–æ—Å—å.
   - –ò—Ç–æ–≥: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç `traces` –∏ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–∏—Ö ‚Üí –¥–µ—Å—è—Ç–∫–∏ –ì–ë.

2. **IsolatedContext** (`knowledge_os/app/isolated_context.py`)
   - `memory` ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã.

## –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### collective_memory.py
- **MAX_TRACES_PER_LOCATION** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 200) ‚Äî –≤ –∫–∞–∂–¥–æ–π location —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–ª–µ–¥–æ–≤.
- **MAX_TRACE_RESULT_CHARS** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2000) ‚Äî –≤ –ø–∞–º—è—Ç–∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ `result`, –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è.
- **MAX_TRACE_LOCATIONS** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 500) ‚Äî –º–∞–∫—Å–∏–º—É–º –∫–ª—é—á–µ–π –≤ `self.traces`; –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —Å–∞–º–∞—è —Å—Ç–∞—Ä–∞—è location.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- `COLLECTIVE_MEMORY_MAX_TRACES_PER_LOCATION`
- `COLLECTIVE_MEMORY_MAX_RESULT_CHARS`
- `COLLECTIVE_MEMORY_MAX_LOCATIONS`

---

## –ü–æ–¥—Ä–æ–±–Ω–µ–µ: –ª–∏–º–∏—Ç 2000 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ `result`

### –ß—Ç–æ —Ç–∞–∫–æ–µ `result`

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ Victoria (—Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–ª–∞–Ω –∏ —Ç.–¥.) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:

```python
await self.collective_memory.record_action(
    agent_name="–í–∏–∫—Ç–æ—Ä–∏—è",
    action="solve",
    result=result.get("result", ""),  # ‚Üê –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ LLM
    location=category
)
```

**`result`** ‚Äî —ç—Ç–æ **–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏**: –ø–ª–∞–Ω, –æ—Ç—á—ë—Ç, –∫–æ–¥, –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ. –û–¥–∏–Ω —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å 5 KB, 50 KB –∏–ª–∏ 500 KB. –†–∞–Ω—å—à–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç —Ü–µ–ª–∏–∫–æ–º —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ –∫–∞–∂–¥–æ–º ¬´—Å–ª–µ–¥–µ¬ª (trace) –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –≤ –ë–î, —á—Ç–æ –∏ –¥–∞–≤–∞–ª–æ —Ä–æ—Å—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –¥–æ –¥–µ—Å—è—Ç–∫–æ–≤ –ì–ë.

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–∏–º–∏—Ç 2000 —Å–∏–º–≤–æ–ª–æ–≤

–ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ —Å–ª–µ–¥–∞ –≤ –ø–∞–º—è—Ç–∏ –º—ã –æ–±—Ä–µ–∑–∞–µ–º —Å—Ç—Ä–æ–∫—É:

- –µ—Å–ª–∏ `result` ‚Äî —Å—Ç—Ä–æ–∫–∞ –¥–ª–∏–Ω–Ω–µ–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí –≤ —Å–ª–µ–¥ –ø–æ–ø–∞–¥–∞–µ—Ç `result[:2000] + "..."`;
- –∏–Ω–∞—á–µ –≤ —Å–ª–µ–¥ –ø–æ–ø–∞–¥–∞–µ—Ç –≤–µ—Å—å `result`.

–¢–æ –µ—Å—Ç—å –≤ **–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏** –≤ –∫–∞–∂–¥–æ–º trace —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–µ –±–æ–ª—å—à–µ ~2 KB —Ç–µ–∫—Å—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–º–µ—Å—Ç–æ –¥–µ—Å—è—Ç–∫–æ–≤/—Å–æ—Ç–µ–Ω KB.

### –ù–∞ —á—Ç–æ —ç—Ç–æ –≤–ª–∏—è–µ—Ç

| –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `result` | –î–æ –ª–∏–º–∏—Ç–∞ | –ü–æ—Å–ª–µ –ª–∏–º–∏—Ç–∞ |
|---------------------------|-----------|--------------|
| **RAM (—Ç—Ä–∞—Å—Å–∏ –≤ –ø–∞–º—è—Ç–∏)** | –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç (–¥–æ —Å–æ—Ç–µ–Ω KB –Ω–∞ —Å–ª–µ–¥) | –ù–µ –±–æ–ª—å—à–µ 2000 —Å–∏–º–≤–æ–ª–æ–≤ (~2 KB) –Ω–∞ —Å–ª–µ–¥ ‚Üí —Å–∏–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏. |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤** (`get_environmental_context` ‚Üí `recent_actions`) | –í –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç–∞–∫ –æ—Ç–¥–∞–≤–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ `str(trace.result)[:200]` | –ü–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç–¥–∞—ë—Ç—Å—è 200 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–ª–µ–¥. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è. |
| **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã** (`successful_patterns`) | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å `str(trace.result)[:100]` | –ü–æ-–ø—Ä–µ–∂–Ω–µ–º—É 100 —Å–∏–º–≤–æ–ª–æ–≤. –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. |
| **–ë–î** (`environmental_traces`) | –í —Ç–∞–±–ª–∏—Ü—É –ø–∏—Å–∞–ª—Å—è –ø–æ–ª–Ω—ã–π `result` | –í —Ç–∞–±–ª–∏—Ü—É –ø–∏—à–µ—Ç—Å—è `str(trace.result)[:1000]` (—É–∂–µ –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –≤ –ø–∞–º—è—Ç–∏ –¥–æ 2000, –≤ –ë–î ‚Äî –¥–æ 1000). –í –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è ¬´–≤—ã–∂–∏–º–∫–∞¬ª, –Ω–µ –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç. |

–ò—Ç–æ–≥:

- **–õ–∏–º–∏—Ç –Ω—É–∂–µ–Ω –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –¥–ª—è RAM**: –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–∞–∂–¥–æ–º trace ‚Üí –º–µ–Ω—å—à–µ –æ–±—â–∏–π –æ–±—ä—ë–º —Ç—Ä–∞—Å—Å –≤ –ø–∞–º—è—Ç–∏.
- **–ù–∞ –ª–æ–≥–∏–∫—É ¬´—á—Ç–æ –≤–∏–¥—è—Ç –∞–≥–µ–Ω—Ç—ã¬ª –∏ ¬´–∫–∞–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã¬ª –ø–æ—á—Ç–∏ –Ω–µ –≤–ª–∏—è–µ—Ç**: —Ç–∞–º –∏ —Ç–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ä–µ–∑—ã (100‚Äì200 —Å–∏–º–≤–æ–ª–æ–≤). –ú–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –º—ã –Ω–µ –¥–µ—Ä–∂–∏–º –≤ –ø–∞–º—è—Ç–∏ –∏ –Ω–µ –ø–∏—à–µ–º –≤ –ë–î ¬´—Ö–≤–æ—Å—Ç¬ª –¥–ª–∏–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.
- **–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é** –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –æ—Ç–¥–∞—ë—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∞ Victoria; –æ–±—Ä–µ–∑–∫–∞ –∫–∞—Å–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≥–æ, —á—Ç–æ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** –≤ Collective Memory (–≤ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –≤ –ë–î).

–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä–æ–≥ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `COLLECTIVE_MEMORY_MAX_RESULT_CHARS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2000).

---

## –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è: –ë–î –∫–∞–∫ ¬´–ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ¬ª —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ò–¥–µ—è ¬´–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –≥–¥–µ-—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –Ω–æ –Ω–µ –≤ –ø–∞–º—è—Ç–∏, –∏ –ø–æ—Ç–æ–º –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –æ—á–∏—Å—Ç–∏—Ç—å¬ª –≤ –∫–æ–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ç–∞–∫ (–ø–æ –º–∏—Ä–æ–≤—ã–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º):

### –ö–∞–∫ —Å–¥–µ–ª–∞–Ω–æ —Å–µ–π—á–∞—Å

1. **–í –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞** ‚Äî –≤ –∫–∞–∂–¥–æ–º trace —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–±—Ä–µ–∑–∫–∞ (–¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤). –¢–∞–∫ –º—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞–µ–º RAM.
2. **–í –ë–î** (`environmental_traces.result`, —Ç–∏–ø `TEXT`) ‚Äî –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ª–µ–¥–∞ –≤ –ë–î –ø–∏—à–µ—Ç—Å—è **–ø–æ–ª–Ω—ã–π** `result` –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏. –¢–æ –µ—Å—Ç—å ¬´–º—ã—Å–ª—å¬ª –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è: –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –ª–µ–∂–∏—Ç –≤ –ë–î.
3. **–û—á–∏—Å—Ç–∫–∞** ‚Äî –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è: –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π (retention), —á—Ç–æ–±—ã –ë–î –Ω–µ —Ä–æ—Å–ª–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ. –°–∞–º–∞ —Ç–∞–±–ª–∏—Ü–∞ –∏ –µ—Å—Ç—å ¬´–ø–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ¬ª —Ö—Ä–∞–Ω–∏–ª–∏—â–µ: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Ç–∞–º –µ—Å—Ç—å, –ø–æ–∫–∞ —Å—Ç—Ä–æ–∫—É –Ω–µ —É–¥–∞–ª–∏–ª–∏ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ.

–ò—Ç–æ–≥–æ: –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç **–Ω–µ –≤ –ø–∞–º—è—Ç–∏**, –∞ **–≤ –ë–î**; –≤ –ø–∞–º—è—Ç–∏ —Ç–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–µ–≤—å—é. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑ –ë–î –ø–æ `trace_id`.

### –í–∞—Ä–∏–∞–Ω—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –±—ã –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –Ω—É–∂–Ω–æ –±—ã–ª–æ –¥–µ—Ä–∂–∞—Ç—å –∏–º–µ–Ω–Ω–æ –≤ **—Ñ–∞–π–ª–µ**, –∞ –Ω–µ –≤ –ë–î, —Ç–∏–ø–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Ç–∞–∫–æ–π:

- –ü—Ä–∏ `record_action`: –ø–æ–ª–Ω—ã–π `result` –∑–∞–ø–∏—Å–∞—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä `COLLECTIVE_MEMORY_TEMP_DIR/{trace_id}.txt`), –≤ –ø–∞–º—è—Ç—å –ø–æ–ª–æ–∂–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—Ä–µ–∑–∫—É (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ `trace_id`).
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î: –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª, –∑–∞–ø–∏—Å–∞—Ç—å –≤ `environmental_traces.result`, –∑–∞—Ç–µ–º **—É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª** ‚Äî —Ç.–µ. ¬´–ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è/–æ—Ç–ø—Ä–∞–≤–∫–∏¬ª —Ñ–∞–π–ª –æ—á–∏—â–∞–µ—Ç—Å—è, –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ë–î.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Ñ–æ–Ω–æ–≤—ã–π job —Ä–∞–∑ –≤ N —á–∞—Å–æ–≤ —É–¥–∞–ª—è–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ N —á–∞—Å–æ–≤ (–Ω–∞ —Å–ª—É—á–∞–π —Å–±–æ–µ–≤).

–°–µ–π—á–∞—Å –≤—ã–±—Ä–∞–Ω –≤–∞—Ä–∏–∞–Ω—Ç ¬´–ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ä–∞–∑—É –≤ –ë–î¬ª, –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: –ø—Ä–æ—â–µ, –º–µ–Ω—å—à–µ –¥–≤–∏–∂—É—â–∏—Ö—Å—è —á–∞—Å—Ç–µ–π, –∏ –ë–î —É–∂–µ –µ—Å—Ç—å. –í–∞—Ä–∏–∞–Ω—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ –æ—Ç–≤–µ—Ç—ã –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏ –≤ –ë–î).

### collective_memory.py (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ, –ø—Ä–∏—á–∏–Ω–∞ 56 –ì–ë)

- **MAX_AGENT_MEMORIES** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100) ‚Äî –º–∞–∫—Å–∏–º—É–º –∞–≥–µ–Ω—Ç–æ–≤ –≤ `agent_memories`; –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —Å–∞–º—ã–π ¬´—Å—Ç–∞—Ä—ã–π¬ª –∞–≥–µ–Ω—Ç. –†–∞–Ω—å—à–µ —Å–ª–æ–≤–∞—Ä—å —Ä–æ—Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ.
- **MAX_EXPERIENCE_VALUE_CHARS** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2000) ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `experience` –ø—Ä–∏ `update_individual_memory` –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `COLLECTIVE_MEMORY_MAX_AGENTS`, `COLLECTIVE_MEMORY_MAX_EXPERIENCE_CHARS`.

### isolated_context.py

- **MAX_MEMORY_ENTRIES = 100** ‚Äî –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π.
- **MAX_CONTEXTS** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 200) ‚Äî –º–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤ `ContextManager.contexts`; –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å —Å–∞–º—ã–º —Å—Ç–∞—Ä—ã–º `last_accessed`. –†–∞–Ω—å—à–µ —Å–ª–æ–≤–∞—Ä—å —Ä–æ—Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ (–∫–∞–∂–¥—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π agent+project = –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç).
- **MAX_MESSAGE_CONTENT_CHARS** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2000) ‚Äî –ø—Ä–∏ `add_memory` —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ —ç—Ç–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç LLM –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `ISOLATED_CONTEXT_MAX_CONTEXTS`, `ISOLATED_CONTEXT_MAX_MESSAGE_CHARS`.

## –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –ø—Ä–∞–≤–æ–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–ß—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å, –ø—Ä–æ—Ü–µ—Å—Å Victoria –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω.** –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å, —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å ‚Äî –ø–∞–º—è—Ç—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ 56 –ì–ë.

```bash
docker-compose -f knowledge_os/docker-compose.yml restart victoria-agent
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Ä–æ—Å—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–º Victoria –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è; –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ ‚Äî —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö.

### –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ª–∏–º–∏—Ç—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

- –í –ª–æ–≥–∞—Ö Victoria –ø—Ä–∏ eviction –ø–æ—è–≤—è—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤–∏–¥–∞: `üóëÔ∏è [MEMORY] Evicted agent ...` –∏–ª–∏ `üóëÔ∏è [MEMORY] Evicted context ...`.
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏: `docker stats victoria-agent` –∏–ª–∏ Grafana (–ø–æ—Ä—Ç 3002). –ß–µ—Ä–µ–∑ 1‚Äì2 —á–∞—Å–∞ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è, –∞ –Ω–µ —Ä–∞—Å—Ç–∏ –ª–∏–Ω–µ–π–Ω–æ.

### –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –≤—Å—ë –µ—â—ë –≤—ã—Å–æ–∫–∞—è –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

1. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω (`docker ps`, –≤—Ä–µ–º—è —Å—Ç–∞—Ä—Ç–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞).
2. –°–Ω–∏–∑–∏—Ç—å –ª–∏–º–∏—Ç—ã —á–µ—Ä–µ–∑ env –≤ `docker-compose` –∏–ª–∏ `.env`: –Ω–∞–ø—Ä–∏–º–µ—Ä `COLLECTIVE_MEMORY_MAX_LOCATIONS=100`, `COLLECTIVE_MEMORY_MAX_TRACES_PER_LOCATION=50`, `ISOLATED_CONTEXT_MAX_CONTEXTS=50`.
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏: –∫—ç—à –º–æ–¥–µ–ª–µ–π MLX (`MLX_MAX_CACHED_MODELS`), semantic_cache/embedding_optimizer (–ª–∏–º–∏—Ç—ã —É–∂–µ –µ—Å—Ç—å), –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤.

---

## Retention –¥–ª—è environmental_traces

–ß—Ç–æ–±—ã —Ç–∞–±–ª–∏—Ü–∞ `environmental_traces` –Ω–µ —Ä–æ—Å–ª–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –º–æ–∂–Ω–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏.

**–°–∫—Ä–∏–ø—Ç:** [knowledge_os/scripts/cleanup_old_traces.py](knowledge_os/scripts/cleanup_old_traces.py)

- –£–¥–∞–ª—è–µ—Ç —Å–ª–µ–¥—ã —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 90).
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `DATABASE_URL`, `TRACES_RETENTION_DAYS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 90).

**–ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é:**
```bash
cd knowledge_os/scripts && python cleanup_old_traces.py
```

**–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é (cron, —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏):**
```bash
0 3 * * * cd /path/to/atra-web-ide/knowledge_os/scripts && TRACES_RETENTION_DAYS=90 DATABASE_URL=postgresql://admin:secret@localhost:5432/knowledge_os python cleanup_old_traces.py
```
(–ü—É—Ç—å –∏ DATABASE_URL –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥ —Å–≤–æ–π —Ö–æ—Å—Ç; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é retention 90 –¥–Ω–µ–π.)

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏

- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä Victoria:** –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ RAM —Å–º–æ—Ç—Ä–µ—Ç—å –≤ `docker stats victoria-agent` –∏–ª–∏ –≤ Activity Monitor (–ø—Ä–æ—Ü–µ—Å—Å Python –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ).
- **Prometheus/Grafana:** –º–µ—Ç—Ä–∏–∫–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ Victoria ‚Äî `container_memory_usage_bytes` –ø–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É `victoria-agent` (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥). –ß—Ç–æ–±—ã –º–µ—Ç—Ä–∏–∫–∞ –±—ã–ª–∞ –≤ Prometheus, –Ω—É–∂–µ–Ω —Å–±–æ—Ä —Å Docker: cAdvisor –∏–ª–∏ node_exporter —Å docker socket; —Å–º. [docs/GRAFANA_SETUP.md](GRAFANA_SETUP.md). Grafana Web IDE ‚Äî –ø–æ—Ä—Ç 3002. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Victoria –∫–∞—Å—Ç–æ–º–Ω—É—é –º–µ—Ç—Ä–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä `process_resident_memory_bytes` —á–µ—Ä–µ–∑ Prometheus client).
- **–°–≤–æ–¥–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (—á—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ):** Collective Memory ‚Äî MAX_TRACES_PER_LOCATION, MAX_TRACE_RESULT_CHARS, MAX_TRACE_LOCATIONS, MAX_AGENT_MEMORIES, MAX_EXPERIENCE_VALUE_CHARS; IsolatedContext ‚Äî MAX_MEMORY_ENTRIES, MAX_CONTEXTS, MAX_MESSAGE_CONTENT_CHARS; –≤–æ—Ä–∫–µ—Ä ‚Äî –∞–≤—Ç–æ—Å–±—Ä–æ—Å –∑–∞–≤–∏—Å—à–∏—Ö in_progress (SMART_WORKER_STUCK_HOURS).
- –ü–æ—Å–ª–µ –≤–∫–ª—é—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ —Ä–æ—Å—Ç –ø–∞–º—è—Ç–∏ –¥–æ–ª–∂–µ–Ω —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö; –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–∏ –Ω–∞ —Ä–æ—Å—Ç ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ Victoria –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤.
