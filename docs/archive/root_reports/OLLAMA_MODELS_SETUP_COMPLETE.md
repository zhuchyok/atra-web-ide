# ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ollama –º–æ–¥–µ–ª–µ–π - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–î–∞—Ç–∞:** 2026-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê** (–º–æ–¥–µ–ª–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è)

---

## üéØ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

#### `local_router.py`:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Å–ª–æ–≤–∞—Ä—å `OLLAMA_MODELS` —Å –º–æ–¥–µ–ª—è–º–∏:
  - `fast`: `phi3.5:3.8b` (2.5 GB)
  - `vision`: `moondream` (1.6 GB)
  - `vision_pdf`: `llava:7b` (4.7 GB)
  - `default`: `phi3.5:3.8b`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `MODEL_MAP` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ollama –º–æ–¥–µ–ª–µ–π
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `_select_model()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Ollama fallback
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX

#### `vision_processor.py`:
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `_process_with_ollama_fallback()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `llava:7b` –¥–ª—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `process_pdf_page()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Moondream Station ‚Üí Ollama (moondream/llava) ‚Üí Fallback

---

## üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –º–æ–¥–µ–ª–∏

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

1. **moondream** (1.6 GB) - ‚è≥ **–£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢–°–Ø**
   - –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ë—ã—Å—Ç—Ä–∞—è –∏ –ª–µ–≥–∫–∞—è vision –º–æ–¥–µ–ª—å

2. **llava:7b** (4.7 GB) - ‚è≥ **–û–ñ–ò–î–ê–ï–¢ –û–ß–ï–†–ï–î–ò**
   - –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - –ë–æ–ª–µ–µ –º–æ—â–Ω–∞—è vision –º–æ–¥–µ–ª—å

3. **phi3.5:3.8b** (2.5 GB) - ‚è≥ **–û–ñ–ò–î–ê–ï–¢ –û–ß–ï–†–ï–î–ò**
   - –ë—ã—Å—Ç—Ä–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å
   - –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –æ–±—â–∏—Ö –∑–∞–¥–∞—á

---

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

#### –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á:
1. **MLX API Server** (–ø–æ—Ä—Ç 11435) - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1
2. **Ollama** —Å `phi3.5:3.8b` (–ø–æ—Ä—Ç 11434) - fallback
3. **–û–±–ª–∞—á–Ω—ã–µ –º–æ–¥–µ–ª–∏** - –ø–æ—Å–ª–µ–¥–Ω–∏–π fallback

#### –î–ª—è vision –∑–∞–¥–∞—á:
1. **Moondream Station** (MLX, –ø–æ—Ä—Ç 2020) - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1
2. **Ollama** —Å `moondream` - –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **Ollama** —Å `llava:7b` - –¥–ª—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **–û–±–ª–∞—á–Ω—ã–µ –º–æ–¥–µ–ª–∏** - –ø–æ—Å–ª–µ–¥–Ω–∏–π fallback

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: Fallback –Ω–∞ Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX
2. **–ì–∏–±–∫–æ—Å—Ç—å**: –†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ë—ã—Å—Ç—Ä—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á
4. **–ö–∞—á–µ—Å—Ç–≤–æ**: –ú–æ—â–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á (PDF)

---

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
ollama list

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# - moondream (1.6 GB)
# - llava:7b (4.7 GB)
# - phi3.5:3.8b (2.5 GB)
# - tinyllama:1.1b-chat (637 MB) - —É–∂–µ –±—ã–ª–∞
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω—É–∂–Ω—É—é –º–æ–¥–µ–ª—å:

```python
# –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç phi3.5:3.8b –∏–∑ Ollama
result = await router.run_local_llm(
    prompt="–ü—Ä–∏–≤–µ—Ç!",
    category="fast"
)

# Vision –∑–∞–¥–∞—á–∏ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç moondream –∏–ª–∏ llava
from vision_processor import get_vision_processor
processor = get_vision_processor()

# –û–±—ã—á–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
result = await processor.describe_image(image_path="image.jpg")

# PDF —Å—Ç—Ä–∞–Ω–∏—Ü—ã
result = await processor.process_pdf_page(image_path="pdf_page.png")
```

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ú–æ–¥–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:

| –ú–æ–¥–µ–ª—å | –†–∞–∑–º–µ—Ä | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|--------|--------|------------|----------|
| `moondream` | 1.6 GB | –°–∫—Ä–∏–Ω—à–æ—Ç—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | Ollama |
| `llava:7b` | 4.7 GB | PDF, –¥–æ–∫—É–º–µ–Ω—Ç—ã | Ollama |
| `phi3.5:3.8b` | 2.5 GB | –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ | Ollama |
| `tinyllama:1.1b-chat` | 637 MB | –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–µ –∑–∞–¥–∞—á–∏ | Ollama |

### MLX –º–æ–¥–µ–ª–∏ (8 —à—Ç—É–∫):
- `qwen2.5-coder:32b`, `deepseek-r1-distill-llama:70b`, –∏ –¥—Ä.

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Ollama –º–æ–¥–µ–ª–µ–π!**

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ MLX
- ‚úÖ –í—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —á–µ—Ä–µ–∑ moondream
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å PDF —á–µ—Ä–µ–∑ llava:7b
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å phi3.5:3.8b –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω—ã –æ –Ω–∞–ª–∏—á–∏–∏ Ollama –º–æ–¥–µ–ª–µ–π!** üéâ
