# –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π MLX API Server

**–î–∞—Ç–∞:** 26.01.2026  
**–í–æ–ø—Ä–æ—Å:** –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤—ã–≥—Ä—É–∂–µ–Ω–∞, –±—É–¥–µ—Ç –ª–∏ –æ–Ω–∞ –¥–æ–ª–≥–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ?

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏ –º–æ–¥–µ–ª–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –∫—ç—à–∞. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –º–æ–¥–µ–ª—å –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–Ω–æ–≤–æ, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è:
- **–ú–∞–ª—ã–µ –º–æ–¥–µ–ª–∏ (3-7B):** 5-15 —Å–µ–∫—É–Ω–¥
- **–°—Ä–µ–¥–Ω–∏–µ –º–æ–¥–µ–ª–∏ (32B):** 20-40 —Å–µ–∫—É–Ω–¥  
- **–ë–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ (70B+):** 60-120+ —Å–µ–∫—É–Ω–¥

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: LRU (Least Recently Used) —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π**
   - `use_count` ‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å
   - `last_used` ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - `loaded_at` ‚Äî –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
   - `load_time_seconds` ‚Äî —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–∞ –∑–∞–≥—Ä—É–∑–∫–∞

2. **–£–º–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (LRU)**
   - –ü—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è **—Å–∞–º—ã–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ** –º–æ–¥–µ–ª–∏
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Å–Ω–∞—á–∞–ª–∞ –ø–æ `use_count` (–ø–æ —É–±—ã–≤–∞–Ω–∏—é), –∑–∞—Ç–µ–º –ø–æ `last_used`
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è 1 –º–æ–¥–µ–ª—å (—Å–∞–º–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è)

3. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ**
   - –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
   - –í health check –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–±—ã—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (85-95% –ø–∞–º—è—Ç–∏)

**–î–æ –æ—á–∏—Å—Ç–∫–∏:**
- `qwen2.5-coder-32b` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ 50 —Ä–∞–∑
- `phi3.5-mini-4k` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ 5 —Ä–∞–∑
- `deepseek-r1-70b` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ 2 —Ä–∞–∑–∞

**–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:**
- ‚úÖ –û—Å—Ç–∞–µ—Ç—Å—è: `qwen2.5-coder-32b` (—Å–∞–º–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è)
- üóëÔ∏è –í—ã–≥—Ä—É–∂–µ–Ω—ã: `phi3.5-mini-4k`, `deepseek-r1-70b`

**–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ:**
- `qwen2.5-coder-32b` ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (—É–∂–µ –≤ –∫—ç—à–µ)
- `phi3.5-mini-4k` ‚Üí **20-30 —Å–µ–∫—É–Ω–¥** (–Ω—É–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞)
- `deepseek-r1-70b` ‚Üí **60-120 —Å–µ–∫—É–Ω–¥** (–Ω—É–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (>98% –ø–∞–º—è—Ç–∏)

**–î–æ –æ—á–∏—Å—Ç–∫–∏:**
- –í—Å–µ –º–æ–¥–µ–ª–∏ –≤ –∫—ç—à–µ

**–ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏:**
- üóëÔ∏è –í—ã–≥—Ä—É–∂–µ–Ω—ã **–í–°–ï** –º–æ–¥–µ–ª–∏

**–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—Ä–æ—Å–µ:**
- –õ—é–±–∞—è –º–æ–¥–µ–ª—å ‚Üí **–Ω—É–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞** (–≤—Ä–µ–º—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞)

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

```bash
# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª—è—Ö
curl http://localhost:11435/ | jq '.cached_models'

# –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
[
  {
    "name": "qwen2.5-coder-32b",
    "use_count": 50,
    "last_used": "2026-01-26T15:30:00",
    "load_time_seconds": 25.3
  },
  {
    "name": "phi3.5-mini-4k",
    "use_count": 5,
    "last_used": "2026-01-26T15:25:00",
    "load_time_seconds": 8.2
  }
]
```

### Health check —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

```bash
curl http://localhost:11435/health | jq '.cached_models'
```

---

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

### 1. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞:

```python
# –í __main__ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ uvicorn
async def preload_popular_models():
    popular_models = ["default", "coding", "fast"]  # –°–∞–º—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ
    for model_key in popular_models:
        try:
            get_model(model_key)
            logger.info(f"‚úÖ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–∞ –º–æ–¥–µ–ª—å: {model_key}")
        except Exception as e:
            logger.warning(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∏—Ç—å {model_key}: {e}")
```

### 2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ —Ñ–æ–Ω–µ**

–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–æ–¥–µ–ª—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ø–æ–∫–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å:

```python
# –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤ –∫—ç—à–µ
if model_key not in _models_cache:
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ —Ñ–æ–Ω–µ (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–∞—è –ø–∞–º—è—Ç—å)
    if memory_info["used_percent"] < 0.7:  # 70% - –µ—Å—Ç—å –∑–∞–ø–∞—Å
        asyncio.create_task(load_model_async(model_key))
```

### 3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)**

MLX –º–æ–¥–µ–ª–∏ —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –Ω–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ tokenizer –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Å–æ–≤ –≤ –ø–∞–º—è—Ç—å GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

---

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –æ—Å–Ω–æ–≤–Ω—É—é –º–æ–¥–µ–ª—å**
   - –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –∫–æ–¥–∏–Ω–≥, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `qwen2.5-coder-32b`
   - –û–Ω–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –∫—ç—à–µ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ø–∞–º—è—Ç–∏

2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, –∫–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∞—â–µ
   curl http://localhost:11435/ | jq '.cached_models | sort_by(.use_count) | reverse'
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥–∏ –ø–∞–º—è—Ç–∏**
   - –ï—Å–ª–∏ —É –≤–∞—Å –º–Ω–æ–≥–æ RAM, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `_memory_warning_threshold`
   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –¥–µ—Ä–∂–∞—Ç—å –±–æ–ª—å—à–µ –º–æ–¥–µ–ª–µ–π –≤ –∫—ç—à–µ

4. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ**
   - –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É 1-2 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
   - –û–Ω–∏ –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ä–∞–∑—É

---

## üéØ –ò—Ç–æ–≥

**–î–∞, –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ**, –Ω–æ:

‚úÖ **–ü–ª—é—Å—ã:**
- –°–∞–º—ã–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –∫—ç—à–µ
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
- –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—è –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏

‚ö†Ô∏è **–ú–∏–Ω—É—Å—ã:**
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ –≤—ã–≥—Ä—É–∑–∫–∏ –∑–∞–π–º–µ—Ç –≤—Ä–µ–º—è (5-120 —Å–µ–∫—É–Ω–¥)
- –ë–æ–ª—å—à–∏–µ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–æ–ª–≥–æ

üí° **–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –æ—Å–Ω–æ–≤–Ω—É—é –º–æ–¥–µ–ª—å –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ health check

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 26.01.2026*
