# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ MLX API Server

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –º–µ—Ç—Ä–∏–∫ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ MLX API Server.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä

### –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```bash
bash scripts/check_mlx_status.sh
```

### –ß–µ—Ä–µ–∑ curl:
```bash
# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ MLX
curl http://localhost:11435/health | python3 -m json.tool

# –ß–µ—Ä–µ–∑ backend API
curl http://localhost:8080/api/chat/mlx/metrics | python3 -m json.tool
```

---

## üìà –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### 1. **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞**
- `status`: `"healthy"` | `"degraded"` | `"warning"` | `"critical"`
- `service`: –ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
- `version`: –í–µ—Ä—Å–∏—è API

### 2. **–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—Ä–æ—Å–∞–º–∏**
- `active_requests`: –¢–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `max_concurrent`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)
- `active_model_requests`: –ó–∞–ø—Ä–æ—Å—ã –ø–æ –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "active_requests": 2,
  "max_concurrent": 5,
  "active_model_requests": {
    "qwen2.5-coder:32b": 1,
    "phi3.5:3.8b": 1
  }
}
```

### 3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**
- `memory.used_percent`: –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ (0-100)
- `memory.available_gb`: –î–æ—Å—Ç—É–ø–Ω–∞—è –ø–∞–º—è—Ç—å –≤ GB
- `memory.total_gb`: –û–±—â–∏–π –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –≤ GB
- `memory.warning_threshold`: –ü–æ—Ä–æ–≥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 85%)
- `memory.critical_threshold`: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø–æ—Ä–æ–≥ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 95%)

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "memory": {
    "used_percent": 45.2,
    "available_gb": 32.5,
    "total_gb": 64.0,
    "warning_threshold": 85.0,
    "critical_threshold": 95.0
  }
}
```

### 4. **–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏**
- `models_cached`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–µ–π –≤ –∫—ç—à–µ
- `cached_models`: –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏:
  - `name`: –ò–º—è –º–æ–¥–µ–ª–∏
  - `use_count`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
  - `last_used`: –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - `load_time_seconds`: –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
  - `active_requests`: –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏
  - `is_loading`: –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ª–∏ –º–æ–¥–µ–ª—å —Å–µ–π—á–∞—Å

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "models_cached": 3,
  "cached_models": [
    {
      "name": "qwen2.5-coder:32b",
      "use_count": 15,
      "last_used": "2026-01-26T21:30:00.000000",
      "load_time_seconds": 5.48,
      "active_requests": 1,
      "is_loading": false
    }
  ]
}
```

### 5. **Rate Limiting**
- `rate_limit.max_per_window`: –ú–∞–∫—Å–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ–∫–Ω–µ
- `rate_limit.window_seconds`: –†–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

### 6. **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**
- `warnings`: –°–ø–∏—Å–æ–∫ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π (–≤—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –∑–∞–ø—Ä–æ—Å–∞–º–∏)

---

## üîç –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤

### `healthy`
- ‚úÖ –ü–∞–º—è—Ç—å < 85%
- ‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ < –º–∞–∫—Å–∏–º—É–º–∞
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ

### `degraded`
- ‚ö†Ô∏è –ü–∞–º—è—Ç—å 85-95% –ò–õ–ò
- ‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ = –º–∞–∫—Å–∏–º—É–º—É
- ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω

### `warning`
- ‚ö†Ô∏è –ü–∞–º—è—Ç—å 85-95%
- ‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### `critical`
- üö® –ü–∞–º—è—Ç—å > 95%
- üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è
- üö® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º–æ–¥–µ–ª–µ–π

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl -s http://localhost:11435/health | python3 -c "import sys, json; d=json.load(sys.stdin); print(f\"–°—Ç–∞—Ç—É—Å: {d['status']}\"); print(f\"–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: {d['active_requests']}/{d['max_concurrent']}\"); print(f\"–ü–∞–º—è—Ç—å: {d['memory']['used_percent']}%\")"
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
watch -n 2 'curl -s http://localhost:11435/health | python3 -m json.tool | grep -A 5 "active_requests\|memory"'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏:
```bash
curl -s http://localhost:11435/health | python3 -c "import sys, json; d=json.load(sys.stdin); models=[m for m in d['cached_models'] if m['name']=='qwen2.5-coder:32b']; print(json.dumps(models[0] if models else {}, indent=2))"
```

---

## üõ†Ô∏è Endpoints

### MLX API Server (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø):
- `GET /health` - –ü–æ–ª–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å

### Backend API (—á–µ—Ä–µ–∑ ATRA Web IDE):
- `GET /api/chat/mlx/metrics` - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ MLX
- `GET /api/chat/status` - –°—Ç–∞—Ç—É—Å Victoria –∏ MLX

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏:**
   - –ü—Ä–∏ > 85% - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
   - –ü—Ä–∏ > 95% - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π

2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - –ú–∞–∫—Å–∏–º—É–º: 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ - –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è
   - LRU (Least Recently Used) –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∫—ç—à–∞ –º–æ–¥–µ–ª–µ–π

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 26.01.2026*
