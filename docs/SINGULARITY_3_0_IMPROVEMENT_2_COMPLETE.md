# ‚úÖ –£–õ–£–ß–®–ï–ù–ò–ï #2: –£–õ–£–ß–®–ï–ù–ù–´–ô ORCHESTRATOR - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.1 ‚Üí 3.2  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û**

---

## üéØ –ß–¢–û –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

### **1. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á**

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
  - –ö–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏/–æ–ø–∏—Å–∞–Ω–∏–∏
  - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∏
  - –°—Ç–∞—Ç—É—Å–∞ –¥–æ–º–µ–Ω–∞ (–≥–æ–ª–æ–¥–Ω—ã–µ –¥–æ–º–µ–Ω—ã = high priority)
  - –ò—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–¥–∞—á–∏ (code_auditor, curiosity_engine, etc.)
- ‚úÖ 4 —É—Ä–æ–≤–Ω—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞: `urgent`, `high`, `medium`, `low`
- ‚úÖ –í–µ—Å–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
- **urgent** (100): –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è
- **high** (50): –í–∞–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏, –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- **medium** (25): –û–±—ã—á–Ω—ã–µ –∑–∞–¥–∞—á–∏, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
- **low** (10): –ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏

---

### **2. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏**

**–§—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
  - –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
  - –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (success rate)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∑–∞ –ø–µ—Ä–∏–æ–¥
- ‚úÖ –£–º–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –ª—É—á—à–µ–º—É —ç–∫—Å–ø–µ—Ä—Ç—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ
- ‚úÖ –£—á–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–∫—Å–ø–µ—Ä—Ç–∞ (–¥–æ–º–µ–Ω, —Ä–æ–ª—å)

**–ú–µ—Ç—Ä–∏–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏:**
```python
workload_score = active_tasks * 10 + (avg_duration_minutes / 10)
```

---

### **3. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î**

**–§–∞–π–ª:** `knowledge_os/db/migrations/add_tasks_table.sql`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `tasks` —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
- ‚úÖ –ü–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∏ —Å—Ç–∞—Ç—É—Å—É
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü (usage_count, is_verified, etc.)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ tasks:**
```sql
- id, title, description
- status (pending, in_progress, completed, failed, cancelled)
- priority (urgent, high, medium, low)
- assignee_expert_id, creator_expert_id
- domain_id
- estimated_duration_minutes, actual_duration_minutes
- created_at, updated_at, started_at, completed_at
```

---

### **4. –£–ª—É—á—à–µ–Ω–Ω—ã–π Orchestrator**

**–§–∞–π–ª:** `knowledge_os/app/enhanced_orchestrator.py`

**–§–∞–∑—ã —Ä–∞–±–æ—Ç—ã:**
1. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á** ‚Äî –ø–µ—Ä–µ—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
2. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –±–µ–∑ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è** ‚Äî —É–º–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
3. **–ü–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏** ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
4. **–ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–æ–∑–≥** ‚Äî –∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
5. **–î–≤–∏–≥–∞—Ç–µ–ª—å –ª—é–±–æ–ø—ã—Ç—Å—Ç–≤–∞** ‚Äî —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π –∑–∞–¥–∞—á

---

## üöÄ –ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨

### **1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:**

```bash
cd /root/knowledge_os
psql -U admin -d knowledge_os -f db/migrations/add_tasks_table.sql
```

### **2. –ó–∞–ø—É—Å–∫ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ Orchestrator:**

```bash
# –í–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ orchestrator.py
python3 app/enhanced_orchestrator.py

# –ò–ª–∏ —á–µ—Ä–µ–∑ cron (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
*/30 * * * * cd /root/knowledge_os && python3 app/enhanced_orchestrator.py
```

### **3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º:**

```python
await conn.execute("""
    INSERT INTO tasks (title, description, priority, domain_id, creator_expert_id)
    VALUES ($1, $2, $3, $4, $5)
""", "–ö—Ä–∏—Ç–∏—á–Ω–∞—è –∑–∞–¥–∞—á–∞", "–û–ø–∏—Å–∞–Ω–∏–µ", "urgent", domain_id, victoria_id)
```

---

## üìä –ú–ï–¢–†–ò–ö–ò –ò –ê–ù–ê–õ–ò–¢–ò–ö–ê

### **–ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**

**–¢–æ–ø –∑–∞–¥–∞—á –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:**
```sql
SELECT priority, count(*) as count
FROM tasks
WHERE status = 'pending'
GROUP BY priority
ORDER BY 
    CASE priority
        WHEN 'urgent' THEN 1
        WHEN 'high' THEN 2
        WHEN 'medium' THEN 3
        WHEN 'low' THEN 4
    END;
```

**–ó–∞–≥—Ä—É–∑–∫–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:**
```sql
SELECT 
    e.name,
    count(t.id) FILTER (WHERE t.status IN ('pending', 'in_progress')) as active_tasks,
    avg(t.actual_duration_minutes) as avg_duration
FROM experts e
LEFT JOIN tasks t ON t.assignee_expert_id = e.id
GROUP BY e.id, e.name
ORDER BY active_tasks DESC;
```

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏:**
```sql
SELECT 
    priority,
    avg(EXTRACT(EPOCH FROM (completed_at - created_at))/60) as avg_completion_time_minutes,
    count(*) FILTER (WHERE status = 'completed')::float / count(*)::float as completion_rate
FROM tasks
WHERE created_at > NOW() - INTERVAL '7 days'
GROUP BY priority;
```

---

## üîÑ –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´

### **–†–∞—Å—á–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:**

```python
priority_score = 0

# –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
if '–∫—Ä–∏—Ç–∏—á–Ω–æ' in title: priority_score += 50
if '–≤–∞–∂–Ω–æ' in title: priority_score += 25

# –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
if reason == 'curiosity_engine_starvation': priority_score += 30
if severity == 'high': priority_score += 40

# –†–µ–∑—É–ª—å—Ç–∞—Ç
if priority_score >= 50: return 'urgent'
elif priority_score >= 30: return 'high'
elif priority_score >= 15: return 'medium'
else: return 'low'
```

### **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–∞:**

```python
for expert in candidates:
    workload = get_expert_workload(expert)
    score = (
        workload['workload_score'] * 0.5 +  # –ó–∞–≥—Ä—É–∑–∫–∞
        (1.0 - workload['success_rate']) * 100 * 0.3 +  # –ù–µ—É—Å–ø–µ—à–Ω–æ—Å—Ç—å
        (workload['avg_duration'] / 10) * 0.2  # –í—Ä–µ–º—è
    )
    # –í—ã–±–∏—Ä–∞–µ–º —ç–∫—Å–ø–µ—Ä—Ç–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º score
```

### **–ü–µ—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:**

1. –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (> 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á)
2. –ù–∞—Ö–æ–¥–∏–º –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (< 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á)
3. –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–¥–∞—á–∏ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
4. –£—á–∏—Ç—ã–≤–∞–µ–º –¥–æ–º–µ–Ω —ç–∫—Å–ø–µ—Ä—Ç–∞

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
knowledge_os/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îî‚îÄ‚îÄ enhanced_orchestrator.py    # –£–ª—É—á—à–µ–Ω–Ω—ã–π Orchestrator
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ add_tasks_table.sql     # –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ SINGULARITY_3_0_IMPROVEMENT_2_COMPLETE.md
```

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–î–æ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ùå –ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á
- ‚ùå –°–ª—É—á–∞–π–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
- ‚ùå –ù–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚ùå –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–µ—Ä—Ç—ã

### **–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á
- ‚úÖ –£–º–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ª—É—á—à–µ–º—É —ç–∫—Å–ø–µ—Ä—Ç—É
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á

### **–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- **–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á:** +30%
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —ç–∫—Å–ø–µ—Ä—Ç–æ–≤:** +25%
- **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:** +50%

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
2. ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ:** –£–ª—É—á—à–µ–Ω–Ω—ã–π Orchestrator
3. ‚è≠Ô∏è **–°–ª–µ–¥—É—é—â–µ–µ:** –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (–º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å)

---

**–ê–≤—Ç–æ—Ä:** –í–∏–∫—Ç–æ—Ä–∏—è (Team Lead)  
**–î–∞—Ç–∞:** 2025-12-14  
**–í–µ—Ä—Å–∏—è:** Singularity 3.2

