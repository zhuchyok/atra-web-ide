# Непрерывное улучшение качества RAG

Процесс мониторинга и улучшения качества ответов после Фазы 4.

---

## Цикл улучшения

1. **Сбор данных:** запросы, ответы, контекст, рейтинги пользователей (FeedbackCollector).
2. **Оценка:** автоматическая по faithfulness, relevance, coherence на validation set и/или на сэмпле прод-трафика.
3. **Анализ:** выявление типов запросов с низкими метриками; A/B тесты новых моделей/параметров.
4. **Внедрение:** канареечное развёртывание; откат при падении метрик ниже порога.
5. **Калибровка:** периодическое обновление validation set и порогов по результатам человеческой оценки.

---

## Регулярные активности

| Частота | Действие |
|---------|----------|
| При каждом PR | Запуск `evaluate_rag_quality.py` на validation set; блокировка мержа при падении ниже порогов (опционально). |
| Ежедневно | Прогон оценки на сэмпле запросов; экспорт метрик в Prometheus/Grafana. |
| Еженедельно | Разбор низких оценок; пополнение validation set проблемными примерами. |
| Ежемесячно | Пересмотр порогов и целей по метрикам; ретрайн/дообучение при наличии разметки. |

---

## Пороги и откат

- Настройка порогов в `docs/QUALITY_METRICS.md`.
- При падении faithfulness/relevance ниже порога в CI — предупреждение или блок мержа.
- В проде: канареечный процент трафика на новую модель; при ухудшении метрик — автоматический откат на стабильную версию.

---

## Связь с документацией

- План Фазы 4: `docs/PHASE4_PLAN.md`
- Метрики: `docs/QUALITY_METRICS.md`
- Мультимодальность: `docs/MULTIMODAL_SETUP.md`
